define("modules/clean/admin/megaphone/prompt/api/utils",["require","exports","tslib"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o;(function(e){var t=function(e){return e.replace(/_(.)/g,function(e,t){return t.toUpperCase()})},n=function(e){return e.replace(/([a-z\d])([A-Z0-9])/g,function(e,t,n){return t+"_"+n.toLowerCase()})},o=function(e,t){if(null===t)return null;if(Array.isArray(t)){var n=[];return t.forEach(function(t){n.push(o(e,t))}),n}if("object"==typeof t){var r={};return Object.keys(t).forEach(function(n){r[e(n)]=o(e,t[n])}),r}return t},r=function(e,t){return o(e,t)},i=function(e){var t={},o=r(n,e);return Object.keys(o).forEach(function(e){o[e]&&o[e].id?t[e]=o[e].id:t[e]=o[e]}),t.approved=!(!t.approved_time&&!t.approved_user),delete t.approved_time,delete t.approved_user_id,t.start_time_enabled=!!t.ad&&!!t.ad.start_time,t.end_time_enabled=!!t.ad&&!!t.ad.end_time,t.remind_me_later_enabled=!!t.remind_me_later_type,t.remind_me_later_enabled||(t.remind_me_later_type=null,t.remind_me_later_delay=null),Object.keys(t).forEach(function(e){"boolean"==typeof t[e]&&(t[e]=t[e]?"on":"off")}),t.upsell_promo_spec=t.cash_promo,delete t.cash_promo,delete t.id,delete t.created_time,delete t.promo_params,delete t.updated_time,delete t.user,delete t.locale,t};e.requestDataFromCampaignAndVersion=function(e,t){var o=i(e),s=r(n,t.content);delete o.content;var a=["modal_type"];return Object.keys(s).forEach(function(e){if(a.includes(e))o[e]=s[e];else{if(null===s[e])return;var t=void 0;t=Array.isArray(s[e])?s[e].join("\n"):s[e],o["content["+e+"]"]=t}}),o.stormcrow_variant=t.stormcrowVariant,"content[image_url]"in o&&(o["content[image]"]=o["content[image_url]"],delete o["content[image_url]"]),"content[cancel_with_xIcon]"in o&&(o["content[cancel_with_x_icon]"]=o["content[cancel_with_xIcon]"],delete o["content[cancel_with_xIcon]"]),Object.keys(o).forEach(function(e){"boolean"==typeof o[e]&&(o[e]=o[e]?"on":"off")}),o},e.toCamelCase=function(e){return r(t,e)},e.jsonToCamelCase=function(t){var n=JSON.parse(t);return e.toCamelCase(n)},e.stringToCamelCase=function(e){return t(e)}})(o=t.APIUtils||(t.APIUtils={})),t.isCampaignResult=function(e){return void 0===e.active},t.campaignResultToCampaign=function(e){return{active:"approved"===e.lifecycle_state[".tag"]&&!!e.ad&&!!e.ad.lifecycle_state&&"active"===e.ad.lifecycle_state[".tag"],ad:e.ad?{end_time:0,priority:0,start_time:0}:null,approved_time:0,approved_user_id:e.approved_user_id,archived:"archived"===e.lifecycle_state[".tag"],campaign_type:{global_dismiss_duration:"",global_dismiss_ns:"",id:e.campaign_type_id,max_dismiss_count:0,name:e.campaign_type_name,description:"",priority:0,recycle_delays:[],cash_promos:[]},cash_promo:null,content:{},created_time:0,description:e.description,for_logged_in:!!e.for_logged_in,for_logged_out:!!e.for_logged_out,id:e.id?e.id:0,locale:{supported_locales:[],translated_locales:[]},location:e.location_id,name:e.name,new_user_grace_period:null,remind_me_later_type:null,remind_me_later_delay:null,source_locale:{id:e.source_locale_id||"",name:e.source_locale_name},stormcrow_feature:e.stormcrow_feature,stormcrow_variant:"",tags:[],updated_time:0,user:{id:0}}},t.versionResultToVersion=function(e){var t=o.toCamelCase(n.__assign({},e.content));return delete t[".tag"],{id:0,name:"",stormcrowVariant:"",content:t}},t.isVersion=function(e){return void 0!==e.id},t.isCreateVersionArg=function(e){return void 0===e.id},t.versionResultToUpdateVersionArg=function(e){return{id:e.id,content:e.content,description:e.description,name:e.name,stormcrow_variant:e.stormcrow_variant}},t.isAdActive=function(e){return!!e.ad&&!!e.ad.lifecycle_state&&"active"===e.ad.lifecycle_state[".tag"]},t.isCampaignArchived=function(e){return"archived"===e.lifecycle_state[".tag"]},t.isCampaignApproved=function(e){return"approved"===e.lifecycle_state[".tag"]},t.isVersionApproved=function(e){return"approved"===e.lifecycle_state[".tag"]},t.isVersionArchived=function(e){return"archived"===e.lifecycle_state[".tag"]}}),define("modules/clean/ajax_minimal",["require","exports"],function(e,t){"use strict";function n(e){var t=document.cookie.match("(^|; )"+e+"=([^;]*)");return t?t[2]:""}function o(e,t){var o=new XMLHttpRequest;o.open("POST",e),o.withCredentials=!0,o.setRequestHeader("X-CSRF-Token",n("__Host-js_csrf")),o.send(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.post=o}),define("modules/clean/deprecated/uirequest",["require","exports","external/lodash","jquery","modules/clean/ajax","modules/clean/css","modules/clean/dbmodal","modules/clean/legacy_pyxl_controllers/ajax_form","modules/core/html","modules/core/i18n","modules/core/notify","modules/pagelet_config"],function(e,t,n,o,r,i,s,a,c,p,l,u){"use strict";return(function(){function e(e,t,o){if(null==o&&(o={}),this.success=this.success.bind(this),this.perform_actions=this.perform_actions.bind(this),this.error=this.error.bind(this),this.handle_errors=this.handle_errors.bind(this),this.complete=this.complete.bind(this),this.$node=e,this.url=t,this.options=o,this.shouldDelayComplete=!1,this.$node.hasClass("ajax-loading"))return!1;this.$node.addClass("ajax-loading"),r.FormWebRequest({url:this.url,type:null!=this.options.type?this.options.type:void 0,data:this.options.data||{},success:this.success,error:this.error,complete:this.complete,subject_user:this.options.subject_user,headers:n.assignIn({"X-RequireJS-Context":u.REQUIREJS_CONFIG.context,"X-UIRequest-Version":3},this.options.headers)})}return e.prototype.success=function(e,t,n){var o=this,r=a.extract_errors(n.responseText);return r?(this.handle_errors(r),void("function"==typeof this.options.error&&this.options.error(n,t))):(e=JSON.parse(n.responseText),e.redirect?void(window.location.href=e.redirect):e.reload?void window.location.reload():(this.shouldDelayComplete=e.js||e.css,this.shouldDelayComplete?i.require_css_multi(e.css,function(){return o.perform_actions(e.actions||[]),"function"==typeof o.options.success&&o.options.success(e,t,n),o.$node.removeClass("ajax-loading"),"function"==typeof o.options.complete?o.options.complete(n,t):void 0}):(this.perform_actions(e.actions||[]),void("function"==typeof this.options.success&&this.options.success(e,t,n)))))},e.prototype.perform_actions=function(e){var t=this;return(function(){for(var n=[],r=0,i=Array.from(e);r<i.length;r++){var a=i[r],p=Array.from(a),u=p[0],m=p[1],d=p[2],h=t.$node;if(d&&"modal"!==u){if("^"===d.charAt(0)){var f=d.split(" ");h=h.closest(f[0].substr(1)),d=f.slice(1).join(" ")}d&&(h=h.find(d).filter(":first"))}switch(u){case"modal":;o("#db-modal-response-modal-placeholder").remove();var _=o(m);_.attr("id","db-modal-response-modal-placeholder"),o("body").append(_);var g=new s.DBModal({element_id:"response-modal-placeholder"});n.push(g.show());break;case"html":n.push(h.html(m));break;case"replaceWith":n.push(h.replaceWith(m));break;case"after":m?n.push(h.after(m)):n.push(void 0);break;case"before":m?n.push(h.before(m)):n.push(void 0);break;case"toggleClass":n.push(h.toggleClass(m));break;case"addClass":n.push(h.addClass(m));break;case"removeClass":n.push(h.removeClass(m));break;case"notify":n.push(l.success(m));break;case"notifyError":n.push(l.error(new c(m),t.options.errorDuration||void 0));break;default:n.push(void 0)}}return n})()},e.prototype.error=function(e,t,n){var o=a.extract_errors(e.responseText);return"abort"!==t&&this.handle_errors(o),"function"==typeof this.options.error?this.options.error(e,t,n):void 0},e.prototype.handle_errors=function(e){if(e===!1)return l.error(p._("There was a problem completing this request."));if("string"==typeof e){var t=void 0;return t=this.options.html_in_error_msg?new c(e):e,l.error(t)}return a.fill_errors(this.$node,e)},e.prototype.complete=function(e,t){if(!this.shouldDelayComplete)return this.$node.removeClass("ajax-loading"),"function"==typeof this.options.complete?this.options.complete(e,t):void 0},e})()}),define("modules/clean/prompt/api/rendering",["require","exports"],function(e,t){"use strict";function n(e){return void 0!==e.remindMeLaterText}Object.defineProperty(t,"__esModule",{value:!0}),t.isHomeModalContent=n}),define("modules/clean/prompt/ha_loader",["require","exports","modules/clean/admin/megaphone/prompt/api/utils","external/react","external/react-dom","modules/clean/ajax","modules/clean/upsell/exception","modules/clean/react/prompt/ha"],function(e,t,n,o,r,i,s,a){"use strict";function c(e){if(!e.userID)return Promise.reject(null);var t=document.querySelector("#prompt-silo .ha-silo");return new Promise(function(c,p){try{i.SilentBackgroundRequest({url:"/prompt/ha",subject_user:e.userID,data:{ref_controller:e.controller,ref_action:e.action}}).then(function(i){var s=n.APIUtils.jsonToCamelCase(i);s.campaign&&(s.subjectUser=e.userID,r.render(o.createElement(a.HA,s),t)),c()})}catch(t){s.reportException({err:t,tags:[s.TAGS.PROMPT_HA_LOADER],exc_extra:{param_user_id:e.userID,param_controller:e.controller,param_action:e.action}}),p()}})}Object.defineProperty(t,"__esModule",{value:!0}),t.initialize_module=c}),define("modules/clean/prompt/react_loader",["require","exports","modules/clean/admin/megaphone/prompt/api/utils","external/react","external/react-dom","modules/clean/upsell/exception","modules/clean/react/prompt/header_link","modules/clean/react/prompt/header_bubble","modules/clean/react/prompt/home_modal"],function(e,t,n,o,r,i,s,a,c){"use strict";function p(e){if(e.userID)for(var t=0,p=e.campaigns;t<p.length;t++){var u=p[t];try{var m=n.APIUtils.toCamelCase(u);if(m&&m.campaign)switch(m.subjectUser=e.userID,m.campaign.campaignLocationId){case"HEADER_LINK":var d=l(e);d&&r.render(o.createElement(s.HeaderLink,m),d);break;case"HEADER_BUBBLE":var h=l(e);h&&r.render(o.createElement(a.HeaderBubble,m),h);break;case"HOME_MODAL":c.HomeModal.showInstance(m)}}catch(t){i.reportException({err:t,tags:[i.TAGS.PROMPT_REACT_LOADER],exc_extra:{param_user_id:e.userID,param_controller:e.controller,param_action:e.action,param_campaign_response:u}})}}}function l(e){var t="#prompt-silo .account-header-react-silo",n=document.querySelector(t);return n||i.reportException({err:new Error("Could not locate mount point "+t),tags:[i.TAGS.PROMPT_REACT_LOADER],exc_extra:{param_user_id:e.userID,param_controller:e.controller,param_action:e.action}}),n}Object.defineProperty(t,"__esModule",{value:!0}),t.initialize_react=p}),define("modules/clean/react/prompt/button",["require","exports","tslib","external/classnames","external/purify","external/react","modules/core/cookies","modules/clean/prompt/api/rendering"],function(e,t,n,o,r,i,s,a){"use strict";function c(e){return e?{__html:r.sanitize(e)}:void 0}function p(e){function t(){return e.campaign.content.confirmText?i.createElement(l,{className:"button-primary",confirmInNewTab:e.campaign.content.confirmInNewTab,confirmIsPost:e.confirmIsPost,confirmUrl:e.confirmUrl,onConfirm:e.onConfirm,html:e.campaign.content.confirmText}):null}function n(){var t=e.campaign,n=e.onRemindMeLater;return a.isHomeModalContent(t.content)&&t.content.remindMeLaterText&&n?i.createElement(u,{className:"remind-me-later cancel-button button-tertiary",onDismiss:n,html:t.content.remindMeLaterText}):null}function r(){var t=e.campaign,n=e.onDismiss,r=e.onRemindMeLater,s={"cancel-button":!0};return t.content.cancelText?(a.isHomeModalContent(t.content)&&t.content.remindMeLaterText&&r?s["cancel-link"]=!0:s["button-tertiary"]=!0,i.createElement(u,{className:o(s),onDismiss:n,html:t.content.cancelText||void 0})):null}return i.createElement("div",{className:"upsell-buttons"},t(),n(),r())}Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeOptionalHTML=c;var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=o(this.props.className,{"confirm-button":!0,enabled:!0});if(this.props.confirmIsPost){var t=s.read("__Host-js_csrf");return i.createElement("form",{className:"form-button-primary",action:this.props.confirmUrl,method:"POST",target:this.getTarget(),onSubmit:this.props.onConfirm},i.createElement("input",{type:"hidden",name:"t",value:t}),i.createElement("button",{type:"submit",className:e,dangerouslySetInnerHTML:c(this.props.html)},this.props.children))}return i.createElement("a",{href:this.props.confirmUrl,className:e,target:this.getTarget(),dangerouslySetInnerHTML:c(this.props.html),onClick:this.props.onConfirm},this.props.children)},t.prototype.getTarget=function(){return this.props.confirmInNewTab?"_blank":"_self"},t})(i.Component);t.ConfirmButton=l;var u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=o(this.props.className,{"dismiss-button":!0,enabled:!0});return i.createElement("a",{href:"#",className:e,dangerouslySetInnerHTML:c(this.props.html),onClick:this.props.onDismiss},this.props.children)},t})(i.Component);t.DismissButton=u,t.PromptButtons=p}),define("modules/clean/react/prompt/campaign_state_manager",["require","exports","tslib","modules/core/uri","modules/clean/upsell/upsell_controller","modules/clean/upsell/prompt_event_logger"],function(e,t,n,o,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e){var t=this;this.onShow=function(){t.component.state.isShown||(t.component.setState(function(e){return n.__assign({},e,{isShown:!0})}),t.eventLogger.triggerExternalEvent(r.ON_SHOW_EVENT_NAME),t.eventLogger.recordClientImpression())},this.onConfirm=function(e){t.confirm(),t.component.props.campaign.content.confirmInNewTab||t.getShouldUsePost()||e.preventDefault()},this.onDismiss=function(e,o){t.isAckInProgress()||(t.component.setState(function(e){return n.__assign({},e,{isDismissed:!0})}),e.preventDefault(),t.eventLogger.triggerExternalEvent(r.PRE_DISMISS_EVENT_NAME),t.eventLogger.recordDismiss(o&&o.remindMeLater))},this.attachListenersToChildren=function(e,n,o){if(e){for(var r=e.querySelectorAll(".confirm-button"),i=0;i<r.length;i++)r[i].addEventListener("click",n||t.onConfirm);for(var s=e.querySelectorAll(".dismiss-button, .db-modal-x, .db-modal-overlay"),i=0;i<s.length;i++)s[i].addEventListener("click",o||t.onDismiss)}},this.component=e,this.eventLogger=new i.PromptEventLogger(this.component.props)}return e.prototype.getConfirmUrl=function(){if("#"===this.component.props.campaign.content.confirmUrl)return"#";var e=this.eventLogger.getUpsellControllerURI("/prompt/confirm_v2"),t=this.component.props.campaign.content.confirmIsPost,n=this.getRedirectURL();return n&&e.updateQuery({redirect_url:n}),t&&e.updateQuery({preserve_post:"1"}),e.toString()},e.prototype.getShouldUsePost=function(){return!!(this.component.props.campaign.content.confirmUrl&&"#"!==this.component.props.campaign.content.confirmUrl||this.component.props.campaign.content.confirmIsPost)},e.prototype.confirm=function(){this.isAckInProgress()||(this.component.setState(function(e){return n.__assign({},e,{isConfirmed:!0})}),this.eventLogger.triggerExternalEvent(r.PRE_CONFIRM_EVENT_NAME),this.getShouldUsePost()||this.eventLogger.recordConfirm())},e.prototype.getRedirectURL=function(){if(this.component.props.campaign.addTkParams&&this.getShouldUsePost()){var e=o.parse(this.component.props.campaign.content.confirmUrl),t=this.component.props.campaign.versionId;return null==t&&(t=this.component.props.campaign.campaignId),e.updateQuery({_tk:this.component.props.campaign.campaignLocationTkId,_camp:t.toString()}),e.toString()}return this.component.props.campaign.content.confirmUrl},e.prototype.isAckInProgress=function(){return this.component.state.isConfirmed||this.component.state.isDismissed},e})();t.CampaignStateManager=s}),define("modules/clean/react/prompt/ha",["require","exports","tslib","jquery","external/classnames","external/react","external/react-dom","modules/clean/react/css","modules/clean/react/sprite","modules/clean/upsell/prompt_event_emitter","modules/clean/react/prompt/button","modules/clean/react/prompt/image","modules/clean/react/prompt/prompt_location","modules/core/i18n"],function(e,t,n,o,r,i,s,a,c,p,l,u,m,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h;(function(e){e[e.HIDE=1]="HIDE",e[e.NO_IMAGE=2]="NO_IMAGE",e[e.SHOW=3]="SHOW"})(h=t.ShowState||(t.ShowState={})),t.UpdateInterval=1e3;var f=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderImage=function(){var e=this.props.content;return e.imageUrl?i.createElement(l.ConfirmButton,{className:"confirm-button--illustration",confirmInNewTab:e.confirmInNewTab,confirmIsPost:this.props.confirmIsPost,confirmUrl:this.props.confirmUrl,onConfirm:this.props.onConfirm},i.createElement(u.Image,{src:e.imageUrl,srcHiRes:e.imageUrlHiRes,alt:e.confirmText,onLoad:this.props.onImageLoad})):null},t.prototype.renderText=function(){var e=this.props.content;return i.createElement("p",null,i.createElement(l.ConfirmButton,{confirmInNewTab:e.confirmInNewTab,confirmIsPost:this.props.confirmIsPost,confirmUrl:this.props.confirmUrl,html:e.text,onConfirm:this.props.onConfirm}))},t.prototype.renderConfirmButton=function(){var e=this.props.content;return e.confirmText?i.createElement(l.ConfirmButton,{className:"button",confirmInNewTab:e.confirmInNewTab,confirmIsPost:this.props.confirmIsPost,confirmUrl:this.props.confirmUrl,html:e.confirmText,onConfirm:this.props.onConfirm}):null},t.prototype.renderDismissButton=function(){return i.createElement(l.DismissButton,{onDismiss:this.props.onDismiss,"aria-label":d._("Close")},i.createElement(c,{group:"web",name:"close_small",alt:d._("Close")}))},t.prototype.render=function(){var e=this.props.isDismissed,t=r({ha:!0,"no-image":!e&&this.props.showState===h.NO_IMAGE,visible:!e&&this.props.showState===h.SHOW,invisible:this.props.isInvisible});return i.createElement("div",{className:t},this.renderImage(),this.renderText(),this.renderConfirmButton(),this.renderDismissButton())},t.displayName="HARendererWithoutCSS",t})(i.Component);t.HARendererWithoutCSS=f,t.HARendererWithCSS=a(f,["/static/css/upsell/prompt_pagelet-vflitEcp8.css"]);var _=(function(e){function r(t){var n=e.call(this,t,{cloneShowState:h.SHOW,isConfirmed:!1,isDismissed:!1,isShown:!1,showState:h.HIDE})||this;return n.setHaRef=function(e){n.ha=e},n.setHaCloneRef=function(e){n.haClone=e},n.onPageUpdate=n.onPageUpdate.bind(n),n}return n.__extends(r,e),r.prototype.componentDidMount=function(){this.onUpdate(),o(window).resize(this.onPageUpdate),p.Emitter.addListener(p.Events.REACT_HA_DID_UPDATE,this.onPageUpdate),this.intervalID=setInterval(this.onPageUpdate,t.UpdateInterval)},r.prototype.componentWillUnmount=function(){o(window).off("resize",this.onPageUpdate),p.Emitter.off(p.Events.REACT_HA_DID_UPDATE,this.onPageUpdate),clearInterval(this.intervalID)},r.prototype.componentDidUpdate=function(){this.onUpdate()},r.prototype.onPageUpdate=function(){this.setState(function(e){return e.cloneShowState=h.SHOW,e})},r.prototype.onUpdate=function(){var e=this;if(this.state.cloneShowState>h.HIDE&&this.canFit())this.state.showState!==this.state.cloneShowState&&this.setState(function(e){return e.showState=e.cloneShowState,e},function(){e.state_manager.onShow()});else{var t=this.state.cloneShowState-1;t>h.HIDE?this.setState(function(e){return e.cloneShowState=t,e}):this.state.showState!==h.HIDE&&this.setState(function(e){return e.showState=h.HIDE,e})}},r.prototype.render=function(){return i.createElement("div",null,i.createElement(t.HARendererWithCSS,{isInvisible:!1,content:this.props.campaign.content,confirmUrl:this.state_manager.getConfirmUrl(),confirmIsPost:this.state_manager.getShouldUsePost(),isDismissed:this.state.isDismissed,onConfirm:this.state_manager.onConfirm,onDismiss:this.state_manager.onDismiss,ref:this.setHaRef,showState:this.state.showState}),i.createElement(t.HARendererWithCSS,{isInvisible:!0,content:this.props.campaign.content,confirmUrl:this.state_manager.getConfirmUrl(),confirmIsPost:this.state_manager.getShouldUsePost(),isDismissed:this.state.isDismissed,onConfirm:this.state_manager.onConfirm,onDismiss:this.state_manager.onDismiss,onImageLoad:this.onPageUpdate,ref:this.setHaCloneRef,showState:this.state.cloneShowState}))},r.prototype.canFit=function(){var e=this.getMenuHeight();if(null===e)return!1;var t=this.getHAHeight();return null!==t&&e+t<=this.getWindowHeight()},r.prototype.getHAHeight=function(){var e=o(s.findDOMNode(this.haClone));if(0===e.length)return null;return e.outerHeight()+75},r.prototype.getMenuHeight=function(){var e=o(".maestro-secondary-sidebar, .appactions-menu").first();if(0===e.length)return null;var t=e.children(),n=e.offset().top-o(document).scrollTop();return t.each(function(e,t){n+=o(t).outerHeight(!0)}),n},r.prototype.getWindowHeight=function(){return o(window).height()},r})(m.PromptLocation);t.HA=_}),define("modules/clean/react/prompt/header_bubble",["require","exports","tslib","external/react","external/classnames","modules/clean/react/css","modules/clean/react/prompt/prompt_location","modules/clean/react/prompt/header_link","modules/clean/react/prompt/image","modules/clean/react/prompt/button"],function(e,t,n,o,r,i,s,a,c,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.state_manager.onShow()},t.prototype.render=function(){var e=this.props.campaign.content,t=o.createElement("div",null,o.createElement("p",{className:"message",dangerouslySetInnerHTML:p.sanitizeOptionalHTML(e.text),ref:this.state_manager.attachListenersToChildren}),o.createElement(p.PromptButtons,{campaign:this.props.campaign,confirmIsPost:this.state_manager.getShouldUsePost(),confirmUrl:this.state_manager.getConfirmUrl(),onConfirm:this.state_manager.onConfirm,onDismiss:this.state_manager.onDismiss})),n=r({"header-bubble-container":!0,show:!0,"header-bubble-container--with-image":!!e.imageUrl}),i=e.imageUrl?[o.createElement("div",{className:"left"},o.createElement(p.ConfirmButton,{className:"image-button",confirmInNewTab:e.confirmInNewTab,confirmUrl:this.state_manager.getConfirmUrl(),confirmIsPost:this.state_manager.getShouldUsePost(),onConfirm:this.state_manager.onConfirm},o.createElement(c.Image,{src:e.imageUrl,srcHiRes:e.imageUrlHiRes,alt:e.confirmText}))),o.createElement("div",{className:"right"},t)]:[t],s=["top-level-nav-item"];return this.state.isConfirmed||this.state.isDismissed||s.push("active"),o.createElement("li",{className:s.join(" ")},o.createElement(a.HeaderLinkRendererWithoutCSS,{content:e,confirmUrl:this.state_manager.getConfirmUrl(),onConfirm:this.state_manager.onConfirm}),o.createElement("div",{className:"sub-nav chat-bubble header-bubble upsell-bubble",id:"upsell-bubble"},o.createElement("div",{className:n},i,o.createElement("div",{className:"chat-bubble-arrow-border"}),o.createElement("div",{className:"chat-bubble-arrow"}))))},t.displayName="HeaderBubbleWithoutCSS",t})(s.PromptLocationWithDefaultState);t.HeaderBubbleWithoutCSS=l,t.HeaderBubble=i(l,["/static/css/upsell/prompt_pagelet-vflitEcp8.css"])}),define("modules/clean/react/prompt/header_link",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/prompt/prompt_location","modules/clean/react/sprite_div"],function(e,t,n,o,r,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.content,t=["confirm-button","header-nav-link","enabled"];e.linkPretext&&t.push("header-nav-link--bold");var n;n=e.linkIcon?o.createElement("a",{className:t.join(" "),href:this.props.confirmUrl,onClick:this.props.onConfirm},o.createElement(s,{group:"web",name:e.linkIcon,text:e.linkText})):o.createElement("a",{className:t.join(" "),href:this.props.confirmUrl,onClick:this.props.onConfirm},e.linkText);var r=n;return e.linkPretext&&(r=o.createElement("div",{className:"header-nav-link--space"},o.createElement("span",{className:"header-link__pretext"},e.linkPretext),n)),o.createElement("div",{className:"header-link"},r)},t.displayName="HeaderLinkRendererWithoutCSS",t})(o.Component);t.HeaderLinkRendererWithoutCSS=a;var c=r(a,["/static/css/upsell/prompt_pagelet-vflitEcp8.css"]),p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.state_manager.onShow()},t.prototype.render=function(){return o.createElement("li",{className:"top-level-nav-item"},o.createElement(c,{content:this.props.campaign.content,confirmUrl:this.state_manager.getConfirmUrl(),onConfirm:this.state_manager.onConfirm}))},t})(i.PromptLocationWithDefaultState);t.HeaderLink=p}),define("modules/clean/react/prompt/home_modal",["require","exports","tslib","external/react","external/classnames","modules/core/i18n","modules/clean/react/css","modules/clean/react/prompt/prompt_location","modules/clean/react/prompt/image","modules/clean/react/modal","modules/clean/react/prompt/button","modules/clean/user_education/user_education_client","modules/clean/user_education/user_education_loader","modules/clean/upsell/prompt_event_logger"],function(e,t,n,o,r,i,s,a,c,p,l,u,m,d){"use strict";function h(e){u.UEClient.sendEvent("OnboardingPromptModal","Shown",{name:e})}function f(e){u.UEClient.sendEvent("OnboardingPromptModal","ConfirmButtonClicked",{name:e})}Object.defineProperty(t,"__esModule",{value:!0});var _=function(e){var t=o.createElement(p.Modal,{id:e.id,className:e.className,title:e.title,acceptButtonText:e.acceptButtonText,clickOutToClose:!1,showX:e.showX},e.children),n=t.type.prototype;return n.componentDidMount&&(n._componentDidMount=n.componentDidMount,delete n.componentDidMount),t},g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onShow=function(){t.state_manager.onShow(),t.props.campaign.onboardingModuleName&&h(t.props.campaign.onboardingModuleName)},t.onConfirm=function(e){t.state_manager.onConfirm(e),t.props.campaign.content.confirmInNewTab?setTimeout(function(){t.close()},0):t.state_manager.getShouldUsePost()||(t.close(),t.props.campaign.onboardingModuleName&&(f(t.props.campaign.onboardingModuleName),t.state_manager.eventLogger.recordEvent("onboarding_confirmed")))},t.onDismiss=function(e){t.state_manager.onDismiss(e),t.close()},t.onRemindMeLater=function(e){t.state_manager.onDismiss(e,{remindMeLater:!0}),t.close()},t.attachListenersToChildren=function(e){t.state_manager.attachListenersToChildren(e,t.onConfirm,t.onDismiss)},t}return n.__extends(t,e),t.shouldDisplayHomeModal=function(e){return!(e.campaign.isHomeOnboardingEnabled&&e.campaign.onboardingModuleName&&["home_v1","home_v0"].indexOf(e.campaign.onboardingModuleName)===-1)},t.kickstartOnboarding=function(e){e.campaign.onboardingModuleName&&(m.UELoader.notifyModuleToLoad(e.campaign.onboardingModuleName),h(e.campaign.onboardingModuleName),f(e.campaign.onboardingModuleName));var t=new d.PromptEventLogger(e);t.recordClientImpression(),t.recordConfirm(),t.recordEvent("onboarding_confirmed_no_prompt")},t.prototype.componentWillMount=function(){this.props.campaign.onboardingModuleName&&m.UELoader.notifyModuleToLoad(this.props.campaign.onboardingModuleName)},t.prototype.close=function(){p.Modal.close()},t.prototype.render=function(){var e=r((n={"dfb-modal":"dfb"===this.props.campaign.campaignTypeId,"pro-modal":"dfb"!==this.props.campaign.campaignTypeId},n["db-modal-custom-"+this.props.campaign.campaignName]=!!this.props.campaign.campaignName,n[this.props.campaign.content.modalStyle||""]=!!this.props.campaign.content.modalStyle,n["show-upsell-modal"]=!0,n)),t=this.props.isPreview?_:p.Modal;return o.createElement(t,{id:this.props.campaign.modalId,className:e,title:this.props.campaign.content.title,clickOutToClose:!0,acceptButtonText:null,onDismiss:this.onDismiss,onShow:this.onShow,showX:!0,isPreview:this.props.isPreview||!1},this.renderImage(),this.renderSubtext(),this.renderButtons(),this.renderBottomText());var n},t.prototype.renderButtons=function(){return o.createElement(l.PromptButtons,{campaign:this.props.campaign,confirmIsPost:this.state_manager.getShouldUsePost(),confirmUrl:this.state_manager.getConfirmUrl(),onConfirm:this.onConfirm,onDismiss:this.onDismiss,onRemindMeLater:this.onRemindMeLater})},t.prototype.renderImage=function(){return this.props.campaign.content.imageUrl?o.createElement(c.Image,{src:this.props.campaign.content.imageUrl,srcHiRes:this.props.campaign.content.imageUrlHiRes,alt:this.props.campaign.content.confirmText||i._("Main modal image.")}):void 0},t.prototype.renderBottomText=function(){return this.props.campaign.content.bottomText?o.createElement("div",{className:"bottom-text",dangerouslySetInnerHTML:l.sanitizeOptionalHTML(this.props.campaign.content.bottomText),ref:this.attachListenersToChildren}):void 0},t.prototype.renderSubtext=function(){return o.createElement("div",{className:"subtext",dangerouslySetInnerHTML:l.sanitizeOptionalHTML(this.props.campaign.content.subtext),ref:this.attachListenersToChildren})},t.displayName="HomeModalWithoutCSS",t})(a.PromptLocationWithDefaultState);t.HomeModalWithCSS=s(g,["/static/css/upsell/upsell_modal-vfl_Ov87f.css"]);var v=(function(e){function r(t){var n=e.call(this,t)||this;return n.state={modalInstance:r.showInstance(t)},n}return n.__extends(r,e),r.showInstance=function(e){if(t.HomeModalWithCSS.shouldDisplayHomeModal(e)){var n=o.createElement(t.HomeModalWithCSS,e);return p.Modal.showInstance(n)}return g.kickstartOnboarding(e),null},r.prototype.render=function(){return null},r})(o.Component);t.HomeModal=v}),define("modules/clean/react/prompt/image",["require","exports","tslib","external/react"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.srcHiRes?this.props.srcHiRes+" 2x":void 0;return o.createElement("img",{src:this.props.src,srcSet:e,alt:this.props.alt,onLoad:this.props.onLoad})},t})(o.Component);t.Image=r}),define("modules/clean/react/prompt/prompt_location",["require","exports","tslib","external/react","modules/clean/react/prompt/campaign_state_manager"],function(e,t,n,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(t,n){var o=e.call(this,t)||this;return o.state=n,o.state_manager=new r.CampaignStateManager(o),o}return n.__extends(t,e),t})(o.Component);t.PromptLocation=i;var s=(function(e){function t(t){return e.call(this,t,{isConfirmed:!1,isDismissed:!1,isShown:!1})||this}return n.__extends(t,e),t})(i);t.PromptLocationWithDefaultState=s}),define("modules/clean/react/sprite_div",["require","exports","tslib","external/classnames","external/react","modules/clean/react/sprite"],function(e,t,n,o,r,i){"use strict";var s=r.createElement,a=r.DOM.div;return(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e,t=this.props.group,n=this.props.name,r=this.props.text,c=this.props.alt,p=o(["sprite-frame","small","icon-"+this.props.spritePosition]),l=a({className:p,key:0},s(i,{group:t,name:n,alt:c})),u=a({className:"sprite-text",key:1},r);switch(this.props.spritePosition){case"left":e=[l,u];break;case"right":e=[u,l]}return a({className:"sprite-div"},e)},t.displayName="SpriteDiv",t.propTypes={group:r.PropTypes.string.isRequired,name:r.PropTypes.string.isRequired,text:r.PropTypes.oneOfType([r.PropTypes.string,r.PropTypes.array]),alt:r.PropTypes.string,spritePosition:r.PropTypes.oneOf(["left","right"])},t.defaultProps={alt:"",spritePosition:"left"},t})(r.Component)}),define("modules/clean/upsell/exception",["require","exports","modules/core/exception","modules/core/xhr"],function(e,t,n,o){"use strict";function r(e){var t=e.severity,r=void 0===t?n.SEVERITY.CRITICAL:t;o.sendXhr("/prompt/log_jse",{severity:r})}function reportException(e){
var o=e.err,r=e.tags,i=void 0===r?[]:r,s=e.severity,a=void 0===s?n.SEVERITY.CRITICAL:s,c=e.exc_extra,p=void 0===c?{}:c;i.push(t.TAGS.PROMPT),i.push(t.TAGS.MEGAPHONE),n.reportException({err:o,tags:i,severity:a,exc_extra:p}),t.logExceptionRate({severity:a})}function i(e){var o=e.err,r=e.js_controller_options,i=void 0===r?{}:r,s=e.severity,a=void 0===s?n.SEVERITY.CRITICAL:s,c=e.tags,p=void 0===c?[]:c,l={"campaign-name":"campaignName",location:"campaignLocationId"};for(var u in l)if(l.hasOwnProperty(u)){var m=l[u],d=i[m];d&&p.push("prompt-"+u+"-"+d)}t.reportException({err:o,tags:p,severity:a,exc_extra:i})}Object.defineProperty(t,"__esModule",{value:!0}),t.SEVERITY=n.SEVERITY,t.TAGS={MEGAPHONE:"megaphone",PROMPT:"prompt",PROMPT_ADMIN:"prompt-admin",PROMPT_REACT_LOADER:"prompt-react-loader",PROMPT_HA_LOADER:"prompt-ha-loader",PROMPT_LOADER:"prompt-loader",PROMPT_MAIN_AND_ACCOUNT_HEADER_LOADER:"prompt-main-and-account-header-loader",PROMPT_MUTUALLY_EXCLUSIVE_LOADER:"prompt-mutually-exclusive-loader",LEGACY_TOP_NOTIFICATIONS:"legacy-top-notifications"},t.logExceptionRate=r,t.reportException=reportException,t.reportJsControllerException=i}),define("modules/clean/upsell/legacy_prompt_event_logging",["require","exports","modules/core/uri","modules/clean/ajax_minimal"],function(e,t,n,o){"use strict";function r(e,t){var o={campaign_id:t.campaignId.toString()};if(t.versionId&&(o.campaign_id=t.versionId.toString(),o.version_id=t.versionId.toString()),"number"==typeof t.promptQueriedAtMs&&(o.prompt_queried_at_ms=t.promptQueriedAtMs.toString()),window&&window.performance&&window.performance.now){var r=Math.round(window.performance.now());o.delta_from_request_start_ms=r.toString()}return t.activeUserId&&(o._subject_uid=String(t.activeUserId)),t.requestId&&(o.prompt_parent_request_id=t.requestId),t.eventName&&(o.event_name=t.eventName),void 0!==t.remindMeLater&&(o.remind_me_later=(!!t.remindMeLater).toString()),t.csrfToken&&(o.csrf_token=encodeURIComponent(t.csrfToken)),t.csrfTokenType&&(o.csrf_token_type=encodeURIComponent(t.csrfTokenType)),new n({path:e,query:o})}Object.defineProperty(t,"__esModule",{value:!0}),t.getUpsellControllerURI=r;var i=(function(){function e(e){this.params=e}return e.prototype.logImpression=function(){var e=r("/prompt/log_impression",this.params);o.post(e.toString(),"")},e.prototype.logDismissal=function(){var e=r("/prompt/dismiss",this.params);o.post(e.toString(),"")},e})();t.LegacyEventLogger=i}),define("modules/clean/upsell/prompt_event_emitter",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Events={REACT_HA_DID_UPDATE:"REACT_HA_DID_UPDATE"},t.Emitter=new n}),define("modules/clean/upsell/prompt_event_logger",["require","exports","jquery","modules/clean/ajax","modules/clean/upsell/upsell_controller","modules/clean/upsell/legacy_prompt_event_logging"],function(e,t,n,o,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e){this.campaignProps=e}return e.prototype.recordClientImpression=function(){var e=this.getUpsellControllerURI("/prompt/log_impression");this.recordAck(e)},e.prototype.recordConfirm=function(){var e=this.getUpsellControllerURI("/prompt/confirm");this.recordAck(e,r.ON_CONFIRM_EVENT_NAME)},e.prototype.recordDismiss=function(e){var t=this.getUpsellControllerURI("/prompt/dismiss",{remindMeLater:e});this.recordAck(t,r.ON_DISMISS_EVENT_NAME)},e.prototype.recordEvent=function(e){var t=this.getUpsellControllerURI("/prompt/log_event",{eventName:e});this.recordAck(t)},e.prototype.recordAck=function(e,t){var n=this;o.SilentBackgroundRequest({type:"POST",url:e.toString()}).done(function(e){t&&n.triggerExternalEvent(t)})},e.prototype.getUpsellControllerURI=function(e,t){return i.getUpsellControllerURI(e,{campaignId:this.campaignProps.campaign.campaignId,versionId:this.campaignProps.campaign.versionId,activeUserId:this.campaignProps.subjectUser,promptQueriedAtMs:this.campaignProps.promptQueriedAtMs,requestId:this.campaignProps.requestId,csrfToken:this.campaignProps.csrfToken,csrfTokenType:this.campaignProps.csrfTokenType,eventName:t&&t.eventName,remindMeLater:t&&t.remindMeLater})},e.prototype.triggerExternalEvent=function(e){n(document).trigger(e,{campaignName:this.campaignProps.campaign.campaignName})},e})();t.PromptEventLogger=s}),define("modules/clean/upsell/prompt_loader",["require","exports","jquery","modules/clean/deprecated/uirequest","modules/clean/prompt/react_loader","modules/clean/prompt/ha_loader","modules/clean/upsell/exception","modules/clean/user_education/user_education_loader"],function(e,t,n,o,r,i,s,a){"use strict";function c(){return window.performance&&window.performance.mark&&window.performance.measure&&window.location.search.indexOf("show_debug_spans")>-1}function p(e){new v(e).didCampaignForUserEducationLoad()||a.UELoader.notifyModuleToLoad(null)}function l(e){return{userID:e.user_id,controller:e.controller,action:e.action}}function u(){return!!n("#top-notification-bar-container").length}function m(){n(".db-modal-overlay").is(":visible")||n("#db-modal-upsell-home-modal").addClass("show-upsell-modal").trigger("show-upsell-modal")}function d(e,t,n){return new Promise(function(i,s){try{new o(e,"/prompt/main_campaign",{data:{ref_controller:t.controller,ref_action:t.action,in_app:t.in_app,sprite_group:t.sprite_group,skip_main_campaign:n},dataType:"json",subject_user:t.user_id,success:function(e){var n=e.data.account_header_campaign_props,o=e.data.main_campaign_props;o?r.initialize_react({userID:t.user_id,controller:t.controller,action:t.action,campaigns:[o]}):(m(),p(e)),n&&r.initialize_react({userID:t.user_id,controller:t.controller,action:t.action,campaigns:[n]}),i(new v(e))}})}catch(e){h(t,n,e),s()}})}function h(e,t,n){s.reportException({err:n,tags:[s.TAGS.PROMPT_MAIN_AND_ACCOUNT_HEADER_LOADER],exc_extra:{param_user_id:e.user_id,param_controller:e.controller,param_action:e.action,param_in_app:e.in_app,param_sprite_group:e.sprite_group,param_options_skip_main_campaign:t}})}function f(){return y.waitFor()}function _(){y.reset()}function g(e){var t=c();t&&window.performance.mark("PromptLoader init start");var o=u(),r=n("#prompt-silo .main-silo");try{var a=d(r,e,e.mutually_exclusive_loading&&o);return e.mutually_exclusive_loading?a.then(function(t){return(o?t.didAccountHeaderCampaignLoad():t.didMainCampaignLoad())?t:Promise.all([a,i.initialize_module(l(e))]).then(function(e){return e[0]})}):a=Promise.all([a,i.initialize_module(l(e))]).then(function(e){return e[0]}),a.then(function(e){return t&&(window.performance.mark("PromptLoader init end"),window.performance.measure("PromptLoader init","PromptLoader init start","PromptLoader init end")),y.resolve(e),e})}catch(t){return s.reportException({err:t,tags:[s.TAGS.PROMPT_LOADER],exc_extra:{param_config:e}}),y.reject(),Promise.reject(null)}}Object.defineProperty(t,"__esModule",{value:!0});var v=(function(){function e(e){this.response_data=e}return e.prototype.didCampaignLoad=function(e,t){for(var n=this.response_data.actions||[],o=0,r=n;o<r.length;o++){var i=r[o],s=i[1];if(i[2]===e&&s)return!t||s.indexOf(t)>=0}return!1},e.prototype.didHeaderBubbleLoad=function(){return this.didCampaignLoad("^body #prompt-silo .account-header-silo","header-bubble-container")||this.didCampaignLoad("^body #prompt-silo .account-header-react-silo","header-bubble-container")},e.prototype.didHeaderLinkLoad=function(){return!this.didHeaderBubbleLoad()&&(this.didCampaignLoad("^body #prompt-silo .account-header-silo","header-link")||this.didCampaignLoad("^body #prompt-silo .account-header-react-silo","header-link"))},e.prototype.didMainCampaignLoad=function(){return this.didHeaderBubbleLoad()||this.didCampaignLoad("^body #prompt-silo .main-silo")},e.prototype.didAccountHeaderCampaignLoad=function(){return this.didHeaderBubbleLoad()||this.didHeaderLinkLoad()},e.prototype.didCampaignForUserEducationLoad=function(){return this.didCampaignLoad("^body #prompt-silo .main-silo",'"onboardingModuleName":')&&!this.didCampaignLoad("^body #prompt-silo .main-silo",'"onboardingModuleName": null')},e.prototype.didAnyContentLoad=function(){for(var e=this.response_data.actions||[],t=0,n=e;t<n.length;t++){if(n[t][1])return!0}return!1},e})();t.ResponseParser=v;var E=(function(){function e(){this.waits=[],this.result=null}return e.prototype.reset=function(){this.result=null},e.prototype.waitFor=function(){var e=this;return this.result?Promise.resolve(this.result):new Promise(function(t,n){e.waits.push({resolve:t,reject:n})})},e.prototype.resolve=function(e){this.result=e,this.waits.forEach(function(t){return t.resolve(e)}),this.waits=[]},e.prototype.reject=function(){this.result=null,this.waits.forEach(function(e){return e.reject()}),this.waits=[]},e})(),y=new E;t.waitForPrompt=f,t.resetWait=_,t.initialize_module=g}),define("modules/clean/upsell/upsell_controller",["require","exports","jquery","modules/clean/ajax","modules/clean/upsell/exception","modules/core/dom","modules/core/uri"],function(e,t,n,o,r,i,s){"use strict";var a=(function(){function e(t,o,r){var i=this;this._keydown=this._keydown.bind(this),this.dismiss=this.dismiss.bind(this),this.confirm=this.confirm.bind(this),this.post_dismiss=this.post_dismiss.bind(this),this.post_confirm=this.post_confirm.bind(this),this.options=r,t.length>0&&t.one("click",function(e){return i.confirm(e)}),o.length>0&&o.one("click",function(e){var t=n(e.target).hasClass("remind-me-later");return i.dismiss(e,t)}),this.options.dismissWithKeys&&n(document).on("keydown",this._keydown),e.add_tk_params(t,{addTkParams:this.options.addTkParams,campaignId:this.options.campaignId,versionId:this.options.versionId,campaignLocationTkId:this.options.campaignLocationTkId}),t.add(o).addClass("enabled")}return e.initClass=function(){this.ON_SHOW_EVENT_NAME="db:prompt:show",this.ON_CONFIRM_EVENT_NAME="db:prompt:confirm",this.ON_DISMISS_EVENT_NAME="db:prompt:dismiss",this.PRE_CONFIRM_EVENT_NAME="db:prompt:pre-confirm",this.PRE_DISMISS_EVENT_NAME="db:prompt:pre-dismiss",this.CONFIRM="confirm",this.DISMISS="dismiss",this.LOG_IMPRESSION="log_impression"},e.prototype._keydown=function(e){if(27===e.keyCode||8===e.keyCode&&!i.focus_in_input())return e.preventDefault(),n(document).off("keydown",this._keydown),this.dismiss(e)},e.prototype._campaignUrl=function(t,n){var o=(function(){return t===e.CONFIRM?"/prompt/confirm":t===e.DISMISS?"/prompt/dismiss":t===e.LOG_IMPRESSION?"/prompt/log_impression":void 0})();if(this.options&&this.options.campaignId){var r=new s({path:o}).updateQuery({campaign_id:this.options.campaignId});return this.options.versionId&&r.updateQuery({campaign_id:this.options.versionId,version_id:this.options.versionId}),t===e.DISMISS&&n&&r.updateQuery({remind_me_later:!0}),r.toString()}},e.prototype._confirmOrDismiss=function(e,t,r,i){var s=this;return"keydown"===e.type||r||(e.stopImmediatePropagation(),e.preventDefault()),o.SilentBackgroundRequest({type:"POST",url:t,subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}}).done(function(t){return"keydown"===e.type||r||e.target.click(),n(document).trigger(i,s.options)})},e.prototype.dismiss=function(t,o){var r=this._campaignUrl(e.DISMISS,o);return r&&this._confirmOrDismiss(t,r,!1,e.ON_DISMISS_EVENT_NAME),n(document).trigger(e.PRE_DISMISS_EVENT_NAME,this.options)},e.prototype.confirmUrl=function(e){var t=n(e.currentTarget);return(function(){return t.is("button, input")&&"submit"===t.attr("type")?n(e.currentTarget).closest("form").attr("action"):t.is("a")?n(e.currentTarget).attr("href"):void 0})()||this.options.confirmUrl},e.prototype.confirmInNewTab=function(e){var t=n(e.currentTarget),o=(function(){return t.is("button, input")&&"submit"===t.attr("type")?n(e.currentTarget).closest("form").attr("target"):t.is("a")?n(e.currentTarget).attr("target"):void 0})();return o?"_blank"===o:this.options.confirmInNewTab},e.prototype.confirm=function(t){var o=this._campaignUrl(e.CONFIRM);return o&&this._confirmOrDismiss(t,o,this.confirmInNewTab(t),e.ON_CONFIRM_EVENT_NAME),n(document).trigger(e.PRE_CONFIRM_EVENT_NAME,this.options)},e.prototype.get_time_since_request_start=function(){if(window.performance&&window.performance.timing&&window.performance.timing.navigationStart)return(new Date).getTime()-window.performance.timing.navigationStart},e.prototype.log_impression=function(){var t=this._campaignUrl(e.LOG_IMPRESSION);if(t)return o.SilentBackgroundRequest({type:"POST",url:t,subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},e.prototype.log_event=function(e){if(this.options&&this.options.campaignId){var t=new s({path:"/prompt/log_event"}).updateQuery({event_name:e,campaign_id:this.options.campaignId});return this.options.versionId&&t.updateQuery({campaign_id:this.options.versionId,version_id:this.options.versionId}),o.SilentBackgroundRequest({type:"POST",url:t.toString(),subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})}},e.prototype.post_dismiss=function(){var e=this._dismissUrl();if(e)return o.SilentBackgroundRequest({type:"POST",url:e,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},e.prototype.post_confirm=function(){var e=this._confirmUrl();if(e)return o.SilentBackgroundRequest({type:"POST",url:e,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},e.add_tk_params=function(e,t){if(t.addTkParams){if(!t.campaignId||!t.campaignLocationTkId){var o=new Error("Missing campaignId or campaignLocationTkId.");return void r.reportJsControllerException({err:o,js_controller_options:t,severity:r.SEVERITY.NONCRITICAL})}return e.each(function(e,o){var r,i=n(o);i.is("a")?r="href":(i=i.closest("form"),r="action");var a=i.attr(r);if(i.length>0&&a){var c=s.parse(a);return c.updateQuery({_tk:t.campaignLocationTkId,_camp:t.versionId||t.campaignId}),i.attr(r,c.toString())}})}},e.register_custom_controller=function(t){var o=t.on_show,r=t.on_confirm,i=t.on_dismiss,s=t.pre_confirm,a=t.pre_dismiss;if(o&&n(document).on(e.ON_SHOW_EVENT_NAME,o),r&&n(document).on(e.ON_CONFIRM_EVENT_NAME,r),i&&n(document).on(e.ON_DISMISS_EVENT_NAME,i),s&&n(document).on(e.PRE_CONFIRM_EVENT_NAME,s),a)return n(document).on(e.PRE_DISMISS_EVENT_NAME,a)},e.unregister_custom_controller=function(t){var o=t.on_show,r=t.on_confirm,i=t.on_dismiss,s=t.pre_confirm,a=t.pre_dismiss;if(o&&n(document).off(e.ON_SHOW_EVENT_NAME,o),r&&n(document).off(e.ON_CONFIRM_EVENT_NAME,r),i&&n(document).off(e.ON_DISMISS_EVENT_NAME,i),s&&n(document).off(e.PRE_CONFIRM_EVENT_NAME,s),a)return n(document).off(e.PRE_DISMISS_EVENT_NAME,a)},e})();return a.initClass(),a}),define("modules/clean/user_education/user_education_client",["require","exports","tslib","external/react","external/react-dom","external/eventemitter3","modules/clean/user_education/user_education_interface"],function(e,t,n,o,r,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),window.ensemble&&!window.ensemble.eventEmitter&&(window.ensemble.eventEmitter=new i),t.eventEmitter=window.ensemble&&window.ensemble.eventEmitter?window.ensemble.eventEmitter:new i;var a=(function(){function e(){this.controllerReady=!1,this.eventQueue=[],this.handleUpdate=this.handleUpdate.bind(this),t.eventEmitter.on(s.UserEducationStateChannel,this.handleUpdate,this)}return e.prototype.init=function(){this._sendEvent({containerName:"UEClient",name:s.UEEventType.Subscribe,data:{}})},e.prototype.sendEvent=function(e,t,n){var o=this;if(void 0===n&&(n={}),!this._isUserEducationDisabled()){var r={containerName:e,name:t,data:n};this.controllerReady?this._shouldSendEventAsynchronously()?setTimeout(function(){return o._sendEvent(r)},0):this._sendEvent(r):this.eventQueue.push(r)}},e.prototype._sendEvent=function(e){this._isUserEducationDisabled()||t.eventEmitter.emit(s.UserEducationEventChannel,e)},e.prototype._isUserEducationDisabled=function(){return!window.ensemble},e.prototype._shouldSendEventAsynchronously=function(){return!0},e.prototype.handleUpdate=function(e){if(e.state===s.UEEventType.Ready)for(this.controllerReady=!0;this.eventQueue.length>0;)this._sendEvent(this.eventQueue.shift())},e})();t.UserEducationClient=a,t.UEClient=new a,t.UEClient.init();var c=(function(){function e(e,t){this._thunk=e,this._fps=t,this._cleanup_func=function(){},this._is_running=!1}return e.prototype.start=function(){if(!this._is_running){this._is_running=!0;var e=this._thunk,t=-1,n=-1,o=1e3/this._fps,r=function(e,t){var i=Date.now(),s=i-t;s>o&&e(),t=i-s%o,n=requestAnimationFrame(function(){return r(e,t)})};t=requestAnimationFrame(function(){r(e,0)}),this._cleanup_func=function(){cancelAnimationFrame(t),cancelAnimationFrame(n)}}},e.prototype.stop=function(){this._is_running&&(this._is_running=!1,this._cleanup_func())},e.prototype.isRunning=function(){return this._is_running},e})(),p=(function(e){function i(t){var n=e.call(this,t)||this;return n.state={effect:null},n.handleUpdate=n.handleUpdate.bind(n),n._updateSize=n._updateSize.bind(n),n}return n.__extends(i,e),i.prototype.componentDidMount=function(){t.eventEmitter.on(s.UserEducationStateChannel,this.handleUpdate,this),t.UEClient.sendEvent(this.props.containerName+"."+this.props.name,s.UEEventType.Subscribe,{}),t.UEClient.sendEvent(this.props.containerName,this.props.name+".componentDidMount",{}),this._updateSize()},i.prototype.componentDidUpdate=function(){this._updateSize()},i.prototype._updateSize=function(){if(this.state.effect){var e=r.findDOMNode(this.refs.container);if(e){var t=e.getBoundingClientRect();this._requestEffect(t)}}},i.prototype._requestEffect=function(e){this.state.effect&&t.eventEmitter.emit(s.UserEducationEffectChannel,{requester:this.props.containerName+"."+this.props.name,rect:e})},i.prototype.componentWillUnmount=function(){this.stopRectUpdateLoop(),t.eventEmitter.removeListener(s.UserEducationStateChannel,this.handleUpdate,this),this._requestEffect({bottom:0,height:0,left:0,right:0,top:-1e3,width:0})},i.prototype.startRectUpdateLoop=function(){this._boundaryPoller?this._boundaryPoller.isRunning()||this._boundaryPoller.start():(this._boundaryPoller=new c(this._updateSize,15),this._boundaryPoller.start())},i.prototype.stopRectUpdateLoop=function(){this._boundaryPoller&&this._boundaryPoller.stop()},i.prototype.handleUpdate=function(e){if(e.state===s.UEEventType.ShowStep){var t=e.step.effect||null;if(t&&t.containerName===this.props.containerName&&t.elementName===this.props.name)return this.startRectUpdateLoop(),void this.setState({effect:t})}null!=this.state.effect&&(this.stopRectUpdateLoop(),this.setState({effect:null}))},i.prototype.render=function(){var e="ue-effect-container uee-"+this.props.containerName+"-"+this.props.name;return this.props.useSpan?o.createElement("span",{ref:"container",className:e},this.props.children):o.createElement("div",{ref:"container",className:e},this.props.children)},i.displayName="UserEducationEffect",i})(o.Component);t.UserEducationEffect=p}),define("modules/clean/user_education/user_education_interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserEducationEventChannel="UE.event",t.UserEducationStateChannel="UE.state",t.UserEducationEffectChannel="UE.effect";var n={Ready:"Ready",ShowStep:"ShowStep",Finished:"Finished",Subscribe:"Subscribe"};t.UEEventType=n;(function(e){e[e.Spotlight=0]="Spotlight",e[e.Pulsar=1]="Pulsar",e[e.ToolTip=2]="ToolTip"})(t.UEEffectType||(t.UEEffectType={}));(function(e){e[e.Small=1]="Small",e[e.Medium=2]="Medium",e[e.Large=3]="Large",e[e.XLarge=4]="XLarge"})(t.UserEducationSpotlightSize||(t.UserEducationSpotlightSize={}));t.UserEducationPulsarSize=24;(function(e){e[e.Center=1]="Center",e[e.LeftCenter=2]="LeftCenter",e[e.RightCenter=3]="RightCenter"})(t.UserEducationEffectPosition||(t.UserEducationEffectPosition={}));var o;(function(e){e[e.TopLeft=1]="TopLeft",e[e.TopRight=2]="TopRight"})(o||(o={})),t.UserEducationToolTipPointerPosition=o}),define("modules/clean/user_education/user_education_loader",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(){this.loadMessage=null,this.callback=null}return e.prototype.notifyModuleToLoad=function(e){this.callback?(this.callback(e),this.callback=null):this.loadMessage={moduleName:e}},e.prototype.setLoadingCallback=function(e){this.loadMessage?e(this.loadMessage.moduleName):this.callback=e},e})();t.UELoader=new n});
//# sourceMappingURL=pkg-prompt.min.js-vflLxHPTs.map