define(["require","exports","tslib","external/create-react-class","external/react","external/lodash","modules/clean/comments/annotation_utils","modules/clean/comments/constants","modules/clean/comments/flux","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/react/file_comments/annotation_bubble","modules/clean/react/file_comments/annotation_comments_list_ui_bubble","modules/constants/comments_panel","modules/core/exception"],function(n,t,e,o,i,a,r,s,u,c,l,p,v,d){"use strict";var m=i.DOM,b=o({displayName:"FilePreviewOverlay",mixins:[i.addons.PureRenderMixin],propTypes:{previewContainer:i.PropTypes.instanceOf(HTMLElement).isRequired,activity:i.PropTypes.object,actorId:i.PropTypes.number,context:i.PropTypes.number.isRequired,useAnnotationCreationExpand:i.PropTypes.bool.isRequired,showCreateBubble:i.PropTypes.bool.isRequired,draftAnnotation:i.PropTypes.object,viewingAnnotation:i.PropTypes.object,viewingAnnotationHover:i.PropTypes.bool.isRequired,viewingCommentActivity:i.PropTypes.object,viewingAnnotationReplyDraft:i.PropTypes.string,actionCreators:i.PropTypes.object.isRequired,isDemoMode:i.PropTypes.bool},getInitialState:function(){return{isExpanded:!1}},onConversationExpand:function(){return this.setState({isExpanded:!0})},onMouseEnterAnnotationConversationBubble:function(){return this.props.actionCreators.updateAnnotationConversationHover(!0)},onMouseLeaveAnnotationConversationBubble:function(){var n=this;if(this.props.actionCreators.updateAnnotationConversationHover(!1),null==this.props.draftAnnotation&&!this.state.isExpanded){var t=function(){if(n.isMounted()&&!n.props.viewingAnnotationHover)return n.props.actionCreators.hideAnnotationConversation()};return window.setTimeout(t,50)}},maybeRenderAnnotationInputBubble:function(){var n=this.props,t=n.activity,o=n.actorId,s=n.context,u=n.previewContainer,c=n.draftAnnotation,v=n.draftAnnotationText,d=n.showCreateBubble,m=n.useAnnotationCreationExpand;if(null!=c){var b={context:s,activity:t,user:l.getActivityUser(o),shouldShowExpandBubble:m,commentText:v,position:"top",x:0,y:0,showBubble:!1,actionCreators:this.props.actionCreators,isDemoMode:this.props.isDemoMode};if(d){if(!r.isAnnotationOffscreen(c,u)){var y=Array.from(r.getBubblePosition(c,u)),A=y[0],f=y[1],x=f.x,C=f.y,h=y[2];if(null!=A&&null!=x&&null!=C)return a.assignIn(b,{showBubble:!0,position:A,x:x,y:C,maxHeight:h}),i.createElement(p,e.__assign({},b))}}return i.createElement(p,e.__assign({},b))}},maybeRenderAnnotationConversationBubble:function(){var n=this.props,t=n.actorId,e=n.context,o=n.activity,a=n.previewContainer,s=n.viewingAnnotationReplyDraft,u=n.viewingCommentActivity,c=n.viewingAnnotation;if(u&&c&&!r.isAnnotationOffscreen(c,a)){var p=Array.from(r.getBubblePosition(c,a)),d=p[0],m=p[1],b=m.x,y=m.y,A=p[2];if(null!=d&&null!=b&&null!=y&&null!=A)return i.createElement(v,{context:e,activity:o,commentActivity:u,user:l.getActivityUser(t),position:d,replyText:s,x:b,y:y,maxHeight:A,onMouseEnter:this.onMouseEnterAnnotationConversationBubble,onMouseLeave:this.onMouseLeaveAnnotationConversationBubble,onConversationExpand:this.onConversationExpand,actionCreators:this.props.actionCreators,isDemoMode:this.props.isDemoMode})}},render:function(){return m.div({},this.maybeRenderAnnotationInputBubble(),this.maybeRenderAnnotationConversationBubble())}}),y=function(n){return d.ALLOW_VIEW_ANNOTATE_MODES&&(null!=n?n.annotation.type:void 0)===s.AnnotationTypes.HIGHLIGHT},A=function(n){var t,e,o,i=n.activity,r=n.viewAnnotation,s=n.createAnnotation;return r&&(o=a.find(i.comment_activities,{activity_key:r.activityKey}),o&&(e=n.annotationReplyTextByKey[o.activity_key])),s&&(t=s.showBubble),{activity:i,actorId:n.actorId,context:n.viewing.context,useAnnotationCreationExpand:y(s),showCreateBubble:!!t,draftAnnotation:null!=s?s.annotation:void 0,draftAnnotationText:n.annotationText,viewingAnnotation:null!=r?r.annotation:void 0,viewingAnnotationHover:!!(null!=r?r.annotationHover:void 0),viewingCommentActivity:o,viewingAnnotationReplyDraft:e}};return u.connect(c,A)(b)});
//# sourceMappingURL=file_preview_overlay.min.js-vfl9zWv4G.map