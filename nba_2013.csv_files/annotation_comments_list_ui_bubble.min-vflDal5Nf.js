define(["require","exports","external/classnames","external/create-react-class","external/react","external/react-dom","jquery","modules/clean/comments/components/ui_constants","modules/clean/comments/lib/click_outside","modules/clean/datetime","modules/clean/react/file_comments/conversation_or_input_card","modules/clean/activity/activity_user","modules/clean/keycode"],function(t,e,n,o,i,s,r,a,p,u,c){"use strict";function l(t,e){return void 0!==t&&null!==t?e(t):void 0}var d=i.DOM;return o({displayName:"AnnotationCommentsListUIBubble",mixins:[i.addons.PureRenderMixin],propTypes:{user:i.PropTypes.object,activity:i.PropTypes.object,x:i.PropTypes.number.isRequired,y:i.PropTypes.number.isRequired,annotation:i.PropTypes.object,commentActivity:i.PropTypes.object,position:i.PropTypes.string,maxHeight:i.PropTypes.number,replyText:i.PropTypes.string,onMouseEnter:i.PropTypes.func,onMouseLeave:i.PropTypes.func,onConversationExpand:i.PropTypes.func,actionCreators:i.PropTypes.object.isRequired,isDemoMode:i.PropTypes.bool},getDefaultProps:function(){return{maxHeight:a.DEFAULT_ANNOTATION_COMMENT_INPUT_MAX_HEIGHT,isDemoMode:!1}},getInitialState:function(){return{button_disabled:!0,show_post_button:!1,initial_text:""}},onConversationExpand:function(){return this._scrollToBottom(),"function"==typeof this.props.onConversationExpand?this.props.onConversationExpand():void 0},onReplyInputBlur:function(){return this.props.actionCreators.updateAnnotationReplyFocused(!1)},onReplyInputFocus:function(){return this.props.actionCreators.updateAnnotationReplyFocused(!0)},_handleOutsideClick:function(t){return this.props.actionCreators.hideAnnotationConversation()},onCancelComment:function(){return this.props.actionCreators.cancelAnnotationComment()},onAddReply:function(t,e){return this.props.actionCreators.addReply({targetActivityKey:e.activity_key,body:{text:t}})},_getReplyCommentInput:function(){return l(null!=this.refs.conversationCard?this.refs.conversationCard.refs.threadedCommentActivityUI:void 0,function(t){return t.refs.commentInput})},_getRawReplyInput:function(){return l(this._getReplyCommentInput(),function(t){return t.getRawCommentInput()})||""},_saveReplyDraft:function(){var t,e=this._getRawReplyInput();return t=e.length>0&&e!==l(this._getReplyCommentInput(),function(t){return t.getPlaceholderText()})?e:null,this.props.actionCreators.updateAnnotationReplyText({activityKey:this.props.commentActivity.activity_key,text:t})},_getRevisionDateTime:function(){var t=this._getRevision();if(null!=t.when&&!isNaN(new Date(null!=t.when)))return""+u.ago(new Date(1e3*t.when))},_getRevision:function(){return this.props.commentActivity.comment.comment_metadata.revision},_isOnOldRevision:function(){return!1},_scrollToBottom:function(){var t=s.findDOMNode(this.refs.annotationBubbleField);return r(t).animate({scrollTop:t.scrollHeight},{duration:300})},_renderConversation:function(){var t={ref:"threadedCommentActivityUI",key:"annotation_bubble_threaded_"+this.props.commentActivity.activity_key,activity:this.props.activity,commentActivity:this.props.commentActivity,user:this.props.user,shouldUseSimpleModals:!1,shouldHidePhotoAvatars:!1,shouldAutoLinkify:!0,shouldShowPostText:!0,onReplyInputFocus:this.onReplyInputFocus,onReplyInputBlur:this.onReplyInputBlur,replyText:this.props.replyText,onCommentExpanded:this.onConversationExpand,isInAnnotationBubble:!0,onCancelComment:this.onCancelComment,onInputChange:this._saveReplyDraft,onAddComment:this.onAddReply};return i.createElement(c.ConversationCard,{ref:"conversationCard",shouldInitiallyShowNotifyHint:!1,initialUsersToNotify:null!=this.props.commentActivity?this.props.commentActivity.users_to_notify:void 0,commentProps:t,actionCreators:this.props.actionCreators,isDemoMode:this.props.isDemoMode})},_renderComments:function(){var t={"comments-holder":!0},e={maxHeight:this.props.maxHeight};return d.div({className:"annotation-bubble__field",ref:"annotationBubbleField",style:e},this._isOnOldRevision()?d.div({className:"annotation-bubble__field__old-revision"},"On older revision, updated "+this._getRevisionDateTime()):void 0,d.div({className:n(t)},d.div({className:"comment-list"},this._renderConversation())))},render:function(){var t={"annotation-bubble-container":!0,"annotation-bubble-invisible-border":!0},e={left:this.props.x-25};return this.props.position.indexOf("bottom")>=0?e.bottom=this.props.y-25:e.top=this.props.y-25,i.createElement(p.ClickOutside,{onClickOutside:this._handleOutsideClick},d.div({onMouseOver:this.onMouseOver,onMouseLeave:this.props.onMouseLeave,onMouseEnter:this.props.onMouseEnter,className:n(t),style:e},d.div({className:"annotation-bubble bubble-dropdown "+this.props.position},this._renderComments(),d.div({className:"bubble-arrow-border"}),d.div({className:"bubble-arrow"}))))}})});
//# sourceMappingURL=annotation_comments_list_ui_bubble.min.js-vflq3X3SZ.map