define("modules/clean/logging/compression",["require","exports"],function(t,e){"use strict";function n(){return new s}Object.defineProperty(e,"__esModule",{value:!0});var s=(function(){function t(){}return t.prototype.inflate=function(t){return t},t.prototype.deflate=function(t){return t},t})();e.IdentityCodec=s,e.getBestCompressionCodec=n}),define("modules/clean/logging/sender",["require","exports","modules/core/xhr"],function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.MAX_REPORT_ATTEMPTS=4;var s={NoContent:204},i=(function(){function t(t,e,n){this.store=t,this.sendInterval=e,this.batchSize=n,this.numSuccessfulPublish=0,this.numFailedPublish=0,this.scheduleNextSend(Date.now())}return t.prototype.sendOnce=function(){var t=this.store.drain(this.batchSize);Object.keys(t).length>0&&this.publish(t);var e=Date.now();this.scheduleNextSend(e),this.lastSendTime=e},t.prototype.publish=function(t){var e=this,i={},r={};Object.keys(t).forEach(function(e){var n=t[e].map(function(t){return t.records()});i[e]=JSON.stringify([].concat.apply([],n))}),r["data-version"]="1",r.batches=JSON.stringify(i),r.stats=this.store.stats.getAndReset();var o=function(n){n===s.NoContent?e.onSendSuccess(t):e.onSendFailure(t)};n.sendXhr("/log/telemetry",r,o)},t.prototype.scheduleNextSend=function(t){var e=this;this.nextSendTime=t+this.sendInterval,setTimeout(function(){e.sendOnce()},this.sendInterval)},t.prototype.onSendSuccess=function(t){this.numSuccessfulPublish++},t.prototype.onSendFailure=function(t){this.numFailedPublish++;for(var n in t)if(t.hasOwnProperty(n))for(var s=0,i=t[n];s<i.length;s++){var r=i[s];r.markFailure(),r.numReportAttempts<e.MAX_REPORT_ATTEMPTS&&this.store.reEnqueueBatch(n,r)}},t})();e.Sender=i}),define("modules/clean/logging/storage",["require","exports","tslib"],function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MAX_MESSAGES_IN_BATCH=100;var s=(function(){function t(){this.stats=new i}return t})();e.EventStorage=s;var i=(function(){function t(){this.rate_stats={}}return t.prototype._val=function(t,e){return t.hasOwnProperty(e)?t[e]:0},t.prototype.onPushEvent=function(t){for(var e=0,n=["*",t];e<n.length;e++){var s=n[e],i="enqueue:"+s;this.rate_stats[i]=this._val(this.rate_stats,i)+1}},t.prototype.onDrain=function(t){var e=0;for(var n in t)if(t.hasOwnProperty(n)){var s=t[n].map(function(t){return t.size()}).reduce(function(t,e){return t+e},0),i="dequeue:"+n;this.rate_stats[i]=this._val(this.rate_stats,i)+s,e+=s}this.rate_stats["dequeue:*"]=this._val(this.rate_stats,"dequeue:*")+e},t.prototype.onReEnqueueBatch=function(t,e){for(var n=0,s=["*",t];n<s.length;n++){var i=s[n],r="reEnqueue:"+i;this.rate_stats[r]=this._val(this.rate_stats,r)+e.size()}},t.prototype.getAndReset=function(){var t=JSON.stringify({"rate-stats":this.rate_stats});return this.rate_stats={},t},t})(),r=(function(t){function s(e){var n=t.call(this)||this;return n.compressionCodec=e,n.existing_batches={},n}return n.__extends(s,t),s.prototype._append_batch_to_category=function(t,e){this.existing_batches[t]||(this.existing_batches[t]=[]),this.existing_batches[t].push(e)},s.prototype._get_or_create_batch=function(t){var e=this.existing_batches[t];return e&&0!==e.length||(this._add_new_batch_for_category(t),e=this.existing_batches[t]),e[e.length-1]},s.prototype._add_new_batch_for_category=function(t){var n=new o(t,e.MAX_MESSAGES_IN_BATCH,this.compressionCodec);return this._append_batch_to_category(t,n),n},s.prototype.pushEvent=function(t,e){var n=JSON.parse(JSON.stringify(e));this.stats.onPushEvent(t),this._get_or_create_batch(t).tryAppend(n)||this._add_new_batch_for_category(t).tryAppend(n)},s.prototype.reEnqueueBatch=function(t,e){return this.stats.onReEnqueueBatch(t,e),this._append_batch_to_category(t,e)},s.prototype.drain=function(t){var e=t,n={};for(var s in this.existing_batches)if(this.existing_batches.hasOwnProperty(s)){if(e<=0)break;var i=this.existing_batches[s].splice(0,e);if(e-=i.length,i.length>0){for(var r=0,o=i;r<o.length;r++){var a=o[r];a.close()}n[s]=i}}return this.stats.onDrain(n),n},s})(s);e.WindowStorage=r;var o=(function(){function t(t,e,n){this.category=t,this.maxMessages=e,this.compressionCodec=n,this.numReportAttempts=0,this.messages=[]}return t.prototype.isFull=function(){return this.messages.length>=this.maxMessages},t.prototype.size=function(){return this.messages.length},t.prototype.tryAppend=function(t){return!this.isFull()&&!this.closed&&(this.messages.push(t),this.isFull()&&this.close(),!0)},t.prototype.close=function(){this.closed||(this.closed=!0)},t.prototype.records=function(){return this.messages},t.prototype.markFailure=function(){if(!this.closed)throw new Error("Attempted to send an open batch");this.numReportAttempts++},t})();e.MessageBatch=o}),define("modules/clean/logging/telemetry",["require","exports","tslib","modules/clean/logging/storage","modules/clean/logging/compression","modules/clean/logging/sender"],function(t,e,n,s,i,r){"use strict";function o(){if(!f.initialized)throw new d;return f.storage}function a(t){void 0===t&&(t={}),f||(f=new p(t))}function u(){return void 0!==f&&f.initialized}Object.defineProperty(e,"__esModule",{value:!0});var c=(function(){function t(t){this.prefix=t}return t.prototype.log=function(t){o().pushEvent(this.prefix+t.category,t)},t})(),h=(function(t){function e(){return t.call(this,"js:")||this}return n.__extends(e,t),e})(c);e.JSEventLogger=h;var l=(function(t){function e(){return t.call(this,"hive:")||this}return n.__extends(e,t),e})(c);e.HiveLogger=l;var p=(function(){function t(t){this.initialized=!1;var e=i.getBestCompressionCodec();this.storage=new s.WindowStorage(e);var n=parseInt(t.flush_interval_ms,10)||5e3,o=parseInt(t.batch_size,10)||1;this.sender=new r.Sender(this.storage,n,o),this.initialized=!0}return t})();e.ClientTelemetry=p;var f,d=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e})(Error);e.StorageUninitializedError=d,e.initialize_module=a,e.is_initialized=u});
//# sourceMappingURL=pkg-telemetry.min.js-vflE3z1H0.map