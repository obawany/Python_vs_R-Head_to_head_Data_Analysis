define("modules/clean/contacts/facebook_modal",["require","exports","tslib","modules/clean/dbmodal"],function(e,t,o,n){"use strict";return(function(e){function t(t,o,n){var i=e.call(this,t,{element_id:"facebook-confirm-modal-user-"+t.id})||this;return i.on_hide=i.on_hide.bind(i),i.on_confirm_button_click=i.on_confirm_button_click.bind(i),i.show_hidden_modal=o,i.link_with_facebook=n,i}return o.__extends(t,e),t.prototype.on_hide=function(){return"function"==typeof this.show_hidden_modal?this.show_hidden_modal():void 0},t.prototype.on_confirm_button_click=function(e){return this.hide(),this.link_with_facebook()},t})(n.DBUserModal)}),define("modules/clean/contacts/facebook_oauth",["require","exports","modules/clean/ajax","modules/clean/viewer","modules/core/exception","modules/core/uri","jquery"],function(e,t,o,n,i,s){"use strict";var r={do_auth:function(e,t){if(i.assert(null!=t,"user_id must be specified"),window.open(new s({path:"/fb/access_token"}).updateQuery("_subject_uid",t).toString(),"fb_auth","width=600,height=450"),e)return r.onLoginSuccessCallback=e},post:function(e,t,a,l,c,u,d){return i.assert(null!=d,"user_id must be specified!"),n.Viewer.get_viewer().is_signed_in?("function"==typeof r.custom_show_posting&&r.custom_show_posting(),o.WebRequest({url:"/fb/post",data:{message:e,link:t,link_name:a,description:l,from_referrals:r.from_referrals,from_getspace:r.from_getspace,picture:c?c:""},success:function(o,n,i){var s=i.responseText;return 0===s.indexOf("ok")?"function"==typeof r.custom_show_complete?r.custom_show_complete():void 0:0===s.indexOf("auth")?r.do_auth(function(){return r.post(e,t,a,l,c,u,d)},d):void 0},error:function(){return"function"==typeof u?u():void 0},subject_user:d})):void window.open(s.parse("http://www.facebook.com/sharer.php").setQuery({u:t,t:a}).toString())}};return r}),define("modules/clean/groups/api",["require","exports","jquery","modules/clean/ajax","modules/clean/contacts/cache_store","modules/clean/viewer"],function(e,t,o,n,i,s){"use strict";function r(){}function a(e,t){return void 0===e&&(e={}),void 0===t&&(t=function(){return{}}),y({method:"get_groups_for_user",data:e,success:t})}function l(e,t){return void 0===e&&(e={}),void 0===t&&(t=function(){return{}}),y({method:"get_group_info",data:e,success:t})}function c(e,t){return void 0===e&&(e={}),void 0===t&&(t=function(){return{}}),y({method:"get_groups_for_team",data:{},success:t})}function u(e,t){return void 0===t&&(t=function(){return{}}),y({method:"get_users_in_group",data:e,success:t})}function d(e,t){return void 0===t&&(t=function(){return{}}),y({method:"make_new_group",data:e,success:t,reload_contacts:!0})}function _(e,t){return void 0===t&&(t=function(){return{}}),y({method:"make_new_group_with_users",data:e,success:t,reload_contacts:!0})}function p(e,t){return void 0===t&&(t=function(){return{}}),y({method:"remove_group",data:e,success:t,reload_contacts:!0})}function m(e,t,o){return void 0===o&&(o=function(){return{}}),y({method:"rename_group",data:e,success:t,error:o,reload_contacts:!0})}function h(e,t){return void 0===t&&(t=function(){return{}}),y({method:"add_users_to_group",data:e,success:t,reload_contacts:!0})}function f(e,t){return void 0===t&&(t=function(){return{}}),y({method:"remove_user_from_group",data:e,success:t,reload_contacts:!0})}function v(e,t){return void 0===t&&(t=function(){return{}}),y({method:"change_group_member_type",data:e,success:t})}function b(e,t){return y({method:"remove_namespace_from_group",data:e,success:t})}function g(e,t){var o=function(e,o,n){return t(n)};return n.WebRequest({url:"/groups_ajax/change_group_access_type",type:"post",data:e,subject_user:s.Viewer.get_viewer().work_user,success:o})}function w(e,t){return void 0===t&&(t=function(){return{}}),y({method:"make_group_join_request",data:e,success:t})}function y(e){var t="/groups_ajax/"+e.method,r=e.reload_contacts||!1,a=function(t){var n=JSON.parse(t);if(n.ok&&(e.success(n.data),o(".error_msg").hide()),r){i.DefaultContactsCacheStore.getOrCreateForViewer().load_contacts(!0)}},l=function(t){var n=t.responseText;e.error&&(e.error(n.slice(4)),o(".error_msg").hide())};return n.WebRequest({url:t,type:"post",data:e.data,subject_user:s.Viewer.get_viewer().work_user,success:a,error:l})}Object.defineProperty(t,"__esModule",{value:!0});t.ready=r,t.get_groups_for_user=a,t.get_group_info=l,t.get_groups_for_team=c,t.get_users_for_group=u,t.create_group=d,t.create_group_with_users=_,t.remove_group=p,t.rename_group=m,t.add_users_to_group=h,t.remove_user_from_group=f,t.change_group_member_type=v,t.remove_namespace_from_group=b,t.change_group_access_typefunction=g,t.make_group_join_request=w,t.metaserver_ajax=y}),define("modules/clean/growth/shared_link_signup_modals",["require","exports","jquery","modules/clean/ajax","modules/clean/analytics","modules/clean/auth_event_logger","modules/clean/dbmodal","modules/clean/growth/experiments/logger","modules/clean/legacy_pyxl_controllers/login_form","modules/clean/register_form","modules/clean/sharing/signup_modal_proxy","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,o,n,i,s,r,a,l,c,u,d,_,p){"use strict";return(function(){function t(e){var t=this;this.init_modals=this.init_modals.bind(this),this.before_signup_modal=this.before_signup_modal.bind(this),this.before_default_signup_modal=this.before_default_signup_modal.bind(this),this.before_download_signup_modal=this.before_download_signup_modal.bind(this),this.before_create_password_modal=this.before_create_password_modal.bind(this),this.show_welcome_modal=this.show_welcome_modal.bind(this),this.show_create_password_modal=this.show_create_password_modal.bind(this),this.on_request_direct_download=this.on_request_direct_download.bind(this),this.on_request_default_signup=this.on_request_default_signup.bind(this),this.handle_direct_download=this.handle_direct_download.bind(this),this.handle_direct_download_cancel=this.handle_direct_download_cancel.bind(this),this.handle_default_modal_authenticate=this.handle_default_modal_authenticate.bind(this),this.handle_default_modal_cancel=this.handle_default_modal_cancel.bind(this),this.direct_download=this.direct_download.bind(this),this.save_to_dropbox=this.save_to_dropbox.bind(this),this.show_login_form=this.show_login_form.bind(this),this.register_success=this.register_success.bind(this),this.kind=e,this.init_modals(),u.connectModal(this),"immediate"===this.kind&&(i.WebMiscActivityLogger.log("signup_modal-show-upfront",{auth_google:null!=o.find(".auth-google")}),this.default_signup_modal.show()),"download"!==this.kind?(o("#download_button_link, #default_content_download_button").click(this.direct_download),this.has_seen_modal=!0):o("#download_button_link, #default_content_download_button").click(function(){return t.has_seen_modal?t.direct_download():(t.has_seen_modal=!0,i.WebMiscActivityLogger.log("signup_modal-show-download",{auth_google:null!=o.find(".auth-google")}),t.download_type="direct_download",t.download_signup_modal.show())}),o(".add_to_my_dropbox_link, #default_content_a2md").click(function(){return t.download_type="add_to_dropbox",t.download_signup_modal.show()})}return t.prototype.init_modals=function(){var e=this;return this.default_signup_modal=new r.DBModal({element_id:"shared-link-immediate-signup-modal"}),this.default_signup_modal.before_show=this.before_default_signup_modal,this.default_signup_modal.on_hide=function(){if(!e._has_authenticated)return"function"==typeof e._on_default_modal_cancel?e._on_default_modal_cancel():void 0},this.download_signup_modal=new r.DBModal({element_id:"shared-link-download-signup-modal"}),this.download_signup_modal.before_show=this.before_download_signup_modal,this.download_signup_modal.on_hide=function(){if(!e._direct_download_started)return"function"==typeof e._on_direct_download_cancel?e._on_direct_download_cancel():void 0},this.welcome_modal=new r.DBModal({element_id:"shared-link-welcome-modal"}),this.welcome_modal.before_show=this.before_welcome_modal,this.create_password_modal=new r.DBModal({element_id:"shared-link-create-password-modal"}),this.create_password_modal.before_show=this.before_create_password_modal},t.prototype.before_signup_modal=function(e){var t=this;e.find(".toggle-form-link").click(function(){return t.toggle_form(e)});var o=e.find(".register-form");o.length&&(o.on(c.RegisterForm.NEW_ACCOUNT_FROM_3RD_PARTY,function(o,n){return t.profile_info=n,t.show_create_password_modal(e,t.profile_info)}),o.on(c.RegisterForm.USER_EXISTS,function(o){return t.show_login_form(e,o)}),o.on(c.RegisterForm.REGISTER_SUCCESS,function(e,o){return t.user_info=o,t.register_success(t.user_info)}));var n=e.find(".login-form");if(n.length)return n.on(l.LOGIN_SUCCESS,function(e,o){return t.user_info=o,p.success(_._("Successfully signed in to Dropbox")),t.download_type?"direct_download"===t.download_type?(t.direct_download(),t.reload()):"add_to_dropbox"===t.download_type?t.save_to_dropbox(!1):void 0:t.reload()})},t.prototype.before_default_signup_modal=function(e){var t=this;return this.before_signup_modal(e),e.find(".close-link").click(function(){return t.default_signup_modal.hide()})},t.prototype.before_download_signup_modal=function(e){var t=this;return this.before_signup_modal(e),this._direct_download_started=!1,"add_to_dropbox"===this.download_type&&(e.find(".login-form-component").is(":visible")||this.toggle_form(e)),e.find(".close-link").click(function(){return t.direct_download(),t.download_signup_modal.hide()})},t.prototype.before_create_password_modal=function(e){var t=this;return e.find(".close-link").click(function(){return t.create_password_modal.hide()}),e.find(".create-password-form-component").find(".register-form").on(c.RegisterForm.REGISTER_SUCCESS,function(e,o){return t.user_info=o,t.register_success(t.user_info)})},t.prototype.before_welcome_modal=function(e){return a.log("sharing","shared_link_welcome_modal_view"),e.find(".go-to-dropbox-button").click(function(){return a.log("sharing","shared_link_welcome_modal_button_click")}),e.find(".welcome-modal-no-thanks a").click(function(){return d.reload()})},t.prototype.show_welcome_modal=function(){return this.default_signup_modal.hide(),this.download_signup_modal.hide(),this.welcome_modal.show()},t.prototype.show_create_password_modal=function(e,t){this.default_signup_modal.hide(),this.download_signup_modal.hide();var o={".input-fname":this.profile_info.fname,".input-lname":this.profile_info.lname,".input-email":this.profile_info.email,"input[name=email_sig]":this.profile_info.email_sig,"input[name=refresh_token]":this.profile_info.refresh_token};return this.create_password_modal.show("input[name=password]",o)},t.prototype.on_request_direct_download=function(){return this.has_seen_modal?this.direct_download():(this.has_seen_modal=!0,i.WebMiscActivityLogger.log("signup_modal-show-download",{auth_google:null!=o.find(".auth-google")}),this.download_type="direct_download",this.download_signup_modal.show())},t.prototype.on_request_default_signup=function(){return this.download_type="add_to_dropbox",this._has_authenticated=!1,this.default_signup_modal.show()},t.prototype.handle_direct_download=function(e){return this._direct_download_override_callback=e},t.prototype.handle_direct_download_cancel=function(e){return this._on_direct_download_cancel=e},t.prototype.handle_default_modal_authenticate=function(e){return this._on_default_modal_authenticate=e},t.prototype.handle_default_modal_cancel=function(e){return this._on_default_modal_cancel=e},t.prototype.direct_download=function(){if(this._direct_download_started=!0,null!=this._direct_download_override_callback)return void this._direct_download_override_callback();var e=d.get_uri().updateQuery({dl:1});return d.redirect(e)},t.prototype.reload=function(){return d.reload()},t.prototype.save_to_dropbox=function(t){var o=this;return e(["legacy_js/dropbox"],function(e){var i=e.SharingModel;if(null!=o._on_default_modal_authenticate)return o._on_default_modal_authenticate(o.user_info.id),o._has_authenticated=!0,void o.default_signup_modal.hide();t||p.success(_._("Saving to your Dropbox ..."));var s=i.c2d_vars;return s.job=i.is_folder,n.WebRequest({url:i.c2d_url,data:s,subject_user:o.user_info.id,success:function(e){if(!t)return p.success(_._("Successfully saved to your Dropbox.")),d.redirect(e)}})}),null},t.prototype.show_login_form=function(e,t){var o=e.find(".login-form-component"),n=o.find(".login-form");for(var i in t.prefill){var s=t.prefill[i];n.find(i).val(s)}if(n.find(t.focus).focus(),!o.is(":visible"))return this.toggle_form(e,!0)},t.prototype.toggle_form=function(e,t){var n=e.find(".register-form-component"),i=e.find(".login-form-component");return n.is(":visible")?(s.AuthEventLogger.log_intent(),n.fadeOut({complete:function(){if(i.show(),null!=t)return setTimeout(function(){return o(i.find(".login-form .login-password input[name='login_password']")[0]).focus()},0)}})):i.fadeOut({complete:function(){return n.show()}})},t.prototype.register_success=function(e){return p.success(_._("Successfully signed up for Dropbox.")),this.download_type?"direct_download"===this.download_type?(this.direct_download(),this.show_welcome_modal()):"add_to_dropbox"===this.download_type?this.save_to_dropbox(!1):void 0:this.show_welcome_modal()},t})()}),define("modules/clean/legacy_pyxl_controllers/bubble_picker",["require","exports","jquery","modules/clean/keycode"],function(e,t,o,n){"use strict";var i=(function(){function e(e){this._listen=this._listen.bind(this),this.set_value=this.set_value.bind(this),this.hide_dropdown=this.hide_dropdown.bind(this),this.show_dropdown=this.show_dropdown.bind(this),this.disable_option=this.disable_option.bind(this),this.enable_option=this.enable_option.bind(this),this._on_option_mouseenter=this._on_option_mouseenter.bind(this),this._on_option_keydown=this._on_option_keydown.bind(this),this._on_button_keydown=this._on_button_keydown.bind(this),this.$bubble_picker=e,this.$label_wrapper=this.$bubble_picker.find(".bubble-picker-label-wrapper"),this.$label_wrapper.on("keydown",this._on_button_keydown),this.$label=this.$bubble_picker.find(".bubble-picker-label"),this.$dropdown=this.$bubble_picker.find(".bubble-picker-dropdown"),this.$options=this.$bubble_picker.find("*[role='option']"),this.$options.on("mouseenter",this._on_option_mouseenter),this.$options.on("keydown",this._on_option_keydown),this._dropdown_shown=!1,this._listen()}return e.initClass=function(){this.CHANGED="db:bubblepicker:changed"},e.prototype._listen=function(){var t=this;return o(document).click(function(e){var n=o(e.target).closest(t.$label_wrapper).length>0,i=o(e.target).closest(t.$dropdown).length>0;return t._dropdown_shown&&!i?t.hide_dropdown():n?t.show_dropdown():void 0}),this.$dropdown.find(".bubble-picker-option:not('.disabled')").click(function(n){n.preventDefault();var i=o(n.currentTarget);if(!i.hasClass("disabled")){var s=t.get_value();return t.set_value(i.data("value")),t.$bubble_picker.trigger(e.CHANGED,{clicked_val:i.data("value"),old_val:s}),t.hide_dropdown(),t.$label_wrapper.focus()}})},e.prototype.get_value=function(){return this.$bubble_picker.attr("data-selected-value")},e.prototype.set_value=function(e){this.$bubble_picker.attr("data-selected-value",e),this.$label.empty(),this.$bubble_picker.find(".bubble-picker-option--selected").removeClass("bubble-picker-option--selected");var t=this.$bubble_picker.find("[data-value='"+e+"']").addClass("bubble-picker-option--selected");return this.$label.html(t.clone().html())},e.prototype.hide_dropdown=function(){return this.$dropdown.hide(),this.$label_wrapper.attr("aria-expanded",!1),this._dropdown_shown=!1},e.prototype.show_dropdown=function(){var e;this.$dropdown.show(),this.$label_wrapper.attr("aria-expanded",!0),this._dropdown_shown=!0,this.$options.attr({tabindex:-1,"aria-selected":!1});var t=this.$bubble_picker.attr("data-selected-value");return e=t?this.$bubble_picker.find(".bubble-picker-option[data-value='"+t+"']")[0]:this.$bubble_picker.find(".bubble-picker-option")[0],o(e).attr({tabindex:0,"aria-selected":!0}).focus()},e.prototype.disable_option=function(e,t){var n=this.$bubble_picker.find(".bubble-picker-option[data-value="+e+"]:not('.disabled')");if(n.length>0){var i=o(n.find(".role-option"));i.attr("saved-title",i.attr("title")),i.attr("title",t),i.attr("aria-disabled",!0)}return n.addClass("disabled")},e.prototype.enable_option=function(e){var t=this.$bubble_picker.find(".bubble-picker-option.disabled[data-value="+e+"]"),n=o(t.find(".role-option"));return n.attr("saved-title")&&(n.attr("title",n.attr("saved-title")),n.removeAttr("saved-title")),n.attr("aria-disabled",!1),t.removeClass("disabled")},e.prototype._change_focus=function(e,t){return o(e).attr({tabindex:-1,"aria-selected":!1}),o(t).attr({tabindex:0,"aria-selected":!0}).focus()},e.prototype._focus_previous=function(e){var t=this.$options.index(e);if(t>0)return this._change_focus(e,this.$options.get(t-1))},e.prototype._focus_next=function(e){var t=this.$options.index(e);if(t<this.$options.length-1)return this._change_focus(e,this.$options.get(t+1))},e.prototype._on_option_mouseenter=function(e){return this.$dropdown.removeClass("bubble-picker-dropdown--keyboard")},e.prototype._on_option_keydown=function(e){this.$dropdown.addClass("bubble-picker-dropdown--keyboard"),e.keyCode===n.KeyCode.ESC?(this.hide_dropdown(),this.$label_wrapper.focus()):e.keyCode===n.KeyCode.DOWN?(this._focus_next(e.target),e.preventDefault()):e.keyCode===n.KeyCode.UP?(this._focus_previous(e.target),e.preventDefault()):e.keyCode!==n.KeyCode.TAB||e.shiftKey||this.hide_dropdown()},e.prototype._on_button_keydown=function(e){e.keyCode===n.KeyCode.ENTER?this.$dropdown.addClass("bubble-picker-dropdown--keyboard"):e.keyCode===n.KeyCode.TAB&&e.shiftKey&&this.hide_dropdown()},e})();return i.initClass(),i}),define("modules/clean/legacy_pyxl_controllers/role_picker",["require","exports","tslib","external/lodash","modules/clean/multiaccount_login","modules/clean/page_role_observer","modules/clean/viewer","modules/core/controller_helpers","modules/core/exception"],function(e,t,o,n,i,s,r,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c={ALL:"all",PERSONAL:"personal",WORK:"work"};t.RolePickerState=c;var u=(function(){function e(e){null==e&&(e={}),this.get_state=this.get_state.bind(this),this.set_state=this.set_state.bind(this),this.ensure_role_is_visible=this.ensure_role_is_visible.bind(this),this.is_role_visible=this.is_role_visible.bind(this),this.is_user_visible=this.is_user_visible.bind(this),this._do_login=this._do_login.bind(this),this._actually_set_state=this._actually_set_state.bind(this),this._allow_merged_state=null==e.allow_merged_state||e.allow_merged_state,this._limit_to_role=null!=e.limit_to_role?e.limit_to_role:null;var t=r.Viewer.get_viewer(),o=t.is_role_signed_in(c.PERSONAL)&&t.is_role_signed_in(c.WORK);if(e.initial_state){var i=n.values(c);l.assert(Array.from(i).includes(e.initial_state),"RolePicker requires initial_state to be one of: "+i),this.set_state(e.initial_state)}else if(this._allow_merged_state&&o)this.set_state(c.ALL);else{var s=t.get_users();l.assert(s.length,"tried to use RolePicker on a page with no users");var a=s[0];this.set_state(a.role)}}return e.prototype.get_state=function(){return this._state},e.prototype.set_state=function(e){var t;if(l.assert(this._allow_merged_state||e!==c.ALL,"tried to set merged state in non-merged picker"),null!=this._limit_to_role&&l.assert(e===c.ALL||e===this._limit_to_role,"some awful assert about roles"),e===c.ALL){for(var o=0,n=["personal","work","photos"];o<n.length;o++)if(t=n[o],!r.Viewer.get_viewer().is_role_signed_in(t))return void this._do_login(t,e)}else if(t=e,!r.Viewer.get_viewer().is_role_signed_in(t))return void this._do_login(t,e);return this._actually_set_state(e)},e.prototype.update_picker_ui=function(){},e.prototype.ensure_role_is_visible=function(e){if(!this.is_role_visible(e))return this._allow_merged_state?this.set_state(c.ALL):this.set_state(e)},e.prototype.is_role_visible=function(e){return this._state===c.ALL||this._state===e},e.prototype.is_user_visible=function(e){return this.is_role_visible(e.role)},e.prototype._do_login=function(e,t){var o=this;return i.show_modal({role:e,on_success:function(){return o._actually_set_state(t)}})},e.prototype._actually_set_state=function(e){if(e!==this._state)return this._state=e,this.update_picker_ui(),"function"==typeof this.on_state_change?this.on_state_change(e):void 0},e})();t.RolePicker=u;var d=(function(e){function t(t,o){var n=this;return null==o&&(o={}),t.find(".bubble-picker").on("db:bubblepicker:changed",function(e,t){n.on_ui_change(e,t)}),n=e.call(this,o)||this,n.on_ui_change=n.on_ui_change.bind(n),n.update_picker_ui=n.update_picker_ui.bind(n),n.limit_to_role=n.limit_to_role.bind(n),n.$container=t,n.$bubble_picker=n.$bubble_picker,n}return o.__extends(t,e),t.prototype.on_ui_change=function(e,t){var o=t.clicked_val;if(o!==this._state)return a.get_controller(this.$bubble_picker).set_value(this._state),this.set_state(o)},t.prototype.update_picker_ui=function(){return a.get_controller(this.$bubble_picker).set_value(this._state)},t.prototype.limit_to_role=function(e,t){var o,n;if(null!=e){this.ensure_role_is_visible(e);for(o in c)n=c[o],n!==e&&n!==c.ALL&&a.get_controller(this.$bubble_picker).disable_option(n,t)}else for(o in c)n=c[o],a.get_controller(this.$bubble_picker).enable_option(n);return this._limit_to_role=e},t})(u);t.RoleSelect=d;var _=(function(e){function t(t,o){return null==o&&(o={}),o.allow_merged_state=!1,e.call(this,t,o)||this}return o.__extends(t,e),t.prototype.on_state_change=function(e){var t=(function(){switch(e){case c.PERSONAL:return"personal";case c.WORK:return"work"}})();return s.emit(t)},t})(d);t.PageRoleSelect=_}),define("modules/clean/payments/dfb_util",["require","exports","tslib","external/lodash","modules/clean/ajax","modules/clean/payments/validation","modules/clean/payments/cash","modules/core/exception"],function(e,t,o,n,i,s,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(){function e(e,t,o,n,i,s,r){this.plan_ids=e,this.schedule_ids=t,this.license_ids_and_counts=o,this.currencies=n,this.country_code=i,this.zip_code=s,this.vat_id=r,this.renew=!1,this.discount_ratio=0,this.discount_allow_monthly=!1}return e.prototype.set_only_license_count=function(e){var t=Object.keys(this.license_ids_and_counts)[0];this.license_ids_and_counts[t]=e},e.prototype.get_only_license_count=function(){var e=Object.keys(this.license_ids_and_counts)[0];return this.license_ids_and_counts[e]},e.prototype.set_country_code=function(e){this.country_code=e},e.prototype.set_zip_code=function(e){this.zip_code=e},e.prototype.set_currencies=function(e){this.currencies=e},e.prototype.set_renew=function(e){this.renew=e},e.prototype.set_discount_ratio=function(e){this.discount_ratio=e},e.prototype.set_discount_allow_monthly=function(e){this.discount_allow_monthly=e},e.prototype.set_vat_id=function(e){""!==e&&s.validateVat(this.country_code||"",e)?this.vat_id=e:this.vat_id=""},e.prototype.cache_key=function(e){void 0===e&&(e=!1);var t;return this.currencies&&!e&&(t=this.currencies.join(",")),[this.plan_ids.join(","),this.schedule_ids.join(","),this.get_only_license_count(),t,this.country_code,this.zip_code,this.vat_id,this.renew,this.discount_ratio].join(":")},e.prototype.to_json=function(){var e=this.renew?{renew:1}:{};return o.__assign({},e,{plan_ids:JSON.stringify(this.plan_ids),schedule_ids:JSON.stringify(this.schedule_ids),license_ids_and_counts:JSON.stringify(this.license_ids_and_counts),currencies:this.currencies?JSON.stringify(this.currencies):"",country_code:this.country_code,zip_code:this.zip_code,vat_id:this.vat_id,discount_percentage:JSON.stringify(100*this.discount_ratio),discount_allow_monthly:this.discount_allow_monthly})},e.from_transition_view_models=function(t){for(var o,i=[],s=[],r=[],l=null,c=null,u=null,d=0,_=t;d<_.length;d++){var p=_[d],m=void 0;if(i.push(p.state.plan.id),s.push(p.state.schedule.id),r.push(p.state.currency),void 0===o){o={};for(var h=0,f=p.state.allocated_licenses;h<f.length;h++)m=f[h],o[m.license_id]=m.license_count;n.isObject(p.read_only_invoice)&&(l=p.read_only_invoice.tax_country_code||null,c=p.read_only_invoice.tax_exclusion_id||null,u=p.read_only_invoice.tax_zip_code||null)}else{a.assert(p.state.allocated_licenses.length===Object.keys(o).length,"License sets differ");for(var v=0,b=p.state.allocated_licenses;v<b.length;v++)m=b[v],a.assert(o.hasOwnProperty(""+m.license_id),"License sets differ"),a.assert(o[m.license_id]===m.license_count,"License count must match");a.assert(l===(p.read_only_invoice?p.read_only_invoice.tax_country_code||null:null),"country code must match"),a.assert(u===(p.read_only_invoice?p.read_only_invoice.tax_zip_code||null:null),"zip code must match"),a.assert(c===(p.read_only_invoice?p.read_only_invoice.tax_exclusion_id||null:null),"VAT ID must match")}}return new e(n.uniq(i),n.uniq(s),o||{},n.uniq(r),l,u,c)},e})();t.DfbTransitionSpaceParams=l;var c=(function(){function e(e){if(this.transition_view_model=e,this.transition_view_model.read_only_invoice?this.current_total=r.Cash.fromObject(this.transition_view_model.read_only_invoice.total):this.current_total=new r.Cash(0,this.transition_view_model.state.currency),this.price_token=this.transition_view_model.expected_price,this.transition_view_model.state.per_license_prices.length?this.per_license_price=r.Cash.fromObject(this.transition_view_model.state.per_license_prices[0].price):this.per_license_price=new r.Cash(0,this.transition_view_model.state.currency),this.recurring_total=r.Cash.fromObject(this.transition_view_model.state.total_recurring_price),this.transition_view_model.prices?this.tax=r.Cash.fromObject(this.transition_view_model.prices.tax):this.tax=new r.Cash(0,this.recurring_total.currency),this.transition_view_model.total_recurring_taxes?this.recurring_tax=r.Cash.fromObject(this.transition_view_model.total_recurring_taxes):this.recurring_tax=new r.Cash(0,this.recurring_total.currency),this.recurring_total_tax=this.recurring_total.add(this.recurring_tax),this.tax_percentage=0,this.transition_view_model.read_only_invoice){var t=this.transition_view_model.read_only_invoice.line_items,o=t.length>0?t[0]:void 0;o&&!n.isEmpty(o.country_tax_percentage)?this.tax_percentage=o.country_tax_percentage:o&&!n.isEmpty(o.state_tax_percentage)&&(this.tax_percentage=o.state_tax_percentage)}}return e})();t.DfBTransitionInfo=c;var u=(function(){function e(e){var t=this;this.has_inflight_request=function(){return Object.keys(t.transition_view_model_requests).length>0},this.add_to_cache=function(e,o){void 0===o&&(o=!1);var n=l.from_transition_view_models(e).cache_key(o),i=e.map(function(e){return new c(e)});return t.transition_info_cache[n]=i,i},this.get_transition_info_for=function(e){return t.transition_info_cache.hasOwnProperty(e)?t.transition_info_cache[e]:null},this.default_transition_view_models=e,this.transition_view_model_requests={},this.transition_info_cache={},this.add_to_cache(this.default_transition_view_models)}return e.prototype.get=function(e,t,o){var s=this,r=l.from_transition_view_models(this.default_transition_view_models);t.total_users&&r.set_only_license_count(t.total_users),t.country_code&&r.set_country_code(t.country_code),t.currency&&r.set_currencies([t.currency]),t.remove_currency===!0&&r.set_currencies([]),t.zip_code&&r.set_zip_code(t.zip_code),n.isBoolean(t.renew)&&r.set_renew(t.renew),(t.vat_id||""===t.vat_id)&&r.set_vat_id(t.vat_id),t.discount_ratio&&r.set_discount_ratio(t.discount_ratio),n.isBoolean(t.discount_allow_monthly)&&r.set_discount_allow_monthly(t.discount_allow_monthly);var a=r.cache_key(),c=this.get_transition_info_for(a);return c?void e(c):this.transition_view_model_requests[a]?void 0:(this.transition_view_model_requests[a]=!0,i.SilentBackgroundRequest({url:"/business/transition-model",type:"GET",dataType:"json",data:r.to_json(),success:function(o){delete s.transition_view_model_requests[a],e(s.add_to_cache(o,t.remove_currency))},error:function(e){n.isFunction(o)&&o(e),delete s.transition_view_model_requests[a]}}))},e})();t.DfBTransitionInfoFetcher=u}),define("modules/clean/react/file_sidebar/comments_wrapper_component",["require","exports","tslib","external/react","modules/clean/activity/constants","modules/clean/comments/action_creators","modules/clean/comments/demo_action_creators","modules/clean/comments/store","modules/clean/react/css"],function(e,t,o,n,i,s,r,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(t){function l(o){var n=t.call(this,o)||this;return n.state={commentsLoaded:e.defined("modules/clean/comments/components/file_comments_pane_container")},n}return o.__extends(l,t),l.prototype.componentDidMount=function(){var t=this;this.state.commentsLoaded||e(["modules/clean/comments/components/file_comments_pane_container"],function(){t.setState({commentsLoaded:!0})})},l.prototype.render=function(){var t=this.state.commentsLoaded,o=this.props,l=o.activityContext,c=o.currentFile,u=o.hideComments,d=o.hideCommentsOverride,_=o.isCommentsDemo,p=o.sharedLinkInfo,m=o.shouldInitiallyFocusInput,h=o.user,f=o.showToggleButton;if(u)return null;if(!t)return c.feedback_off||a.areCommentsHidden()?n.createElement("div",null):n.createElement("div",{id:"file-comments",className:"file-feedback"},n.createElement("div",{className:"comment-holder"}));var v=e("modules/clean/comments/components/file_comments_pane_container"),b=_?r:s,g=_?-1:h?h.id:void 0,w=null;switch(l){case i.ActivityContext.BROWSE_FILE_VIEWER:w=c.fq_path;break;case i.ActivityContext.SHARED_CONTENT_LINK_VIEW:case i.ActivityContext.SHARED_LINK_VIEW:p&&(w=p.url)}return n.createElement("div",{className:"react-file-viewer__activity"},n.createElement(v,{actionCreators:b,actorId:g,context:l,contextData:w,currentFile:c,hideCommentsOverride:d,isDemoMode:_,previewSelector:".react-file-viewer__preview .flex-preview-container",shouldInitiallyFocusInput:m,showToggleButton:f}))},l})(n.Component),u=["/static/css/comments-vflqPj4Xj.css","/static/css/comments_annotations-vflT6HX_-.css","/static/css/file_comments_pane-vflMEOpSG.css"],d=l(c,u);t.CommentsWrapperComponent=d}),define("modules/clean/react/file_sidebar/file_sidebar",["require","exports","tslib","external/react","modules/clean/react/css","modules/constants/file_activity_stream","modules/clean/react/file_sidebar/store/file_activity/api","modules/clean/react/file_sidebar/comments_wrapper_component"],function(e,t,o,n,i,s,r,a){"use strict";function l(e){return{activityContext:e.activityContext,hideComments:e.hideComments,isCommentsDemo:e.isCommentsDemo,shouldInitiallyFocusInput:e.shouldInitiallyFocusInput,currentFile:e.currentFile,sharedLinkInfo:e.sharedLinkInfo,user:e.user,showToggleButton:!0}}Object.defineProperty(t,"__esModule",{value:!0});var c=(function(t){function i(o){var n=t.call(this,o)||this;return n._isMounted=!1,n.state={fileSidebarLoaded:e.defined("modules/clean/react/file_sidebar/file_sidebar_component")},n}return o.__extends(i,t),i.prototype.componentDidMount=function(){var t=this;this._isMounted=!0,this.state.fileSidebarLoaded||e(["modules/clean/react/file_sidebar/file_sidebar_component"],function(){t._isMounted&&t.setState({fileSidebarLoaded:!0})})},i.prototype.componentWillUnmount=function(){this._isMounted=!1},i.prototype.render=function(){if(this.state.fileSidebarLoaded){var t=e("modules/clean/react/file_sidebar/file_sidebar_component").FileSidebarComponent;return n.createElement(t,o.__assign({},this.props))}return n.createElement("div",{className:"file-sidebar"})},i})(n.Component);t.StormcrowedInFileSidebar=i(c,["/static/css/file-sidebar-vflLgvyP1.css"]);var u=(function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(i,e),i.prototype.componentDidMount=function(){!s.IS_ON&&s.IS_DARK_LAUNCH_ON&&this.props.user&&new r.FileActivityStreamApi(this.props.user.id).getActivityStream(this.props.currentFile.file_id)},i.prototype.render=function(){
return s.IS_ON?n.createElement(t.StormcrowedInFileSidebar,o.__assign({},this.props)):n.createElement(a.CommentsWrapperComponent,o.__assign({},l(this.props)))},i})(n.Component);t.FileSidebar=u}),define("modules/clean/react/file_viewer/container",["require","exports","tslib","external/react","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/file_viewer","modules/clean/open_in_app/actions","modules/clean/sharing/async_share_modal_util","modules/clean/viewer","modules/clean/web_timing_logger"],function(e,t,o,n,i,s,r,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(t){function u(e){var o=t.call(this,e)||this;o.onCloseViewer=function(){return window.open(o.props.onCloseUrl,"_self")};var n=l.Viewer.get_viewer(),i=e.userId?n.get_user_by_id(e.userId):n.work_user||n.personal_user;return o.state={user:i},o}return o.__extends(u,t),u.prototype.componentWillMount=function(){c.log_js_modules_application_code_start();var e=this.props.sharedLinkInfo?[this.props.sharedLinkInfo]:[],t=this.props.shareToken?[this.props.shareToken]:[],o=this.props.sharePermissions?[this.props.sharePermissions]:[],n={sharedLinkInfos:e,shareTokens:t,sharePermissions:o,disableFlipping:!1};i.setup(this.props.files,this.props.currentIndex,this.state.user,n)},u.prototype.componentWillUnmount=function(){i.cleanup()},u.prototype.componentDidMount=function(){var t=this,o=this.props.shareEmail;if(o&&this.state.user&&new Promise(function(t,o){e(["modules/clean/react/browse/models"],t,o)}).then(function(e){var n=e.File;a.asyncShowPrefilledShareModal({user:t.state.user,sharePrefillEmail:o,content:new n(t.props.files[t.props.currentIndex])})}),this.props.openImmediatelyInApp){var n=this.props.files[this.props.currentIndex];r.openImmediately(n.open_in_app_data)}},u.prototype.render=function(){var e=this.props,t=e.fileViewerProps;return null!=e.onCloseUrl&&(t.onCloseViewer=this.onCloseViewer),n.createElement(s.FileViewer,o.__assign({},t,{transparentBackground:!0}))},u})(n.Component);t.FileViewerContainer=u}),define("modules/clean/react/share_sync/actions",["require","exports","modules/clean/multiaccount_login","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/viewer"],function(e,t,o,n,i){"use strict";function s(e,t,s){new Promise(function(e,n){i.Viewer.get_viewer().is_role_signed_in(t)?e():o.show_modal({role:t,on_success:function(){e()}})}).then(function(){n.mountSharedFolder(e,t,s)})}Object.defineProperty(t,"__esModule",{value:!0}),t.syncToDropbox=s}),define("modules/clean/react/share_sync/button",["require","exports","tslib","external/react","modules/clean/filepath","modules/clean/react/bubble_menu","modules/clean/react/share_sync/models","modules/clean/react_format","modules/clean/sharing/constants","modules/clean/sharing/views/sync_coachmark","modules/clean/react/sprite_div","modules/clean/viewer","modules/core/i18n","modules/constants/payments"],function(e,t,o,n,i,s,r,a,l,c,u,d,_,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.render=function(){var e=this.props.options.map(function(e){return n.createElement(s.BubbleMenuItem,{onClick:function(){return e.handler()},disabled:e.isDisabled},n.createElement(u,{group:"web",name:e.spriteName,text:e.text}))});return n.createElement(s.BubbleMenu,{targetButton:this.props.targetButton,position:s.BubbleMenu.POSITIONS.BOTTOM,verticalDisplacement:4,items:e})},t})(n.Component),h=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.onClickedOption=function(e,t){e.preventDefault(),t.handler()},t.prototype.getSyncOptions=function(){var e=this,t=this.props.sharePermission.canSyncToDropboxRoles,o=d.Viewer.get_viewer();return t.map(function(t){return r.ShareSyncActionOption.buildOption(e.props.folder,o,t,l.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE)})},t.prototype.renderSyncCoachmark=function(){var e=this.props.sharePermission.canSyncToDropboxRoles.length>0;return this.props.showSyncCoachmark&&e?n.createElement("div",{className:"sync-button__coachmark-container"},n.createElement(c.SharingSyncCoachmark,null)):null},t.prototype.renderSyncButton=function(){var e=this;if(""!==this.props.shareToken.subPath)return null;if(0===this.props.sharePermission.canSyncToDropboxRoles.length)return null;var t="button-primary control__button sync-button";if(this.props.outOfQuota){var o=p.BUY_URL;return n.createElement("a",{className:t,href:o},_._("Upgrade to Add Folder"))}var s=void 0;if(this.props.user&&this.props.user.is_cdm_member){var r=i.filename(this.props.user.cdm_tmf_path);s=r.length>25?_._("Add to my member folder"):a.reactFormat(_._("Add to <strong>%(cdm_tmf_name)s</strong> folder"),{cdm_tmf_name:r,strong:n.createElement("strong",{style:{fontWeight:800}})})}else s=_._("Add to Dropbox");var l=this.getSyncOptions();if(1===l.length)return n.createElement("button",{className:t,style:{display:"-webkit-box"},onClick:function(t){return e.onClickedOption(t,l[0])}},s);var c=n.createElement("button",{className:t},s);return n.createElement(m,{targetButton:c,folder:this.props.folder,shareToken:this.props.shareToken,options:l})},t.prototype.render=function(){return n.createElement("div",null,this.renderSyncCoachmark(),this.renderSyncButton())},t})(n.Component);t.ShareSyncButton=h}),define("modules/clean/react/share_sync/models",["require","exports","tslib","external/immutable","external/react","modules/clean/filepath","modules/clean/react/share_sync/actions","modules/clean/react_format","modules/core/i18n"],function(e,t,o,n,i,s,r,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c={text:void 0,handler:void 0,isDisabled:!1,spriteName:void 0},u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.buildOption=function(e,o,n,c){var u=l._("Save to my Dropbox"),d="dropbox",_=o.get_user_by_role(n);if(_&&_.is_cdm_member){var p=s.filename(_.cdm_tmf_path);u=p.length>12?l._("Save to my member folder"):a.reactFormat(l._("Save to <strong>%(cdm_tmf_name)s</strong> folder"),{cdm_tmf_name:p,strong:i.createElement("strong",null)}),o.is_paired&&(d="s_briefcase")}else if(o.is_paired)switch(n){case"personal":u=l._("Save to personal Dropbox"),d="s_house";break;case"work":u=l._("Save to %(team_name)s Dropbox").format({team_name:o.team_name}),d="s_briefcase"}return new t({text:u,handler:function(){r.syncToDropbox(e.shared_folder_id,n,c)},spriteName:d})},t})(n.Record(c));t.ShareSyncActionOption=u}),define("modules/clean/react/shared_link/actions",["require","exports","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/core/browser"],function(e,t,o,n,i){"use strict";function s(e,t,i){return new Promise(function(s,r){return n.deleteLinkWithConfirmLegacy({client:new o.ShareApiClient({userId:e}),contentName:i,onCancel:r,onDeleteLink:s,tkey:t})})}function r(e,t,o){return s(e,t,o).then(function(){return i.redirect("/home")})}Object.defineProperty(t,"__esModule",{value:!0}),t.removeLink=s,t.removeLinkAsNonOwner=r}),define("modules/clean/sharing/notifications",["require","exports","jquery","modules/clean/browse_interface","modules/clean/sharing/api/client","modules/clean/sharing/ui_notifications_util","modules/clean/viewer","modules/constants/payments","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,o,n,i,s,r,a,l,c,u){"use strict";function d(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var _=function(e){var t=o(e).closest("form");return d(t.closest(".sc-invite-action"),function(e){return e.addClass("loading")}),t.length&&new i.ShareApiClient({userId:t[0]._subject_uid.value}).dismissInviteNotification({contentId:t[0].content_id.value}).finally(function(){return t.closest(".sc-invite-action").removeClass("loading"),t.closest(".feed-row").remove()}),!1};t.register_dismiss=_;var p=function(e){var t=o(e);t.closest(".sc-invite-action").addClass("loading");var a=r.Viewer.get_viewer().get_user_by_id(e._subject_uid.value);return new i.FolderShareApiClient({userId:a.id}).mount({contentId:e.sf_id.value,origin:"NOTIFICATION_WEB"}).then(function(e){t.closest(".sc-invite-action").addClass("sf-mounted");var o=e.path_lower,i=new u({path:n.get_browse_root(a)+o}).toString();return l.redirect(i),s.sharingNotificationSuccess(c._("Added the shared folder %(folder_name)s.").format({folder_name:e.name}))}).finally(function(){return t.closest(".sc-invite-action").removeClass("loading")}),!1};t.register_mount=p;var m=function(){s.sharingNotificationInfo(c._("Continue upgrading to add the shared folder to your Dropbox."));var e=a.BUY_URL,t=new u({scheme:"https",authority:"www.dropbox.com",path:e});return t.updateQuery({cont:"sf",oqa:"sf_aoq_b_n"}),l.redirect(t.toString()),!1};t.upgrade_to_mount=m}),define("modules/clean/sharing/views/sync_coachmark",["require","exports","tslib","external/react","modules/clean/ajax","modules/clean/react/bubble","modules/clean/react/css","modules/clean/react/image","modules/clean/static_urls","modules/core/i18n"],function(e,t,o,n,i,s,r,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=c.i18n_default_project("sharing")._,d=(function(e){function t(){var t=e.call(this)||this;return t.hideSyncCoachmark=function(){t.setState({show:!1})},t.state={show:!0},t}return o.__extends(t,e),t.prototype.componentWillMount=function(){i.BackgroundRequest({url:"/sharing/seen_sync_coachmark"})},t.prototype.render=function(){return this.state.show?n.createElement(s,{arrow:s.ARROW.TOP_RIGHT,className:"sync-coachmark u-pad-s"},n.createElement(a.Image,{className:"u-l-ib",src:l.static_url("/static/images/sharing/sync_coachmark-vflyzarQZ.png"),srcHiRes:l.static_url("/static/images/sharing/sync_coachmark@2x-vflMrQ12G.png")}),n.createElement("div",{className:"u-l-ib u-pad-left-s sync-coachmark__content"},n.createElement("h2",null,u("Stay in sync")),n.createElement("p",null,u("For easy access to this folder in the future, add it to your Dropbox.")),n.createElement("button",{className:"c-btn c-btn--secondary",onClick:this.hideSyncCoachmark},u("Got it")))):n.createElement("div",null)},t.displayName="SharingSyncCoachmark",t})(n.Component);t.SharingSyncCoachmark=r(d,["/static/css/sharing/sync_coachmark-vfl_8vkAL.css"])}),define("modules/clean/teams/limited_team_invite_form",["require","exports","tslib","external/classnames","external/react","modules/core/uri","modules/core/i18n","modules/clean/react_format","modules/clean/ajax","modules/clean/css","modules/clean/contacts/contact_token_state","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/react/input"],function(e,t,o,n,i,s,r,a,l,c,u,d,_,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=i.DOM,h=p.textarea,f=(function(){function e(){this.inFlight=!0,this.canInvite=!1,this.reason="checking",this.callbacks=[]}return e.prototype.whenReady=function(e){this.inFlight?this.callbacks.push(e):e()},e.prototype.resultArrived=function(e,t){if(this.inFlight){this.inFlight=!1,this.canInvite=e,this.reason=t;for(var o=0,n=this.callbacks;o<n.length;o++){(0,n[o])()}this.callbacks=[]}},e})(),v=(function(){function e(e){var t=this;this.checkEmails=function(e,o){var n={},i=e.length;if(0===i)return o(n);for(var s=[],r=function(e){var r=t.checkedEmails[e];r||(r=t.checkedEmails[e]=new f,s.push(e)),r.whenReady(function(){n[e]=r,0===--i&&o(n)})},a=0,c=e;a<c.length;a++){r(c[a])}(function(e){l.WebRequest({url:t.checkUrl,data:{emails:e.join(",")},success:function(e){var o=JSON.parse(e);for(var n in o)if(o[n]){var i=o[n],s=i.can_invite,r=i.reason;t.checkedEmails[n]&&t.checkedEmails[n].resultArrived(s,r)}},error:function(){for(var o=0,n=e;o<n.length;o++){var i=n[o];delete t.checkedEmails[i]}}})})(s)},this.getEmailCheckResult=function(e){return t.checkedEmails[e]},this.checkUrl=e,this.checkedEmails={}}return e})();t.InvitationContexts={existingTeam:{id:"existingTeam",checkUrl:"/team/manage/check_can_invite"},createLimitedTeam:{id:"createLimitedTeam",checkUrl:"/team/create_limited/check_can_invite"}};var b={};for(var g in t.InvitationContexts)if(t.InvitationContexts[g]){var w=t.InvitationContexts[g],y=w.id,k=w.checkUrl;b[y]=new v(k)}var C=(function(e){function l(t){var o=e.call(this,t)||this;return o._isUnMounted=!1,o.getContacts=function(){return o.refs.tokenizer.getContacts()},o.getFinalData=function(e){var t;o.refs.tokenizer.tokenizeAll();var n=o.getContacts();o.props.includeCustomMessage&&(t=o.refs.customMessage.getValue()),o._ensureContactsStateUpdated(n,function(){var i=n.filter(function(e){return e.type===_.EMAIL}),s=i.map(function(e){return e.email});o._updateErrorMessage(),e({emails:s,custom_message:t})})},o.areAllContactsValid=function(){if(o._overInviteLimit())return!1;var e=o.refs.tokenizer.serializeInputData().tokens;return 0===e.length||e.every(function(e){return o._validateContact(e).state===u.ContactTokenState.ok})},o.isEmpty=function(){var e=o.refs.tokenizer.serializeInputData(),t=e.tokens,n=e.value;return 0===t.length&&0===n.length},o._ensureContactsStateUpdated=function(e,t){e=e.filter(function(e){return e.type===_.EMAIL&&!e.invalid&&!e.on_team});var n=e.map(function(e){return e.email});o.state.emailCheckerStore.checkEmails(n,function(){o._isUnMounted||t()})},o._validateContact=function(e){var t;if(e.invalid)t={state:u.ContactTokenState.invalid,msg:r._("Invalid email.")};else if(e.on_team)t={state:u.ContactTokenState.invalid,msg:r._("User is already a member of this team.")};else{var n=o.state.emailCheckerStore.getEmailCheckResult(e.email),i=null;n?n.inFlight?t={state:u.ContactTokenState.pending,msg:i}:n.canInvite?t={state:u.ContactTokenState.ok,msg:i}:("team_member"===n.reason?i=r._("This person is already on another team."):"already_on_this_team"===n.reason?i=r._("User is already invited to this team."):"error"===n.reason&&(i=r._("User isnâ€™t eligible to join this team.")),t={state:u.ContactTokenState.invalid,msg:i}):t={state:u.ContactTokenState.invalid,msg:i}}return t},o._overInviteLimit=function(){var e=o.refs.tokenizer.serializeInputData().tokens;return void 0!==o.props.memberInviteLimit&&e.length>o.props.memberInviteLimit},o._updateErrorMessage=function(){for(var e=0,t=o.refs.tokenizer.serializeInputData().tokens;e<t.length;e++){var n=t[e],i=o._validateContact(n),l=i.state,c=i.msg;if(l!==u.ContactTokenState.ok)return void o.setState({errorMessage:c})}if(o._overInviteLimit()){var d={tk:String(o.props.maxTeamSize),_camp:"invite"},_=new s({path:"/team/upgrade",query:d});return void o.setState({errorMessage:a.reactFormat(r.ungettext("You have %(num_rem)s invite remaining. <upgradeLink>Upgrade</upgradeLink> now to add as   many members as you like to your team.","You have %(num_rem)s invites remaining. <upgradeLink>Upgrade</upgradeLink> now to add as   many members as you like to your team.",o.props.memberInviteLimit),{num_rem:o.props.memberInviteLimit,upgradeLink:m.a({href:_.toString()})})})}o.setState({errorMessage:null})},o.onContentsChange=function(e,t){o._ensureContactsStateUpdated(e,function(){o._updateErrorMessage(),o.props.onChange&&o.props.onChange()})},o._customContactFilter=function(e){return!(e.type!==_.EMAIL||e.team||!e.name||e.email===o.props.user.email)},o.state={errorMessage:null,emailCheckerStore:o.props.emailCheckerStore||b[o.props.invitationContext.id]},o}return o.__extends(l,e),l.prototype.componentWillMount=function(){var e=this;c.require_css("/static/css/teams/limited_team_invite_form-vflcSjpys.css"),c.require_css("/static/css/react/contacts_tokenizer-vflQsfYaG.css"),this.props.populatedContacts&&this.props.populatedContacts.length>0&&this._ensureContactsStateUpdated(this.props.populatedContacts,function(){e._updateErrorMessage(),e.props.onChange&&e.props.onChange()})},l.prototype.componentDidUnMount=function(){this._isUnMounted=!0},l.prototype.render=function(){var e,t={"limited-team-invite-form":!0,"error-message-fixed":this.props.errorMessageSpaceFixed,"has-custom-message":this.props.includeCustomMessage};return this.props.includeCustomMessage&&(e=i.createElement(h,{ref:"customMessage",className:"custom-message","disable-errors":!0,placeholder:this.props.messagePlaceholder,value:this.props.populatedCustomMessage})),i.createElement("div",{className:n(t,this.props.customClass)},i.createElement("div",{className:"error-message u-mar-bottom-xss"},this.props.customErrorMessage||this.state.errorMessage),i.createElement(d.ContactsTokenizer,{ref:"tokenizer",user:this.props.user,placeholder:this.props.emailPlaceholder,onContentsChange:this.onContentsChange,autofocus:this.props.autofocusTokenizer,populatedInputData:{tokens:this.props.populatedContacts,value:""},tokenSpacing:this.props.tokenSpacing,customContactValidator:this._validateContact,customContactFilter:this._customContactFilter}),e)},l.displayName="LimitedTeamInviteForm",l.defaultProps={customClass:"",invitationContext:t.InvitationContexts.existingTeam,populatedContacts:[],emailPlaceholder:r._("Name or email"),messagePlaceholder:r._("Add a message (optional)"),includeCustomMessage:!0,autofocusTokenizer:!0},l})(i.Component);t.LimitedTeamInviteForm=C}),define("modules/clean/teams/membership_request_block",["require","exports","tslib","external/react","modules/clean/avatar/triple_avatars","modules/clean/growth/experiments/logger","modules/clean/react/css","modules/clean/viewer","modules/constants/trademark","modules/core/browser","modules/core/cookies","modules/core/i18n","jquery","modules/clean/analytics","modules/clean/teams/membership_discovery_util","modules/constants/teams","modules/core/notify","modules/core/user_i18n"],function(e,t,o,n,i,s,r,a,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=n.createElement,p=n.DOM,m=a.Viewer.get_viewer(),h=d.i18n_default_project("sharing")._,f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isUnloaded:"true"===u.read("_SFUD")},t.onCTAClick=function(){return t._logSFUpsellExpEvent("click_cta"),c.redirect("/business/try?oqa=ujsf")},t.onCloseClick=function(){return t._logSFUpsellExpEvent("click_close"),u.create("_SFUD","true"),t.setState({isUnloaded:!0})},t._logSFUpsellExpEvent=function(e){var o=(null!=m.personal_user?m.personal_user.paid:void 0)?"paid":"basic",n={is_corp_domain:null!=t.props.membershipRequestOptions?t.props.membershipRequestOptions.isViewerCorpDomain:void 0,ns_id:null!=t.props.membershipRequestOptions?t.props.membershipRequestOptions.nsId:void 0,num_users_in_sf:null!=t.props.membershipRequestOptions?t.props.membershipRequestOptions.numMembers:void 0,num_users_same_corp:null!=t.props.membershipRequestOptions?t.props.membershipRequestOptions.numInSameDomain:void 0,user_plan_type:o};return s.log("uj_shared_folder_upsell_v1",e,n)},t}return o.__extends(t,e),t.prototype.componentDidMount=function(){if(!this.state.isUnloaded&&(null!=this.props.membershipRequestOptions?this.props.membershipRequestOptions.expSharedFolderUpsell:void 0))return this._logSFUpsellExpEvent("view")},t.prototype.render=function(){return(null!=this.props.membershipRequestOptions?this.props.membershipRequestOptions.expSharedFolderUpsell:void 0)?this.state.isUnloaded?p.div({}):p.div({className:"membership-request-block"},p.button({className:"membership-request-block__close",onClick:this.onCloseClick}),p.div({className:"u-mar-top-l u-mar-bottom-l"},p.div({className:"membership-request-block__avatars"},_(i.TripleAvatars,{contacts:this.props.membershipRequestOptions.contacts,count:this.props.membershipRequestOptions.numMembers})),p.div({},p.div({className:"membership-request-block__header u-mar-top-s"},h("Create a shared workspace with Dropbox %(trademark_business)s").format({trademark_business:l.TRADEMARK_BUSINESS})),p.div({className:"membership-request-block__subheader u-mar-top-xs"},h("Share, comment on, and edit docs all in one place. Your teamâ€™s space automatically syncs for everyone, so you stay organized and in the flow."))),p.button({className:"mc-button mc-button-large mc-button-primary u-mar-top-s",onClick:this.onCTAClick},h("Try free for 30 days")))):p.div({})},t.displayName="MembershipRequestBlock",t.propTypes={membershipRequestOptions:n.PropTypes.shape({expSharedFolderUpsell:n.PropTypes.bool,contacts:n.PropTypes.arrayOf(n.PropTypes.object),isViewerCorpDomain:n.PropTypes.bool,nsId:n.PropTypes.number,numMembers:n.PropTypes.number,numInSameDomain:n.PropTypes.number})},t.defaultProps={membershipRequestOptions:{expSharedFolderUpsell:!1}},t})(n.Component),v=r(f,["/static/css/scooter/scooter-scoped-vflhQ6850.css","/static/css/teams/membership_request_block-vflDOvWif.css"]);t.MembershipRequestBlock=v}),define("modules/clean/top_notif",["require","exports","jquery","modules/clean/ajax"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={HIDE_EVENT:"db:topnotificationbar:hide",hide:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],i=null!=n?n:{clearPageletCache:!0},s=i.clearPageletCache,r=null==s||s;if(o("#top-notification-bar-container").remove(),o(".top-notification-bar-silo").remove(),o("body").removeClass("top-notification-bar"),o(".embedded-app.IndexRebrandPage.top-notification-bar").removeClass("top-notification-bar"),o(".maestro .has-top-notification").removeClass("has-top-notification"),o(".maestro #notify-wrapper.with-top-notification").removeClass("with-top-notification"),o(document).trigger(this.HIDE_EVENT),r&&window.ensemble&&window.ensemble.clearPageletCache)return window.ensemble.clearPageletCache()}};t.TopNotificationBar=i;var s={init:function(){return o(".eu-bar-dismiss").on("click",function(e){return e.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_eu_cookie_notification"})})}};t.EUCookieNotificationBar=s;var r={init:function(){return o(".expired-ios-bar-dismiss").on("click",function(e){return e.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_expired_ios_notification"})})}};t.ExpiredIOSNotificationBar=r;var a={init:function(){return o("#locale-switch-banner-dismiss").on("click",function(e){return e.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_locale_switch_banner"})})}};t.LocaleSwitchBar=a;var l={init:function(){return o("#super-inactive-recover-bar-dismiss").on("click",function(e){return e.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_super_inactive_recover_bar"})})}};t.SuperInactiveRecoverBar=l;var c={init:function(){return o("#unsupported-browser-dismiss").on("click",function(e){return e.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_browser_msg"})})}};t.UnsupportedBrowser=c;var u={init:function(e){return o(".expired-dismiss").on("click",function(t){return t.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_expired_cc_notification",data:{source:e}})})}};t.ExpiredCCNotificationBar=u;var d={init:function(e){return o(".beta-locale-dismiss").on("click",function(t){return t.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_beta_locale_notification",data:{source:e}})})}};t.BetaLocaleNotificationBar=d});
//# sourceMappingURL=pkg-legacy-aa.min.js-vflfH-wB3.map