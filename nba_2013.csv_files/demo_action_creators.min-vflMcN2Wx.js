define(["require","exports","external/immutable","external/lodash","modules/clean/activity/activity_user","modules/clean/comments/action_creators","modules/clean/comments/action_creators_helpers","modules/clean/comments/actions","modules/clean/comments/models/comment","modules/clean/comments/models/comment_activity","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/contacts/demo_contacts_min","modules/clean/immutability_helper","modules/core/notify","modules/core/i18n"],function(e,t,n,i,o,a,c,s,m,r,u,l,d,v,y,_){"use strict";function f(e){var t=C(e);s.receiveFileActivity(t)}function h(e){for(var t,n=/@\[(dbid:demo\-data\-[0-9]+):.+?\]/g,i=[];null!=(t=n.exec(e));)i.push(t[1]);return i}function C(e){if(0===Object.keys(F).length)for(var t=0,i=d.demoContacts;t<i.length;t++){var a=i[t];F[a.dbx_account_id]=o.ActivityUser.fromDict({id:parseInt(a.dbx_account_id.split("-").slice(-1)[0],10),fname:a.fname,lname:a.lname,display_name:a.name,email:a.email})}for(var c=n.Set(),s=0,m=e.comment_activities;s<m.length;s++){var r=m[s],u=r.comment.raw_comment_text;c=c.union(h(u))}var y=[];return c.forEach(function(e){return y.push(F[String(e)])}),y.push(l.getActivityUser(-1)),v.set(e,"users_to_notify",y)}function b(e,t,n){var o=t.text,a=u.state.activity,d=c.buildCommentMetadata(t,n),v=new m.Comment({comment_gid:i.uniqueId("demo-data-"),commenter:l.getActivityUser(-1),comment_text:o,raw_comment_text:o,when_mses:1e3*Date.now(),resolved:!1,comment_metadata:d}),y=new r.CommentActivityPermissions({user_ids_who_can_delete:[-1]}),_=new r.CommentActivity({activity_key:i.uniqueId("demo-data-"),comment_activities:[],users_to_notify:[],is_seen:!0,highlight_as_unread:!1,comment:v,permissions:y,status:"POSTED"}),h=a.appendComment(e,_);return s.addedComment(),f(h),_}function g(e){b(u.state.activity.activity_key,e,null)}function p(e){i.defer(function(){D(e.activity_key,!1)})}function A(e){p(b(e.targetActivityKey,e.body,null))}function w(e){var t=u.state.createAnnotation.annotation;if(t){p(b(u.state.activity.activity_key,e,t))}}function x(e){}function I(e){f(u.state.activity.purgeCommentByKey(e.commentActivityKey))}function k(e){var t,n=u.state.activity,i=e.commentActivityKey,o=e.resolved;t=o?n.resolveCommentByKey(i):n.unresolveCommentByKey(i),f(t)}function K(e){var t=u.state.activity,n=t.users_to_notify,i=[],o=l.getActivityUser(-1);if(e.subscribed)i=v.push(n,o),y.success(_._("You have been subscribed."));else{for(var c=0,s=0,m=n;s<m.length;s++){c=m[s].id!==o.id?c++:c}i=v.splice(n,c,1),y.success(_._("You have been unsubscribed."))}var r=v.set(t,"users_to_notify",i);a.receiveFileActivity(r)}function P(e){}function S(){}function D(e,t){a.revealCommentInPane({activityKey:e,expandConversation:t})}function U(e){a.revealAnnotationInPreview(e)}function q(){}function B(){}var F={};return i.assignIn({},s,{addFileComment:g,addReply:A,addInlineAnnotation:w,retryPostingComment:x,deleteComment:I,setCommentResolved:k,setCommentSubscribed:K,markConversationSeen:P,showOnboardingIfNecessary:S,revealCommentInPane:D,revealAnnotationInPreview:U,markCommentsTutorialAsDone:q,fetchRevisions:B})});
//# sourceMappingURL=demo_action_creators.min.js-vflL-dEOV.map