define("external/spectrum/icon_mode",["require","exports","tslib","external/spectrum/icon_mode/index"],function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.__exportStar(s,t)}),define("external/spectrum/icon_mode/index",["require","exports","tslib","external/react","external/spectrum/packages/spectrum-icons/templates/stateless","external/spectrum/packages/spectrum-icons/generated/bundles/mode"],function(e,t,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ICONS=i.ICONS,t.IconMode=function(e){var t=e.name,n=i.ICONS[t],a=n.attrs,l=n.innerHtml,c=s.createElement("svg",r.__assign({},a,{dangerouslySetInnerHTML:{__html:l}}));return s.createElement(o.Component,r.__assign({icon:c},e))},t.IconMode.displayName="IconMode"}),define("external/spectrum/packages/spectrum-icons/generated/bundles/mode",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ICONS={list:{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"},innerHtml:'<title>mode-list</title><g fill="#637282" fill-rule="evenodd"><path d="M6 15h2v2H6zM10 15h8v2h-8zM6 11h2v2H6zM10 11h8v2h-8zM6 7h2v2H6zM10 7h8v2h-8z"></path></g>'},tiles:{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"},innerHtml:'<title>mode-tiles</title><g fill="#637282" fill-rule="evenodd"><path d="M7 7h4v4H7zM13 7h4v4h-4zM13 13h4v4h-4zM7 13h4v4H7z"></path></g>'}}}),define("modules/clean/base64",["require","exports"],function(e,t){"use strict";function r(e){var t=[],r=0,s=0,o=0,i=0,n=0;for(e+="";r<e.length;)o=e.charCodeAt(r),o<128?(t[s++]=String.fromCharCode(o),r++):o>191&&o<224?(i=e.charCodeAt(r+1),t[s++]=String.fromCharCode((31&o)<<6|63&i),r+=2):(i=e.charCodeAt(r+1),n=e.charCodeAt(r+2),t[s++]=String.fromCharCode((15&o)<<12|(63&i)<<6|63&n),r+=3);return t.join("")}function s(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=void 0,s=void 0,o=void 0,i=void 0,n=void 0,a=void 0,l=void 0,c=void 0,d=0,u=0,p="",h=[];if(!e)return e;for(;;)if(r=e.charCodeAt(d++),s=e.charCodeAt(d++),o=e.charCodeAt(d++),c=r<<16|s<<8|o,i=c>>18&63,n=c>>12&63,a=c>>6&63,l=63&c,h[u++]=t.charAt(i)+t.charAt(n)+t.charAt(a)+t.charAt(l),!(d<e.length))break;p=h.join("");var f=e.length%3;return(f?p.slice(0,f-3):p)+"===".slice(f||3)}function o(e,t){var s=function(e){return e},o=t?s:r;if("function"==typeof window.atob)return o(window.atob(e));var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=0,a=0,l=[];if(!e)return e;for(e+="";;){var c=i.indexOf(e.charAt(n++)),d=i.indexOf(e.charAt(n++)),u=i.indexOf(e.charAt(n++)),p=i.indexOf(e.charAt(n++)),h=c<<18|d<<12|u<<6|p,f=h>>16&255,m=h>>8&255,_=255&h;if(l[a++]=64===u?String.fromCharCode(f):64===p?String.fromCharCode(f,m):String.fromCharCode(f,m,_),!(n<e.length))break}var S=l.join("");return S=o(S)}Object.defineProperty(t,"__esModule",{value:!0}),t.encode=s,t.decode=o}),define("modules/clean/browse/browse_bolt_client",["require","exports","modules/clean/ajax","modules/clean/bolt","modules/clean/react/browse/constants"],function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e){var t=this;this.startLiveUpdate=function(e){void 0===e&&(e=null),e&&(t.handleUpdate=e),t.updateBoltClient(),t.status=o.BrowseBoltClientStatus.Live},this.onBoltRefresh=function(){t.updateBoltClient(),t.status=o.BrowseBoltClientStatus.Live},this.onBoltUpdate=function(){t.handleUpdate&&t.handleUpdate()},this.updateBoltClient=function(){var e=t.boltData.map(function(e){return new s.SignedChannelState("sfj",e.bolt_unique_id,e.latest_sjid.toString(),e.bolt_token)});t.boltClient?t.boltClient.update_states(e):(t.boltClient=new s.BoltClient(e,t.onBoltUpdate,t.onBoltRefresh),t.boltClient.start())},this.userId=e,this.status=o.BrowseBoltClientStatus.NotReady,this.boltData=[]}return e.prototype.isReady=function(){return this.status!==o.BrowseBoltClientStatus.NotReady},e.prototype.setInitialBoltData=function(e){this.boltData=e,this.status=o.BrowseBoltClientStatus.NotLive},e.prototype.fetchInitialBoltData=function(e){var t=this;this.initialBoltDataRequest&&this.initialBoltDataRequest.abort(),this.initialBoltDataRequest=r.WebRequest({url:"/get_browse_bolt_data",dataType:"json",subject_user:this.userId,success:function(r,s,o){t.setInitialBoltData(r),e()},error:function(e,r,s){t.status=o.BrowseBoltClientStatus.NotReady},complete:function(){delete t.initialBoltDataRequest}})},e.prototype.handleUpdateBoltClient=function(e){this.boltData=e,this.updateBoltClient()},e.prototype.getNsMap=function(){var e={};return this.boltData.forEach(function(t){e[t.bolt_unique_id]=parseInt(t.latest_sjid,10)}),e},e.prototype.stopLiveUpdate=function(){this.status=o.BrowseBoltClientStatus.NotLive,this.boltClient&&this.boltClient.unsubscribe()},e})();t.BrowseBoltClient=i}),define("modules/clean/file_operations/notifications",["require","exports","external/lodash","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/undo","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,r,s,o,i,n,a,l,c,d){"use strict";function u(e,t,r,s,o){var i=function(){return n.rollbackChangeSets({changesets:r,userId:t.id,progressText:c._("Undoing…"),rollbackHints:s?s:void 0,onSuccess:function(){d.success(c._("Undo complete.")),o&&o()}})};a.notifyWithUndo(e,r,i)}function p(e,t){var n=s.browse_uri_for_fq_path(t,e),a=o.Emstring.em_snippet(i.filename(e),40);return{href:n,text:r.escape(a)}}function h(e,t,r,s,o,i){var n;if(s){var a=p(s,t);n=c.ungettext('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:a.href,dest_name:a.text}),n=new l(n)}else n=c.ungettext("Copied %(num_items)d item.","Copied %(num_items)d items.",e).format({num_items:e});u(n,t,r,o,i)}function f(e,t,r,s,o,i){var n;if(s){var a=p(s,t);n=c.ungettext('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:a.href,dest_name:a.text}),n=new l(n)}else n=c.ungettext("Moved %(num_items)d item.","Moved %(num_items)d items.",e).format({num_items:e});u(n,t,r,o,i)}function m(e,t,r,s,o){u(c.ungettext("Deleted %(num_items)d item.","Deleted %(num_items)d items.",e).format({num_items:e}),t,r,s,o)}function _(e,t,r,s){u(c._("Rename complete."),e,t,r,s)}function S(e,t,r){u(c._("Created folder %(folder_name)s.").format({folder_name:e}),t,r)}function g(e){var t=c.ungettext("Permanently deleted %(num)s item.","Permanently deleted %(num)s items.",e).format({num:e});d.success(t)}function w(e){var t,s=e.length;if(1===s){var o=r.escape(i.filename(e[0].fq_path));t=c._("Restored <strong>%(filename)s</strong>.").format({filename:o}),t=new l(t)}else t=c.ungettext("Restored %(num)s file.","Restored %(num)s files.",s).format({num:s});d.success(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.notifyCopySuccess=h,t.notifyMoveSuccess=f,t.notifyDeleteSuccess=m,t.notifyRenameSuccess=_,t.notifyFolderCreationSuccess=S,t.notifyPurgeSuccess=g,t.notifyRestoreSuccess=w}),define("modules/clean/pagination_manager",["require","exports","tslib","modules/clean/ajax","modules/core/i18n","modules/core/notify"],function(e,t,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){this.hasMoreItems=e}return e.prototype.areAllItemsReady=function(){return!this.hasMoreItems},e.prototype.invalidateHasMore=function(){this.hasMoreItems=!0},e.prototype.addDataToAjax=function(e){},e})(),a=(function(){function e(e){this.ajaxURL=e.ajaxURL,this.newDataCallback=e.newDataAvailableCallback,this.autoFetching=!1,this.mode=e.mode,this.keyName=e.keyName,this.items={},this.pages=[],this.nextRequestVoucher=e.firstPage.next_request_voucher,this.userID=e.userID,this.fqPathPrefix=e.fqPathPrefix?"/"+e.fqPathPrefix:"",this.addPage(e.firstPage.items)}return e.prototype.areAllItemsReady=function(){return this.mode.areAllItemsReady()},e.prototype.addPage=function(e){for(var t=[],r=[],s=0,n=e;s<n.length;s++){var a=n[s],l=a[this.keyName];if(null==l)return void i.warning(o._("Invalid server response"));null==this.items[l]&&(this.items[l]=a,r.push(a),t.push(l))}this.pages.push(t),this.newDataCallback(this,r)},e.prototype.startAutoFetching=function(){this.autoFetching=!0,this.fetchNext()},e.prototype.stopAutoFetching=function(){this.autoFetching=!1},e.prototype.reSync=function(e){void 0===e&&(e=!1),e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]);var t=this.autoFetching&&this.mode.areAllItemsReady();this.mode.invalidateHasMore(),t&&this.startAutoFetching()},e.prototype.fetchNext=function(){var e=this;if(!this.mode.areAllItemsReady()){var t={};this.nextRequestVoucher&&(t.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(t),s.WebRequest({url:this.ajaxURL,data:t,subject_user:this.userID,success:function(t){var r=JSON.parse(t);e.nextRequestVoucher=r.next_request_voucher,e.mode.hasMoreItems=r.has_more_items,e.autoFetching&&e.fetchNext();for(var s=0,o=r.items;s<o.length;s++){var i=o[s];i.fq_path=e.fqPathPrefix+i.fq_path}e.addPage(r.items)},error:function(){i.error(o._("There was a problem completing this request."))}})}},e.prototype.loadedPageCount=function(){return this.pages.length},e.prototype.getLoadedPage=function(e){var t=this,r=this.pages[e];return null==r?null:r.map(function(e){return t.items[e]})},e.prototype.getLastLoadedPage=function(){return this.getLoadedPage(this.loadedPageCount()-1)},e})();t.BasePaginationManager=a;var l=(function(e){function t(t){return e.call(this,r.__assign({},t,{mode:new n(t.firstPage.has_more_items)}))||this}return r.__extends(t,e),t.create=function(e){return new t(e)},t})(a);t.PaginationManager=l}),define("modules/clean/photos/thumb_loading/buffered_thumb_store",["require","exports","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/web_timing_logger","modules/core/exception"],function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e,t){var o=this;this.isTTI=!1,this.postTTISuccesses=[],this.postTTIErrors=[],this.postTTIRequests=[],this.wrapHandlers=function(e){return{onSuccess:function(t){o.isTTI?e.onSuccess(t):o.bufferCallbacks(o.postTTISuccesses,e,t)},onRequest:function(t){e.onRequest&&(o.isTTI?e.onRequest(t):o.bufferCallbacks(o.postTTIRequests,e,t))},onError:function(){e.onError&&(o.isTTI?e.onError():o.bufferErrorCallback(e))}}},this.innerStore=new r.GenericThumbStore(e,t),s.waitForTTI().then(function(){o.isTTI=!0,o.postTTIRequests.forEach(function(e){var t=e[0].onRequest;t&&t(e[1])}),o.postTTIErrors.forEach(function(e){return e.onError&&e.onError()}),o.postTTISuccesses.forEach(function(e){return e[0].onSuccess(e[1])}),o.postTTIRequests=[],o.postTTIErrors=[],o.postTTISuccesses=[]})}return e.prototype.get_thumb=function(e){return this.isTTI?this.innerStore.get_thumb(e):null},e.prototype.is_batching=function(){return this.innerStore.is_batching()},e.prototype.bind_url=function(e,t){var r=this.isTTI?t:this.wrapHandlers(t);return this.innerStore.bind_url(e,r)},e.prototype.bufferCallbacks=function(e,t,r){o.assert(!this.isTTI,"Should not buffer callback after TTI"),e.push([t,r])},e.prototype.bufferErrorCallback=function(e){o.assert(!this.isTTI,"Should not buffer error callback after TTI"),this.postTTIErrors.push(e)},e.prototype.unbind_url=function(e){this.innerStore.unbind_url(e)},e})();t.BufferedThumbStore=i}),define("modules/clean/react/async_folder_selector_modal",["require","exports"],function(e,t){"use strict";function r(t){e(["modules/clean/react/folder_selector_modal"],function(e){e.FolderSelectorModal.show(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.show=r}),define("modules/clean/react/browse/action_logger",["require","exports","tslib","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/store","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/selectors","modules/clean/web_user_action_logger","modules/clean/web_user_action_events","modules/clean/analytics"],function(e,t,r,s,o,i,n,a,l,c,d){"use strict";function u(){var e=i.getBrowseStore().selectedFiles().toArray(),t=e.filter(function(e){return e.is_dir}).length;return{num_files:e.filter(function(e){return!e.is_dir}).length,num_dirs:t}}function p(e){return e&&!!e.fq_path}function h(e){return e&&!!e.pad_id}function f(e,t,o,i,n){var a=u(),c=a.num_files,d=a.num_dirs,f={num_files_selected:c,num_folders_selected:d,source:t,view_type:i};if(p(n)){var m=n,_=m.request_id,S=m.ns_id,g=m.sjid,w=m.file_id,v=m.fq_path,T=m.bytes,b=m.ext;f=r.__assign({},f,{request_id:_,file_nsid:S,file_sjid:g,file_id:w,file_name:s.filename(v),file_path:v,file_size:T,file_extension:b})}else if(h(n)){var m=n,_=m.request_id;f=r.__assign({},f,{request_id:_})}l.WebUserActionLog.log(e,o,f)}function m(e){var t=e.uid,r=e.entity_type,s=e.view_type,o=e.file_nsid,i=e.file_sjid,n=e.file_id,a=e.file_name,d=e.file_path,u=e.file_size,p=e.file_extension,h=e.request_id;l.WebUserActionLog.log(t,c.WebUserActionLogEvent.SELECT_ROW,{entity_type:r,view_type:s,file_nsid:o,file_sjid:i,file_id:n,file_name:a,file_path:d,file_size:u,file_extension:p,request_id:h})}function _(e){var t=e.uid,r=e.entity_type,s=e.source,o=e.view_type,i=e.file_nsid,n=e.file_sjid,a=e.file_id,d=e.file_name,u=e.file_path,p=e.file_size,h=e.file_extension,f=e.request_id;l.WebUserActionLog.log(t,c.WebUserActionLogEvent.OPEN_ROW,{entity_type:r,source:s,view_type:o,file_nsid:i,file_sjid:n,file_id:a,file_name:d,file_path:u,file_size:p,file_extension:h,request_id:f})}function S(e){var t=e.uid,r=e.view_type;e.file_nsid,e.file_path,e.file_name;l.WebUserActionLog.log(t,c.WebUserActionLogEvent.CREATE_FOLDER,{view_type:r})}function g(e){var t=e.uid,r=e.modal_session_id,s=e.file_nsid,o=e.file_sjid,i=e.file_id,n=e.file_name,a=e.file_path;l.WebUserActionLog.log(t,c.WebUserActionLogEvent.VIEW_SHARE_MODEL,{modal_session_id:r,file_nsid:s,file_sjid:o,file_id:i,file_name:n,file_path:a})}function w(e){var t=e.uid,r=e.show_deleted_files,s=e.view_type;l.WebUserActionLog.log(t,c.WebUserActionLogEvent.TOGGLE_DELETED_FILES,{show_deleted_files:r,view_type:s})}function v(e){var t=e.uid,r=e.sort_by,s=e.sort_direction,o=e.view_type;l.WebUserActionLog.log(t,c.WebUserActionLogEvent.SORT_RECORDS,{sort_by:r,sort_direction:s,view_type:o})}function T(e){var t=e.uid,r=e.isSearchMode;e.view_type;l.WebUserActionLog.log(t,c.WebUserActionLogEvent.SWITCH_VIEW_TYPE,{view_type:o.ViewType.Grid}),r&&d.SearchClientActivityLogger.log("switch_view_type",t,{search_session_id:a.searchSessionID(n.getStoreForSearchBar().getState()),view_type:o.ViewType.Grid})}function b(e){var t=e.uid,r=e.isSearchMode;e.view_type;l.WebUserActionLog.log(t,c.WebUserActionLogEvent.SWITCH_VIEW_TYPE,{view_type:o.ViewType.List}),r&&d.SearchClientActivityLogger.log("switch_view_type",t,{search_session_id:a.searchSessionID(n.getStoreForSearchBar().getState()),view_type:o.ViewType.List})}function F(e){var t=e.uid,r=e.source,s=e.view_type,o=e.file_nsid,i=e.file_path,n=e.file_name,a=u(),d=a.num_files,p=a.num_dirs;l.WebUserActionLog.log(t,c.WebUserActionLogEvent.RESTORE,{num_files:d,num_dirs:p,source:r,view_type:s,file_nsid:o,file_path:i,file_name:n})}function E(e){var t=e.uid,r=e.source,s=e.view_type,o=e.result;f(t,r,c.WebUserActionLogEvent.MOVE,s,o)}function y(e){var t=e.uid,r=e.source,s=e.view_type,o=e.result;f(t,r,c.WebUserActionLogEvent.OPEN_ADD_TO_COLLECTION_MODAL,s,o)}function C(e){var t=e.uid,r=e.source,s=e.view_type,o=e.result;f(t,r,c.WebUserActionLogEvent.COPY,s,o)}function R(e){var t=e.uid,r=e.source,s=e.view_type;f(t,r,c.WebUserActionLogEvent.VERSIONS,s)}function D(e){var t=e.uid,r=e.source,s=e.view_type;f(t,r,c.WebUserActionLogEvent.OPEN_MOVE_MODAL,s)}function A(e){var t=e.uid,r=e.source,s=e.view_type;f(t,r,c.WebUserActionLogEvent.RENAME,s)}function I(e){var t=e.uid,r=e.source,s=e.view_type;f(t,r,c.WebUserActionLogEvent.ADD_COMMENT,s)}function P(e){var t=e.uid,r=e.source,s=e.view_type;f(t,r,c.WebUserActionLogEvent.DOWNLOAD,s)}function N(e){var t=e.uid,r=e.source,s=e.view_type;f(t,r,c.WebUserActionLogEvent.OPEN_COPY_MODAL,s)}function L(e){var t=e.uid,r=e.source,s=e.view_type;f(t,r,c.WebUserActionLogEvent.DELETE,s)}function x(e){var t=e.uid,r=e.source,s=e.view_type;f(t,r,c.WebUserActionLogEvent.PERMANENT_DELETE,s)}Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.MAESTRO_RIGHT_SIDEBAR="MAESTRO_RIGHT_SIDEBAR",e.MAESTRO_PHOTOS_RIGHT_SIDEBAR="MAESTRO_PHOTOS_RIGHT_SIDEBAR",e.LEGACY_HEADER_ACTIONS="LEGACY_HEADER_ACTIONS",e.DRAG="DRAG"})(t.BrowseLogEventSource||(t.BrowseLogEventSource={})),t.logBrowseAction=f,t.logSelectRow=m,t.logOpenRow=_,t.logCreateFolder=S,t.logViewShareModel=g,t.logToggleDeletedFiles=w,t.logSortRecords=v,t.logSwitchToGridView=T,t.logSwitchToListView=b,t.logRestore=F,t.logMoveFiles=E,t.logOpenAddToCollectionModal=y,t.logCopyFiles=C,t.logVersions=R,t.logOpenMoveModal=D,t.logRenameFiles=A,t.logAddComment=I,t.logDownload=P,t.logOpenCopyModal=N,t.logDeleteFiles=L,t.logPermanentDeleteFiles=x}),define("modules/clean/react/browse/actions",["require","exports","tslib","external/lodash","modules/clean/browse_interface","modules/clean/downloads","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/history","modules/clean/previews/constants","modules/clean/react/fileops_actions","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/nav_actions","modules/clean/react/browse/store","modules/constants/python","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/search/constants","modules/clean/react/browse/action_logger","modules/clean/react/file_viewer/async_controller","modules/clean/search/search_results/dispatcher","modules/clean/react/snackbar"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h,f,m,_,S,g,w,v,T,b,F,E,y,C,R){"use strict";function D(){return e("modules/clean/react/file_viewer/controller")}function A(){return e.defined("modules/clean/react/file_viewer/controller")}Object.defineProperty(t,"__esModule",{value:!0});var I=(function(){function e(e){var t=this;this.nameNewFolder=function(){f.BrowseDispatcher.dispatch({type:h.BrowseActionType.REQUEST_FOLDER_NAME})},this.createFolderPending=function(){f.BrowseDispatcher.dispatch({type:h.BrowseActionType.CREATE_FOLDER_PENDING})},this.cancelCreateFolder=function(){f.BrowseDispatcher.dispatch({type:h.BrowseActionType.CANCEL_CREATE_FOLDER})},this.createFolderComplete=function(e){var t=e.folderName,r=e.user,s=e.changesets;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.CREATE_FOLDER_COMPLETE}),n.notifyFolderCreationSuccess(t,r,s)},this.createFolder=function(e){var s=e.folderName,o=e.pathName,i=e.nsId,n=void 0===i?null:i,a=e.checkFSWs,l=S.getBrowseStore().user();t.createFolderPending(),t.dataApi.createNewFolder({pathName:o,folderName:s,nsId:n,checkFSWs:a,userId:l.id,onSuccess:function(o){var i=o.changesets,n=o.createdFolder,a=o.failureDetails;if(a){var c=function(){t.createFolder(r.__assign({},e,{checkFSWs:!1}))};u.showFileSystemWarningsModal({fsws:a,onFinalAccept:c,confirmText:T._("Create folder"),onAbortAction:t.cancelCreateFolder})}else t.createFolderComplete({user:l,folderName:s,changesets:i}),n&&t.selectRowsFromBoltClient([n])},onError:t.cancelCreateFolder})},this.dataApi=e}return e.prototype.initializeEverything=function(e){var t=e.user,r=e.path,s=e.files,o=e.paginatedTotalNumFiles,i=e.urlPrefix,n=e.context,a=e.mountPoints,l=e.shouldShowDeletedFiles,c=e.fqPathsToSelect,d=e.loadingState,u=e.teamFolders;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.INITIALIZE_EVERYTHING,data:{user:t,path:r,files:s,paginatedTotalNumFiles:o,urlPrefix:i,context:n,mountPoints:a,shouldShowDeletedFiles:l,fqPathsToSelect:c,loadingState:d,teamFolders:u}})},e.prototype.load=function(e){var t=e.path,r=e.files,s=e.paginatedTotalNumFiles,o=e.context;_.browseNavActions.load({path:t,files:r,paginatedTotalNumFiles:s,context:o})},e.prototype.add=function(e){var t=e.path,r=e.files,s=e.paginatedTotalNumFiles;_.browseNavActions.add({path:t,files:r,paginatedTotalNumFiles:s})},e.prototype.setLoadingState=function(e){var t=e.loadingState,r=e.path;_.browseNavActions.setLoadingState({loadingState:t,path:r})},e.prototype.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,s=e.files,o=e.paginatedTotalNumFiles;_.browseNavActions.addFilesAndSetLoadingState({path:t,loadingState:r,files:s,paginatedTotalNumFiles:o})},e.prototype.setMountPoints=function(e){var t=e.mountPoints;_.browseNavActions.setMountPoints({mountPoints:t})},e.prototype.setTeamFolders=function(e){var t=e.teamFolders;_.browseNavActions.setTeamFolders({teamFolders:t})},e.prototype.setPath=function(e){var t=e.path,r=e.sortLabel,s=e.sortIsAscending,o=e.onPathLoaded,i=e.nsId,n=e.logFetchedDataRequiredForTTI,a=void 0!==n&&n,l=e.ajaxWebTimer;_.browseNavActions.setPath({path:t,sortLabel:r,sortIsAscending:s,onPathLoaded:o,nsId:i,logFetchedDataRequiredForTTI:a,ajaxWebTimer:l})},e.prototype.reloadCurrentPath=function(){var e=S.getBrowseStore();this.setPath({path:e.path(),sortLabel:e.sortLabel(),sortIsAscending:e.sortIsAscending(),nsId:e.context().rootNSID})},e.prototype.setUser=function(e){var t=e.user;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_USER,data:{user:t}})},e.prototype.updatePreview=function(e){var t=e.files;A()&&D().updateFiles(t)},e.prototype.closeFileViewer=function(){A()&&D().close()},e.prototype.setUrlPrefix=function(e){var t=e.prefix;_.browseNavActions.setUrlPrefix({prefix:t})},e.prototype.setUrl=function(e){var t=e.path,r=e.qargs;_.browseNavActions.setUrl({path:t,qargs:r})},e.prototype.copyFilesToClipboard=function(e){if(e.length){if(e.some(function(e){return e.isDeleted}))return void b.error(T._("Deleted files cannot be added to the clipboard"));if(e.some(m.File.isTeamSharedFolder))return void b.error(T._("Team Folders can’t be copied."));var t=T.ungettext("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",e.length).format({num_items:e.length});b.success(t),f.BrowseDispatcher.dispatch({type:h.BrowseActionType.COPY_FILES_TO_CLIPBOARD,data:{files:e}})}},e.prototype.pasteClipboardFilesToCurrentPath=function(){d.copyFiles({user:S.getBrowseStore().user(),files:S.getBrowseStore().clipboardFiles(),newPath:S.getBrowseStore().path(),checkFSWs:!0,dataApi:this.dataApi})},e.prototype.selectRowsFromBoltClient=function(e){void 0===e&&(e=[]),this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.map(function(e){return e.fq_path})})},e.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t=e.fqPathsToSelect;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,data:{fqPathsToSelect:t}})},e.prototype.copyFiles=function(e){d.copyFiles(e)},e.prototype.moveFiles=function(e){d.moveFiles(e)},e.prototype.showFileRename=function(e){var t=e.file;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.REQUEST_NEW_FILE_NAME,data:{file:t}})},e.prototype.cancelFileRename=function(e){var t=e.file;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.CANCEL_FILE_RENAME,data:{file:t}})},e.prototype.setFileRenameComplete=function(e){var t=e.file;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_FILE_RENAME_COMPLETE,data:{file:t}})},e.prototype.renameFile=function(e){var t=this,r=e.file,s=e.newName,o=e.isSearchMode;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_FILE_RENAME_PENDING,data:{file:r}});var i=S.getBrowseStore().user();this.dataApi.renameFile({file:r,newName:s,userId:i.id,onSuccess:function(e){var s=e.renamedFile,a=e.changesets,l=e.rollbackHints;n.notifyRenameSuccess(i,a,l,function(){t.selectRowsFromBoltClient([r])}),o&&C.SearchResultsDispatcher.dispatch({type:F.CHANGE_FILES_ACTION,data:{fileDeltas:[{before:r.fq_path,after:r.is_dir?s.set("icon",r.icon):s}]}}),t.selectRowsFromBoltClient([s])},onError:function(){t.cancelFileRename({file:r})}})},e.prototype.applyFileDeltas=function(e){var t=e.path,r=e.fileDeltas;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.CHANGE_FILES,data:{path:t,fileDeltas:r}})},e.prototype.getMountPointUpdateForCurrentPath=function(e){var t,r,o=S.getBrowseStore().path(),i=S.getBrowseStore().mountPoints(),n=i?i.toJS():{},a=function(e){return e===o},l=parseInt(s.findKey(n,a),10);if(l)t=e[l]||null,r=n[l]||null;else{r=null;t=!!s.findKey(e,a)?o:null}return[r,t]},e.prototype.getPathForNewMountPoint=function(e,t){return e&&!t?S.getBrowseStore().path():e&&t?a.paths_are_equal(e,t)?null:t:!e&&t?S.getBrowseStore().path():null},e.prototype.showUserNotificationForPathChange=function(e,t){function r(e){return s.escape(a.filename(e))}function i(e){b.success(new v(e))}function n(e){b.error(new v(e))}var l=t.old_fq_path,c=o.get_browse_root(e)+t.new_fq_path,d=!t.is_changing_view,u=null!=t.change_type?t.change_type.toLowerCase():null;if("moved"===u)if(d)i(T._("This folder has been moved"));else{var p=T._('The folder ‘%(folder_name)s’ has been moved. <a href="%(href)s">View</a>').format({folder_name:r(l),href:s.escape(c)});n(p)}else if("renamed"===u)if(d){var p=T._("This folder has been renamed to ‘%(folder_name)s’").format({folder_name:r(t.change_to_fq_path)});i(p)}else{var p=T._('The folder ‘%(folder_name)s’ has been renamed. <a href="%(href)s">View</a>').format({folder_name:r(l),href:s.escape(c)});n(p)}else if("deleted"===u){var p=T._("The folder ‘%(folder_name)s’ has been deleted").format({folder_name:r(l)});n(p)}},e.prototype.computeAndApplyDeltasFromBoltClient=function(e){var t=e.path,r=e.payload,s=e.currentNSId,o=r.added,i=r.moved,n=r.removed,a=r.mount_points,l=r.parent_changes;if(l&&l.change_to_fq_path){var c=S.getBrowseStore().user();return this.showUserNotificationForPathChange(c,l),void this.setUrl({path:l.change_to_fq_path})}var d=this.getMountPointUpdateForCurrentPath(a),u=d[0],p=d[1];u&&!p&&b.success(T._("The folder was unshared."));var h=this.getPathForNewMountPoint(u,p);if(h)return void this.setPath({path:h,sortLabel:S.getBrowseStore().sortLabel(),sortIsAscending:S.getBrowseStore().sortIsAscending(),nsId:s});this.setMountPoints({mountPoints:a});for(var f=S.getBrowseStore().filesMap(),_=[],g=0,w=o;g<w.length;g++){var v=w[g],F=null,E=m.File.fromServerObject(v);_.push({before:F,after:E})}for(var y=0,C=i;y<C.length;y++){var R=C[y],D=R[0],v=R[1],F=f.get(D,null),E=m.File.fromServerObject(v);_.push({before:F,after:E})}for(var A=0,I=n;A<I.length;A++){var P=I[A],F=f.get(P,null),E=null;_.push({before:F,after:E})}this.applyFileDeltas({path:t,fileDeltas:_})},e.prototype.setSelection=function(e){var t=e.selection;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_SELECTION,data:{selection:t}})},e.prototype.selectFilesAfterUpload=function(e){var t=e.fqPathsToSelect;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SELECT_FILES_AFTER_UPLOAD,data:{fqPathsToSelect:t}})},e.prototype.selectFilesByFqPath=function(e){var t=e.fqPathsToSelect;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SELECT_FILES_BY_FQ_PATH,data:{fqPathsToSelect:t}})},e.prototype.setActiveTab=function(e){var t=e.tabName;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_ACTIVE_TAB,data:{tabName:t}})},e.prototype.navigateToFileOrFolder=function(e){var t=e.file,r=e.shouldFocusComment,s=void 0!==r&&r,o=e.onFileViewerUnmount,i=e.fileViewAction,n=void 0===i?g.FileViewActionType.CLICK:i,a=e.fileViewOrigin,l=void 0===a?g.FileViewOriginType.BROWSE:a,d=e.expShouldShowUnifiedTrashModal,p=void 0!==d&&d;if(!S.getBrowseStore().context().isNonUserRelativeContext||t.is_dir)if(t.is_dir)m.File.isNoAccessSharedFolder(t)?u.showNoAccess(S.getBrowseStore().user(),t,S.getBrowseStore().context()):this.setUrl({path:t.fq_path});else{var f=S.getBrowseStore().getIndexOfFile(t),_=f<0?[t]:S.getBrowseStore().files().toArray();if(f<0&&(f=0),t.isDeleted)p&&n!==g.FileViewActionType.SEARCH?u.showUnifiedTrashModal({userId:S.getBrowseStore().user().id,context:S.getBrowseStore().context(),files:[t]}):u.showRestore(S.getBrowseStore().user(),[t]);else if(t.preview_type===c.PreviewType.Download)w.unsafe_open_tab(t.href);else if(t.preview_type===c.PreviewType.CloudDoc&&t.preview_url)w.unsafe_open_tab(t.preview_url);else{var v=function(){y.showElementsBehindFileViewer(),o&&o()};y.asyncOpenPreview({containerId:h.BROWSE_FILE_VIEWER_ELEMENT_ID,files:_,indexOfPreviewFile:f,shouldFocusComment:s,user:S.getBrowseStore().user(),onFileViewerDidMount:y.hideElementsBehindFileViewer,onFileViewerUnmount:v,fileViewAction:n,fileViewOrigin:l,fileViewTarget:g.FileViewTargetType.PRIVATE})}}},e.prototype.navigateToResultObjectParentFolder=function(e){var t=e.file,r=e.fileViewAction;void 0===r&&g.FileViewActionType.CLICK;if(m.File.isNoAccessSharedFolder(t))u.showNoAccess(S.getBrowseStore().user(),t,S.getBrowseStore().context());else{var s=a.parent_dir(t.fq_path);this.setUrl({path:s})}},e.prototype.navigateToParentFolder=function(){var e=a.parent_dir(S.getBrowseStore().path());this.setUrl({path:e})},e.prototype.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles,r=e.shouldReloadFolder,s=void 0===r||r,o=S.getBrowseStore();t?l.update_query_param("d","1"):l.remove_query_param("d"),f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_SHOULD_SHOW_DELETED_FILES,data:{shouldShowDeletedFiles:t}}),s&&(o.context().isNonUserRelativeContext?this.setPath({path:o.path(),sortLabel:o.sortLabel(),sortIsAscending:o.sortIsAscending(),nsId:o.context().rootNSID}):this.reloadCurrentPath())},e.prototype.sortFiles=function(e){var t=e.sortField,r=e.sortDirection;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SORT_FILES,data:{sortField:t,sortDirection:r}})},e.prototype.setViewType=function(e){var t=e.viewType,r=e.isSearchMode,s=S.getBrowseStore().user();if(s){var o=s.id;switch(t){case h.ViewType.List:E.logSwitchToListView({uid:o,isSearchMode:r,view_type:S.getBrowseStore().viewType()});break;case h.ViewType.Grid:E.logSwitchToGridView({uid:o,isSearchMode:r,view_type:S.getBrowseStore().viewType()})}}f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_VIEW_TYPE,data:{viewType:t}})},e.prototype.setColumnDependentCapabilities=function(e){var t=e.canDisplayFolderSizes;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_COLUMN_DEPENDENT_CAPABILITIES,data:{canDisplayFolderSizes:t}})},e.prototype.setColumnConfiguration=function(e){var t=e.columns,r=e.viewType,s=e.canDisplayFolderSizes;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_COLUMN_CONFIGURATION,data:{columns:t,viewType:r,canDisplayFolderSizes:s}})},e.prototype.setTilesPerRow=function(e){var t=e.tilesPerRow;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_TILES_PER_ROW,data:{tilesPerRow:t}})},e.prototype.setCopyMode=function(e){var t=e.copyMode;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_COPY_MODE,data:{copyMode:t}})},e.prototype.downloadFiles=function(e){var t=e.files,r=e.context,s=e.user;if(1!==t.count()||t.first().is_dir){if(r.blockHash)if(r.isNonUserRelativeContext)i.zip_batch_by_ns_id({parent_ns_id:r.rootNSID,parent_ns_path:r.currentFQPath,files:t.toArray(),subject_uid:s.id,block_hash:r.blockHash});else{var o=r.currentFQPath,n=t.toArray().map(function(e){return e.fq_path});i.get_zip({fq_paths:n,subject_uid:s.id,block_hash:r.blockHash,parent_path:o})}}else if(r.isNonUserRelativeContext){var l=t.first(),c=l.direct_blockserver_link,d=r.rootNSID,u=a.filename(l.fq_path),p="/"===r.currentFQPath?"/"+u:r.currentFQPath+"/"+u;i.get_blockserver_link({url:c,ns_id:d,ns_path:p,inside_admin_console:!0})}else i.get_blockserver_link({url:t.first().direct_blockserver_link})},e.prototype.createCloudDoc=function(e){var t=e.pathName,r=e.title,s=e.documentType;R.Snackbar.sync(T._("Creating new Paper doc..."),!0);var o=S.getBrowseStore().user().id;this.dataApi.createCloudDoc({pathName:t,title:r,documentType:s,userId:o,
onSuccess:function(e){var t=(e.changesets,e.createdFile);R.Snackbar.complete(T._("Paper doc created!")),w.redirect(t.preview_url)},onError:function(e){R.Snackbar.fail(e)}})},e.prototype.addCommentStatusBatch=function(e){var t=e.commentStatusByFqPath;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.ADD_COMMENT_STATUS_BATCH,data:{commentStatusByFqPath:t}})},e.prototype.setDropTarget=function(e){var t=e.target;f.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_DROP_TARGET,data:{target:t}})},e.prototype.setDataApi=function(e){this.dataApi=e,_.browseNavActions.setDataApi(e)},e.prototype.fetchFolderSizes=function(e){var t=e.file;return r.__awaiter(this,void 0,void 0,function(){var e,s,o,i,n,a,l,c,d;return r.__generator(this,function(r){switch(r.label){case 0:e=S.getBrowseStore().user(),s=h.MAX_FOLDER_SIZE_ITERATIONS,r.label=1;case 1:return r.trys.push([1,7,,8]),f.BrowseDispatcher.dispatch({type:h.BrowseActionType.REQUEST_FETCH_FOLDER_SIZES,data:{fqPath:t.fq_path}}),[4,this.dataApi.fetchSharedFolderSizes(e.id,{fq_path:t.fq_path})];case 2:return o=r.sent(),f.BrowseDispatcher.dispatch({type:h.BrowseActionType.FETCHED_FOLDER_SIZES,data:{fqPath:t.fq_path,resp:o}}),i=[],[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:h.MAX_FOLDERS_PER_CALL})];case 3:n=r.sent(),n.queue&&(i=i.concat(n.queue)),r.label=4;case 4:return i.length>0&&s>0?(s--,a=Math.min(h.MAX_FOLDER_SIZE_QUEUE_SIZE,i.length),l=i.splice(0,a),[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:h.MAX_FOLDERS_PER_CALL,queue:l})]):[3,6];case 5:return n=r.sent(),n.queue&&i&&(i=i.concat(n.queue)),[3,4];case 6:return c=0!==s&&n.queue&&0===n.queue.length?h.FetchFolderSizeState.COMPLETE:h.FetchFolderSizeState.ERROR,f.BrowseDispatcher.dispatch({type:h.BrowseActionType.COMPLETE_FETCH_FOLDER_SIZES,data:{state:c}}),[3,8];case 7:return d=r.sent(),f.BrowseDispatcher.dispatch({type:h.BrowseActionType.COMPLETE_FETCH_FOLDER_SIZES,data:{state:h.FetchFolderSizeState.ERROR}}),[3,8];case 8:return[2]}})})},e.prototype.fetchAndSetSameNamespaceFolderSize=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var s;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.dataApi.fetchSameNamespaceFolderSizes(e,t)];case 1:return s=r.sent(),f.BrowseDispatcher.dispatch({type:h.BrowseActionType.FETCHED_FOLDER_SIZES,data:{fqPath:t.fq_path,resp:s}}),[2,s]}})})},e})();t.browseActions=new I(p)}),define("modules/clean/react/browse/api",["require","exports","external/lodash","modules/clean/ajax","modules/clean/api_v2/client","modules/clean/react/browse/models","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,s,o,i,n,a,l){"use strict";function c(e){try{return JSON.parse(e)}catch(e){if(!(e instanceof SyntaxError))throw e}return null}function d(e){var t=e.sortLabel,r=e.sortIsAscending,o=e.path,i=e.userId,n=e.onSuccess,a=e.includeDeletedFiles,l=void 0!==a&&a,d=e.sortFoldersFirst,u=void 0===d||d,p=e.onError;return s.WebRequest({data:{sort_label:t,sort_is_ascending:r.toString(),show_deleted:l||"",sort_folders_first:u,include_file_info:"True",path2:o},url:"/browse",subject_user:i,success:function(e,t,r){var s=c(e);s&&n({path:o,data:s,xhr:r})},error:function(e,t,r){p&&p(e,t,r)}})}function u(e){var t=e.files,o=e.newPath,l=e.userId,c=e.onSuccess,d=e.checkFSWs,u=t.map(function(e){return e.fq_path});return u.includes(o)?(a.error(n._("You can’t copy a folder into itself.")),null):s.WebProgressRequest({url:"/cmd/copy",data:{files:u,to_path:o,fsw_request:d?"check":void 0},subject_user:l,progress_text:n._("Copying files..."),success:function(e){try{var t=r.isString(e)?JSON.parse(e):e;c({newFiles:t.new_browse_files?t.new_browse_files.map(i.File.fromServerObject):[],destinationPath:o,changesets:t.changesets,rollbackHints:t.rollback_hints,failureDetails:t.failure_details})}catch(e){}}})}function p(e){var t=e.files,o=e.userId,i=e.onSuccess,a=t.map(function(e){return e.fq_path});return s.WebProgressRequest({url:"/cmd/delete",data:{files:a},subject_user:o,progress_text:n._("Deleting files..."),success:function(e){try{var s=r.isString(e)?JSON.parse(e):e;i({fileDeltas:t.map(function(e){return{before:e,after:null}}),changesets:s.changesets,rollbackHints:s.rollback_hints})}catch(e){}}})}function h(e){var t=e.path,o=e.files,l=e.newPath,c=e.userId,d=e.onSuccess,u=e.allowOwnershipTransfer,p=e.checkFSWs;if(t===l)return a.error(n._("Those files already exist in that folder.")),null;var h=o.map(function(e){return e.fq_path});return h.includes(l)?(a.error(n._("You can’t move a folder into itself.")),null):s.WebProgressRequest({url:"/cmd/move",data:{files:h,to_path:l,allow_ownership_transfer:u,fsw_request:p?"check":void 0},subject_user:c,progress_text:n._("Moving files..."),skipNotifyError:!u,success:function(e){try{var s=r.isString(e)?JSON.parse(e):e;d({path:t,destinationPath:l,newFiles:s.new_browse_files?s.new_browse_files.map(i.File.fromServerObject):[],changesets:s.changesets,rollbackHints:s.rollback_hints,failureDetails:s.failure_details})}catch(e){}},error:function(t,r,s){a.error(s),e.onError&&e.onError(s)}})}function f(e){var t=e.file,r=e.newName,o=e.userId,i=e.onSuccess,n=e.onError;return s.WebRequest({url:new l({path:"/cmd/rename"+t.fq_path}).toString(),subject_user:o,data:{to_path:r},success:function(e,r,s){var o=c(e);if(o){var a=t.merge(o.new_browse_files[0]);i({changesets:o.changesets,renamedFile:a,rollbackHints:o.rollback_hints})}else n&&n()},error:n})}function m(e){var t=e.files,r=e.userId,o=e.onSuccess;return s.WebProgressRequest({url:"/cmd/restore",data:{files:t.map(function(e){return e.fq_path})},subject_user:r,dataType:"json",progress_text:n._("Restoring…"),success:function(){o()}})}function _(e){var t=e.files,r=e.userId,o=e.onSuccess,i=e.progressText,a=void 0===i?n._("Deleting…"):i;return s.WebProgressRequest({url:"/cmd/purge",data:{files:t.map(function(e){return e.fq_path})},subject_user:r,dataType:"text",progress_text:a,success:function(e){var t=c(e);t&&"success"===t.status&&o()}})}function S(e){var t=e.userId,r=e.changesets,o=void 0===r?null:r,i=e.progressText,n=e.rollbackHints,a=void 0===n?{}:n,l=e.onSuccess;return s.WebProgressRequest({url:"/cmd/rollback",data:{ns_to_cs:JSON.stringify(o),rollback_hints:JSON.stringify(a)},subject_user:t,progress_text:i,success:function(){l()}})}function g(e){var t=e.pathName,r=e.folderName,o=e.userId,n=e.onSuccess,a=e.onError,d=e.checkFSWs;return s.WebProgressRequest({url:new l({path:"/cmd/new"+t}).toString(),data:{to_path:r,folder:"yes",fsw_request:d?"check":void 0},subject_user:o,success:function(e){var t=c(e);if(t){var r=t.new_browse_files?i.File.fromServerObject(t.new_browse_files[0]):null;n({changesets:t.changesets,createdFolder:r,failureDetails:t.failure_details})}},error:function(){a()}})}function w(e){var t=e.pathName,r=e.title,o=e.documentType,n=e.userId,a=e.onSuccess,d=e.onError,u=(t+"/"+r+"."+o).replace("//","/");return s.WebRequest({url:new l({path:"/cmd/create_cloud_doc"}).toString(),subject_user:n,data:{to_path:u,title:r},success:function(e){var t=c(e);if(t){a({changesets:null,createdFile:i.File.fromServerObject(t.new_browse_files[0])})}},error:function(e,t,r){d(r)},skipNotifyError:!0})}function v(e){var t=e.path,o=e.userId,i=e.namespaceToJournalIdMap,n=e.onSuccess,a=e.includeDeletedFiles,l=e.isNonUserRelativeContext,d="/"===t?"":t,u={fq_dir:d,ns_map:r.map(i,function(e,t){return t+"_"+e}).join(","),show_deleted:!!a,admin_console:!!l};return s.WebRequest({url:"/update/list_dir",subject_user:o,data:u,dataType:"text",success:function(e){var t=c(e);t&&n(t)}})}function T(e,t){return(new o.ApiV2Client).ns("folders").rpc("get_shared_subfolder_sizes",t,{subjectUserId:e})}function b(e,t){return(new o.ApiV2Client).ns("folders").rpc("get_subfolder_sizes_in_same_namespace",t,{subjectUserId:e})}Object.defineProperty(t,"__esModule",{value:!0}),t.loadPath=d,t.copyFiles=u,t.deleteFiles=p,t.moveFiles=h,t.renameFile=f,t.restoreFiles=m,t.purgeFiles=_,t.rollbackChangeSets=S,t.createNewFolder=g,t.createCloudDoc=w,t.getChangesForDirectory=v,t.fetchSharedFolderSizes=T,t.fetchSameNamespaceFolderSizes=b}),define("modules/clean/react/browse/browse",["require","exports","tslib","external/react","external/react-dom","external/lodash","modules/clean/ajax_as_promised","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/history","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/actions","modules/clean/react/browse/api","modules/clean/react/browse/browse_view","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/browse/browse_bolt_client","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/file_uploader","modules/clean/react/file_uploader/store","modules/clean/react/file_viewer/async_controller","modules/clean/search/search_results/actions","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_results/store","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/viewer","modules/clean/pagelet_logger","modules/clean/web_timing_logger","modules/core/browser","modules/core/framework_args","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/filepath","modules/constants/python","modules/clean/search/search_helpers","modules/clean/search/search_bar/data/action_creators","modules/clean/storage","modules/clean/react/browse/browse_prefetch_loader"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h,f,m,_,S,g,w,v,T,b,F,E,y,C,R,D,A,I,P,N,L,x,O,M,U,B,k,q,V,H,W){"use strict";function z(e){M.success(O._("%(file_name)s added to your Dropbox.").format({file_name:c.filename(e)}))}function G(e){var t=O._('Added “%(folder_name)s” <a href="%(href)s">Learn More</a>').format({folder_name:l.Emstring.em_snippet(c.filename(e),D.SNIPPET_SIZES.FILENAME),href:"/help/business/team-space-overview#acceptfolder"});M.success(new x(t))}function j(e){var t=c.parent_dir(e);"/"!==t&&M.success(O._("Folder is in %(path)s").format({path:l.Emstring.em_snippet(t,22)}))}function Q(e){var t=d.deconstruct_url().qargs;d.replace_state(e,i.pick.apply(i,[t,"d","select","preview"].concat(L.FRAMEWORK_ARGS)))}Object.defineProperty(t,"__esModule",{value:!0});var K;(function(e){e[e.BROWSE=0]="BROWSE",e[e.SEARCH=1]="SEARCH"})(K||(K={}));var J=(function(t){function l(s){var a=t.call(this,s)||this;a.logOnceFetchedDataRequiredForTTI=i.once(function(){return P.log_js_modules_fetched_data_required_for_tti()}),a.previousHistoryCallbackMode=K.BROWSE,a.receiveStateFromStores=function(){a.setState(a.getStateFromStores())},a.handleComponentTTI=function(e){a.browseLogger&&(a.browseLogger.componentReady(e),a.browseLogger.ttiLogged&&a.ajaxRequestWebTimer&&(a.ajaxRequestWebTimer.markTimeToInteractive(),delete a.ajaxRequestWebTimer))},a.onAllUploadsComplete=function(e){var t=e.detail.files,r=t.map(function(e){return B.normalize(e.path)+B.normalize(e.name)});p.browseActions.selectFilesAfterUpload({fqPathsToSelect:r})},a.onAllUploadsAborted=function(){p.browseActions.setUrl({path:"/"})},a.getIsFileJumping=function(){return S.getBrowseStore().isFileJumping()},a.setBrowseViewRef=function(e){a.browseViewRef=e},a.startBoltLiveUpdate=function(){a.browseBoltClient.startLiveUpdate(function(){a.getChangesRequest&&a.getChangesRequest.abort();var e=a.state,t=e.context,r=e.path,s=e.shouldShowDeletedFiles,o=a.getUser();a.getChangesRequest=h.getChangesForDirectory({path:r,userId:o.id,namespaceToJournalIdMap:a.browseBoltClient.getNsMap(),includeDeletedFiles:s,isNonUserRelativeContext:t.isNonUserRelativeContext,onSuccess:function(e){delete a.getChangesRequest,p.browseActions.computeAndApplyDeltasFromBoltClient({payload:e,path:r}),a.browseBoltClient.handleUpdateBoltClient(e.bolt_data)}})})},a.handleFileLocationChange=function(e,t){e="/"+U.decode(e);var r=S.getBrowseStore().sortLabel(),s=S.getBrowseStore().sortIsAscending();a.ensureFileViewerIsOpenedOrClosedIfNeeded(t),a.previousHistoryCallbackMode===K.BROWSE&&S.getBrowseStore().isPathEqualsTo(e)||(a.previousHistoryCallbackMode=K.BROWSE,a.navigateToPath({path:e,sortLabel:r,sortIsAscending:s}))},a.getPathFromProps=function(){return a.props["init-fq-path"]||"/"},a.getUser=function(){return A.Viewer.get_viewer().get_user_by_id(a.props["user-id"])},a.handleSearchLocationChange=function(e,t){if(t){var r=t.query||t.query_unnormalized;e=t.path||t.last_fq_path||"/";var s=t.qsid,o=S.getBrowseStore().sortLabel(),i=S.getBrowseStore().sortIsAscending();if(r&&(!B.paths_are_equal(e,a.state.path)||r!==a.state.latestQuery)){var n=a.getUser();a.previousHistoryCallbackMode=K.SEARCH,S.getBrowseStore().isPathEqualsTo(e)||p.browseActions.setPath({path:e,sortLabel:o,sortIsAscending:i}),E.getStoreForSearchBar().dispatch(V.setSearchQueryAndFetchResults({user:n,searchPath:e,query:r,searchSessionID:s}));var l=a.props["exp-search-results-experiments"],c=l&&l.expFetchPartialSearchResult;F.searchResultsActions.runSearch({user:n,path:e,query:r,qsid:s,webTimer:a.ajaxRequestWebTimer,logOnceFetchedDataRequiredForTTI:a.logOnceFetchedDataRequiredForTTI,fetchPartialSearchResult:c})}}},a.handleSearchExit=function(){E.getStoreForSearchBar().dispatch(V.clearSearchBar()),F.searchResultsActions.clearSearch()},a.markTTVIfNeeded=function(){if(!a.hasTTVBeenLogged&&a.mounted&&(a.prefetchComplete||a.props["search-query"])){var e=window.ensemble;e&&e.markPageletRenderedByDOMNode(o.findDOMNode(a)),P.mark_time_to_view(),a.hasTTVBeenLogged=!0}},a.handleFileListUpdated=function(){if(a.fileViewerIsShown())a.state.files.isEmpty()?p.browseActions.closeFileViewer():p.browseActions.updatePreview({files:a.state.files.toJS()});else{var e=d.deconstruct_url().qargs;a.ensureFileViewerIsOpenedOrClosedIfNeeded(e)}},a.handleDelete=function(e){var t=a.state.context,r=a.getUser(),s=e.some(_.File.isTeamSharedFolder),o=e.some(function(e){return e.read_only});!t.isCurrentPathWriteable()||s||o?s?M.error(O._("Team folders can’t be deleted.")):M.warning(O._("You don’t have permission to delete files in this folder.")):u.showDelete(r,e,t,function(){return p.browseActions.selectRowsFromBoltClient(e)},!!a.props["exp-subgrowth-biz-web-client-oq-delete"])},a.handleRestore=function(e){var t=a.props["exp-subgrowth-pro-restore-files-upsell"],r=a.getUser();!r.is_team&&a.props["is-over-free-quota"]&&"V1"===t?u.showOverquota("wb_oq_rstdel_f"):u.showRestore(r,e),t&&["CONTROL","V1"].includes(t)&&n.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_restore_files_upsell",variant:t}})},a.handlePermanentDelete=function(e){var t=a.getUser();u.showPermanentlyDelete(t,e,function(){return p.browseActions.reloadCurrentPath()})},a.handleShowRename=function(e){p.browseActions.showFileRename({file:e})},a.actionHandlers={onDelete:a.handleDelete,onRestore:a.handleRestore,onPermanentDelete:a.handlePermanentDelete,onShowRename:a.handleShowRename},a.handleSearch=function(e,t,r){var s=q.buildSearchURL({user:a.getUser(),searchPath:t,normalizedQuery:e,searchSessionID:r?y.searchSessionID(E.getStoreForSearchBar().getState()):C.getSearchResultsStore().searchSessionID()});a.ensureTimer("search_results"),d.push_state(s.getPath(),s.getQuery())},a.fileViewerIsShown=function(){return!!a.state.arePostTTIModulesLoaded&&e("modules/clean/react/file_viewer/controller").isShown()},a.ensureFileViewerClosedIfNotPreviewing=function(e){void 0===e&&(e={}),!e.preview&&a.fileViewerIsShown()&&p.browseActions.closeFileViewer()},a.ensureFileViewerIsOpenedOrClosedIfNeeded=function(e){void 0===e&&(e={});var t=a.fileViewerIsShown();if(e.preview&&!t){var r=S.getBrowseStore().getFileByFilename(e.preview);r&&p.browseActions.navigateToFileOrFolder({file:r})}else t&&!e.preview&&p.browseActions.closeFileViewer()},P.log_js_modules_application_code_start();var l=S.getBrowseStore(),c=C.getSearchResultsStore();return l.add_change_listener(a.receiveStateFromStores),c.add_change_listener(a.receiveStateFromStores),T.UploaderStore.add_change_listener(a.receiveStateFromStores),window.addEventListener(w.ALL_UPLOADS_COMPLETE_EVENT,a.onAllUploadsComplete),window.addEventListener(w.ALL_UPLOADS_ABORTED_DUE_TO_FILE_SYSTEM_WARNINGS_EVENT,a.onAllUploadsAborted),a.state=r.__assign({},a.getStateFromStores(),{arePostTTIModulesLoaded:!1}),a}return r.__extends(l,t),l.prototype.componentWillMount=function(){var e,t=this;e=this.props["search-query"]?["FilesViewController"]:["FilesViewController","AppActionsView"],this.browseLogger=new I.PageletLogger("browse",e,!0,{view_type:this.state.viewType.toLowerCase()});var r=S.getBrowseStore(),s=this.getUser(),o=a.get_browse_root(s),i=this.props["search-query"],n=this.props["share-link"],l=!!this.props["preview-file-info"],c=this.getPathFromProps();p.browseActions.setUrlPrefix({prefix:o}),p.browseActions.setUser({user:s}),i||n||l||Q(this.getUrlForFQPath(o,c));var u=A.Viewer.get_viewer().get_users().map(function(e){return e.id});H.UserLocalStorage.clearOtherUsers(u),this.browseBoltClient=new g.BrowseBoltClient(s.id);var h=new W.BrowsePrefetchLoader({user:s,path:c,urlPrefix:o,shouldShowDeletedFiles:!!this.props["should-show-deleted-files"],fqPathsToSelect:this.props["select-fq-paths"]},function(){t.prefetchComplete=!0,E.getStoreForSearchBar().dispatch(V.setBrowseScope({browseScope:c})),P.log_js_modules_fetched_data_required_for_tti(),t.markTTVIfNeeded()},function(){t.prefetchComplete=!0,p.browseActions.setUrl({path:""}),t.navigateToPath({path:"",sortLabel:r.sortLabel(),sortIsAscending:r.sortIsAscending()})});h.isPrefetching()?h.handlePrefetch():i||this.navigateToPath({path:c,sortLabel:r.sortLabel(),sortIsAscending:r.sortIsAscending(),logFetchedDataRequiredForTTI:!0}),d.add_callback(o,this.handleFileLocationChange,!0),d.add_callback("/search",this.handleSearchLocationChange,!i),d.add_exit_callback("/search",this.handleSearchExit)},l.prototype.componentDidMount=function(){var t=this;this.mounted=!0;var s=this.getPathFromProps(),o=this.getUser(),a=this.props["search-query"],c=this.props["share-link"],u=!!this.props["preview-file-info"];if(this.props["from-scl-sync-modal"]&&(o.is_cdm_member?G(s):z(s)),!a&&c&&!u&&o.is_cdm_member&&j(s),this.markTTVIfNeeded(),l.mountFileViewerTarget(),this.props["loaded-with-explicit-preview"]&&!u){var p=d.deconstruct_url(),h=p.path,f=p.qargs;delete f.preview,d.replace_state(h,f)}P.waitForTTI().then(function(){a||t.fetchAndStartBoltUpdates();var r=function(e,r,s,o,a,l,c,d,u,p,h,f,m,_,g){var w=s.SharedWithStore,v=o.checkForMissingStarredData,T=o.StarredStore,b=p.BloodhoundContactsV2,F=f.EmailVerification;if(t.mounted){var E=t.state,y=E.path,C=E.files,R=C.toArray(),D=t.getUser();w.initializeWith({path:y,files:R}),v({files:R,user:D});var A=T.addListener(function(){t.setState({starredState:T.getLoadingStates()})}),I=S.getBrowseStore(),P=function(){return i.defer(function(){v({files:t.state.files.toArray(),user:D})})};I.add_change_listener(P),t.removeStarredStoreListener=function(){A(),I.remove_change_listener(P)},b.getOrCreateForUser(D),h.setup(),t.setState({arePostTTIModulesLoaded:!0}),t.props["email-just-verified"]?F.getForRole(D.role).show_verified_modal():t.props["email-just-verified-and-changed"]?F.getForRole(D.role).show_verified_and_changed_modal():t.props["send-verification-email"]&&F.getForRole(D.role).show_sent_modal(),n.SilentBackgroundRequest({url:"/browse_ajax_post_tti_fetch"}).then(function(e){return JSON.parse(e)}).then(function(e){e.should_show_ncct_paywall&&N.redirect("/ncct-trial-end")})}};r.perfName="browse_post_tti",e(["modules/clean/react/file_viewer/controller","modules/clean/react/browse/file_actions","modules/clean/react/browse/shared_with","modules/clean/react/starred/browse_exports","modules/clean/react/file_modal_controller","modules/clean/sharing/share_modal_util","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/sharing/ui_util","modules/clean/sharing/wizard/wizard_modals","modules/clean/contacts/bloodhound_contacts_v2","modules/clean/react/browse/comment_status","modules/clean/account/email","modules/clean/unity_browse_interface","modules/clean/unity/features","modules/clean/unity/check_file_cache"],r)});var g=!!this.props["show-share-modal"],w=this.props["share-prefill-email"],v=this.props["preview-file-info"];if(v){var T=_.File.fromServerObject(v);b.asyncOpenPreview({containerId:m.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[T],fileViewAction:k.FileViewActionType.CLICK,fileViewOrigin:k.FileViewOriginType.BROWSE,fileViewTarget:k.FileViewTargetType.PRIVATE,indexOfPreviewFile:0,user:o,updateBrowserLocation:!1,onFileViewerDidMount:b.hideElementsBehindFileViewer,onFileViewerUnmount:function(){b.showElementsBehindFileViewer();var e=t.browseViewRef;(e=e.getFilesViewControllerRef())&&(e=e.getBrowseTileGridRef())&&(e=e.getTileGridRef())&&e.getAndUpdateTileLayout(),t.restoreUrlAfterFileViewClose()}}),g&&P.waitForTTI().then(function(){t.mounted&&R.asyncShowPrefilledShareModal({user:o,sharePrefillEmail:w,content:T})})}else g&&P.waitForTTI().then(function(){if(t.mounted){var e=t.props["ns-id"],r=t.props["ns-path"];R.asyncShowPrefilledShareModal({user:o,sharePrefillEmail:w,content:{fqPath:s,isFolder:!0,nsId:e&&r?e:null,targetNsId:e&&!r?e:null}})}});g||this.props["showing-ios-apple-billing-modal"]||this.props["showing-client-modal"]||P.waitForTTI().then(function(){e(["modules/clean/upsell/prompt_loader"],function(s){return r.__awaiter(t,void 0,void 0,function(){var t,o=this;return r.__generator(this,function(i){switch(i.label){case 0:return[4,s.waitForPrompt()];case 1:return t=i.sent(),t.didMainCampaignLoad()||t.didCampaignForUserEducationLoad()?[2]:(e(["modules/clean/react/ncct/reminder_modal"],function(t){return r.__awaiter(o,void 0,void 0,function(){var s;return r.__generator(this,function(r){switch(r.label){case 0:return[4,t.NcctReminderModalView.load()];case 1:return s=r.sent(),s||e(["modules/clean/react/teams/modals/multifield_invite_reminder_modal"],function(e){e.MultifieldInviteReminderModal.load()}),[2]}})})}),[2])}})})})})},l.prototype.componentWillUpdate=function(e,t){t.isSearchMode&&!this.state.isSearchMode?this.browseBoltClient.stopLiveUpdate():!t.isSearchMode&&this.state.isSearchMode&&this.fetchAndStartBoltUpdates(),t.files.equals(this.state.files)||i.defer(this.handleFileListUpdated)},l.prototype.componentWillUnmount=function(){e.defined("modules/clean/react/browse/comment_status")&&e("modules/clean/react/browse/comment_status").teardown(),this.removeStarredStoreListener&&this.removeStarredStoreListener(),l.unmountFileViewerTarget(),S.getBrowseStore().remove_change_listener(this.receiveStateFromStores),C.getSearchResultsStore().remove_change_listener(this.receiveStateFromStores),T.UploaderStore.remove_change_listener(this.receiveStateFromStores),window.removeEventListener(w.ALL_UPLOADS_COMPLETE_EVENT,this.onAllUploadsComplete),window.removeEventListener(w.ALL_UPLOADS_ABORTED_DUE_TO_FILE_SYSTEM_WARNINGS_EVENT,this.onAllUploadsAborted),this.mounted=!1},l.prototype.getStateFromStores=function(){var e=S.getBrowseStore(),t=C.getSearchResultsStore(),r=t.latestQuery();return{context:e.context(),files:e.files(),filesWithoutTeamFolders:e.filesWithoutTeamFolders(),paginatedTotalNumFiles:e.paginatedTotalNumFiles(),teamFolders:e.teamFolders(),loadingState:e.loadingState(),path:e.path(),selection:e.selection(),selectedFiles:e.selectedFiles(),fileRename:e.fileRename(),shouldShowDeletedFiles:e.shouldShowDeletedFiles(),isDraggingInternalFiles:v.FileUploaderController.isDraggingInternalFiles(),isDraggingExternalFiles:v.FileUploaderController.isDraggingExternalFiles(),activeDropTarget:e.activeDropTarget(),isUploadModalOpen:v.FileUploaderController.isUploadModalOpen(),isTextSelectable:!!e.fileRename(),createNewFolderState:e.newFolderCreationState(),latestQuery:r,isSearchMode:!!r,currentSort:e.currentSort(),viewType:e.viewType(),canDisplayFolderSizes:e.canDisplayFolderSizes(),viewTypeColumns:e.viewTypeColumns(),urlPrefix:e.urlPrefix(),isQueryingFolderSizes:e.isQueryingFolderSizes(),tilesPerRow:e.tilesPerRow()}},l.prototype.restoreUrlAfterFileViewClose=function(){var e,t=this.getUser(),r=a.get_browse_root(t),s=this.getUrlForFQPath(r,this.state.path);e=this.props["loaded-with-explicit-preview"]?i.omit(d.deconstruct_url().qargs,"preview","select"):{},d.replace_state(s,e)},l.prototype.getUrlForFQPath=function(e,t){return e+("/"===t?"":U.encode_parts(t))},l.prototype.fetchAndStartBoltUpdates=function(){this.browseBoltClient.isReady()?this.startBoltLiveUpdate():this.browseBoltClient.fetchInitialBoltData(this.startBoltLiveUpdate)},l.prototype.ensureTimer=function(e,t){if(this.ajaxRequestWebTimer&&this.ajaxRequestWebTimer.getContextName()!==e&&delete this.ajaxRequestWebTimer,this.ajaxRequestWebTimer)this.ajaxRequestWebTimer.restart();else{this.ajaxRequestWebTimer=P.get_timer(e);var r={requireTTI:!0,requireTTV:!1};t&&(r.url=t),this.ajaxRequestWebTimer.initialize(r)}},l.prototype.navigateToPath=function(e){var t=e.path,r=e.sortLabel,s=e.sortIsAscending,o=e.logFetchedDataRequiredForTTI,i=void 0!==o&&o;this.browseLogger&&this.browseLogger.ttiLogged&&this.ensureTimer("browse_ajax","browse_ajax_nav"),p.browseActions.setPath({path:t,sortLabel:r,sortIsAscending:s,logFetchedDataRequiredForTTI:i,onPathLoaded:this.markTTVIfNeeded,ajaxWebTimer:this.ajaxRequestWebTimer}),E.getStoreForSearchBar().dispatch(V.clearSearchBar()),E.getStoreForSearchBar().dispatch(V.setBrowseScope({browseScope:t}))},l.prototype.render=function(){var e=this.state,t=e.activeDropTarget,r=e.context,o=e.path,i=e.createNewFolderState,n=e.currentSort,a=e.shouldShowDeletedFiles,l=e.isUploadModalOpen,c=e.selection,d=e.fileRename,u=e.files,p=e.teamFolders,h=e.isTextSelectable,_=e.loadingState,S=e.selectedFiles,g=e.isSearchMode,w=e.viewType,v=e.canDisplayFolderSizes,T=e.viewTypeColumns,b=e.starredState,F=e.filesWithoutTeamFolders,E=e.arePostTTIModulesLoaded,y=e.isDraggingExternalFiles,C=e.isDraggingInternalFiles,R=e.isQueryingFolderSizes,D=e.paginatedTotalNumFiles,A=e.tilesPerRow,I=this.getUser();return s.createElement(f.BrowseView,{ref:this.setBrowseViewRef,actionHandlers:this.actionHandlers,activeDropTarget:t,context:r,createNewFolderState:i,currentSort:n,ensureFileViewerClosedIfNotPreviewing:this.ensureFileViewerClosedIfNotPreviewing,fileRename:d,files:u,filesWithoutTeamFolders:F,getIsFileJumping:this.getIsFileJumping,handleComponentTTI:this.handleComponentTTI,isDraggingExternalFiles:y,isDraggingInternalFiles:C,isFileViewerShown:this.fileViewerIsShown,isSearchMode:g,isTextSelectable:h,isUploadModalOpen:l,loadingState:_,onSearch:this.handleSearch,path:o,selectedFiles:S,selection:c,shouldOpenUploadModal:this.props["should-open-upload-modal"],shouldShowDeletedFiles:a,starredState:b,teamFolders:p,totalNumItems:D,user:I,viewType:w,canDisplayFolderSizes:v,columns:w===m.ViewType.List?T[m.ViewType.List]:T[m.ViewType.Grid],viewTypeColumns:T,tilesPerRow:A,arePostTTIModulesLoaded:E,isNoComment:this.props["is-no-comment"],isOverFreeQuota:this.props["is-over-free-quota"],isQueryingFolderSizes:R,searchBarExperiments:this.props["exp-search-bar-experiments"],searchResultsExperiments:this.props["exp-search-results-experiments"],expShouldCheckFSWs:this.props["exp-should-check-fsws"],expShouldShowUnifiedTrashModal:this.props["exp-should-show-unified-trash-modal"],expShowAddToShowcase:this.props["exp-show-add-to-showcase"],expSubgrowthBizTeamHomeContent:this.props["exp-subgrowth-biz-team-home-content"],expSubgrowthBizTrialOnboarding:this.props["exp-subgrowth-biz-trial-onboarding"],expSharedFolderUpsell:this.props["exp-uj-shared-folder-upsell-v1"],expSharedFolderUpsellMembers:this.props["exp-uj-shared-folder-upsell-v1-members"],expSharedFolderUpsellNumMembers:this.props["exp-uj-shared-folder-upsell-v1-num-members"],expSharedFolderUpsellNumInSameDomain:this.props["exp-uj-shared-folder-upsell-v1-num-in-same-corp"],expSharedFolderUpsellViewerIsCorpDomain:this.props["exp-uj-shared-folder-upsell-v1-viewer-is-corp-domain"],nsId:this.props["ns-id"],expBrowseCdmNsfShouldCreateNsf:this.props["exp-browse-cdm-nsf-should-create-nsf"],expBrowseCdmNsfAutoTeamGroupId:this.props["exp-browse-cdm-nsf-auto-team-group-id"]})},l.mountFileViewerTarget=function(){var e=document.getElementById(m.BROWSE_FILE_VIEWER_ELEMENT_ID);e||(e=document.createElement("div"),e.id=m.BROWSE_FILE_VIEWER_ELEMENT_ID,document.body.insertBefore(e,document.body.children[0]))},l.unmountFileViewerTarget=function(){var e=document.getElementById(m.BROWSE_FILE_VIEWER_ELEMENT_ID);e&&document.body.removeChild(e)},l})(s.Component);t.BrowseApp=J}),define("modules/clean/react/browse/browse_location",["require","exports","tslib","external/classnames","external/immutable","external/spectrum/icon_arrow","external/spectrum/icon_content","external/spectrum/popover","external/react","modules/clean/react/icon/icon_helper","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/actions","modules/clean/react/sprite","modules/clean/sharing/browse_exports","modules/clean/user_education/user_education_client","modules/clean/viewer","modules/core/i18n"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h,f,m,_,S,g){"use strict";function w(e,t){return t?m.GoldenGate.hasContentManagerCdm(e.id)?g._("Content"):g._("Team folders"):p.filename("",S.Viewer.get_root_name(e))}function v(e,t){return 20-(t?2.625:new u.Emstring(e).length)}function T(e,t,r){for(var s=w(e,r),o=t.split("/").filter(Boolean),i=[{path:"",folderName:s,icon:"folder_dropbox-small",alt:"work"===e.role?g._("Work"):g._("Personal")}],n=c.spectrum_folder_icon({size:c.ICON_SIZES.SMALL}),a=0;a<o.length;a++)t="/"+o.slice(0,a+1).join("/"),i.push({path:t,folderName:p.filename(t),icon:n,alt:g._("Folder")});if(i.length<3)return{dropdownCrumbs:[],inlineCrumbs:i,root:i[0]};for(var l=i[0]&&i[0].folderName||"",d=v(l,!1),h=i.map(function(e){return new u.Emstring(e.folderName||"").length}),f=1,m=h[i.length-1],a=i.length-2;a>=1&&(m+=1.64,m+=h[a],!(m>d));a--)f+=1;i.length===f+1&&(f+=1);var _=i.length-f;return{dropdownCrumbs:i.slice(0,_),inlineCrumbs:i.slice(_),root:i[0]}}Object.defineProperty(t,"__esModule",{value:!0});t.generateBreadcrumbData=T;var b=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.path,s=this.props,o=s.user,i=s.isBrowseInContentManager,n=this.props,a=n.isDraggingInternalFiles,c=n.shouldHighlightDropTargets,d=n.setFileUploaderPath,u=T(o,t,i),h=u.dropdownCrumbs,f=u.inlineCrumbs,m=u.root,_=v(m&&m.folderName||"",h.length>0),S="page-header-text u-l-fl";return f.length>1||h.length>0?l.createElement("span",null,l.createElement("h1",{className:"ax-visually-hidden"},p.filename(t)),l.createElement("nav",{className:S,id:"browse-location","aria-label":g._("Folder hierarchy"),role:"navigation"},h.length>0&&l.createElement(C,{crumbs:h,currentPath:t,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:a,shouldHighlightDropTargets:c,setFileUploaderPath:d}),f.map(function(s,i){return l.createElement(E,r.__assign({},s,{key:encodeURI(s.path),user:o,isOnlyCrumb:0===i&&1===f.length&&0===h.length,isLastCrumb:i===f.length-1,maxWidth:_,currentPath:t,selectedFiles:e.props.selectedFiles,isDraggingInternalFiles:a,isHighlightedDropTarget:c,setFileUploaderPath:d}))}))):l.createElement("h1",{className:S},w(o,i))},t.defaultProps={path:"/",selectedFiles:o.OrderedMap(),isDraggingInternalFiles:!1,shouldHighlightDropTargets:!1,isBrowseInContentManager:!1,setFileUploaderPath:function(){}},t})(l.PureComponent);t.BrowseLocation=b;var F=function(){return l.createElement("span",null,l.createElement(f,{group:"web",name:"chevron",className:"breadcrumb__spacer",alt:""}))},E=(function(e){function t(t){var r=e.call(this,t)||this;return r.onDragEnterBreadcrumb=function(e){e.preventDefault(),e.target!==r.lastEnteredElement&&(r.lastEnteredElement=e.target,r.dragEnterCount+=1,r.setState({isDraggedOver:!0}),r.props.isLastCrumb||r.props.setFileUploaderPath({path:r.props.path}))},
r.onDragLeaveBreadcrumb=function(e){e.preventDefault(),r.lastEnteredElement=null,r.dragEnterCount-=1,r.dragEnterCount<1&&(r.dragEnterCount=0,r.state.isDraggedOver&&(r.props.setFileUploaderPath({path:r.props.currentPath}),r.setState({isDraggedOver:!1})))},r.onDropBreadcrumb=function(){r.setState({isDraggedOver:!1})},r.onDragOverBreadcrumb=function(e){e.preventDefault(),e.stopPropagation()},r.handleMouseEnter=function(){r.props.isDraggingInternalFiles&&r.setState({isDraggedOver:!0})},r.handleMouseLeave=function(){r.state.isDraggedOver&&r.setState({isDraggedOver:!1})},r.handleMouseUp=function(){r.state.isDraggedOver&&r.setState({isDraggedOver:!1})},r.navigateToFolder=function(e){var t=r.props.path;_.UEClient.sendEvent("BreadCrumbSegment","linkClicked",{path:t}),e.preventDefault(),h.browseActions.setUrl({path:t})},r.eventHandlers={onDragEnter:r.onDragEnterBreadcrumb,onDragLeave:r.onDragLeaveBreadcrumb,onDrop:r.onDropBreadcrumb,onDragOver:r.onDragOverBreadcrumb,onMouseEnter:r.handleMouseEnter,onMouseLeave:r.handleMouseLeave,onMouseUp:r.handleMouseUp},r.state={isDraggedOver:!1},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.dragEnterCount=0,this.lastEnteredElement=null},t.prototype.render=function(){var e=this.props,t=e.user,o=e.path,n=e.isOnlyCrumb,a=e.maxWidth,c=e.isLastCrumb,p=e.isHighlightedDropTarget,h=n?this.props.folderName:u.Emstring.em_snippet(this.props.folderName,a),f={"breadcrumb-segment":!0,"breadcrumb-segment--is-drop-target":!c&&p,"breadcrumb-segment--file-dragged-over":!c&&this.state.isDraggedOver};return c?l.createElement("span",r.__assign({},this.eventHandlers),h):l.createElement("span",r.__assign({className:"breadcrumb-segment__wrapper"},this.eventHandlers),l.createElement(_.UserEducationEffect,{containerName:"BreadCrumbSegment",name:"link-"+o,useSpan:!0},l.createElement("a",{href:d.browse_uri_for_fq_path(t,o).toString(),onClick:this.navigateToFolder,className:s(f)},h)),l.createElement(i.IconArrow,{name:"right"}))},t.defaultProps={isOnlyCrumb:!1,isDraggingInternalFiles:!1,isHighlightedDropTarget:!1,selectedFiles:o.OrderedMap()},t})(l.Component),y=(function(e){function t(t){var r=e.call(this,t)||this;return r.onDragEnter=function(e){e.preventDefault(),e.target!==r.lastEnteredElement&&(r.lastEnteredElement=e.target,r.dragEnterCount+=1,r.setState({isDraggedOver:!0}),r.props.setFileUploaderPath({path:r.props.path}))},r.onDragLeave=function(e){e.preventDefault(),r.lastEnteredElement=null,r.dragEnterCount-=1,r.dragEnterCount<1&&(r.dragEnterCount=0,r.state.isDraggedOver&&(r.props.setFileUploaderPath({path:r.props.currentPath}),r.setState({isDraggedOver:!1})))},r.onDrop=function(e){r.setState({isDraggedOver:!1})},r.onDragOver=function(e){e.preventDefault(),e.stopPropagation()},r.handleMouseEnter=function(){r.props.isDraggingInternalFiles&&r.setState({isDraggedOver:!0})},r.handleMouseLeave=function(){r.state.isDraggedOver&&r.setState({isDraggedOver:!1})},r.handleMouseUp=function(){r.state.isDraggedOver&&r.setState({isDraggedOver:!1}),r.props.isDraggingInternalFiles&&!r.props.isLastCrumb&&r.props.closeFunc()},r.eventHandlers={onDragEnter:r.onDragEnter,onDragLeave:r.onDragLeave,onDrop:r.onDrop,onDragOver:r.onDragOver,onMouseEnter:r.handleMouseEnter,onMouseLeave:r.handleMouseLeave,onMouseUp:r.handleMouseUp},r.state={isDraggedOver:!1},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.dragEnterCount=0,this.lastEnteredElement=null},t.prototype.render=function(){var e=this.props,t=e.icon,o=e.alt,i=e.folderName,c={"breadcrumb-menu-item":!0,"breadcrumb-menu-item--is-drop-target":this.props.isHighlightedDropTarget,"breadcrumb-menu-item--file-dragged-over":this.state.isDraggedOver},d=l.createElement("span",r.__assign({title:i,className:"breadcrumb-menu-item-wrapper"},this.eventHandlers),l.createElement("span",{className:"breadcrumb-menu-item-icon"},l.createElement(n.IconContent,{name:t,alt:o})),l.createElement("span",{className:"breadcrumb-menu-item-text"},i));return l.createElement(a.PopoverContentItem,{value:this.props.path,className:s(c)},d)},t.defaultProps={isHighlightedDropTarget:!1,closeFunc:function(){},alt:"",isDraggingInternalFiles:!1,selectedFiles:o.OrderedMap()},t})(l.Component),C=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={menuVisible:!1},t.onDragEnter=function(e){e.preventDefault(),t.setState({menuVisible:!0})},t.onMouseEnter=function(e){t.props.isDraggingInternalFiles&&(e.preventDefault(),t.setState({menuVisible:!0}))},t.onCrumbSelected=function(e){h.browseActions.setUrl({path:e})},t.onPopoverToggle=function(e){var r=e.isOpen;t.setState({menuVisible:r})},t.onClose=function(){t.onPopoverToggle({isOpen:!1})},t}return r.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.crumbs.slice().reverse(),r=this.props,s=r.currentPath,o=r.shouldHighlightDropTargets,i=r.isDraggingInternalFiles,c=r.selectedFiles,d=r.setFileUploaderPath,u=g._("Show parent folders (descending)"),p=l.createElement(n.IconContent,{name:"folder_dropdown-small",alt:u,className:"breadcrumb-menu-icon"});return l.createElement("div",{onDragOver:this.onDragEnter,onMouseEnter:this.onMouseEnter},l.createElement(a.Popover,{onSelection:this.onCrumbSelected,onMenuToggle:this.onPopoverToggle,className:"breadcrumb-dropdown-container"},l.createElement(a.PopoverTrigger,null,l.createElement("button",{className:"u-unbutton breadcrumb-overflow-button u-l-fl"},p)),l.createElement(a.PopoverContent,{isRevealed:this.state.menuVisible},t.map(function(t){return l.createElement(y,{key:encodeURI(t.path),path:t.path,icon:t.icon,alt:t.alt,folderName:t.folderName,currentPath:s,isHighlightedDropTarget:o,isDraggingInternalFiles:i,selectedFiles:c,setFileUploaderPath:d,closeFunc:e.onClose})})),l.createElement(F,null)))},t.defaultProps={shouldHighlightDropTargets:!1,selectedFiles:o.OrderedMap(),isDraggingInternalFiles:!1},t})(l.Component)}),define("modules/clean/react/browse/browse_prefetch_loader",["require","exports","modules/core/exception","modules/clean/react/browse/constants","modules/clean/react/browse/actions","modules/clean/react/browse/models","modules/clean/pagination_manager","modules/core/notify","modules/clean/web_timing_logger"],function(e,t,r,s,o,i,n,a,l){"use strict";function c(e){if(0===e.indexOf("err:")){var t=e.substr("err:".length);a.error(t)}}Object.defineProperty(t,"__esModule",{value:!0});var d=(function(){function e(e,t,a,d){var u=e.user,p=e.path,h=e.urlPrefix,f=e.shouldShowDeletedFiles,m=e.fqPathsToSelect;void 0===d&&(d=window);var _=this;this.isPrefetching=function(){return!!_.browsePreloadHandler&&!!_.firstPagePreloadHandler},this.handlePrefetch=function(){r.assert(_.isPrefetching(),"trying to handle prefetching and think we aren't prefetching at the same time.  something is wrong"),_.browsePreloadHandler(_.handlePrefetchDataSuccess,_.onPrefetchError)},this.handlePrefetchDataSuccess=function(e){var t=_.extractAjaxInitData(e);if(!t)return void _.onPrefetchError();var r,n,a=[],l=0,c=s.LoadingState.LOADING_FIRST_PAGE,d=_.firstPagePreloadHandler.getDataIfAvailable();if(d){if(!d.payload||d.error)return void _.onPrefetchError();var u=_.extractAjaxFileInfo(d.payload);if(!u)return void _.onPrefetchError();r=u.file_info,n=u.first_page,n?(a=[],l=n.total_num_items,c=s.LoadingState.LOADING_REMAINING_PAGES):r&&(a=r,l=a.length,c=s.LoadingState.LOADED)}var p=i.BrowseContext.fromServerObject(t);o.browseActions.initializeEverything({user:_.user,path:_.path,files:a,paginatedTotalNumFiles:l,urlPrefix:_.urlPrefix,context:p,mountPoints:t.ns_id_to_mount_point,shouldShowDeletedFiles:_.shouldShowDeletedFiles,fqPathsToSelect:_.fqPathsToSelect,loadingState:c,teamFolders:t.team_folders_js_info}),r||n?(n&&_.initializePaginationManager(n),_.onPrefetchComplete()):_.firstPagePreloadHandler(function(e){_.handleFirstPagePrefetchDataSuccess(e,p)},_.onPrefetchError)},this.handleFirstPagePrefetchDataSuccess=function(e,t){var r=_.extractAjaxFileInfo(e);if(!r)return void _.onPrefetchError();r.paginated?_.initializePaginationManager(r.first_page):o.browseActions.load({path:_.path,files:r.file_info,paginatedTotalNumFiles:r.file_info.length,context:t}),_.onPrefetchComplete()},this.extractAjaxInitData=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.extractAjaxFileInfo=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.initializePaginationManager=function(e){var t=e.total_num_items,r=n.PaginationManager.create({firstPage:e,keyName:"sjid",ajaxURL:"/browse_get_next",userID:_.user.id,newDataAvailableCallback:function(e,r){var i=e.areAllItemsReady(),n=i?s.LoadingState.LOADED:s.LoadingState.LOADING_REMAINING_PAGES;o.browseActions.addFilesAndSetLoadingState({path:_.path,files:r,paginatedTotalNumFiles:t,loadingState:n}),i&&e.stopAutoFetching()}});l.waitForTTI().then(function(){return r.startAutoFetching()})},this.user=u,this.path=p,this.urlPrefix=h,this.shouldShowDeletedFiles=f,this.fqPathsToSelect=m,this.onPrefetchComplete=t,this.onPrefetchError=a,this.browsePreloadHandler=d.__REGISTER_BROWSE_PRELOAD_HANDLER,this.firstPagePreloadHandler=d.__REGISTER_BROWSE_FIRST_PAGE_PRELOAD_HANDLER}return e})();t.BrowsePrefetchLoader=d}),define("modules/clean/react/browse/browse_view",["require","exports","tslib","external/immutable","external/react","modules/clean/filepath","modules/clean/react/app_actions_view","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/browse_location","modules/clean/react/browse/constants","modules/clean/filetypes","modules/clean/react/browse/global_actions","modules/clean/react/browse/files_view/controller","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/browse/util","modules/clean/react/file_uploader/file_uploader","modules/clean/react/maestro/layout","modules/clean/search/search_results/log_helper","modules/clean/search/search_bar/log_helper","modules/clean/search/search_results/controller","modules/clean/sharing/browse_exports","modules/clean/sharing/access_level","modules/clean/user_education/user_education_client","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/python","modules/core/browser","modules/core/i18n","modules/clean/search/search_bar/chips","modules/clean/analytics","modules/clean/web_user_action_events"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h,f,m,_,S,g,w,v,T,b,F,E,y,C,R,D,A,I,P,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var L=[F.NameSpaceAccess.ACCESS_NO_ACCESS,F.NameSpaceAccess.ACCESS_READER,F.NameSpaceAccess.ACCESS_READER_NO_COMMENT],x=(function(t){function F(c){var d=t.call(this,c)||this;return d.handleGetFileActionsForOneFile=function(e,t){return d.handleGetFileActionsForSetOfFiles(s.Set([e]),t,!1)},d.handleGetFileActionsForSetOfFiles=function(t,r,s){if(d.props.arePostTTIModulesLoaded){var o=d.props,i=o.context,n=o.user,a=o.actionHandlers,l=o.isSearchMode,c=o.isOverFreeQuota,u=o.isQueryingFolderSizes,p=o.expShouldShowUnifiedTrashModal,h=o.expShowAddToShowcase;return e("modules/clean/react/browse/file_actions").getActionsForFileCollection({files:t,context:i,user:n,canDisplayFolderSizes:r,actionHandlers:a,skipSharing:!1,isSearchMode:l,isOverFreeQuota:c,isQueryingFolderSizes:u,shouldShowUnifiedTrashModal:p,canShowUJPopup:s,showAddToShowcase:h})}return[]},d.handleNavigateToFileOrFolder=function(e,t){var r=d.props,s=r.user,o=r.isSearchMode,n=r.viewType,c=r.expShouldShowUnifiedTrashModal,p=e.ns_id,h=e.sjid,f=e.file_id,_=e.fq_path,S=e.bytes,g=e.ext,v=e.request_id;if(a.logOpenRow({uid:s.id,entity_type:e.is_dir?"folder":"file",source:"list_browse",view_type:n,file_nsid:p,file_sjid:h,file_id:f,file_name:i.filename(e.fq_path),file_path:_,file_size:S,file_extension:g,request_id:v}),e.type===u.FileTypes.TEAM_SHARED_FOLDER&&(E.UEClient.sendEvent("FileItemRow","TeamFolderClicked"),P.TeamsWebActionsLogger.log("clicked_team_folder_web",{team_id:y.Viewer.get_viewer().team_id})),o&&e.is_unmounted)w.recordSearchResultsAction({result:e,user:s,action_type:N.WebUserActionLogEvent.UNMOUNTED_VIEW,view_type:m.getBrowseStore().viewType()}),b.asyncShowSharedContentLinkSyncModal(s,e);else{var T=R.FileViewActionType.CLICK;o&&(w.recordSearchResultsAction({result:e,user:s,action_type:e.is_dir?N.WebUserActionLogEvent.FOLDER_OPEN:N.WebUserActionLogEvent.FILE_VIEW,view_type:m.getBrowseStore().viewType()}),T=R.FileViewActionType.SEARCH),l.browseActions.navigateToFileOrFolder({file:e,onFileViewerUnmount:t,fileViewAction:T,expShouldShowUnifiedTrashModal:c})}},d.handleUploadButtonClick=function(){S.FileUploaderController.setPath(d.props.path),S.FileUploaderController.handleUploadButtonClick()},d.handleShowFileUploader=function(){S.FileUploaderController.setPath(d.props.path),S.FileUploaderController.showModal()},d.handleSelectionChange=function(e){var t=m.getBrowseStore().getFileByFullPath(e.selected.first());if(t){var r=t.ns_id,s=t.sjid,o=t.file_id,n=t.fq_path,c=t.bytes,u=t.ext,p=t.request_id;a.logSelectRow({uid:d.props.user.id,entity_type:t.is_dir?"folder":"file",view_type:d.props.viewType,file_nsid:r,file_sjid:s,file_id:o,file_name:i.filename(t.fq_path),file_path:n,file_size:c,file_extension:u,request_id:p})}l.browseActions.setSelection({selection:e})},d.handleFileListSortChange=function(e,t){a.logSortRecords({uid:d.props.user.id,sort_by:e,sort_direction:t,view_type:d.props.viewType}),l.browseActions.sortFiles({sortField:e,sortDirection:t})},d.handleStarClick=function(e,t){var r=t?N.WebUserActionLogEvent.STAR:N.WebUserActionLogEvent.REMOVE_STAR,s=d.props,o=s.user,i=s.isSearchMode,n=s.viewType;i&&w.recordSearchResultsAction({result:e,user:o,action_type:r,view_type:n}),a.logBrowseAction(o.id,"BROWSE",r,n,e)},d.handleSearchFromSearchBar=function(e){var t=I.getSearchPathForChips(d.props.searchBarExperiments);e?d.props.onSearch(e,t,!0):l.browseActions.setUrl({path:t})},d.handleSearchResultOpen=function(e){e instanceof f.File?e.is_unmounted?b.asyncShowSharedContentLinkSyncModal(d.props.user,e):(v.logDropdownSearchAction({result:e,user:d.props.user,action_type:e.is_dir?N.WebUserActionLogEvent.FOLDER_OPEN:N.WebUserActionLogEvent.FILE_VIEW,viewport:"dropdown-view"}),l.browseActions.navigateToFileOrFolder({file:e,fileViewAction:R.FileViewActionType.SEARCH})):(e instanceof f.Paper||e instanceof f.PaperFolder)&&(v.logDropdownSearchAction({result:e,user:d.props.user,action_type:N.WebUserActionLogEvent.PAPER_OPEN,viewport:"dropdown-view"}),D.open_tab(e.url))},d.handleResultObjectPathClick=function(e){v.logDropdownSearchAction({result:e,user:d.props.user,action_type:N.WebUserActionLogEvent.CLICK_PATH_LINK,viewport:"dropdown-view"}),l.browseActions.navigateToResultObjectParentFolder({file:e,fileViewAction:R.FileViewActionType.SEARCH})},d.setFilesViewControllerRef=function(e){d.filesViewControllerRef=e},d.handleSearchFromSearchResults=function(e,t){d.props.onSearch(e,t,!1)},d.renderSideBar=function(e){return o.createElement("div",{className:"maestro-browse-action-sidebar"},d.maybeRenderBrowseFileUploader(),o.createElement(n.AppActionsView,r.__assign({},d.state.appActionsProps,{responsive:e})))},d.renderAppContent=function(e){return o.createElement("div",{className:"maestro-browse-app-content"},d.renderBrowseItemList(e))},d.state={appActionsProps:d.getCurrentAppActionsProps(d.props),searchBarProps:d.getCurrentSearchBarProps(d.props),sharedFolderUpsellBanner:void 0},d}return r.__extends(F,t),F.prototype.componentWillReceiveProps=function(e){e.selectedFiles===this.props.selectedFiles&&e.context===this.props.context&&e.user===this.props.user&&e.shouldShowDeletedFiles===this.props.shouldShowDeletedFiles&&e.isNoComment===this.props.isNoComment&&e.arePostTTIModulesLoaded===this.props.arePostTTIModulesLoaded&&e.viewType===this.props.viewType&&e.starredState===this.props.starredState&&e.isSearchMode===this.props.isSearchMode&&e.canDisplayFolderSizes===this.props.canDisplayFolderSizes||this.setState({appActionsProps:this.getCurrentAppActionsProps(e)}),e.isSearchMode===this.props.isSearchMode&&e.path===this.props.path||this.setState({searchBarProps:this.getCurrentSearchBarProps(e)})},F.prototype.componentDidMount=function(){var e=this;C.waitForTTI().then(function(){e.defineFileUploader(),e.maybeOpenUploaderOnMount(),e.maybeLoadSharedFolderUpsell()}),E.UEClient.sendEvent("BrowseView","componentDidMount",this.props.context.toJSON())},F.prototype.componentDidUpdate=function(){this.props.loadingState===d.LoadingState.LOADED&&E.UEClient.sendEvent("BrowseView","componentDidUpdate",this.props.context.toJSON())},F.prototype.maybeOpenUploaderOnMount=function(){this.props.shouldOpenUploadModal&&this.handleShowFileUploader()},F.prototype.getCurrentDropTargetHighlightMode=function(){var e=this.props.selectedFiles,t=this.props.context;return t.isInsideSharedFolder&&L.includes(t.currentSharedFolderPermissionRole)?d.DropTargetHighlightMode.NONE:this.props.isDraggingInternalFiles?e.some(function(e){return e.isDeleted||e.type===u.FileTypes.TEAM_SHARED_FOLDER})?d.DropTargetHighlightMode.NONE:e.some(function(e){return e.type===u.FileTypes.SHARED_FOLDER})?t.currentNSAllowsNesting?d.DropTargetHighlightMode.NONSELECTED_FOLDERS:d.DropTargetHighlightMode.NONSELECTED_NONSHARED_FOLDERS:d.DropTargetHighlightMode.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?d.DropTargetHighlightMode.ALL_FOLDERS:d.DropTargetHighlightMode.NONE},F.prototype.getCurrentSearchBarProps=function(e){return{showSearchBar:!0,currentPath:e.path,onSearch:this.handleSearchFromSearchBar,onSearchResultOpen:this.handleSearchResultOpen,onResultObjectPathClick:this.handleResultObjectPathClick,isSearchBarExpanded:e.isSearchMode,searchBarExperiments:e.searchBarExperiments}},F.prototype.getCurrentAppActionsProps=function(t){var r=t.selectedFiles,s=_.getSelectedFilesText(r,t.context),i=r.count(),n=o.createElement("div",null),a=[];if(i>0)a=this.handleGetFileActionsForSetOfFiles(r,t.canDisplayFolderSizes,!0),1===i&&(n=this.renderSingleSelectionAudienceBox(t));else if(a=p.getGlobalActions({context:t.context,user:t.user,showDeletedFiles:t.shouldShowDeletedFiles,onFileUpload:this.handleUploadButtonClick,isContextMenu:!1,isNoComment:this.props.isNoComment,experiments:{expShouldShowUnifiedTrashModal:t.expShouldShowUnifiedTrashModal,expBrowseCdmNsfShouldCreateNsf:t.expBrowseCdmNsfShouldCreateNsf,expBrowseCdmNsfAutoTeamGroupId:t.expBrowseCdmNsfAutoTeamGroupId}}),t.arePostTTIModulesLoaded){var l=e("modules/clean/react/browse/shared_with").SharedWithController;n=o.createElement(l,{browseContext:t.context,isInAudienceBox:!0})}var c=a.map(function(e){return{displayName:e.label,iconName:e.iconName,handleClick:e.performAction,disabled:e.disabled,className:e.className}});return t.isNoComment&&(n=o.createElement("div",null)),{headerText:s,popoverTriggerLabel:A._("Actions"),primaryMenuItem:c[0],primarySubnode:n,secondaryMenuItems:c.slice(1),handleComponentTTI:t.handleComponentTTI}},F.prototype.getFilesViewControllerRef=function(){return this.filesViewControllerRef},F.prototype.shouldShowPinnedTeamFolder=function(){var e=this.props,t=e.context,r=e.expSubgrowthBizTrialOnboarding,s=e.loadingState,o=e.path,i=e.teamFolders,n=e.viewType;if(r&&("/"!==o||n!==d.ViewType.List))return!1;var a=s===d.LoadingState.LOADED;return t.showPinnedTeamFolder&&!i.isEmpty()&&a},F.prototype.renderBrowseItemList=function(e){var t=this.shouldShowPinnedTeamFolder(),r=t?this.props.filesWithoutTeamFolders:this.props.files;return o.createElement("div",null,o.createElement(h.FilesViewController,{getFileActions:this.handleGetFileActionsForOneFile,onNavigateToFileOrFolder:this.handleNavigateToFileOrFolder,actionHandlers:this.props.actionHandlers,activeDropTarget:this.props.activeDropTarget,context:this.props.context,createNewFolderState:this.props.createNewFolderState,currentSort:this.props.currentSort,dropTargetHighlightMode:this.getCurrentDropTargetHighlightMode(),fileRename:this.props.fileRename,items:r,responsive:e,expShouldShowUnifiedTrashModal:this.props.expShouldShowUnifiedTrashModal,expSharedFolderUpsell:this.props.expSharedFolderUpsell,getIsFileJumping:this.props.getIsFileJumping,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isFileViewerShown:this.props.isFileViewerShown,isOverFreeQuota:this.props.isOverFreeQuota,isSubgrowthPinnedExp:t&&this.props.expSubgrowthBizTrialOnboarding,numTeamFolders:this.props.teamFolders.size,arePostTTIModulesLoaded:this.props.arePostTTIModulesLoaded,isTextSelectable:this.props.isTextSelectable,loadingState:this.props.loadingState,onComponentTTI:this.props.handleComponentTTI,onSelectionChange:this.handleSelectionChange,onSortChange:this.handleFileListSortChange,onStarClick:this.handleStarClick,path:this.props.path,ref:this.setFilesViewControllerRef,selectedFiles:this.props.selectedFiles,selection:this.props.selection,setFileUploaderPath:S.FileUploaderController.setPathAndPermissions,shouldShowPinnedTeamFolders:t,showFileUploaderModal:this.handleShowFileUploader,teamFolders:this.props.teamFolders,totalNumFiles:this.props.totalNumItems,user:this.props.user,viewType:this.props.viewType,isQueryingFolderSizes:this.props.isQueryingFolderSizes,columns:this.props.columns,viewTypeColumns:this.props.viewTypeColumns,tilesPerRow:this.props.tilesPerRow}))},F.prototype.defineFileUploader=function(){S.FileUploaderController.loadCoreComponent()},F.prototype.maybeRenderBrowseFileUploader=function(){var e=this.props,t=e.user,r=e.context;return t&&null!=r.currentFQPath?o.createElement(S.FileUploaderController,{key:"file-uploader-controller",ref:"fileUploader",loadOnRender:!1,needToSetStoreValues:!1,expShouldCheckFSWs:this.props.expShouldCheckFSWs,browseViewType:this.props.viewType}):null},F.prototype.renderSingleSelectionAudienceBox=function(e){var t=e.selectedFiles.first();return e.arePostTTIModulesLoaded?this.renderAudienceBox(e,t):null},F.prototype.renderAudienceBox=function(t,r){var s=e("modules/clean/react/browse/shared_with").SharedWithController;return o.createElement(s,{file:r,browseContext:t.context,isInAudienceBox:!0})},F.prototype.renderBrowseLocation=function(){var e=this.props.path;if(e){var t=e.split("/"),r=t.length;document.title="/"!==e?A._("%(folder_name)s - Dropbox").format({folder_name:e.split("/")[r-1]}):A._("Files - Dropbox")}var s=this.props,i=s.isDraggingInternalFiles,n=s.isDraggingExternalFiles,a=s.isUploadModalOpen;return o.createElement(c.BrowseLocation,{path:this.props.path,user:this.props.user,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:i,setFileUploaderPath:S.FileUploaderController.setPathAndPermissions,shouldHighlightDropTargets:i||n&&!a})},F.prototype.renderBrowse=function(){var e=this.props.user;return o.createElement("div",null,o.createElement(g.MaestroChrome,{user:e,titleRegion:this.renderBrowseLocation(),titleClass:"page-header__title-overflow",embeddedAppRegion:this.renderAppContent,actionSidebarRegion:this.renderSideBar,searchBarProps:this.state.searchBarProps}),this.renderSharedFolderUpsell())},F.prototype.renderSearchResults=function(){var e=this.props,t=e.actionHandlers,r=e.fileRename,s=e.path,i=e.user,n=e.handleComponentTTI,a=e.isFileViewerShown,l=e.arePostTTIModulesLoaded,c=e.getIsFileJumping,d=e.ensureFileViewerClosedIfNotPreviewing,u=e.searchResultsExperiments;return o.createElement(T.SearchResultsController,{actionHandlers:t,path:s,user:i,searchResultsExperiments:u,onSearch:this.handleSearchFromSearchResults,setFileUploaderPath:S.FileUploaderController.setPathAndPermissions,maestroSearchBarProps:this.state.searchBarProps,handleComponentTTI:n,ensureFileViewerClosedIfNotPreviewing:d,getIsFileJumping:c,isFileViewerShown:a,fileRename:r,arePostTTIModulesLoaded:l,getFileActions:this.handleGetFileActionsForOneFile,onNavigateToFileOrFolder:this.handleNavigateToFileOrFolder})},F.prototype.maybeLoadSharedFolderUpsell=function(){return r.__awaiter(this,void 0,void 0,function(){var t,s;return r.__generator(this,function(r){switch(r.label){case 0:return this.props.expSharedFolderUpsell&&this.props.context.isInsideSharedFolder?[4,new Promise(function(t,r){e(["modules/clean/teams/membership_request_block"],t,r)})]:[3,2];case 1:t=r.sent().MembershipRequestBlock,s={expSharedFolderUpsell:this.props.expSharedFolderUpsell,contacts:this.props.expSharedFolderUpsellMembers,isViewerCorpDomain:this.props.expSharedFolderUpsellViewerIsCorpDomain,nsId:this.props.nsId,numMembers:this.props.expSharedFolderUpsellNumMembers,numInSameDomain:this.props.expSharedFolderUpsellNumInSameDomain},this.setState({sharedFolderUpsellBanner:o.createElement(t,{membershipRequestOptions:s})}),r.label=2;case 2:return[2]}})})},F.prototype.renderSharedFolderUpsell=function(){if(this.props.expSharedFolderUpsell&&this.props.context.isInsideSharedFolder)return this.state.sharedFolderUpsellBanner},F.prototype.render=function(){return this.props.isSearchMode?this.renderSearchResults():this.renderBrowse()},F.defaultProps={selectedFiles:s.OrderedMap(),viewType:d.ViewType.List},F})(o.PureComponent);t.BrowseView=x}),define("modules/clean/react/browse/dispatcher",["require","exports","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/react/browse/store"],function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseDispatcher={dispatch:function(e){r.assert(o.browseStoreInstantiated(),"Must call getBrowseStore() before a dispatch"),s.Dispatcher.dispatch(e)}}}),define("modules/clean/react/browse/file_list_utils",["require","exports","modules/clean/filetypes","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/sharing/browse_exports"],function(e,t,r,s,o,i){"use strict";function n(e){var t=e.file,i=e.isSelected,n=e.dropTargetHighlightMode;if(n===s.DropTargetHighlightMode.NONE)return!1;if(!t.is_dir)return!1;if(o.File.isReadOnlySharedFolder(t))return!1;if(t.isDeleted)return!1;switch(n){case s.DropTargetHighlightMode.ALL_FOLDERS:return!0;case s.DropTargetHighlightMode.NONSELECTED_FOLDERS:return!i;case s.DropTargetHighlightMode.NONSELECTED_NONSHARED_FOLDERS:return!i&&t.type!==r.FileTypes.SHARED_FOLDER;case s.DropTargetHighlightMode.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:return!i&&![r.FileTypes.SHARED_FOLDER,r.FileTypes.TEAM_SHARED_FOLDER].includes(t.type)}return!1}function a(e){var t=e.context,r=e.file;e.user;return r.isDeleted||r.is_dir&&i.shouldUsePublicFolderSharing(t.config,r.fq_path)||o.File.isTeamMemberFolder(r)||!o.File.canViewFileMembers(r,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.shouldFileBeHighlightedDropTarget=n,t.isSharingDisabledForFile=a}),define("modules/clean/react/browse/files_view/column_header",["require","exports","tslib","external/classnames","external/spectrum/checkbox","external/spectrum/table","external/react","modules/clean/react/browse/files_view/column_header_menu","modules/clean/react/browse/files_view/fixed_table_head","modules/clean/react/browse/files_view/sticky_table_head","modules/clean/react/browse/files_view/view_type_column_header_menu","modules/clean/react/browse/constants","modules/clean/react/browse/files_view/constants"],function(e,t,r,s,o,i,n,a,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isHovered:!1},t.handleChangeSelectAllCheckbox=function(e){"unchecked"===e?t.props.onDeselectAll():t.props.onSelectAll()},t.handleMouseEnter=function(){t.setState({isHovered:!0})},t.handleMouseLeave=function(){t.setState({isHovered:!1})},t}return r.__extends(t,e),t.prototype.getAriaSortValue=function(e){return e===u.SortDirection.ASCENDING?"ascending":e===u.SortDirection.DESCENDING?"descending":"none"},t.prototype.render=function(){var e=this,t=this.state.isHovered,h=this.props,f=h.columnFlex,m=h.isCompactMode,_=h.isSelectMode,S=h.isSticky,g=h.isTabbing,w=h.currentSort,v=h.onSelection,T=h.onSort,b=h.onSwitchViewType,F=h.selectAllCheckboxState,E=void 0===F?"unchecked":F,y=h.stickyOffsetHeight,C=h.stickyOffsetTop,R=h.visibleColumns,D=h.viewType,A=h.onTTI,I=!(g||_||t||m),P=[n.createElement(i.TableHeadCell,{className:"brws-column-header-table-cell brws-checkbox-cell",key:"checkbox-cell",role:"columnheader",scope:"col"},n.createElement("div",{className:"brws-vertically-center"},n.createElement(o.Checkbox,{className:s("brws-checkbox",{"brws-checkbox-checked":"checked"===E}),checked:E,onChange:this.handleChangeSelectAllCheckbox,variant:I?"invisible":"default"})))].concat(R.map(function(t,r){var s=w&&w.sortField===t.sortField?w.sortDirection:void 0;return n.createElement(i.TableHeadCell,{key:r,role:"columnheader",scope:"col","aria-sort":e.getAriaSortValue(s),className:"brws-column-header-table-cell"},n.createElement(a.ColumnHeaderMenu,{column:t,sortDirection:s,columns:D===u.ViewType.List?p.LIST_VIEW_COLUMNS:p.GRID_VIEW_COLUMNS,visibleColumns:R,onSelection:v,onSort:T,viewType:D}),r===R.length-1&&n.createElement(d.ViewTypeColumnHeaderMenu,{onTTI:A,viewType:D,onSwitchViewType:b}))})),N={offsetHeight:y,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave};return S?n.createElement(c.StickyTableHead,r.__assign({columnFlex:f,offsetTop:C,className:"brws-column-header"},N),P):n.createElement(l.FixedTableHead,r.__assign({},N),P)},t})(n.PureComponent);t.ColumnHeader=h}),define("modules/clean/react/browse/files_view/column_header_menu",["require","exports","tslib","external/classnames","external/spectrum/icon_form","external/spectrum/popover","external/react","modules/clean/react/browse/constants","modules/core/i18n"],function(e,t,r,s,o,i,n,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePopoverSelection=function(e){var r=t.props,s=r.onSort,o=r.onSelection,i=r.column;e===a.SortDirection.ASCENDING||e===a.SortDirection.DESCENDING?s(i.sortField,e):(o(e,i),1===t.props.visibleColumns.length&&s(e.sortField,t.props.sortDirection||a.SortDirection.ASCENDING))},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.column,r=e.columns,c=e.visibleColumns,d=e.sortDirection,u=e.viewType;if(t.isSortDisabled)return n.createElement("div",{className:"normal brws-column-header-menu"},n.createElement("span",{className:"brws-column-header-menu-trigger-disabled"},t.label));var p,h=u===a.ViewType.Grid?l._("Group by"):l._("Show");!t.isLocked&&r&&r.length&&(p=[n.createElement(i.PopoverItemGroupSeparator,{key:"show-separator"}),n.createElement(i.PopoverItemGroup,{key:"show-item-group"},n.createElement(i.PopoverItemGroupTitle,{className:"brws-column-header-menu-title",key:"show-title"},h),r.filter(function(e){return!e.isLocked}).map(function(e){return n.createElement(i.PopoverSelectableItem,{key:e.sortField,disabled:c.map(function(e){return e.sortField}).includes(e.sortField)&&e.sortField!==t.sortField,selected:e.sortField===t.sortField,value:e},e.label)}))]);var f=d===a.SortDirection.ASCENDING?"sort-arrow-up":d===a.SortDirection.DESCENDING?"sort-arrow-down":"caret-down";return n.createElement(i.Popover,{className:"brws-column-header-menu",onSelection:this.handlePopoverSelection},n.createElement(i.PopoverTrigger,{className:s("brws-column-header-menu-trigger",{"brws-column-header-menu-trigger-active":!!d}),title:t.label},n.createElement("span",null,t.label),n.createElement("span",{className:"brws-column-header-menu-label-icon-wrapper"},n.createElement(o.IconForm,{className:"brws-column-header-menu-label-icon",name:f}))),n.createElement(i.PopoverContent,null,n.createElement(i.PopoverItemGroup,null,n.createElement(i.PopoverItemGroupTitle,{className:"brws-column-header-menu-title"},l._("Order")),n.createElement(i.PopoverSelectableItem,{selected:d===a.SortDirection.ASCENDING,value:a.SortDirection.ASCENDING},l._("Ascending")),n.createElement(i.PopoverSelectableItem,{selected:d===a.SortDirection.DESCENDING,value:a.SortDirection.DESCENDING},l._("Descending"))),p))},t})(n.PureComponent);t.ColumnHeaderMenu=c}),
define("modules/clean/react/browse/files_view/column_manager",["require","exports","tslib","external/react","modules/clean/immutability_helper","modules/clean/react/browse/constants"],function(e,t,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleSelection=function(e,t){var s=r.props,n=s.viewType,a=s.onColumnsChanged,l=s.viewTypeColumns,c=r.state.visibleColumns,d=l?l[i.ViewType.List]:void 0,u=l?l[i.ViewType.Grid]:void 0;if(d&&u){var p=c.indexOf(t);if(p===-1||c.includes(e))r.changeVisibleColumns(c);else{var h=o.splice(c,p,1,e);r.changeVisibleColumns(h);var f=r.isSizeColumnPresent(h);n===i.ViewType.List?a(r.swapColumns(d,t.sortField,e.sortField),i.ViewType.List,f):(a(r.swapColumns(u,t.sortField,e.sortField),i.ViewType.Grid,f),e.sortField!==i.BrowseSortField.FILENAME&&a(r.swapColumns(d,d[1].sortField,e.sortField),i.ViewType.List,f))}}},r}return r.__extends(t,e),t.prototype.componentWillMount=function(){this.changeVisibleColumns(this.computeVisibleColumns(this.props),!0)},t.prototype.componentWillReceiveProps=function(e){var t=this.props.viewTypeColumns,r=this.state.visibleColumns,s=this.getNumVisibleColumns(this.props),o=this.getNumVisibleColumns(e);if(this.props.columns!==e.columns)if(1===o&&e.columns.length&&e.currentSort){var n=e.columns,a=e.viewType,l=t?t[i.ViewType.Grid]:void 0;if(a===i.ViewType.List)this.changeVisibleColumns([n[0]],!0);else if(l&&a===i.ViewType.Grid){var c=e.currentSort,d=n.find(function(e){return e.sortField===c.sortField}),u=d||n[0];this.deferredOnColumnsChangedHandler([u],this.swapColumns(l,l[0].sortField,u.sortField),i.ViewType.Grid)}}else this.changeVisibleColumns(e.columns.slice(0,o),!0);else if(o<s)this.changeVisibleColumns(r.slice(0,o),!0);else if(o>s){var n=this.props.columns,p=o-r.length,h=[];n.forEach(function(e){h.length<p&&!r.includes(e)&&h.push(e)}),this.changeVisibleColumns(r.concat(h),!0)}},t.prototype.changeVisibleColumns=function(e,t){var r=this;void 0===t&&(t=!1),this.resetChangeVisibleColumnsTimeout();var s=this.isSizeColumnPresent(e);this.setState({visibleColumns:e,canDisplayFolderSizes:s}),t?this.changeVisibleColumnsTimeout=setTimeout(function(){r.resetChangeVisibleColumnsTimeout(),r.props.onCanDisplayFolderSizesChanged(s)}):this.props.onCanDisplayFolderSizesChanged(s)},t.prototype.resetChangeVisibleColumnsTimeout=function(){this.changeVisibleColumnsTimeout&&(clearTimeout(this.changeVisibleColumnsTimeout),this.changeVisibleColumnsTimeout=void 0)},t.prototype.deferredOnColumnsChangedHandler=function(e,t,r){var s=this;this.resetDeferredOnColumnsChangedHandler();var o=this.isSizeColumnPresent(e);this.setState({visibleColumns:e,canDisplayFolderSizes:o}),this.onColumnsChangesTimeout=setTimeout(function(){s.resetDeferredOnColumnsChangedHandler(),s.props.onColumnsChanged(t,r,o)})},t.prototype.resetDeferredOnColumnsChangedHandler=function(){this.onColumnsChangesTimeout&&(clearTimeout(this.onColumnsChangesTimeout),this.onColumnsChangesTimeout=void 0)},t.prototype.swapColumns=function(e,t,r){var s=e.map(function(e){return e.sortField}).indexOf(t),i=e.map(function(e){return e.sortField}).indexOf(r);if(s===i||s===-1||i===-1)return e;var n=e[s],a=e[i];return o.splice(o.splice(e,s,1,a),i,1,n)},t.prototype.computeVisibleColumns=function(e){return e.columns.slice(0,this.getNumVisibleColumns(e))},t.prototype.getNumVisibleColumns=function(e){var t=e.isMatchedLarge,r=e.isMatchedMedium,s=e.isSearchMode;return e.viewType===i.ViewType.Grid?1:t?s?2:3:r?2:1},t.prototype.isSizeColumnPresent=function(e){return e.some(function(e){return e.sortField===i.BrowseSortField.SIZE})},t.prototype.render=function(){var e=this.props.children,t=this.state,r=t.visibleColumns,s=t.canDisplayFolderSizes;if(!e)return null;var o=e;return"function"==typeof e&&(o=e({visibleColumns:r,canDisplayFolderSizes:s,handleSelection:this.handleSelection})),o},t})(s.PureComponent);t.ColumnManager=n}),define("modules/clean/react/browse/files_view/controller",["require","exports","tslib","external/classnames","external/immutable","external/spectrum/media_table_skeleton","external/spectrum/table","external/react","external/react-dom","external/lodash","modules/clean/react/browse/actions","modules/clean/react/browse/browse_drag_and_drop","modules/clean/react/browse/constants","modules/clean/react/maestro/file_list_empty_folder_table","modules/clean/react/browse/files_view/column_header","modules/clean/react/browse/files_view/column_manager","modules/clean/react/browse/files_view/constants","modules/clean/react/browse/files_view/list","modules/clean/react/browse/files_view/pinned_team_folder_view","modules/clean/react/browse/files_view/selectable_list","modules/clean/react/browse/files_view/selectors","modules/clean/react/browse/files_view/tile_grid","modules/clean/react/browse/models","modules/clean/react/browse/name_input","modules/clean/react/browse/internal_drag_status","modules/clean/react/file_uploader/constants","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/core/i18n","modules/core/notify","modules/clean/sharing/access_level","modules/clean/search/search_results/log_helper","modules/core/browser","modules/clean/web_user_action_events","modules/clean/photos/thumb_loading/buffered_thumb_store","modules/clean/photos/thumb_loading/generic_thumb_store"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h,f,m,_,S,g,w,v,T,b,F,E,y,C,R,D,A,I,P,N,L,x,O){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var M=function(){},U=[I.NameSpaceAccess.ACCESS_NO_ACCESS,I.NameSpaceAccess.ACCESS_READER,I.NameSpaceAccess.ACCESS_READER_NO_COMMENT],B=(function(t){function I(){var e=null!==t&&t.apply(this,arguments)||this;return e.gridViewPrewarmedThumbnailRequestIds=[],e.state={thumbStore:new x.BufferedThumbStore,isTabbing:!1,keyboardShortcutModalHandler:function(){e.setState({shouldShowKeyboardShortcutModal:!0})}},e.handleOpenPaper=function(t,r){e.props.isSearchMode&&P.recordSearchResultsAction({result:r,user:e.props.user,action_type:L.WebUserActionLogEvent.PAPER_OPEN,view_type:e.props.viewType}),N.mac&&t.metaKey||!N.mac&&t.ctrlKey?N.open_tab(r.url):N.redirect(r.url)},e.handleMouseDownBody=function(){e.setState({isTabbing:!1})},e.handleKeyDownBody=function(t){9===t.keyCode&&e.setState({isTabbing:!0})},e.handleTabbingStart=function(){e.setState({isTabbing:!0})},e.handleCopyToClipboard=function(){var t=e.props.selectedFiles;t.size&&d.browseActions.copyFilesToClipboard(t.toArray())},e.handlePasteFromClipboard=function(){d.browseActions.pasteClipboardFilesToCurrentPath()},e.handleSetDragCopyMode=function(e){d.browseActions.setCopyMode({copyMode:e})},e.handleNavigateToParentFolder=function(){d.browseActions.navigateToParentFolder()},e.handleNavigateToPath=function(e){d.browseActions.setUrl({path:e})},e.handleNewFolderSubmit=function(t){""===t?e.handleNewFolderCancel({source:F.NameInputActionSource.SUBMIT}):d.browseActions.createFolder({pathName:e.props.context.currentFQPath,folderName:t,nsId:e.props.context.rootNSID,checkFSWs:!0})},e.handleNewFolderCancel=function(e){e.source!==F.NameInputActionSource.ESC&&A.error(D._("Please provide a name for the new folder.")),d.browseActions.cancelCreateFolder()},e.handleRenameSubmit=function(t,r){d.browseActions.renameFile({file:t,newName:r,isSearchMode:!!e.props.isSearchMode})},e.handleRenameCancel=function(e){d.browseActions.cancelFileRename({file:e})},e.handleSetDropTarget=function(e){d.browseActions.setDropTarget({target:e})},e.handleSetFileUploaderPath=function(t){var r=t?t.path:e.props.path,s=e.props.context.isCurrentPathWriteable();t&&t.hasOwnProperty("hasPermissionToUploadToFolder")&&(s=!!t.hasPermissionToUploadToFolder),e.props.setFileUploaderPath({path:r,hasPermissionToUploadToFolder:s})},e.handleDragStart=function(t,s){void 0===s&&(s=[]);var o=e.props,i=o.path,n=o.selectedFiles,a=o.user,d=c.keyBy(s,"fq_path");d=r.__assign({},d,n.toJS());var u=c.values(d);if(u.some(function(e){return b.File.isTeamSharedFolder(e)}))return void A.error(D._("Team folders can’t be moved."));if(u.some(function(e){return b.File.isTeamMemberFolder(e)}))return void A.error(D._("Your member folder can’t be moved."));var p=t.dataTransfer;p&&(p.setDragImage&&e.internalDragStatusRef&&p.setDragImage(l.findDOMNode(e.internalDragStatusRef),-10,-10),p.setData(y.INTERNAL_FILE_DATA_TRANSFER_TYPE,JSON.stringify({userId:a.id,fromPath:i,filePaths:u.map(function(e){return e.fq_path})})),p.effectAllowed="copyMove")},e.handleDragEnter=function(t,r,s,o){u.onFileDragEnterItem(r,!!e.props.isDraggingExternalFiles,!!e.props.isDraggingInternalFiles,s,o,e.props.context,e.handleSetDropTarget,e.handleSetFileUploaderPath)},e.handleSelectionChange=function(t){C.UEClient.sendEvent("FileItemRow","CheckboxToggled"),e.props.onSelectionChange(t)},e.handleDeselectAll=function(){var t=e.props,r=t.selection;(0,t.onSelectionChange)(r.set("selected",o.OrderedSet()))},e.handleSelectAll=function(){var t=e.props,r=t.items,s=t.selection;(0,t.onSelectionChange)(s.set("selected",o.OrderedSet(r.filter(function(e){return e instanceof b.File}).map(function(e){return e.fq_path}))))},e.handleSwitchViewType=function(t){d.browseActions.setViewType({viewType:t,isSearchMode:e.props.isSearchMode})},e.handleTTI=function(){e.props.onComponentTTI("FilesViewController")},e.setBrowseTileGridRef=function(t){e.browseTileGridRef=t},e.setInternalDragStatusRef=function(t){e.internalDragStatusRef=t},e.handleTilesPerRowChange=function(e){d.browseActions.setTilesPerRow({tilesPerRow:e})},e.getIsCurrentPathWriteable=function(){return e.props.context.isCurrentPathWriteable()},e.handleCanDisplayFolderSizesChanged=function(e){d.browseActions.setColumnDependentCapabilities({canDisplayFolderSizes:e})},e.handleColumnsChanged=function(e,t,r){d.browseActions.setColumnConfiguration({columns:e,viewType:t,canDisplayFolderSizes:r})},e}return r.__extends(I,t),I.prototype.componentDidMount=function(){var t=this;this.setupUnity(),document.addEventListener("keydown",this.handleKeyDownBody),document.addEventListener("mousedown",this.handleMouseDownBody),R.waitForTTI().then(function(){t.prewarmGridViewThumbStore();var r=function(e){var r=e.showKeyboardShortcutsModal;t.state.shouldShowKeyboardShortcutModal&&r(t.props.viewType===p.ViewType.List),t.setState({keyboardShortcutModalHandler:function(){r(t.props.viewType===p.ViewType.List)},shouldShowKeyboardShortcutModal:!1})};r.perfName="keyboard_shortcuts_modal",e(["modules/clean/react/browse/keyboard_shortcuts_modal"],r)})},I.prototype.componentWillReceiveProps=function(e){if(e.context&&this.props.context&&e.context.currentFQPath!==this.props.context.currentFQPath){this.undoPrewarmGridViewThumbStore();var t=this.props.arePostTTIModulesLoaded?new O.GenericThumbStore:new x.BufferedThumbStore;this.setState({thumbStore:t})}},I.prototype.componentDidUpdate=function(e){e.context&&this.props.context&&e.context.currentFQPath!==this.props.context.currentFQPath&&this.prewarmGridViewThumbStore(),this.props.enableUnity&&e.items!==this.props.items&&this.triggerUnityChangeCallback&&this.triggerUnityChangeCallback(),e.path!==this.props.path&&this.handleScrollToTop()},I.prototype.componentWillUnmount=function(){this.triggerUnityChangeCallback=void 0,document.removeEventListener("keydown",this.handleKeyDownBody),document.removeEventListener("mousedown",this.handleMouseDownBody)},I.prototype.setupUnity=function(){return r.__awaiter(this,void 0,void 0,function(){var t,s=this;return r.__generator(this,function(r){switch(r.label){case 0:return[4,R.waitForTTI()];case 1:return r.sent(),[4,e(["modules/clean/unity_browse_interface"])];case 2:return t=r.sent()[0],this.triggerUnityChangeCallback=function(){t.browse_visible_change_callback(s.props.items.toArray(),s.props.user.id,0,s.props.items.size-1)},[2]}})})},I.prototype.prewarmGridViewThumbStore=function(){var e=this;if(this.props.viewType!==p.ViewType.Grid){var t=this.state.thumbStore;this.props.items.slice(0,100).forEach(function(r){if(r instanceof b.File){var s=T.getThumbnailUrlForItem(r);if(s){var o=t.bind_url(s,{onSuccess:M});o&&e.gridViewPrewarmedThumbnailRequestIds.push(o)}}})}},I.prototype.undoPrewarmGridViewThumbStore=function(){var e=this;this.gridViewPrewarmedThumbnailRequestIds.length&&(this.gridViewPrewarmedThumbnailRequestIds.forEach(function(t){e.state.thumbStore.unbind_url(t)}),this.gridViewPrewarmedThumbnailRequestIds=[])},I.prototype.handleScrollToTop=function(){window.scrollTo(0,0)},I.prototype.getBrowseTileGridRef=function(){return this.browseTileGridRef},I.prototype.renderEmptyFolderView=function(){if(this.props.customEmptyFolderView)return this.props.customEmptyFolderView();var e=this.props.context,t=e.isInsideSharedFolder,r=e.currentSharedFolderPermissionRole,s=t&&U.includes(r),o=s?void 0:D._("Drag and drop files onto this window to upload.");return a.createElement(h.EmptyFolderTable,{title:D._("This folder is empty"),subtitle:o,onTTI:this.handleTTI})},I.prototype.renderPinnedTeamFolderView=function(e){var t=this.props,r=t.activeDropTarget,s=t.context,o=t.dropTargetHighlightMode,i=t.isSubgrowthPinnedExp,n=t.shouldShowPinnedTeamFolders,l=t.teamFolders,c=t.user,d=this.state,u=d.isTabbing,p=d.thumbStore;if(n&&l&&l.size)return a.createElement(g.PinnedTeamFolderView,{activeDropTarget:r,columnFlex:_.LIST_VIEW_COLUMN_FLEX[1],context:s,dropTargetHighlightMode:o,expSubgrowthBizTrialOnboarding:i,getFileActions:this.props.getFileActions,isCompactMode:e,isTabbing:u,onDragEnter:this.handleDragEnter,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,onRenameCancel:this.handleRenameCancel,onRenameSubmit:this.handleRenameSubmit,teamFolders:l,user:c,arePostTTIModulesLoaded:this.props.arePostTTIModulesLoaded,thumbStore:p})},I.prototype.getSelectAllCheckboxCheckedVariant=function(){var e=this.props,t=e.selectedFiles,r=e.items,s="unchecked";return t.size===r.size?s="checked":t.size&&(s="mixed"),s},I.prototype.isCreateFolderUIActive=function(){var e=this.props.createNewFolderState;return e&&"CREATE_FOLDER_INACTIVE"!==e},I.prototype.shouldShowEmptyFolderView=function(){return this.props.loadingState===p.LoadingState.LOADED&&!this.props.items.size&&!this.isCreateFolderUIActive()},I.prototype.shouldComponentUpdate=function(e){return e.loadingState!==this.props.loadingState||e.loadingState!==p.LoadingState.LOADING_FIRST_PAGE},I.prototype.render=function(){var e=this,t=this.props,r=t.actionHandlers,o=t.activeDropTarget,l=t.currentSort,c=t.createNewFolderState,d=t.context,u=t.columns,h=t.dropTargetHighlightMode,g=t.expSharedFolderUpsell,b=t.fileRename,F=t.getIsFileJumping,y=t.items,C=t.isSubgrowthPinnedExp,R=t.isSearchMode,D=t.isDraggingExternalFiles,A=t.isDraggingInternalFiles,I=t.isQueryingFolderSizes,P=t.isFileViewerShown,N=t.loadingState,L=t.onSortChange,x=t.onSelectionChange,O=t.path,M=t.selectedFiles,U=t.selection,B=t.shouldShowPinnedTeamFolders,k=t.teamFolders,q=t.tilesPerRow,V=t.totalNumFiles,H=t.user,W=t.viewType,z=t.viewTypeColumns,G=t.onNavigateToFileOrFolder,j=t.getFileActions,Q=t.arePostTTIModulesLoaded,K=t.onStarClick,J=this.props.responsive,Y=J.isMatchedLarge,X=J.isMatchedMedium,Z=this.state,$=Z.thumbStore,ee=Z.isTabbing,te=Z.keyboardShortcutModalHandler;if(N===p.LoadingState.LOADING_FIRST_PAGE)return Q?a.createElement(i.MediaTableSkeleton,{numRows:15}):null;var re=v.getItemIds(this.props),se=!Y,oe=!!M.size;if(this.shouldShowEmptyFolderView())return a.createElement("div",{className:"brws-files-view"},this.renderPinnedTeamFolderView(se),this.renderEmptyFolderView());var ie=Y?_.DEFAULT_COLUMN_HEADER_HEIGHT:_.COMPACT_COLUMN_HEADER_HEIGHT,ne=Y||X?_.DEFAULT_PAGE_HEADER_HEIGHT:_.COMPACT_PAGE_HEADER_HEIGHT,ae=ie+ne,le=0;B&&k&&k.size&&(le+=ie+ie+_.PINNED_TEAM_FOLDER_SECONDARY_HEADER_PADDING_TOP+k.size*_.DEFAULT_ROW_HEIGHT);var ce="";return g&&d.isInsideSharedFolder&&(ce="exp-shared-folder-upsell-v1__scrollList"),a.createElement("div",{className:"brws-files-view"},this.renderPinnedTeamFolderView(se),a.createElement("div",{className:ce},a.createElement(m.ColumnManager,{columns:u,viewTypeColumns:z,currentSort:l,onCanDisplayFolderSizesChanged:this.handleCanDisplayFolderSizesChanged,onColumnsChanged:this.handleColumnsChanged,isMatchedLarge:Y,isMatchedMedium:X,isSearchMode:R,viewType:W},function(t){var i=t.visibleColumns,u=t.handleSelection,m=t.canDisplayFolderSizes,g=(R?_.LIST_VIEW_SEARCH_MODE_COLUMN_FLEX:_.LIST_VIEW_COLUMN_FLEX)[i.length],v=a.createElement(f.ColumnHeader,{columnFlex:g,currentSort:l,isCompactMode:se,isSelectMode:oe,isSticky:C&&W===p.ViewType.List,isTabbing:ee,onDeselectAll:e.handleDeselectAll,onSelectAll:e.handleSelectAll,onSelection:u,onSort:L,onSwitchViewType:e.handleSwitchViewType,selectAllCheckboxState:e.getSelectAllCheckboxCheckedVariant(),stickyOffsetHeight:ie,stickyOffsetTop:ne,visibleColumns:i,viewType:W,onTTI:e.handleTTI});return W===p.ViewType.List?a.createElement(w.SelectableList,{itemIds:re,keyScope:_.SELECTABLE_LIST_KEY_SCOPE,linkedOutsideClasses:_.SELECTABLE_LIST_LINKED_OUTSIDE_CLASSES,onSelectionChange:e.handleSelectionChange,onTabbingStart:e.handleTabbingStart,selection:U,tilesPerRow:q},function(t){var l=t.focusedFileId,u=t.handleDeselect,p=(t.handleDeselectAll,t.handleFocusFile),f=t.handleSelect,w=(t.handleSelectAll,t.isSelectableListEvent);return a.createElement(n.Table,{"aria-rowcount":V,className:s("brws-files-view-list",{"brws-files-view-list-compact":se}),columnFlex:g},v,a.createElement(S.FilesViewList,{actionHandlers:r,activeDropTarget:o,context:d,createNewFolderState:c,dropTargetHighlightMode:h,items:y,fileRename:b,focusedFileId:l,getFileActions:j,getIsCurrentPathWriteable:e.getIsCurrentPathWriteable,getIsFileJumping:F,isCompactMode:se,isDraggingExternalFiles:D,isDraggingInternalFiles:A,isFileViewerShown:P,isSearchMode:R,isSelectMode:oe,isSelectableListEvent:w,arePostTTIModulesLoaded:Q,isTabbing:ee,keyScope:_.SELECTABLE_LIST_KEY_SCOPE,onCopyToClipboard:e.handleCopyToClipboard,onDragStart:e.handleDragStart,onDragEnter:e.handleDragEnter,onDeselectFile:u,onFocusFile:p,onOpenKeyboardShortcutModal:te,onNavigateToFileOrFolder:G,onNavigateToParentFolder:e.handleNavigateToParentFolder,onNavigateToPath:e.handleNavigateToPath,onNewFolderCancel:e.handleNewFolderCancel,onNewFolderSubmit:e.handleNewFolderSubmit,onOpenPaper:e.handleOpenPaper,onPasteFromClipboard:e.handlePasteFromClipboard,onRenameCancel:e.handleRenameCancel,onRenameSubmit:e.handleRenameSubmit,onSelectFile:f,onSetDragCopyMode:e.handleSetDragCopyMode,onSetDropTarget:e.handleSetDropTarget,onSetFileUploaderPath:e.handleSetFileUploaderPath,onStarClick:K,scrollPositionOffset:le,scrollToRow:l?re.indexOf(l):0,selectedFiles:M,selection:U,user:H,viewportTopOffset:ae,visibleColumns:i,canDisplayFolderSizes:m,thumbStore:$}))}):a.createElement(w.SelectableList,{itemIds:re,keyScope:_.TILE_GRID_SCOPE,onSelectionChange:e.handleSelectionChange,onTabbingStart:e.handleTabbingStart,selection:U,tilesPerRow:q},function(t){var s=t.handleDeselectAll,i=t.handleFocusFile,u=t.handleSelectAll;return a.createElement("div",null,a.createElement(n.Table,{columnFlex:_.GRID_VIEW_COLUMN_FLEX},v),a.createElement(T.BrowseTileGrid,{actionHandlers:r,activeDropTarget:o,activeSortDirection:l&&l.sortDirection,activeSortField:l&&l.sortField,arePostTTIModulesLoaded:Q,createNewFolderState:c,context:d,deselectAll:s,fileRename:b,getFileActions:j,getIsCurrentPathWriteable:e.getIsCurrentPathWriteable,getIsFileJumping:F,onTTI:e.handleTTI,items:y,isCreateFolderUIActive:e.isCreateFolderUIActive(),isDraggingExternalFiles:D,isDraggingInternalFiles:A,isSearchMode:R,onCopyToClipboard:e.handleCopyToClipboard,onDragEnter:e.handleDragEnter,onDragStart:e.handleDragStart,onNewFolderCancel:e.handleNewFolderCancel,onNewFolderSubmit:e.handleNewFolderSubmit,onNavigateToFileOrFolder:G,onOpenPaper:e.handleOpenPaper,onOpenKeyboardShortcutModal:te,onPasteFromClipboard:e.handlePasteFromClipboard,onRenameCancel:e.handleRenameCancel,onRenameSubmit:e.handleRenameSubmit,onSelectionChange:x,onSetDragCopyMode:e.handleSetDragCopyMode,onSetDropTarget:e.handleSetDropTarget,onSortChange:L,onStarClick:K,onFocusFile:i,path:O,ref:e.setBrowseTileGridRef,selectAll:u,selectedFiles:M,selection:U,setFileUploaderPath:e.handleSetFileUploaderPath,thumbStore:$,totalNumItems:V,user:H,isQueryingFolderSizes:I,tilesPerRow:q,onTilesPerRowChange:e.handleTilesPerRowChange}))})})),a.createElement(E.InternalDragStatus,{className:"offscreen-drag-icon",files:M.toArray(),ref:this.setInternalDragStatusRef}))},I.defaultProps={activeDropTarget:null,dropTargetHighlightMode:p.DropTargetHighlightMode.NONE,enableUnity:!0,fileRename:null,loadingState:p.LoadingState.LOADING_FIRST_PAGE},I})(a.PureComponent);t.FilesViewController=B}),define("modules/clean/react/browse/files_view/culled_table_body",["require","exports","tslib","external/spectrum/table","external/react"],function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rangeInViewStartIndex=0,t.rangeInViewEndIndex=0,t.handleRangeInView=function(e,r){var s=document.body.scrollTop,o=window.innerHeight-t.props.viewportTopOffset,i=t.props.listItemHeight,n=t.props.items.length,a=n*i;t.rangeInViewStartIndex=Math.floor(s/a*n),t.rangeInViewEndIndex=Math.ceil((s+o||1)/a*n)-1},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.scrollToRow&&this.updateScroll(this.props.scrollToRow)},t.prototype.componentWillReceiveProps=function(e){this.props.scrollToRow!==e.scrollToRow&&e.scrollToRow!==-1&&this.updateScroll(e.scrollToRow)},t.prototype.updateScroll=function(e){var t=this.props,r=t.listItemHeight,s=t.viewportTopOffset;if(e<=this.rangeInViewStartIndex||e>=this.rangeInViewEndIndex){var o=document.body.scrollTop,i=window.innerHeight-s,n=(e+1)*r,a=e*r,l=0;l=a>o?Math.abs(i-n):n-r,window.scrollTo(0,l)}},t.prototype.render=function(){var e=this.props,t=(e.children,e.scrollToRow,e.viewportTopOffset),i=r.__rest(e,["children","scrollToRow","viewportTopOffset"]);return o.createElement("div",null,o.createElement(s.CulledTableBody,r.__assign({onRangeInView:this.handleRangeInView,viewportHeight:window.innerHeight-t},i)))},t.defaultProps={viewportTopOffset:0},t})(o.PureComponent);t.CulledTableBodyWithScrollToRow=i}),define("modules/clean/react/browse/files_view/file_name_cell",["require","exports","tslib","external/classnames","external/spectrum/media_table","external/react","modules/clean/browse_interface","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/name_input","modules/clean/react/browse/file_folder_icon","modules/clean/search/search_results/log_helper","modules/clean/search/search_highlights","modules/clean/user_education/user_education_client","modules/core/i18n","modules/clean/react/title_bubble","modules/clean/react/browse/files_view/star","modules/clean/react/browse/util","modules/clean/web_user_action_events"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h,f,m,_,S,g,w,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var T=(function(e){function t(r){var s=e.call(this,r)||this;return s.handleNameInputSubmit=function(e){s.props.onRenameSubmit(s.props.file,e)},s.handleNameInputCancel=function(){s.props.onRenameCancel(s.props.file)},s.handleOnClickNameInput=function(e){e.stopPropagation()},s.handleOnClickName=function(e){s.props.isTextSelectable||s.props.isSelectMode||w.shouldHandleClick(e)&&(e.preventDefault(),e.stopPropagation(),s.props.onNavigateToFileOrFolder(s.props.file))},s.handleOnClickLocationLink=function(e){e.stopPropagation();var t=s.props,r=t.file,o=t.isSearchMode,i=t.user;if(o&&h.recordSearchResultsAction({result:r,user:i,action_type:v.WebUserActionLogEvent.CLICK_PATH_LINK,view_type:c.ViewType.List}),s.props.onNavigateToPath&&w.shouldHandleClick(e)){e.preventDefault(),e.stopPropagation();var n=a.parent_dir(r.fq_path);s.props.onNavigateToPath(n)}},s.handleThumbnailError=function(){s.setState({thumbLoaded:!1})},s._setFilenameRef=function(e){return s._filenameDiv=e},s.onStarClick=function(e){var t=s.props,r=t.file,o=t.onStarClick;o&&o(r,e)},s.state={shouldShowTooltip:s.shouldShowTooltip(r),thumbLoaded:t.isThumbLoaded(r)},s}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.fetchThumbnail()},t.prototype.componentDidUpdate=function(e,t){var r=this.shouldShowTooltip(this.props);r!==t.shouldShowTooltip&&this.setState({shouldShowTooltip:r})},t.prototype.componentWillReceiveProps=function(e){var r=this.shouldShowTooltip(e);r!==this.state.shouldShowTooltip&&this.setState({shouldShowTooltip:r}),e.file.thumbnail_url_tmpl!==this.props.file.thumbnail_url_tmpl&&(this.unbindThumbnailIfNeeded(),this.setState({thumbLoaded:t.isThumbLoaded(e)}),this.fetchThumbnail())},t.prototype.componentWillUnmount=function(){this.unbindThumbnailIfNeeded()},t.prototype.shouldShowTooltip=function(e){var t=this._filenameDiv;return!!(e.showTooltip&&t&&t.offsetWidth<t.scrollWidth)},t.isThumbLoaded=function(e){var t=e.file,r=e.thumbStore,s=t.thumbnail_url_tmpl;return!(!s||!r.get_thumb(s))},t.prototype.fetchThumbnail=function(){var e=this,t=this.props,r=t.file,s=t.thumbStore,o=r.thumbnail_url_tmpl;o&&(this._thumbRequestId=s.bind_url(o,{onSuccess:function(){e.setState({thumbLoaded:!0})},onError:function(){e.handleThumbnailError()}}))},t.prototype.unbindThumbnailIfNeeded=function(){var e=this.props.thumbStore;this.state.thumbLoaded&&this._thumbRequestId&&e.unbind_url(this._thumbRequestId),this.setState({thumbLoaded:!1})},t.prototype.renderThumbnail=function(){var e=this.props,t=e.file,r=e.thumbStore,o=t.thumbnail_url_tmpl,n=t.fq_path;if(this.state.thumbLoaded&&o){var a=r.get_thumb(o);if(a)return i.createElement("img",{alt:n,draggable:!1,className:s("brws-file-name-cell-icon","brws-file-name-cell-thumb"),src:a,onError:this.handleThumbnailError})}return this.renderFileIcon()},t.prototype.renderFileIcon=function(){var e=this.props,t=e.file,r=e.showCDMUserEducationEffects,s=i.createElement(p.FileOrFolderIcon,{className:"brws-file-name-cell-icon",ref:"icon",file:t,onClick:this.handleOnClickName,showPreview:!1});return r?i.createElement(m.UserEducationEffect,{containerName:"FileItemRow",name:"TMFIcon",useSpan:!0},s):s},t.prototype.renderScreenReaderExtraInfo=function(){var e=[],t=this.props,r=t.file,s=t.isSelected;if(r.isDeleted&&e.push(_._("Deleted")),s&&e.push(_._("Selected")),r.is_dir&&(r.type===l.FileTypes.SHARED_FOLDER?d.File.isReadOnlySharedFolder(r)?e.push(_._("Read-only shared folder")):e.push(_._("Shared folder")):r.type===l.FileTypes.TEAM_SHARED_FOLDER?d.File.isReadOnlySharedFolder(r)?e.push(_._("Read-only team shared folder")):e.push(_._("Team shared folder")):e.push(_._("Folder"))),e.length>0)return i.createElement("span",{className:"ax-visually-hidden"},""+e.join(" "))},t.prototype.renderTitle=function(){var e=this.props,t=e.file,r=e.renameState,s=e.user;if(r===c.RenameState.SAVING_INPUT)return i.createElement("span",{role:"status"},_._("Renaming…"));var o,l=a.filename(t.fq_path);if(o=this.props.showHighlights&&t.filename_highlights?f.highlightMatchReact(l,t.filename_highlights):i.createElement("span",null,l),o=i.createElement("div",{className:"brws-file-name-element",ref:this._setFilenameRef},o),this.state.shouldShowTooltip&&(o=i.createElement(S.TitleBubble,{content:l,position:S.TitleBubble.POSITIONS.BOTTOM,className:"list-label__title-bubble"},o)),!t.is_unmounted){var d=t.is_dir?t.href:n.preview_uri_for_fq_path(s,t.fq_path).toString();o=i.createElement("a",{className:"brws-file-name-cell-filename",href:d,onClick:this.handleOnClickName},o)}return this.props.showUserEducationEffects?i.createElement(m.UserEducationEffect,{containerName:"FileItemRow",name:this.props.userEducationEffectName||"FileNameLabel",useSpan:!0},o):o},t.prototype.renderSubtitle=function(){var e=this.props,t=e.file,r=e.isSelectMode,s=e.renameState,o=e.renderLocationAsLink,l=e.showLocation,c=e.user;if(s||!l)return null;var d=a.parent_dir(t.fq_path),u="/"===d?n.get_browse_root_name(c):d.slice(1);if(t.is_unmounted)return _._("not added yet, in %(location)s",{comment:"Describes the parent directory of a file in a list of search results."}).format({location:u});var p=_._("in %(location)s",{comment:"Describes the parent directory of a file in a list of search results."}).format({location:u});if(!o||r)return p;var h=n.browse_uri_for_fq_path(c,d);return i.createElement("a",{className:"brws-file-name-cell-location",href:h.toString(),onClick:this.handleOnClickLocationLink},p)},t.prototype.render=function(){var e,t=this.props,r=t.file,n=t.mediaActions,l=t.renameState,d=t.user,p=t.showStar;if(l===c.RenameState.PENDING_INPUT){var h=r.is_dir?_._("Rename directory…"):_._("Rename file…");e=i.createElement(u.NameInput,{defaultValue:a.filename(r.fq_path),label:h,onClick:this.handleOnClickNameInput,onSubmit:this.handleNameInputSubmit,onCancel:this.handleNameInputCancel})}else e=[i.createElement(o.MediaCellText,{key:"title",highlight:this.props.isHovered},this.renderTitle(),this.renderScreenReaderExtraInfo()),i.createElement(o.MediaCellText,{highlight:this.props.isHovered,key:"subtitle",variant:"subtitle"},this.renderSubtitle())];var f=s("brws-file-name-cell-text","brws-vertically-center",{"brws-file-name-cell-text-rename":!!this.props.renameState});return i.createElement(o.MediaCell,{icon:this.renderThumbnail()},i.createElement("div",{className:f},e),p&&!l&&i.createElement(g.StarContainer,{fileId:r.file_id,user:d,className:"brws-file-name-cell-star brws-vertically-center",onStarClick:this.onStarClick}),n)},t.defaultProps={renderLocationAsLink:!0},t})(i.Component);t.FileNameCell=T}),define("modules/clean/react/browse/files_view/file_row",["require","exports","tslib","external/classnames","external/spectrum/button","external/spectrum/icon_table","external/spectrum/checkbox","external/spectrum/media_table","external/react","external/react-dom","modules/clean/filetypes","modules/clean/react/browse/constants","modules/clean/react/browse/files_view/file_name_cell","modules/clean/react/browse/models","modules/clean/react/browse/share_button","modules/clean/user_education/user_education_client","modules/core/i18n","modules/clean/react/title_bubble","modules/clean/browse_interface","modules/clean/react/browse/util"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h,f,m,_,S,g,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=function(e){return e.type===d.FileTypes.TEAM_SHARED_FOLDER&&("archived"===e.team_folder_status||"archive_in_progress"===e.team_folder_status)},T=function(){return l.createElement("span",{"aria-hidden":!0},"--")},b=function(e){var t=e.isVisible,r=e.onClick;return l.createElement(o.Button,{className:"brws-file-row-view-file-button","aria-label":_._("View File"),onClick:r,tabIndex:t?void 0:-1,variant:t?"secondary":"invisible"},l.createElement(i.IconTable,{name:"view"}))},F=function(){return l.createElement("svg",{width:"20px",height:"20px",viewBox:"0 0 20 20",version:"1.1"},l.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},l.createElement("g",{id:"Group",transform:"translate(2.000000, 2.000000)"},l.createElement("circle",{id:"Oval-65",cx:"8",cy:"8",r:"8"}),l.createElement("path",{d:"M8,13 L8,14.5 L5.5,12.5 L8,10.5 L8,12 C10.209139,12 12,10.209139 12,8 C12,6.93104698 11.5806921,5.96002857 10.8975817,5.24245012 L11.4674192,4.39763124 C12.4121861,5.30722218 13,6.58496544 13,8 C13,10.7614237 10.7614237,13 8,13 Z M8,3 L8,1.5 L10.5,3.5 L8,5.5 L8,4 C5.790861,4 4,5.790861 4,8 C4,8.96511539 4.34180174,9.8503987 4.91095749,10.5414022 L4.33270318,11.3986995 C3.5056268,10.5066799 3,9.3123877 3,8 C3,5.23857625 5.23857625,3 8,3 Z",id:"Oval-67",fill:"#637282"}))))},E=function(){return l.createElement("svg",{width:"20px",height:"20px",viewBox:"0 0 20 20",version:"1.1"},l.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},l.createElement("g",{id:"icon-warning",fill:"#637282"},l.createElement("path",{
d:"M13.9298189,16.125 C16.4624689,16.125 17.5138484,14.3377448 16.2785476,12.1337797 L12.238298,4.92535765 C11.002815,2.72106753 8.99951926,2.72139251 7.76421846,4.92535765 L3.7239688,12.1337797 C2.48848585,14.3380698 3.54098311,16.125 6.07269759,16.125 L13.9298189,16.125 Z M11.002944,14.0995516 L8.99957244,14.0995516 L8.99957244,12.0741033 L11.002944,12.0741033 L11.002944,14.0995516 L11.002944,14.0995516 Z M11.002944,11.0613791 L8.99957244,11.0613791 L8.99957244,7.01048239 L11.002944,7.01048239 L11.002944,11.0613791 L11.002944,11.0613791 Z",id:"Shape"}))))},y=function(){return l.createElement("div",{className:"error-tooltip"},l.createElement("div",{className:"error-tooltip__title"},_._("This folder is too large")),_._("We can’t calculate the full size of this folder right now. This can happen when there are a large number of files inside of the folder or if the request takes too long."))},C=function(e){var t=e.file;if(!t.is_dir)return l.createElement("span",null,t.size);switch(t.fetchFolderSizesStatus){case u.FetchFolderSizeState.LOADING:return l.createElement("span",{className:"item-cell-title item-cell-title--loading"},l.createElement("span",{className:"ax-visually-hidden"},_._("Calculating folder sizes...")),l.createElement(F,null),_._("Calculating..."));case u.FetchFolderSizeState.ERROR:return l.createElement("span",{className:"item-cell-title"},l.createElement(S.TitleBubble,{content:l.createElement(y,null),position:S.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!1},l.createElement("span",{className:"ax-visually-hidden"},_._("Error in calculating folder sizes")),l.createElement("span",null,l.createElement(E,null))),t.size);case u.FetchFolderSizeState.COMPLETE:return l.createElement("span",{className:"item-cell-title"},t.size);default:return l.createElement(T,null)}},R=(function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.checkboxRef=null,e.handleClick=function(t){if(!e.checkboxRef||!c.findDOMNode(e.checkboxRef).contains(t.target)){if(e.props.isSelectMode&&e.props.onDeselect&&e.props.onSelect){t.preventDefault();var r=e.props.file.fq_path;return void(e.props.isSelected?e.props.onDeselect(r,t.shiftKey):e.props.onSelect(r,t.shiftKey))}w.shouldHandleClick(t)&&(t.preventDefault(),t.stopPropagation(),e.props.onNavigateToFileOrFolder(e.props.file))}},e.handleClickViewFileButton=function(t){w.shouldHandleClick(t)&&(t.preventDefault(),t.stopPropagation(),e.props.onNavigateToFileOrFolder(e.props.file))},e.handleChangeCheckbox=function(t,r){if(e.props.onSelect&&e.props.onDeselect){var s=e.props.file.fq_path;"checked"===t?e.props.onSelect(s,r.shiftKey):e.props.onDeselect(s,r.shiftKey)}},e.handleDragEnter=function(t){var r=e.props,s=r.file,o=r.isSelected,i=r.isActiveDropTarget;e.props.onDragEnter(t,s,!!o,!!i)},e.handleDragStart=function(t){var r=e.props,s=r.file,o=r.isSelected,i=r.onDragStart,n=r.onSelect;i&&(o?i(t):(n&&n(s.fq_path),i(t,[s])))},e.setCheckboxRef=function(t){e.checkboxRef=t},e.rowChildFn=function(t){var r,o=t.isHovered,i=e.props,c=i.isCompactMode,d=i.isPinned,u=i.isSelectMode,p=i.isSelected,h=i.showUserEducationEffects,f=i.isTabbing,_=i.visibleColumns;if(!d){var S=!(f||o||p||u||c);r=l.createElement(n.Checkbox,{checked:p?"checked":"unchecked",className:s("brws-checkbox",{"brws-checkbox-checked":p}),onChange:e.handleChangeCheckbox,ref:e.setCheckboxRef,variant:S?"invisible":"default"}),h&&(r=l.createElement(m.UserEducationEffect,{containerName:"FileItemRow",name:"FirstFileSelectCheckbox",useSpan:!0},r))}return[l.createElement(a.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"},l.createElement("div",{className:"brws-vertically-center"},r))].concat(_.map(function(t,r){return e.renderCell({isHovered:o,isLastCell:r===_.length-1,sortField:t.sortField})}))},e}return r.__extends(o,t),o.prototype.componentDidUpdate=function(e){var t=this;(this.props.isFocused&&!e.isFocused||this.props.isFocused&&this.props.isSelected&&!e.isSelected)&&this.checkboxRef&&Promise.resolve().then(function(){if(t.checkboxRef){var e=c.findDOMNode(t.checkboxRef);e&&e.focus()}})},o.prototype.renderMediaActions=function(t){var s=this.props,o=s.file,i=s.user,n=s.context,c=s.isCompactMode,d=s.isSelected,u=s.isSelectMode,p=s.isSharingDisabled,h=s.isTabbing,m=s.getFileActions,_=s.isSearchMode,S=s.canDisplayFolderSizes,g=s.arePostTTIModulesLoaded,w={browseContext:n,file:o,isSearchMode:_,user:i},v=null;if(g){var T=e("modules/clean/react/starred/browse_exports").OverflowMenuWithStar;v=l.createElement(T,{file:o,getFileActions:m,showBorders:h||t,canDisplayFolderSizes:S})}return u?l.createElement(a.MediaActions,null,!p&&l.createElement(f.ShareButton,r.__assign({},w,{isVisible:!c&&(d||t)})),l.createElement(b,{isVisible:d||c||t,onClick:this.handleClickViewFileButton})):l.createElement(a.MediaActions,null,!p&&l.createElement(f.ShareButton,r.__assign({},w,{isVisible:h||t&&!c})),v)},o.prototype.renderModifiedCell=function(e,t){var r=e.ago,s=e.last_modified_name||void 0,o=s&&_._("by %(modified_by)s",{comment:"name of the person that modified the file"}).format({modified_by:s});return l.createElement(a.MediaCell,{className:"brws-file-modified-at-cell",key:"modifiedAt",subtitle:o,title:r||l.createElement(T,null)},t)},o.prototype.renderSharedWithController=function(){var t=this.props,r=t.context,s=t.file,o=t.isSelectMode;if(!t.arePostTTIModulesLoaded||v(s))return null;var i=e("modules/clean/react/browse/shared_with").SharedWithController;return l.createElement("div",{className:"brws-vertically-center brws-shared-with-wrapper"},l.createElement(i,{file:s,browseContext:r,inSelectMode:o}))},o.prototype.renderCell=function(e){var t=e.isHovered,r=e.isLastCell,s=e.sortField,o=this.props,i=o.file,n=o.user,c=o.isCompactMode,d=o.isSearchMode,f=o.isSelectMode,m=o.arePostTTIModulesLoaded,_=o.renameState,S=o.showCDMUserEducationEffects,g=o.showUserEducationEffects,w=o.userEducationEffectName,v=o.onNavigateToFileOrFolder,T=o.onStarClick,b=o.thumbStore,F=r&&!(c&&_),E=F?this.renderMediaActions(t):void 0;switch(s){case u.BrowseSortField.FILENAME:return l.createElement(p.FileNameCell,{key:"fileName",user:n,file:i,isHovered:t,isSearchMode:d,isSelectMode:f,mediaActions:E,onNavigateToPath:this.props.onNavigateToPath,onNavigateToFileOrFolder:v,onRenameCancel:this.props.onRenameCancel,onRenameSubmit:this.props.onRenameSubmit,renameState:_,showCDMUserEducationEffects:S,showTooltip:m,showHighlights:d,showLocation:d,showUserEducationEffects:g,userEducationEffectName:w,showStar:m&&!f&&!h.File.isNoAccessSharedFolder(i),onStarClick:T,thumbStore:b});case u.BrowseSortField.MODIFIED:return this.renderModifiedCell(i,E);case u.BrowseSortField.SHARED_WITH:return l.createElement(a.MediaCell,{className:"brws-file-shared-with-cell",key:"sharedWith"},this.renderSharedWithController(),E);case u.BrowseSortField.CATEGORY:return l.createElement(a.MediaCell,{className:"brws-file-category-cell",key:"category",title:h.File.getCategoryDescription(i)},E);case u.BrowseSortField.EXTENSION:return l.createElement(a.MediaCell,{className:"brws-file-extension-cell",key:"extension",title:h.File.getExtension(i)},E);case u.BrowseSortField.SIZE:return l.createElement(a.MediaCell,{className:"brws-file-size-cell",key:"size",title:l.createElement(C,{file:i})},E)}},o.prototype.render=function(){var e=this.props,t=e.file,o=e.isActiveDropTarget,i=e.isAvailableDropTarget,n=e.isPinned,c=e.isSelected,d=e.renameState,u=e.rowIndex,p=e.tabIndex,f=e.topOffset,m=e.user,_=s("brws-file-row",{"brws-file-row-selected":c,"brws-file-row-deleted":t.isDeleted,"brws-file-row-droppable":i&&!o,"brws-file-row-dragover":o,"brws-file-row-no-access":h.File.isNoAccessSharedFolder(t),"brws-file-row-pinned":n}),S=o?"dragover":i&&!o?"droppable":c?"selected":"default",w={"aria-rowindex":void 0!==u?u+1:void 0,className:_,"data-filename":t.fq_path.split("/").slice(-1),onClick:this.handleClick,onDragEnter:this.handleDragEnter,tabIndex:p,variant:S};if(n)return l.createElement(a.MediaRow,r.__assign({},w),this.rowChildFn);var v=t.is_dir?t.href:g.preview_uri_for_fq_path(m,t.fq_path).toString();return l.createElement("a",{className:"brws-file-name-cell",href:v,onDragStart:this.handleDragStart},l.createElement(a.CulledMediaRow,r.__assign({},w,{draggable:!d,topOffset:f}),this.rowChildFn))},o.defaultProps={isSelectionEmpty:!0,topOffset:0},o})(l.PureComponent);t.FileRow=R}),define("modules/clean/react/browse/files_view/fixed_table_head",["require","exports","tslib","external/spectrum/vertically_fixed","external/spectrum/table","external/react"],function(e,t,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FixedTableHead=function(e){var t=e.children,n=e.offsetHeight,a=r.__rest(e,["children","offsetHeight"]);return i.createElement("thead",r.__assign({className:"mc-table-head mc-table-head-fixed brws-column-header"},a),i.createElement(s.VerticallyFixed,{tag:function(e){var s=e.style;return i.createElement(o.TableRow,r.__assign({className:"mc-table-head-row mc-table-head-row-fixed",style:{height:n}},s),t)}}))}}),define("modules/clean/react/browse/files_view/list",["require","exports","tslib","external/react","modules/clean/react/browse/browse_drag_and_drop","modules/clean/react/browse/files_view/constants","modules/clean/react/browse/files_view/culled_table_body","modules/clean/react/browse/files_view/file_row","modules/clean/react/browse/files_view/new_folder_row","modules/clean/react/browse/files_view/paper_row","modules/clean/react/browse/files_view/selectors","modules/clean/react/browse/keyboard_shortcuts","modules/clean/react/browse/models"],function(e,t,r,s,o,i,n,a,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=function(){},f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={scrollToRow:0},t.handleFileViewerUnmount=function(){var e=t.props.selectedFiles.first();e&&t.props.onFocusFile(e.fq_path)},t.getIsListEvent=function(e){return t.props.isSelectableListEvent()&&"BUTTON"!==e.target.tagName},t.getSelectedFiles=function(){return t.props.selectedFiles},t.handleNavigateToFileOrFolder=function(e){t.props.onNavigateToFileOrFolder(e,t.handleFileViewerUnmount)},t.enableContextMenu=function(){return!1},t.getActiveDropTarget=function(){return t.props.activeDropTarget},t.getIsDraggingInternalFiles=function(){return!!t.props.isDraggingInternalFiles},t.getIsDraggingExternalFiles=function(){return!!t.props.isDraggingExternalFiles},t.renderRow=function(e,r,o){if("NewFolderRow"===e.type)return s.createElement(l.NewFolderRow,{createNewFolderState:e.props.createNewFolderState,isInsideTeamFolderTree:e.props.isInsideTeamFolderTree,onCancel:t.props.onNewFolderCancel,onSubmit:t.props.onNewFolderSubmit,rowIndex:r,topOffset:o});if("PaperRow"===e.type)return s.createElement(c.PaperRow,{paper:e.props.paper,isSearchMode:e.props.isSearchMode,rowIndex:r,topOffset:o,user:t.props.user,visibleColumns:e.props.visibleColumns,onOpenPaper:t.props.onOpenPaper});var i=t.props.selection,n=e.props.file,d=i.selected.last()===e.props.file.fq_path||!i.selected.size&&0===r?0:void 0,u=0===r||t.props.user.is_cdm_member&&2===r;return s.createElement(a.FileRow,{context:t.props.context,file:n,getFileActions:t.props.getFileActions,isActiveDropTarget:e.props.isActiveDropTarget,isAvailableDropTarget:e.props.isAvailableDropTarget,isCompactMode:e.props.isCompactMode,isFocused:e.props.isFocused,isSearchMode:e.props.isSearchMode,isSelectMode:e.props.isSelectMode,isSelected:e.props.isSelected,arePostTTIModulesLoaded:e.props.arePostTTIModulesLoaded,isSharingDisabled:e.props.isSharingDisabled,isTabbing:e.props.isTabbing,key:n.fq_path,onDeselect:t.props.onDeselectFile,onDragStart:t.props.onDragStart,onDragEnter:t.props.onDragEnter,onNavigateToPath:t.props.onNavigateToPath,onNavigateToFileOrFolder:t.handleNavigateToFileOrFolder,onRenameCancel:t.props.onRenameCancel,onRenameSubmit:t.props.onRenameSubmit,onSelect:t.props.onSelectFile,onStarClick:t.props.onStarClick,renameState:e.props.renameState,rowIndex:r,showUserEducationEffects:u,userEducationEffectName:u?"FileNameLabel-"+r:void 0,showCDMUserEducationEffects:p.File.isTeamMemberFolder(n),tabIndex:d,topOffset:o,user:t.props.user,visibleColumns:t.props.visibleColumns,canDisplayFolderSizes:t.props.canDisplayFolderSizes,thumbStore:t.props.thumbStore})},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props.onTTI;e&&e(),this.setupKeyboardShortcuts(),this.setupExternalDragHandler(),this.props.selectedFiles.size&&!this.props.isFileViewerShown()&&this.setState({scrollToRow:this.getRowIndexForFile(this.props.selectedFiles.first())})},t.prototype.componentWillReceiveProps=function(e){this.props.scrollToRow!==e.scrollToRow&&this.setState({scrollToRow:e.scrollToRow})},t.prototype.componentDidUpdate=function(e){e.createNewFolderState===this.props.createNewFolderState||"PENDING_INPUT"!==this.props.createNewFolderState||this.props.isFileViewerShown()||this.setState(function(e){return 0===e.scrollToRow?(window.scrollTo(0,0),{}):{scrollToRow:0}})},t.prototype.componentWillUnmount=function(){this.cleanupKeyboardShortcuts(),o.cleanupExternalDragHandler(this.props.keyScope)},t.prototype.getRowIndexForFile=function(e){return this.props.items.indexOf(e)},t.prototype.cleanupKeyboardShortcuts=function(){u.resetBrowseKeyboardShortcuts(this.props.keyScope),u.resetFileJumpKeyboardShortcuts(this.props.keyScope)},t.prototype.setupKeyboardShortcuts=function(){var e=this,t=this.props,r=t.actionHandlers,s=t.getIsFileJumping,o=t.keyScope,i=t.onCopyToClipboard,n=t.onNavigateToParentFolder,a=t.onPasteFromClipboard,l=t.onSetDragCopyMode;u.setupFileJumpKeyboardShortcuts({scope:o,getIsFileJumping:s}),u.setupItemListKeyboardShortcuts({getIsGlobalEvent:this.getIsGlobalEvent(),getIsItemEvent:this.getIsListEvent,getSelectedFiles:this.getSelectedFiles,isCurrentPathWriteable:this.props.getIsCurrentPathWriteable,enableContextMenu:this.enableContextMenu,selectAllAction:h,deselectAllAction:h,onCopyToClipboard:i,onDelete:r.onDelete,onNavigateToFileOrFolder:this.handleNavigateToFileOrFolder,onNavigateToParentFolder:n,onPasteFromClipboard:a,onSetDragCopyMode:l,onShowRename:r.onShowRename,openContextMenuAtPosition:h,scope:o,onShowHelpMenu:function(){return e.props.onOpenKeyboardShortcutModal()}})},t.prototype.setupExternalDragHandler=function(){o.setupExternalDragHandler(this.props.keyScope,this.getIsDraggingInternalFiles,this.getIsDraggingExternalFiles,this.props.onSetFileUploaderPath,".brws-file-row",this.getActiveDropTarget,this.props.onSetDropTarget)},t.prototype.getIsGlobalEvent=function(){return u.generateGetIsGlobalEvent(this)},t.prototype.render=function(){var e=this.props,t=e.scrollPositionOffset,r=e.viewportTopOffset;return s.createElement(n.CulledTableBodyWithScrollToRow,{items:d.getFilesViewListRowItems(this.props),listItemHeight:i.DEFAULT_ROW_HEIGHT,renderRow:this.renderRow,scrollPositionOffset:t,scrollToRow:this.state.scrollToRow,viewportTopOffset:r})},t.defaultProps={isFileViewerShown:function(){return!1}},t})(s.PureComponent);t.FilesViewList=f}),define("modules/clean/react/browse/files_view/new_folder_row",["require","exports","external/spectrum/media_table","external/spectrum/table","external/react","external/spectrum/icon_content","modules/clean/react/browse/name_input","modules/core/i18n"],function(e,t,r,s,o,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFolderRow=function(e){var t,l=e.createNewFolderState,c=e.isInsideTeamFolderTree,d=void 0!==c&&c,u=e.onCancel,p=e.onSubmit,h=e.rowIndex,f=e.topOffset;return t="SAVING_INPUT"===l?o.createElement("p",{className:"brws-new-folder-row-status",role:"status","aria-live":"polite"},a._("Creating new folder…")):o.createElement(n.NameInput,{defaultValue:"",label:a._("Folder name"),onSubmit:p,onCancel:u}),o.createElement(r.CulledMediaRow,{"aria-rowindex":void 0!==h?h+1:void 0,className:"brws-new-folder-row",topOffset:f},o.createElement(s.TableCell,{className:"brws-checkbox-cell"}),o.createElement(r.MediaCell,{icon:o.createElement(i.IconContent,{className:"brws-file-name-cell-icon",name:d?"folder_shared-small":"folder-small"})},o.createElement("div",{className:"brws-new-folder-row-content brws-vertically-center"},t)),o.createElement(s.TableCell,null),o.createElement(s.TableCell,null))}}),define("modules/clean/react/browse/files_view/paper_row",["require","exports","tslib","external/spectrum/media_table","external/react","modules/clean/react/browse/constants","modules/clean/react/browse/constants","modules/clean/search/search_results/log_helper","modules/core/i18n","modules/clean/web_user_action_events","modules/clean/search/paper_formatting_utils"],function(e,t,r,s,o,i,n,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleDocNameClick=function(e){r.props.isSearchMode&&a.recordSearchResultsAction({result:r.props.paper,user:r.props.user,action_type:c.WebUserActionLogEvent.PAPER_OPEN,view_type:n.ViewType.List}),e.stopPropagation()},r.handleRowClick=function(e){r.props.onOpenPaper(e,r.props.paper)},r.state=r.calcState(t),r}return r.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){if(this.props.paper.title!==e.paper.title){var t=this.calcState(e);this.setState(t)}},t.prototype.calcState=function(e){return{titleParts:d.getPaperDocTitleParts(e.paper,"brws-file-name-cell-icon","brws-file-name-cell-icon-emoji")}},t.prototype.renderDocName=function(e){var t=this.props,r=t.paper,i=t.showHighlights,n=this.state.titleParts,a=n.title,c=n.highlightedTitle,d=n.icon,u=o.createElement("a",{className:"brws-paper-doc-name-cell-title",href:r.url,onClick:this.handleDocNameClick},i?c:o.createElement("span",null,a));return o.createElement(s.MediaCell,{highlight:e,icon:d,key:"docName"},o.createElement("div",{className:"brws-paper-doc-name-cell-content brws-vertically-center"},o.createElement(s.MediaCellText,{highlight:e},u),o.createElement(s.MediaCellText,{highlight:e,variant:"subtitle"},l._("in Paper",{comment:"The Dropbox Paper page"}))))},t.prototype.renderDocInfo=function(){var e=this.props.paper,t=e.last_modified_date||"",r=l._("by %(modified_by)s",{comment:"name of the person that modified the file"}).format({modified_by:e.creator_name});return o.createElement(s.MediaCell,{key:"docInfo",subtitle:r,title:t})},t.prototype.renderCell=function(e){var t=e.isHovered;switch(e.sortField){case i.BrowseSortField.FILENAME:return this.renderDocName(t);case i.BrowseSortField.MODIFIED:return this.renderDocInfo()}return null},t.prototype.render=function(){var e=this,t=this.props,r=t.rowIndex,i=t.topOffset,n=t.visibleColumns;return o.createElement(s.CulledMediaRow,{"aria-rowindex":void 0!==r?r+1:void 0,className:"brws-paper-row",draggable:!1,onClick:this.handleRowClick,topOffset:i,variant:"default"},function(t){var r=t.isHovered;return[o.createElement(s.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"})].concat(n.map(function(t){return e.renderCell({isHovered:r,sortField:t.sortField})}))})},t.defaultProps={showHighlights:!0,isSearchMode:!0},t})(o.PureComponent);t.PaperRow=u}),define("modules/clean/react/browse/files_view/pinned_team_folder_view",["require","exports","tslib","external/classnames","external/spectrum/dimensions","external/spectrum/table","external/spectrum/vertically_fixed","modules/clean/react/browse/file_list_utils","modules/clean/react/browse/files_view/constants","modules/clean/react/browse/files_view/file_row","modules/clean/react/browse/models","external/react","modules/clean/react/sprite","modules/constants/trademark","modules/core/i18n","modules/clean/react/tooltip","modules/clean/user_education/user_education_client"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h,f,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.displayName="PinnedTeamFolderView",t.renderTeamFolderRow=function(e,r){var s=t.props,o=s.activeDropTarget,i=s.context,n=s.dropTargetHighlightMode,p=s.getFileActions,h=s.isTabbing,f=s.onDragEnter,m=s.onNavigateToFileOrFolder,S=s.onRenameCancel,g=s.onRenameSubmit,w=s.user,v=s.arePostTTIModulesLoaded,T=s.thumbStore,b=a.shouldFileBeHighlightedDropTarget({dropTargetHighlightMode:n,file:e,isSelected:!1}),F=u.createElement(c.FileRow,{context:i,file:e,getFileActions:p,key:encodeURI(e.fq_path),isAvailableDropTarget:b,isActiveDropTarget:e===o,isPinned:!0,arePostTTIModulesLoaded:v,isTabbing:h,onDragEnter:f,onNavigateToFileOrFolder:m,onRenameCancel:S,onRenameSubmit:g,showUserEducationEffects:0===r,showCDMUserEducationEffects:d.File.isTeamMemberFolder(e),user:w,visibleColumns:l.LIST_VIEW_COLUMNS.slice(0,1),canDisplayFolderSizes:!1,thumbStore:T});return r>0?F:u.createElement(_.UserEducationEffect,{containerName:"PinnedTeamFolder",name:"TeamFolder",key:encodeURI(e.fq_path)+"-UserEducationEffect"},F)},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){_.UEClient.sendEvent(this.displayName,"componentDidMount",JSON.stringify(this.props.context))},t.prototype.renderHeaderTitle=function(e,t){var r=t?u.createElement("span",{className:"brws-pinned-team-folder-info-button"},u.createElement(m.Tooltip,{position:m.TooltipPosition.RIGHT,tooltip_contents:u.createElement("div",null,t),tooltip_classname:"brws-pinned-team-folder-tooltip"},u.createElement(p,{group:"web",name:"info",alt:f._("File section information")}))):null;return u.createElement("span",{className:"brws-pinned-team-folder-header-title"},u.createElement("span",null,e),r)},t.prototype.renderContent=function(e){var t=this.props,r=t.columnFlex,o=t.isCompactMode,n=t.teamFolders,a=f.ungettext("Team folder","Team folders",n.size),l=this.props.expSubgrowthBizTeamHomeContent?this.renderHeaderTitle(a,f._("Team folders are the hub of content for a team and contents are           automatically shared with team folder members. %(trademark_business)s           team admins own and manage team folders.").format({trademark_business:h.TRADEMARK_BUSINESS})):this.renderHeaderTitle(a,f._("Everything in a Team folder is automatically shared with your team.           Team folders can also contain shared folders for collaborating with           people outside your team.")),c=this.props.expSubgrowthBizTeamHomeContent?this.renderHeaderTitle(f._("Everything else")):this.renderHeaderTitle(f._("Other folders"),f._("These folders help you organize your private work files."));return u.createElement("div",{className:"brws-pinned-team-folder-view",style:e},u.createElement(i.Table,{columnFlex:r},u.createElement(i.TableHead,{className:s("brws-column-header","brws-pinned-team-folder-header",{"brws-column-header-compact brws-pinned-team-folder-header-compact ":o})},u.createElement(i.TableHeadCell,{className:"brws-checkbox-cell"}),u.createElement(i.TableHeadCell,{className:"brws-vertically-center"},l)),u.createElement(i.TableBody,null,n.map(this.renderTeamFolderRow))),u.createElement(i.Table,{columnFlex:r},u.createElement(i.TableHead,{className:s("brws-column-header","brws-pinned-team-folder-header","brws-pinned-team-folder-header-secondary",{"brws-column-header-compact brws-pinned-team-folder-header-compact ":o})},u.createElement(i.TableHeadCell,{className:"brws-checkbox-cell"}),u.createElement(i.TableHeadCell,{className:"brws-vertically-center"},c))))},t.prototype.render=function(){var e=this;return this.props.expSubgrowthBizTrialOnboarding?this.renderContent():u.createElement(o.Dimensions,{className:s("brws-pinned-team-folder-view-fixed",{"brws-pinned-team-folder-view-fixed-compact":this.props.isCompactMode})},function(t){var r=t.width,s=t.height;return u.createElement(n.VerticallyFixed,null,e.renderContent({width:r,height:s}))})},t})(u.Component);t.PinnedTeamFolderView=S}),define("modules/clean/react/browse/files_view/selectable_list",["require","exports","tslib","external/immutable","external/keymaster","external/react","external/react-dom","modules/core/browser","modules/clean/react/browse/files_view/constants"],function(e,t,r,s,o,i,n,a,l){"use strict";function c(e,t,r,s){switch(e){case u.PREV:return Math.max(0,t-1);case u.NEXT:return Math.min(r-1,t+1);case u.PREV_ROW:var o=t>=0?t-s:0;return o>=0?o:t;case u.NEXT_ROW:var i=t>=0?t+s:0;return i<r?i:t}}function d(e,t,r,s,o,i,n,a){switch(e){case u.PREV:if(0===t)return n;if(s===i)o-1>=0&&n.push(a[o-1]);else{var l=n.indexOf(a[i]);n.splice(l,1)}break;case u.NEXT:if(t===a.length)return n;if(s===o||s!==i)i+1<a.length&&n.push(a[i+1]);else{var l=n.indexOf(a[o]);n.splice(l,1)}break;case u.PREV_ROW:if(0===t)return n;if(s===i)for(var c=Math.min(r,t),d=t-1;d>=t-c;d--)n.push(a[d]);else if(s===o)for(var p=Math.min(r,t-o),d=i;d>i-p;d--){var l=n.indexOf(a[d]);n.splice(l,1)}break;case u.NEXT_ROW:if(t===a.length)return n;if(s===o)for(var c=Math.min(r,a.length-t-1),d=t+1;d<=t+c;d++)n.push(a[d]);else if(s===i)for(var p=Math.min(r,i-t),d=o;d<o+p;d++){var l=n.indexOf(a[d]);n.splice(l,1)}}return n}Object.defineProperty(t,"__esModule",{value:!0});var u,p="";(function(e){e[e.PREV=0]="PREV",e[e.NEXT=1]="NEXT",e[e.PREV_ROW=2]="PREV_ROW",e[e.NEXT_ROW=3]="NEXT_ROW"})(u=t.SelectDirection||(t.SelectDirection={})),t.findNeighboringItem=c,t.findSelectionRange=d;var h=(function(e){function t(t){var r=e.call(this,t)||this;return r.isFocused=!1,r.handleSelectPrevious=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.selectNeighboringItem(u.PREV))},r.handleSelectPreviousRow=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.selectNeighboringItem(u.PREV_ROW))},r.handleExtendSelectionToPrevious=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.extendSelectionRange(u.PREV))},r.handleExtendSelectionToPreviousRow=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.extendSelectionRange(u.PREV_ROW))},r.handleSelectNext=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.selectNeighboringItem(u.NEXT))},r.handleSelectNextRow=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.selectNeighboringItem(u.NEXT_ROW))},r.handleExtendSelectionToNext=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.extendSelectionRange(u.NEXT))},r.handleExtendSelectionToNextRow=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.extendSelectionRange(u.NEXT_ROW))},r.handleDeselectAll=function(e){var t=r.props.selection;if((!e||r.isGlobalEvent(e))&&t.selected.size&&(r.updateSelection([],!0),n.findDOMNode(r).contains(document.activeElement))){var s=document.activeElement;s.blur&&s.blur()}},r.handleSelectAll=function(e){var t=r.props,s=t.itemIds,o=t.selection;e&&!r.isGlobalEvent(e)||o.selected.size===s.length||r.updateSelection(r.props.itemIds,!0)},r.handleDeselect=function(e,t){if(t)return r.extendOrShrinkSelectionByFile(e);r.updateSelectionById(e,"delete")},r.handleSelect=function(e,t){if(t)return r.extendOrShrinkSelectionByFile(e);r.updateSelectionById(e,"add")},r.handleFocusFile=function(e){r.setState({focusedFileId:e})},r.isSelectableListEvent=function(){return r.isFocused},r.handleFocus=function(){r.isFocused=!0},r.handleBlur=function(){r.isFocused=!1},r.state={focusedFileId:null,selection:t.selection,keyScope:t.keyScope},r}return r.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){this.props.keyScope!==e.keyScope&&(this.setState({keyScope:e.keyScope}),this.isFocused=!1)},t.prototype.componentDidMount=function(){this.setupKeyboardShortcuts(),this.setFocusedIdFromSelection(this.props.selection)},t.prototype.componentDidUpdate=function(e,t){e.selection&&this.props.selection&&e.selection.anchor!==this.props.selection.anchor&&this.setFocusedIdFromSelection(this.props.selection),this.state.keyScope!==t.keyScope&&this.setupKeyboardShortcuts()},t.prototype.componentWillUnmount=function(){this.cleanupKeyboardShortcuts()},t.prototype.setupKeyboardShortcuts=function(){var e=this,t=this.state.keyScope;p=o.getScope(),p!==t&&o.setScope(t);var r=o.filter||function(e){var t=e.target||e.srcElement,r=t.tagName;return!("INPUT"===r||"SELECT"===r||"TEXTAREA"===r)};o.filter=function(t){var s=t.target||t.srcElement,o=s.tagName;return(!e.isSelectableListEvent()||"BUTTON"!==o)&&(s instanceof HTMLInputElement&&"checkbox"===s.type||r.call(e,t))},t===l.SELECTABLE_LIST_KEY_SCOPE?(o("up",t,this.handleSelectPrevious),o("shift+up",t,this.handleExtendSelectionToPrevious),o("down",t,this.handleSelectNext),o("shift+down",t,this.handleExtendSelectionToNext)):t===l.TILE_GRID_SCOPE&&(o("left",t,this.handleSelectPrevious),o("shift+left",t,this.handleExtendSelectionToPrevious),o("right",t,this.handleSelectNext),o("shift+right",t,this.handleExtendSelectionToNext),o("up",t,this.handleSelectPreviousRow),o("shift+up",t,this.handleExtendSelectionToPreviousRow),o("down",t,this.handleSelectNextRow),o("shift+down",t,this.handleExtendSelectionToNextRow)),o("escape",t,this.handleDeselectAll),a.mac?o("command+a",t,this.handleSelectAll):o("ctrl+a",t,this.handleSelectAll)},t.prototype.cleanupKeyboardShortcuts=function(){o.clearScope(this.state.keyScope),p&&o.setScope(p),o.resetFilter()},t.prototype.setFocusedIdFromSelection=function(e){e.anchor&&0!==e.selected.size&&this.setState({focusedFileId:e.anchor})},t.prototype.handleTabbingStart=function(){document.body.classList.add("tabbing"),this.props.onTabbingStart()},t.prototype.updateSelection=function(e,t){void 0===t&&(t=!1);var r=this.props.selection,o=t?e.length?e[0]:this.props.itemIds[0]:r.anchor,i=r.merge({selected:s.OrderedSet(e),anchor:o});this.props.onSelectionChange(i)},t.prototype.selectNeighboringItem=function(e){var t=this.props,r=t.itemIds,s=t.selection,o=t.tilesPerRow,i=r.indexOf(s.selected.last()),n=c(e,i,r.length,o),a=r[n];this.setState({focusedFileId:a}),this.updateSelection([a],!0),this.handleTabbingStart()},t.prototype.extendSelectionRange=function(e){var t=this.props,r=t.itemIds,s=t.selection,o=t.tilesPerRow,i=s.anchor||r[0];if(i){var n=r.indexOf(s.selected.last()),a=s.selected.toArray(),l=r.indexOf(i),c=this.getRangeOfSelectedBlock(i);a=d(e,n,o,l,c.startIndex,c.endIndex,a,r),this.setState({focusedFileId:a[a.length-1]}),this.updateSelection(a),this.handleTabbingStart()}},t.prototype.getRangeOfSelectedBlock=function(e){for(var t=this.props,r=t.itemIds,s=t.selection,o=r.indexOf(e),i=0,n=0;i=o,o--,!(o<0)&&s.selected.has(r[o]););for(o=i;;){var a=r[o];if(!a||!s.selected.has(a))break;n=o,o++}return{startIndex:i,endIndex:n}},t.prototype.extendOrShrinkSelectionByFile=function(e){var t=this.props,r=t.itemIds,s=t.selection,o=s.anchor||r[0];if(o){var i=r.indexOf(o),n=r.indexOf(e),a=this.getRangeOfSelectedBlock(o),l=a.startIndex,c=a.endIndex;if(n!==c){var d=[],u=[];r.forEach(function(e,t){l<=t&&t<=c&&d.push(e),(n<=t&&t<=i||i<=t&&t<=n)&&u.push(e)}),n<i&&u.reverse();var p=s.update("selected",function(e){return e.subtract(d).union(u)});this.setState({focusedFileId:e}),this.props.onSelectionChange(p),this.handleTabbingStart()}}},t.prototype.updateSelectionById=function(e,t){var r=this.props.selection,s=r.selected[t](e),o=r.merge({selected:s,anchor:s.first()||null});this.props.onSelectionChange(o)},t.prototype.isGlobalEvent=function(e){var t=e.target instanceof HTMLInputElement,r=t&&"checkbox"===e.target.type;return!document.activeElement||document.activeElement===document.body||n.findDOMNode(this).contains(e.target)&&(!t||r)},t.prototype.render=function(){var e=this.props.children,t=this.state.focusedFileId;if(!e)return null;var r=e;return"function"==typeof e&&(r=e({focusedFileId:t,handleDeselect:this.handleDeselect,handleDeselectAll:this.handleDeselectAll,handleFocusFile:this.handleFocusFile,handleSelect:this.handleSelect,handleSelectAll:this.handleSelectAll,isSelectableListEvent:this.isSelectableListEvent})),this.state.keyScope===l.SELECTABLE_LIST_KEY_SCOPE?i.createElement("div",{onBlur:this.handleBlur,onFocus:this.handleFocus},r):i.createElement("div",null,r)},t})(i.PureComponent);t.SelectableList=h}),define("modules/clean/react/browse/files_view/selectors",["require","exports","tslib","external/reselect","modules/clean/react/browse/file_list_utils","modules/clean/react/browse/models"],function(e,t,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})
;var n=s.createSelector(function(e){return e.isCompactMode},function(e){return e.isSelectMode},function(e){return e.arePostTTIModulesLoaded},function(e){return e.isSearchMode},function(e){return e.isTabbing},function(e,t,r,s,o){return{isCompactMode:e,isSelectMode:t,arePostTTIModulesLoaded:r,isSearchMode:s,isTabbing:o}});t.getFilesViewListRowItems=s.createSelector(n,function(e){return e.activeDropTarget},function(e){return e.context},function(e){return e.createNewFolderState},function(e){return e.dropTargetHighlightMode},function(e){return e.items},function(e){return e.fileRename},function(e){return e.focusedFileId},function(e){return e.selection},function(e){return e.user},function(e){return e.visibleColumns},function(e){return e.canDisplayFolderSizes},function(e,t,s,n,a,l,c,d,u,p,h,f){var m=l.toArray().map(function(n){if(n instanceof i.Paper)return{type:"PaperRow",props:{isSearchMode:e.isSearchMode,paper:n,visibleColumns:h}};var l=u.selected.has(n.fq_path),m=o.shouldFileBeHighlightedDropTarget({file:n,isSelected:l,dropTargetHighlightMode:a});return{type:"FileRow",props:r.__assign({},e,{file:n,isActiveDropTarget:m&&t===n,isAvailableDropTarget:m,isFocused:n.fq_path===d,isSelected:l,isSharingDisabled:o.isSharingDisabledForFile({context:s,file:n,user:p}),renameState:c&&c.file.fq_path===n.fq_path?c.state:void 0,visibleColumns:h,canDisplayFolderSizes:f})}});return n&&"CREATE_FOLDER_INACTIVE"!==n&&m.unshift({type:"NewFolderRow",props:{createNewFolderState:n,isInsideTeamFolderTree:s.isInsideTeamFolderTree}}),m}),t.getItemIds=s.createSelector(function(e){return e.items},function(e){return e.toArray().map(function(e){return e.fq_path})})}),define("modules/clean/react/browse/files_view/sticky_table_head",["require","exports","tslib","external/spectrum/dimensions","external/spectrum/table","external/react","modules/clean/react/sticky/sticky","modules/clean/react/sticky/container"],function(e,t,r,s,o,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickyTableHead=function(e){var t=e.children,l=e.columnFlex,c=e.offsetHeight,d=e.offsetTop,u=r.__rest(e,["children","columnFlex","offsetHeight","offsetTop"]);return i.createElement("thead",{className:"brws-sticky-table-head"},i.createElement(s.Dimensions,{tagName:"tr"},function(e){var s=e.width;return i.createElement("td",{className:"brws-sticky-table-cell"},i.createElement(a.StickyContainer,{offsetTop:d,useNativeSticky:!0,useWindowToDetermineBottom:!0},i.createElement(n.Sticky,{offsetHeight:c},i.createElement(o.Table,{columnFlex:l,style:{width:s}},i.createElement(o.TableHead,r.__assign({},u),t)))))}))}}),define("modules/clean/react/browse/files_view/view_type_column_header_menu",["require","exports","tslib","external/spectrum/icon_form","external/spectrum/icon_mode","external/spectrum/popover","external/react","modules/clean/react/browse/constants","modules/core/i18n"],function(e,t,r,s,o,i,n,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSelection=function(e){e!==t.props.viewType&&t.props.onSwitchViewType(e)},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.onTTI()},t.prototype.render=function(){var e=this.props.viewType;return n.createElement(i.Popover,{className:"brws-view-type-column-header-menu",onSelection:this.handleSelection},n.createElement(i.PopoverTrigger,{className:"brws-view-type-column-header-menu-trigger",title:e===a.ViewType.Grid?l._("Grid"):l._("List")},n.createElement(o.IconMode,{name:e===a.ViewType.Grid?"tiles":"list"}),n.createElement(s.IconForm,{name:"caret-down"})),n.createElement(i.PopoverContent,{attachment:"right",className:"brws-view-type-column-header-menu-content"},n.createElement(i.PopoverItemGroup,null,n.createElement(i.PopoverItemGroupTitle,null,l._("View Mode")),n.createElement(i.PopoverSelectableItem,{icon:n.createElement(o.IconMode,{name:"list"}),selected:e===a.ViewType.List,value:a.ViewType.List},l._("List")),n.createElement(i.PopoverSelectableItem,{icon:n.createElement(o.IconMode,{name:"tiles"}),selected:e===a.ViewType.Grid,value:a.ViewType.Grid},l._("Grid")))))},t})(n.PureComponent);t.ViewTypeColumnHeaderMenu=c}),define("modules/clean/react/browse/global_actions",["require","exports","modules/clean/filepath","modules/clean/browse_interface","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/async_file_modal_controller","modules/clean/sharing/browse_exports","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/clean/viewer","modules/constants/cloud_docs","modules/core/browser","modules/core/i18n","modules/clean/react/browse/store","modules/core/notify"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h,f,m,_){"use strict";function S(e){var t=e.context,r=e.user,s=e.showDeletedFiles,o=e.onFileUpload,i=(e.isContextMenu,e.isNoComment),a=void 0!==i&&i,c=e.experiments,d=void 0===c?{}:c,h=t.isCurrentlyInRoot,f=!t.canViewContainingNSMembers,m=t.isCurrentPathWriteable(),_={className:"action-upload",label:g,iconName:"upload",performAction:A(o),disabled:!m},S=[];if(t.isInsideTeamFolderTree||!t.isInsideDeletedSharedFolder&&!t.isInsideDeletedNestedSharedFolder)if(t.isInsideDeletedFolder)S.push({label:T,iconName:"restore",className:"action-restore",performAction:x(r,t,d&&d.expShouldShowUnifiedTrashModal),disabled:!m});else{var U={label:v,iconName:"new-folder",performAction:I(r,t,d.expBrowseCdmNsfShouldCreateNsf,d.expBrowseCdmNsfAutoTeamGroupId),disabled:!m,className:"action-new-folder"},B={label:h?y:C,iconName:"new-shared-folder",performAction:N(r,t),disabled:f,className:"action-share-folder"},k={label:D,iconName:"new-team-folder",performAction:M(r,t),disabled:!1,className:"action-team-folder"};r.is_cdm_member&&"/"===t.currentFQPath?S.push(_,U):h?(S.push(_),!r.is_cdm_member&&l.GoldenGate.hasContentManagerAndSuperAdmin(r.id)&&S.push(k),S.push(B,U)):(S.push(B),S.push(_,U)),p.ENABLE_CREATE&&S.push({label:w,iconName:"new-paper-doc",className:"action-paper-docs",performAction:P(n.CloudDoc.PAPER,t),disabled:!m}),a||S.push({label:s?E:F,iconName:s?"hide":"show-deleted-files",performAction:L(r,s),disabled:f,className:"action-deleted-files"}),!u.Viewer.get_viewer().is_assume_user_session&&(l.GoldenGate.hasContentManagerAndSuperAdmin(r.id)&&l.GoldenGate.hasNewOwnershipModel(r.id)&&!t.isNonUserRelativeContext&&t.isInsideTeamFolderTree||!r.is_cdm_member&&l.GoldenGate.hasContentManagerAndSuperAdmin(r.id)&&t.isCurrentlyInRoot&&!t.isNonUserRelativeContext)&&S.push({label:R,iconName:"settings-gear",performAction:M(r,t)})}else S.push({label:b,iconName:"restore",performAction:O(r,t),disabled:!m});return S}Object.defineProperty(t,"__esModule",{value:!0});var g=f._("Upload files"),w=f._("New Paper Document"),v=f._("New folder"),T=f._("Restore folder"),b=f._("Re-add shared folder"),F=f._("Show deleted files"),E=f._("Hide deleted files"),y=f._("New shared folder"),C=f._("Share folder"),R=f._("View in admin console"),D=f._("New team folder"),A=function(e){return function(){e&&e()}},I=function(e,t,s,n){return function(){var d=t.currentNSID,u=t.currentFQPath;if(o.logCreateFolder({uid:e.id,view_type:m.getBrowseStore().viewType(),file_nsid:d,file_path:u,file_name:r.filename(u)}),e.is_cdm_member&&"/"===u){var p=function(){_.error(f._("There was a problem completing this request.")),i.browseActions.cancelCreateFolder()},h=function(e){var t=e.user,r=e.folderName,s=e.fqPath;i.browseActions.createFolderComplete({user:t,folderName:r,changesets:null}),i.browseActions.selectFilesByFqPath({fqPathsToSelect:[s]})};l.asyncShowAppropriateNewFolderModalForCdmUser({user:e,context:t,expBrowseCdmNsfShouldCreateNsf:s,expBrowseCdmNsfAutoTeamGroupId:n,onNormalFolderCreationNeeded:i.browseActions.createFolder,showFileSystemWarningsModal:a.showFileSystemWarningsModal,onPending:i.browseActions.createFolderPending,onComplete:h,onCancel:p,autoTeamGroupDefaultAccessLevel:c.ACCESS_LEVEL.WRITER})}else i.browseActions.nameNewFolder()}},P=function(e,t){return function(){i.browseActions.createCloudDoc({pathName:t.currentFQPath,title:"Untitled",documentType:e})}},N=function(e,t){return function(){t.isCurrentlyInRoot?l.asyncShowShareAFolderWizardModal(e):l.asyncShowShareModal(e,t,{origin:d.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS})}},L=function(e,t){return function(){o.logToggleDeletedFiles({uid:e.id,show_deleted_files:!t,view_type:m.getBrowseStore().viewType()}),i.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:!t})}},x=function(e,t,i){return void 0===i&&(i=!1),function(){var n=t.currentNSID,l=t.currentFQPath;if(o.logRestore({uid:e.id,view_type:m.getBrowseStore().viewType(),file_nsid:n,file_path:l,file_name:r.filename(l)}),i)a.showUnifiedTrashModal({userId:e.id,context:t});else{var c=s.getRestoreFileUrl({fqPath:l,userId:e.id});h.redirect(c)}}},O=function(e,t){return function(){var r=t.currentFQPath.toLowerCase(),s=t.inactiveNSIDByFQPath[r],o=t.isInsideDeletedNestedSharedFolder;s&&l.asyncMountSharedFolder(s,e.role,d.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,!1,null,o)}},M=function(e,t){return function(){l.asyncGoToContentManagerForPath({isLimitedTeam:u.Viewer.get_viewer().team_is_limited,containingFolder:t.currentFQPath,isCDM:e.is_cdm_member})}};t.getGlobalActions=S}),define("modules/clean/react/browse/internal_drag_status",["require","exports","tslib","external/classnames","external/react","modules/clean/react/sprite"],function(e,t,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.className,r=e.files,n=s("active",t);return o.createElement("div",{id:"drag-status",className:n},o.createElement("div",{id:"drag-selection-status"},r.slice(0,4).map(function(e,t){return e.thumbnail_url_tmpl?o.createElement("img",{key:t,src:e.thumbnail_url_tmpl,className:"icon icon"+t,alt:""}):o.createElement(i,{key:t,group:"web",name:e.icon,className:"icon icon"+t,alt:""})}),o.createElement("span",{className:"badge"},r.length)))},t})(o.PureComponent);t.InternalDragStatus=n}),define("modules/clean/react/browse/nav_actions",["require","exports","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/selection","modules/clean/sharing/gating_util","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(){function e(e){this.dataApi=e}return e.prototype.setUrlPrefix=function(e){var t=e.prefix;n.BrowseDispatcher.dispatch({type:i.BrowseActionType.SET_URL_PREFIX,data:{prefix:t}})},e.prototype.setUrl=function(e){var t=e.path,s=(e.qargs,{});"1"===r.deconstruct_url().qargs.d&&(s.d="1");var o=t?h.encode_parts(t):"";r.push_state(l.getBrowseStore().urlPrefix()+o,s),n.BrowseDispatcher.dispatch({type:i.BrowseActionType.SET_SELECTION,data:{selection:c.createSelection()}})},e.prototype.setLoadingState=function(e){var t=e.loadingState,r=e.path;n.BrowseDispatcher.dispatch({type:i.BrowseActionType.SET_LOADING_STATE,data:{loadingState:t,path:r}})},e.prototype.setMountPoints=function(e){var t=e.mountPoints;n.BrowseDispatcher.dispatch({type:i.BrowseActionType.SET_MOUNT_POINTS,data:{mountPoints:t}})},e.prototype.setTeamFolders=function(e){var t=e.teamFolders;n.BrowseDispatcher.dispatch({type:i.BrowseActionType.SET_TEAM_FOLDERS,data:{teamFolders:t}})},e.prototype.setPath=function(e){var t=this,r=e.path,o=e.sortLabel,c=e.sortIsAscending,h=e.onPathLoaded,f=e.nsId,m=e.logFetchedDataRequiredForTTI,_=void 0!==m&&m,S=e.ajaxWebTimer,g=l.getBrowseStore(),w=g.user(),v=w.id;n.BrowseDispatcher.dispatch({type:i.BrowseActionType.SET_PATH,data:{path:r,sortLabel:o,sortIsAscending:c}}),this.setLoadingState({loadingState:i.LoadingState.LOADING_FIRST_PAGE,path:r});var T=function(e){var r=e.path,o=e.data,n=e.xhr;if(_&&u.log_js_modules_fetched_data_required_for_tti(),S){var l=n.getResponseHeader("x-dropbox-request-id");S.end(l?l:void 0)}t.setMountPoints({mountPoints:o.ns_id_to_mount_point}),t.setTeamFolders({teamFolders:o.team_folders_js_info});var c=a.BrowseContext.fromServerObject(o);if(o.paginated){t.clear({path:r,context:c});var p=c.isNonUserRelativeContext,f=p&&!w.is_cdm_member&&!d.GoldenGate.hasContentManagerCdm(v),m=g.path(),T="/"!==m&&f?m.split("/")[1]:"",b=o.first_page.total_num_items;s.PaginationManager.create({firstPage:o.first_page,keyName:"sjid",ajaxURL:"/browse_get_next",userID:v,newDataAvailableCallback:function(e,s){var o=e.areAllItemsReady()?i.LoadingState.LOADED:i.LoadingState.LOADING_REMAINING_PAGES;t.addFilesAndSetLoadingState({path:r,files:s,paginatedTotalNumFiles:b,loadingState:o}),e.areAllItemsReady()&&e.stopAutoFetching()},fqPathPrefix:T}).startAutoFetching()}else{var F=o.file_info,E=F?F.length:0;t.load({path:r,files:F,paginatedTotalNumFiles:E,context:c})}h&&h()},b=l.getBrowseStore().sortLabel(),F=l.getBrowseStore().sortIsAscending();this.dataApi.loadPath({sortLabel:b,sortIsAscending:F,path:r,userId:v,sortFoldersFirst:!p.mac,includeDeletedFiles:l.getBrowseStore().shouldShowDeletedFiles(),nsId:f,onSuccess:T,onError:function(){"/"!==r&&t.setPath({path:"/",sortLabel:b,sortIsAscending:F,onPathLoaded:h})}})},e.prototype.load=function(e){var t=e.path,r=e.files,s=e.paginatedTotalNumFiles,o=e.context;n.BrowseDispatcher.dispatch({type:i.BrowseActionType.LOAD_PATH,data:{path:t,files:r,paginatedTotalNumFiles:s,context:o}})},e.prototype.clear=function(e){var t=e.path,r=e.context;n.BrowseDispatcher.dispatch({type:i.BrowseActionType.CLEAR_FILES,data:{path:t,context:r}})},e.prototype.add=function(e){var t=e.path,r=e.files,s=e.paginatedTotalNumFiles;n.BrowseDispatcher.dispatch({type:i.BrowseActionType.ADD_FILES,data:{path:t,files:r,paginatedTotalNumFiles:s}})},e.prototype.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,s=e.files,o=e.paginatedTotalNumFiles;n.BrowseDispatcher.dispatch({type:i.BrowseActionType.ADD_FILES_AND_SET_LOADING_STATE,data:{path:t,loadingState:r,files:s,paginatedTotalNumFiles:o}})},e.prototype.setDataApi=function(e){this.dataApi=e},e})();t.BrowseNavActions=f,t.browseNavActions=new f(o)}),define("modules/clean/react/browse/selectors",["require","exports","external/reselect","modules/clean/filetypes"],function(e,t,r,s){"use strict";function o(e,t){return e.withMutations(function(r){t.forEach(function(t,s){var o=e.get(s);if(o&&t){var i=o.updateSize(t.size,t.state);r.set(s,i)}})})}function i(e,t){return e.map(function(e){var r=t.get(e.fq_path);return r?e.updateSize(r.size,r.state):e})}Object.defineProperty(t,"__esModule",{value:!0}),t.makeFilesWithoutTeamSharedFolders=function(){return r.createSelector(function(e){return e.sortedFiles},function(e){return e.filter(function(e){return e.type!==s.FileTypes.TEAM_SHARED_FOLDER})})},t.makeUnsortedFilesWithFolderSizes=function(){return r.createSelector(function(e){return e.unsortedFiles},function(e){return e.folderSizes},function(e,t){return o(e,t)})},t.makeSortedFilesWithFolderSizes=function(){return r.createSelector(function(e){return e.sortedFiles},function(e){return e.folderSizes},function(e){return e.currentSort},function(e,t){return i(e,t)})}}),define("modules/clean/react/browse/share_button",["require","exports","tslib","external/spectrum/button","external/react","modules/clean/search/search_results/log_helper","modules/clean/react/browse/constants","modules/clean/sharing/browse_exports","modules/core/i18n","modules/clean/web_user_action_events"],function(e,t,r,s,o,i,n,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(e){e.preventDefault();var r=t.props,s=r.file,o=r.user,l=r.browseContext;t.props.isSearchMode&&i.recordSearchResultsAction({result:s,user:o,action_type:c.WebUserActionLogEvent.SHARE,view_type:n.ViewType.List}),a.asyncShowShareModal(o,s,{browseContext:l,origin:"BROWSE_FILE_ROW"}),e.stopPropagation()},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.isVisible;return o.createElement(s.Button,{"aria-label":l._("Share"),className:"inline-share-button",onClick:this.handleClick,tabIndex:e?void 0:-1,variant:e?"secondary":"invisible"},l._("Share"))},t.defaultProps={isVisible:!0,isSearchMode:!1},t})(o.PureComponent);t.ShareButton=d}),define("modules/clean/react/browse/sort_helpers",["require","exports"],function(e,t){"use strict";function r(e,t,r){for(var s="=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<Math.max(e.length,t.length);o++){var i=e.charAt(o),n=t.charAt(o);if(!i)return-r;if(!n)return r;var a=s.indexOf(i),l=s.indexOf(n);if(a<l)return-r;if(l<a)return r}return 0}function s(e,t,s){if(Array.isArray(e)&&Array.isArray(t)){for(var o=0;o<Math.max(e.length,t.length);o++){var i=e[o],n=t[o];if(null==i)return-s;if(null==n)return s;if("number"==typeof i&&"string"==typeof n)return-s;if("number"==typeof n&&"string"==typeof i)return s;if("string"==typeof i&&"string"==typeof n){var a=r(i,n,s);if(0!==a)return a}else{if(i<n)return-s;if(n<i)return s}}return 0}return e===t?0:e<t?-s:s}Object.defineProperty(t,"__esModule",{value:!0}),t.compare=s}),define("modules/clean/react/browse/store",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/filetypes","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/sort_helpers","modules/clean/react/selection","modules/core/browser","modules/core/exception","modules/clean/react/browse/selectors","modules/core/cookies","modules/clean/react/browse/files_view/constants","modules/clean/storage"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h,f,m,_){"use strict";function S(){return null===v&&(v=new w),v}function g(){return null!==v}Object.defineProperty(t,"__esModule",{value:!0});var w=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.unsortedFilesWithFolderSizes=h.makeUnsortedFilesWithFolderSizes(),t.sortedFilesWithFolderSizes=h.makeSortedFilesWithFolderSizes(),t.filesWithoutTeamSharedFolders=h.makeFilesWithoutTeamSharedFolders(),t}return r.__extends(t,e),t.prototype._init=function(){this._unsortedFiles=s.Map(),this._sortedFiles=s.List(),this._paginatedTotalNumFiles=0,this._teamFolders=s.List(),this._path="",this._user=null,this._urlPrefix="",this._loadingState=a.LoadingState.LOADING_FIRST_PAGE,this._mountPoints=null,this._shouldShowDeletedFiles=!1,this._activeDropTarget=null,this._inCopyMode=!1,this._clipboardFiles=[],this._currentSort={sortField:a.BrowseSortField.FILENAME,sortDirection:a.SortDirection.ASCENDING},this._canDisplayFolderSizes=!1,this._viewType=this.getViewTypeCookie()||a.ViewType.List,this._viewTypeColumns={},this._viewTypeColumns[a.ViewType.List]=m.LIST_VIEW_COLUMNS,this._viewTypeColumns[a.ViewType.Grid]=m.GRID_VIEW_COLUMNS,this._fileRename=null,this._newFolderCreationState=a.NewFolderCreationState.CREATE_FOLDER_INACTIVE,this._filePathsToSelectOnNextUpdate=s.Set(),this._activeFileJumpFilter="",this._fileJumpIndex=[],this._activeTab=void 0,this._folderSizes=s.Map(),this._currentFolderSizesQuery=s.Set(),this._isQueryingFolderSizes=!1,this._tilesPerRow=1,this._selection=void 0,this._context=void 0},t.prototype.isPathEqualsTo=function(e){return!(e&&"/"!==e||this._path&&"/"!==this._path)||e===this._path},t.prototype.files=function(){return this._folderSizes.size>0?this.sortedFilesWithFolderSizes({sortedFiles:this._sortedFiles,folderSizes:this._folderSizes,currentSort:this._currentSort}):this._sortedFiles},t.prototype.filesMap=function(){return this._folderSizes.size>0?this.unsortedFilesWithFolderSizes({unsortedFiles:this._unsortedFiles,folderSizes:this._folderSizes}):this._unsortedFiles},t.prototype.filesWithoutTeamFolders=function(){return this._folderSizes.size>0?this.sortedFilesWithFolderSizes({sortedFiles:this._sortedFiles,folderSizes:this._folderSizes,currentSort:this._currentSort}).filter(function(e){return e.type!==i.FileTypes.TEAM_SHARED_FOLDER}):this._sortedFiles.size>0?this.filesWithoutTeamSharedFolders({sortedFiles:this._sortedFiles}):s.List()},t.prototype.teamFolders=function(){return this.context().showPinnedTeamFolder?this._sortedFiles.filter(function(e){return e.type===i.FileTypes.TEAM_SHARED_FOLDER}):this._folderSizes.size>0?this.sortedFilesWithFolderSizes({sortedFiles:this._sortedFiles,folderSizes:this._folderSizes,currentSort:this._currentSort}).filter(function(e){return e.type===i.FileTypes.TEAM_SHARED_FOLDER}):this._teamFolders},t.prototype.path=function(){return this._path},t.prototype.user=function(){return this._user},t.prototype.urlPrefix=function(){return this._urlPrefix},t.prototype.selection=function(){return this._selection||(this._selection=d.createSelection())},t.prototype.paginatedTotalNumFiles=function(){return this._paginatedTotalNumFiles},t.prototype.selectedFiles=function(){var e=this;if(this.selection().selected.isEmpty()||this._sortedFiles.isEmpty())return s.OrderedMap();var t=this._sortedFiles.filter(function(t){return e.selection().selected.has(t.fq_path)});return s.OrderedMap(t.map(function(e){return[e.fq_path,e]}))},t.prototype.activeTab=function(){return this._activeTab},t.prototype.loadingState=function(){return this._loadingState},t.prototype.context=function(){return this._context||(this._context=new l.BrowseContext)},t.prototype.mountPoints=function(){return this._mountPoints},t.prototype.shouldShowDeletedFiles=function(){return this._shouldShowDeletedFiles},t.prototype.activeDropTarget=function(){return this._activeDropTarget},t.prototype.currentSort=function(){return this._currentSort},t.prototype.sortIsAscending=function(){return"ASCENDING"===this._currentSort.sortDirection},t.prototype.sortLabel=function(){return this._currentSort.sortField in a.BrowseSortIsFilename?a.BrowseSortLabel.FILENAME:"MODIFIED"===this._currentSort.sortField?a.BrowseSortLabel.MODIFIED:a.BrowseSortLabel.SIZE},t.prototype.viewType=function(){return this._viewType||a.ViewType.List},t.prototype.viewTypeColumns=function(){return this._viewTypeColumns},t.prototype.getIndexOfFile=function(e){return this._sortedFiles.findIndex(function(t){return t.sjid===e.sjid&&t.ns_id===e.ns_id})},t.prototype.getFileByFilename=function(e){return this._sortedFiles.find(function(t){return o.filename(t.fq_path)===e})||null},t.prototype.getFileByFullPath=function(e){return this._sortedFiles.find(function(t){return t.fq_path===e})||null},t.prototype.inCopyMode=function(){return this._inCopyMode},t.prototype.clipboardFiles=function(){return this._clipboardFiles},t.prototype.fileRename=function(){return this._fileRename},t.prototype.newFolderCreationState=function(){return this._newFolderCreationState},t.prototype.isFileJumping=function(){return this._activeFileJumpFilter.length>0},t.prototype.canDisplayFolderSizes=function(){return this._canDisplayFolderSizes},t.prototype.isQueryingFolderSizes=function(){return this._isQueryingFolderSizes},t.prototype.tilesPerRow=function(){return this._tilesPerRow},t.prototype.initializeEverything=function(e){var t=e.user,r=e.path,o=e.files,i=e.paginatedTotalNumFiles,n=e.urlPrefix,l=e.context,c=e.mountPoints,d=e.fqPathsToSelect,u=e.loadingState,p=e.shouldShowDeletedFiles,h=e.teamFolders;this._user=t,this._path=r,this._urlPrefix=n,this.updateUserPrefData(t.id),this.appendFiles({path:r,files:o,paginatedTotalNumFiles:i},!1),this._context=l,this._mountPoints=s.Map(c),this._loadingState=u,this.setTeamFolders({teamFolders:h}),u===a.LoadingState.LOADED?this.selectFqPaths({fqPathsToSelect:d},!1):this._filePathsToSelectOnNextUpdate=s.Set(d),this._shouldShowDeletedFiles=!!p,this.emit_change()},t.prototype.setUser=function(e){var t=e.user;null==this.user()&&(this._user=t,this.updateUserPrefData(t.id))},t.prototype.updateUserPrefData=function(e){var t=this,r=this.getCurrentSortCookie();r&&(this._currentSort=r),a.AllViewTypes.forEach(function(r){t.updateViewTypeColumns(e,r)})},t.prototype.updateViewTypeColumns=function(e,t){var r=this.getUserLocalStorage(e,a.COLUMNS_STORAGE_KEY+"_"+t);r&&(this._viewTypeColumns[t]=r)},t.prototype.setPathData=function(e,t){var r=e.path,s=e.files,i=e.paginatedTotalNumFiles,n=e.context;void 0===t&&(t=!0),o.paths_are_equal(r,this._path)&&(this._unsortedFiles=this._unsortedFiles.clear(),this._sortedFiles=this._sortedFiles.clear(),this._selection=void 0,this.appendFiles({path:r,files:s,paginatedTotalNumFiles:i},!1),this._context=n,t&&this.emit_change())},t.prototype.clearFiles=function(e){var t=e.path,r=e.context;o.paths_are_equal(t,this._path)&&(this._unsortedFiles=this._unsortedFiles.clear(),this._sortedFiles=this._sortedFiles.clear(),this._selection=void 0,this._paginatedTotalNumFiles=0,this._context=r,this.buildFileJumpIndex(),this.emit_change())},t.prototype.appendFiles=function(e,t){var r=e.path,i=e.files,n=e.paginatedTotalNumFiles;if(void 0===t&&(t=!0),o.paths_are_equal(r,this._path)){for(var a=[],c=[],d=0,u=i;d<u.length;d++){var h=u[d],f=h instanceof l.File?h:l.File.fromServerObject(h);a.push([h.fq_path,f]),this._unsortedFiles.has(h.fq_path)||c.push(f)}this._unsortedFiles=this._unsortedFiles.merge(s.Map(a)),this._sortedFiles=this._sortedFiles.concat(s.List(c)),p.assert(this._unsortedFiles.size===this._sortedFiles.size,"appendFiles ended up with mismatched data structures"),this.sortFiles(this._currentSort,!1),this._filePathsToSelectOnNextUpdate.count()&&this.selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1),this.buildFileJumpIndex(),this._paginatedTotalNumFiles=n,t&&this.emit_change()}},t.prototype.applyFileDeltas=function(e){var t=e.path,r=e.fileDeltas;if(o.paths_are_equal(t,this._path)){for(var i=0,n=r;i<n.length;i++){var a=n[i],l=a.before,c=a.after;this.applyFileDelta({before:l,after:c,pathForDelta:t})}if(this._filePathsToSelectOnNextUpdate.size){this.selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1).size===this._filePathsToSelectOnNextUpdate.size&&(this._filePathsToSelectOnNextUpdate=s.Set())}p.assert(this._unsortedFiles.size===this._sortedFiles.size,"applyFileDeltas ended up with mismatched file collections (map vs. sorted list)"),this.sortFiles(this._currentSort,!1),this.buildFileJumpIndex(),this.emit_change()}},t.prototype.setPath=function(e){var t=e.path;this._path=t,this.emit_change()},t.prototype.setUrlPrefix=function(e){var t=e.prefix;this._urlPrefix=t,this.emit_change()},t.prototype.setLoadingState=function(e){var t=e.path,r=e.loadingState;o.paths_are_equal(t,this._path)&&(this._loadingState=r,r===a.LoadingState.LOADED&&(this._filePathsToSelectOnNextUpdate=s.Set()),this.emit_change())},t.prototype.setMountPoints=function(e){var t=e.mountPoints;this._mountPoints=s.Map(t)},t.prototype.setTeamFolders=function(e){var t=e.teamFolders;this._teamFolders=s.List((t||[]).map(l.File.fromServerObject))},t.prototype.setSelection=function(e){var t=e.selection;this._selection=t,this.emit_change()},t.prototype.selectFilesAfterUpload=function(e){var t=this,r=e.fqPathsToSelect;r.every(function(e){return t.filesMap().has(e)})?this.selectFqPaths({fqPathsToSelect:r}):this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:r})},t.prototype.selectFqPaths=function(e,t){var r=e.fqPathsToSelect;void 0===t&&(t=!0);var o=r.map(function(e){return e.toLowerCase()}),i=this._sortedFiles.filter(function(e){return o.includes(e.fq_path.toLowerCase())}),n=i.map(function(e){return e.fq_path}),a=s.OrderedSet(n),l=n.size?n.get(0):null;return this._selection=this.selection().set("selected",a).set("anchor",l),t&&this.emit_change(),n},t.prototype.setActiveTab=function(e){var t=e.tabName;this._activeTab=t,this.emit_change()},t.prototype.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles;this._shouldShowDeletedFiles=!!t,this.emit_change()},t.prototype.setDropTarget=function(e){var t=e.target;this._activeDropTarget=t,this.emit_change()},t.prototype.setCopyMode=function(e){var t=e.copyMode;this._inCopyMode=t,this.emit_change()},t.prototype.setViewType=function(e){var t=e.viewType;this._viewType=t,this.setViewTypeCookie(t),this.emit_change()},t.prototype.getViewTypeCookie=function(){return f.read(a.VIEW_TYPE_COOKIE_NAME)},t.prototype.setViewTypeCookie=function(e){f.delete(a.VIEW_TYPE_COOKIE_NAME),f.create(a.VIEW_TYPE_COOKIE_NAME,e,1095)},t.prototype._setColumnDependentCapabilities=function(e){var t=e.canDisplayFolderSizes;this._canDisplayFolderSizes=t},t.prototype.setColumnDependentCapabilities=function(e){var t=e.canDisplayFolderSizes;this._canDisplayFolderSizes!==t&&(this._setColumnDependentCapabilities({canDisplayFolderSizes:t}),this.emit_change())},t.prototype._setViewTypeColumns=function(e,t){this._viewTypeColumns[t]=e,this.setUserLocalStorage(a.COLUMNS_STORAGE_KEY+"_"+t,e)},t.prototype.setColumnConfiguration=function(e){var t=e.columns,r=e.viewType,s=e.canDisplayFolderSizes;this._setViewTypeColumns(t,r),this._setColumnDependentCapabilities({canDisplayFolderSizes:s}),this.emit_change()},t.prototype.getCurrentSortCookie=function(){var e=f.read(a.BROWSE_SORT_COOKIE_NAME);if(e&&e.length&&e.indexOf("|")>-1){var t=e.split("|",2);return{sortField:t[0],sortDirection:t[1]}}},t.prototype.setCurrentSortCookie=function(e){f.delete(a.BROWSE_SORT_COOKIE_NAME);var t=e.sortField+"|"+e.sortDirection;f.create(a.BROWSE_SORT_COOKIE_NAME,t,1095)},t.prototype.setUserLocalStorage=function(e,t){this._user&&_.UserLocalStorage.set(this._user.id,e,t)},t.prototype.getUserLocalStorage=function(e,t){return _.UserLocalStorage.get(e,t)},t.prototype.setTilesPerRow=function(e){var t=e.tilesPerRow;this._tilesPerRow=t,this.emit_change()},t.prototype.sortFiles=function(e,t){function r(e,t){var r=e.value,s=e.isTMF,o=t.value;return i(s,t.isTMF)||c.compare(r,o,h)}function s(e,t){var r=e.isFolder,s=e.value,o=e.isTMF,n=t.isFolder,a=t.value,l=t.isTMF,d=i(o,l);return d?d:(s||(s=1/0*h),a||(a=1/0*h),r&&n?c.compare(s,a,h):r?-h:n?h:c.compare(s,a,h))}function o(e,t){var r=e.isFolder,s=e.value,o=e.isTMF,n=t.isFolder,a=t.value,l=t.isTMF,d=i(o,l);return d?d:r&&n?c.compare(s,a,h):r?1:n?-1:""===s?1:""===a?-1:c.compare(s,a,h)}function i(e,t){if(f){if(e)return-1;if(t)return 1}return 0}var n=this,d=e.sortField,p=e.sortDirection;void 0===t&&(t=!0);var h=p===a.SortDirection.ASCENDING?1:-1,f=!this.context().isNonUserRelativeContext,m=d===a.BrowseSortField.FILENAME||d===a.BrowseSortField.SHARED_WITH,_=u.mac?r:s;m?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.sort_key,isTMF:l.File.isTeamMemberFolder(e)}},_):d===a.BrowseSortField.MODIFIED?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.ts,isTMF:l.File.isTeamMemberFolder(e)}},o):d===a.BrowseSortField.CATEGORY?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:l.File.getCategoryDescription(e),isTMF:l.File.isTeamMemberFolder(e)}},o):d===a.BrowseSortField.EXTENSION?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:l.File.getExtension(e),isTMF:l.File.isTeamMemberFolder(e)}},o):d===a.BrowseSortField.SIZE&&(this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.is_dir&&n._folderSizes.has(e.fq_path)?n._folderSizes.get(e.fq_path).size:e.bytes,isTMF:l.File.isTeamMemberFolder(e)}},_)),this._currentSort={sortField:d,sortDirection:p},this.setCurrentSortCookie(this._currentSort),t&&this.emit_change()},t.prototype.setClipboardToFiles=function(e){this._clipboardFiles=e,this.emit_change()},t.prototype.updateRenameState=function(e,t){this._fileRename=t?{file:e,state:t}:null,this.emit_change()},t.prototype.setNewFolderCreationState=function(e){this._newFolderCreationState=e,this.emit_change()},t.prototype.setFilePathsToSelectOnNextUpdate=function(e){
var t=e.fqPathsToSelect,r=void 0===t?[]:t;this._filePathsToSelectOnNextUpdate=s.Set(r)},t.prototype.addCommentStatusBatch=function(e){var t=this,r=e.commentStatusByFqPath;Object.keys(r).map(function(e){var s=t._unsortedFiles.get(e);if(null!=s){var o=s.merge(r[e]);t.insertOrUpdateFile({file:o,forceUpdate:!0})}}),this.emit_change()},t.prototype.addFileJumpKeyCode=function(e){var t=e.keyChar;this._activeFileJumpFilter+=t.toLowerCase();for(var r=null,s=0,o=this._fileJumpIndex;s<o.length;s++){var i=o[s],n=i.fqPath;if(i.filename>=this._activeFileJumpFilter){r=n;break}}null!=r&&this.selectFqPaths({fqPathsToSelect:[r]})},t.prototype.resetFileJump=function(){this._activeFileJumpFilter=""},t.prototype.buildFileJumpIndex=function(){this._fileJumpIndex=this._unsortedFiles.keySeq().toArray().map(function(e){return{filename:o.filename(e).toLowerCase(),fqPath:e}}),this._fileJumpIndex.sort(function(e,t){var r=e.filename,s=t.filename;return r<s?-1:r>s?1:0})},t.prototype.applyFileDelta=function(e){var t=e.before,r=e.after,s=e.pathForDelta;if(r&&!o.paths_are_equal(o.parent_dir(r.fq_path),s)&&(r=null),r!==t){var i=r&&this._unsortedFiles.get(r.fq_path);if(!(i&&i.sjid>=r.sjid)){if(this._fileRename&&r&&t){var n=this._folderSizes.get(t.fq_path);n&&(this._folderSizes=this._folderSizes.set(r.fq_path,{size:n.size,state:n.state}))}return t&&(this._folderSizes=this._folderSizes.delete(t.fq_path)),r&&t?this.replaceFile({existingFile:t,newFile:r}):r&&!t?this.insertOrUpdateFile({file:r}):t&&!r?this.removeFile({file:t}):void 0}}},t.prototype.insertOrUpdateFile=function(e){function t(e){return e.fq_path.toLowerCase()===i}var r=e.file,s=e.forceUpdate,o=void 0!==s&&s;this._unsortedFiles=this._unsortedFiles.set(r.fq_path,r);var i=r.fq_path.toLowerCase(),n=this._sortedFiles.findEntry(t)||[null,null],a=n[0],l=n[1];l?(o||r.sjid>l.sjid)&&(this._sortedFiles=this._sortedFiles.set(a,r)):this._sortedFiles=this._sortedFiles.push(r)},t.prototype.removeFile=function(e){function t(e){return e.fq_path.toLowerCase()===o}var r=e.file;p.assert(this._unsortedFiles.has(r.fq_path),"trying to remove a file that doesn't exist in the file map");var s=this._sortedFiles.indexOf(r),o=r.fq_path.toLowerCase(),i=this._sortedFiles.findEntry(t),n=i?i[0]:-1;p.assert(n!==-1,"tried to remove file that doesn't exist in the sorted file list"),this._unsortedFiles=this._unsortedFiles.delete(r.fq_path),this._sortedFiles=this._sortedFiles.delete(s)},t.prototype.replaceFile=function(e){function t(e){return e.fq_path.toLowerCase()===o}var r=e.existingFile,s=e.newFile;p.assert(this._unsortedFiles.has(r.fq_path),"tried to replace file, but previous file doesn't exist in map");var o=r.fq_path.toLowerCase(),i=this._sortedFiles.findEntry(t),n=i?i[0]:-1;p.assert(n!==-1,"tried to update file, but previous file doesn't exist in sorted list"),r.fq_path===s.fq_path?(this._sortedFiles=this._sortedFiles.set(n,s),this._unsortedFiles=this._unsortedFiles.set(r.fq_path,s)):(this._sortedFiles=this._sortedFiles.delete(n),this._unsortedFiles=this._unsortedFiles.delete(r.fq_path),this._unsortedFiles=this._unsortedFiles.set(s.fq_path,s),this._sortedFiles=this._sortedFiles.push(s),this._fileRename&&this._fileRename.state===a.RenameState.SAVING_INPUT&&(this.updateRenameState(r,null),this.selectFqPaths({fqPathsToSelect:[s.fq_path]})))},t.prototype.requestFolderSizes=function(e){this._isQueryingFolderSizes||(this._isQueryingFolderSizes=!0,this._folderSizes=this._folderSizes.withMutations(function(t){t.set(e,{size:0,state:a.FetchFolderSizeState.LOADING})}),this.emit_change())},t.prototype.setFolderSizesPending=function(e){var t=this;this._folderSizes=this._folderSizes.withMutations(function(r){for(var s=function(e){r.update(e.fq_path,{size:0,state:a.FetchFolderSizeState.LOADING},function(t){return{size:t.size+e.size,state:a.FetchFolderSizeState.LOADING}}),t._currentFolderSizesQuery=t._currentFolderSizesQuery.add(e.fq_path)},o=0,i=e.sizes_dict;o<i.length;o++){s(i[o])}}),this.emit_change()},t.prototype.completeFolderSizes=function(e){var t=this;this._folderSizes=this._folderSizes.withMutations(function(r){t._currentFolderSizesQuery.forEach(function(s){var o=t._folderSizes.get(s);o&&r.update(s,function(){return{size:o.size,state:e}})})}),this._currentFolderSizesQuery=s.Set(),this._isQueryingFolderSizes=!1,this.emit_change()},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case a.BrowseActionType.INITIALIZE_EVERYTHING:this.initializeEverything(t.data);break;case a.BrowseActionType.LOAD_PATH:this.setPathData(t.data,!1),this.setLoadingState({path:t.data.path,loadingState:a.LoadingState.LOADED});break;case a.BrowseActionType.CLEAR_FILES:this.clearFiles(t.data);break;case a.BrowseActionType.ADD_FILES:this.appendFiles(t.data);break;case a.BrowseActionType.ADD_FILES_AND_SET_LOADING_STATE:this.appendFiles(t.data,!1),this.setLoadingState(t.data);break;case a.BrowseActionType.SET_PATH:this.setPath(t.data);break;case a.BrowseActionType.SET_USER:this.setUser(t.data);break;case a.BrowseActionType.SET_URL_PREFIX:this.setUrlPrefix(t.data);break;case a.BrowseActionType.CHANGE_FILES:this.applyFileDeltas(t.data);break;case a.BrowseActionType.SET_ACTIVE_TAB:this.setActiveTab(t.data);break;case a.BrowseActionType.SET_SELECTION:this.setSelection(t.data);break;case a.BrowseActionType.SELECT_FILES_AFTER_UPLOAD:this.selectFilesAfterUpload(t.data);break;case a.BrowseActionType.SELECT_FILES_BY_FQ_PATH:this.selectFqPaths(t.data);break;case a.BrowseActionType.SET_LOADING_STATE:this.setLoadingState(t.data);break;case a.BrowseActionType.SET_MOUNT_POINTS:this.setMountPoints(t.data);break;case a.BrowseActionType.SET_TEAM_FOLDERS:this.setTeamFolders(t.data);break;case a.BrowseActionType.SET_SHOULD_SHOW_DELETED_FILES:this.setShouldShowDeletedFiles(t.data);break;case a.BrowseActionType.SET_DROP_TARGET:this.setDropTarget(t.data);break;case a.BrowseActionType.SET_COPY_MODE:this.setCopyMode(t.data);break;case a.BrowseActionType.COPY_FILES_TO_CLIPBOARD:this.setClipboardToFiles(t.data.files);break;case a.BrowseActionType.SET_VIEW_TYPE:this.setViewType(t.data);break;case a.BrowseActionType.SORT_FILES:this.sortFiles(t.data);break;case a.BrowseActionType.REQUEST_NEW_FILE_NAME:this.updateRenameState(t.data.file,a.RenameState.PENDING_INPUT);break;case a.BrowseActionType.SET_FILE_RENAME_PENDING:this.updateRenameState(t.data.file,a.RenameState.SAVING_INPUT);break;case a.BrowseActionType.SET_FILE_RENAME_COMPLETE:case a.BrowseActionType.CANCEL_FILE_RENAME:this.updateRenameState(t.data.file,null);break;case a.BrowseActionType.REQUEST_FOLDER_NAME:this.setNewFolderCreationState(a.NewFolderCreationState.PENDING_INPUT);break;case a.BrowseActionType.CREATE_FOLDER_PENDING:this.setNewFolderCreationState(a.NewFolderCreationState.SAVING_INPUT);break;case a.BrowseActionType.CREATE_FOLDER_COMPLETE:case a.BrowseActionType.CANCEL_CREATE_FOLDER:this.setNewFolderCreationState(a.NewFolderCreationState.CREATE_FOLDER_INACTIVE);break;case a.BrowseActionType.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:this.setFilePathsToSelectOnNextUpdate(t.data);break;case a.BrowseActionType.ADD_COMMENT_STATUS_BATCH:this.addCommentStatusBatch(t.data);break;case a.BrowseActionType.ADD_FILE_JUMP_KEY_CODE:this.addFileJumpKeyCode(t.data);break;case a.BrowseActionType.RESET_FILE_JUMP:this.resetFileJump();break;case a.BrowseActionType.REQUEST_FETCH_FOLDER_SIZES:this.requestFolderSizes(t.data.fqPath);break;case a.BrowseActionType.FETCHED_FOLDER_SIZES:this.setFolderSizesPending(t.data.resp);break;case a.BrowseActionType.COMPLETE_FETCH_FOLDER_SIZES:this.completeFolderSizes(t.data.state);break;case a.BrowseActionType.SET_COLUMN_DEPENDENT_CAPABILITIES:this.setColumnDependentCapabilities(t.data);break;case a.BrowseActionType.SET_COLUMN_CONFIGURATION:this.setColumnConfiguration(t.data);break;case a.BrowseActionType.SET_TILES_PER_ROW:this.setTilesPerRow(t.data)}},t})(n);t.BrowseStore=w;var v=null;t.getBrowseStore=S,t.browseStoreInstantiated=g}),define("modules/clean/react/file_uploader/constants",["require","exports","tslib","external/immutable","modules/core/browser"],function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.SET_PATH="UPLOADER_SET_PATH",e.SET_USER="UPLOADER_SET_USER",e.SET_NUM_DRAGGING_FILES="SET_NUM_DRAGGING_FILES",e.QUEUE_UPLOADS="QUEUE_UPLOADS",e.START_UPLOAD="START_UPLOAD",e.COMPLETE_UPLOAD="COMPLETE_UPLOAD",e.CANCEL_UPLOADS="CANCEL_UPLOADS",e.SET_CURRENT_UPLOAD_PROGRESS="SET_CURRENT_UPLOAD_PROGRESS",e.UPLOAD_ERROR="UPLOAD_ERROR",e.SET_IS_UPLOAD_MODAL_OPEN="SET_IS_UPLOAD_MODAL_OPEN",e.SET_IS_INLINE_STATUS_DISMISSED="SET_IS_INLINE_STATUS_DISMISSED",e.ADD_NEW_FAILED_FILE="ADD_NEW_FAILED_FILE",e.CONFIRM_FSW="CONFIRM_FSW",e.ADD_FILES_TO_PLU="ADD_FILES_TO_PLU",e.ADD_DIRECTORIES_TO_PLU="ADD_DIRECTORIES_TO_PLU",e.REMOVE_FILES="REMOVE_FILES"})(t.UploaderActionType||(t.UploaderActionType={}));var i;(function(e){e.PENDING="PENDING",e.UPLOADING="UPLOADING",e.COMPLETE="COMPLETE",e.CANCELLED="CANCELLED",e.FAILED="FAILED"})(i=t.FileStatusType||(t.FileStatusType={}));var n;(function(e){e.FILE_SIZE_ERROR="FILE_SIZE_ERROR",e.HTTP_ERROR="HTTP_ERROR",e.CONNECTION_ERROR="CONNECTION_ERROR",e.OVER_QUOTA_ERROR="OVER_QUOTA_ERROR",e.LOCKED_TEAM_ERROR="LOCKED_TEAM_ERROR",e.IGNORED="IGNORED",e.EMPTY_OR_FOLDER="EMPTY_OR_FOLDER",e.PACKAGE_FILE="PACKAGE_FILE",e.GENERIC="GENERIC"})(n=t.UploadErrorType||(t.UploadErrorType={}));(function(e){e.NONE="NONE",e.BASIC_OVER_QUOTA="BASIC_OVER_QUOTA",e.BASIC_NEAR_QUOTA="BASIC_NEAR_QUOTA",e.LIMITED_TEAM_USER_OVER_QUOTA="LIMITED_TEAM_USER_OVER_QUOTA",e.LIMITED_TEAM_TSD_OVER_QUOTA="LIMITED_TEAM_TSD_OVER_QUOTA",e.LOCKED_TEAM_USER_OVER_QUOTA="LOCKED_TEAM_USER_OVER_QUOTA"})(t.OverQuotaStatusType||(t.OverQuotaStatusType={}));var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t})(s.Record({uploadId:void 0,dest:"",ns_id:null,ns_path:null,userId:null,name:"",size:0,percentUploaded:0,status:i.PENDING,errorType:n.GENERIC,errorMessage:""},"FileUpload"));t.FileUpload=a,t.INTERNAL_FILE_DATA_TRANSFER_TYPE=o.msie?"text":o.edge?"text/plain":"application/x-dropbox-file-list",t.UPLOAD_BEGIN_EVENT="dbxUploadBegin",t.UPLOAD_CANCEL_EVENT="dbxUploadCancel",t.UPLOAD_COMPLETE_EVENT="dbxUploadComplete",t.ALL_UPLOADS_COMPLETE_EVENT="dbxAllUploadsComplete",t.UPLOAD_ERROR_EVENT="dbxUploadError",t.ALL_UPLOADS_ABORTED_DUE_TO_FILE_SYSTEM_WARNINGS_EVENT="dbxAllUploadsAbortedDueToFileSystemWarnings"}),define("modules/clean/react/file_uploader/store",["require","exports","tslib","external/immutable","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/utils","modules/core/exception"],function(e,t,r,s,o,i,n,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._init=function(){this._path="/",this._hasPermissionToUploadToFolder=!0,this._user=null,this._fileList=s.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._isInlineStatusDismissed=!1,this._numSecondsLeft=0,this._confirmedFSWs=[]},t.prototype.fileList=function(){return this._fileList},t.prototype.currentUpload=function(){var e=this._currentUploadId;if(!e)return null;var t=this._fileList.get(e);return t?t:null},t.prototype.numSecondsLeft=function(){return this._numSecondsLeft},t.prototype.isUploadCancelled=function(e){var t=this._fileList.get(e);return!!t&&t.status===n.FileStatusType.CANCELLED},t.prototype.isInlineStatusDismissed=function(){return this._isInlineStatusDismissed},t.prototype.path=function(){return this._path},t.prototype.hasPermissionToUploadToFolder=function(){return this._hasPermissionToUploadToFolder},t.prototype.user=function(){return this._user},t.prototype.nextUpload=function(){return this._fileList.find(function(e){return e.status===n.FileStatusType.PENDING})},t.prototype.numDraggingFiles=function(){return this._numDraggingFiles},t.prototype.isInternalTransfer=function(){return this._isInternalTransfer},t.prototype.isUploadModalOpen=function(){return this._isUploadModalOpen},t.prototype.confirmedFSWs=function(){return this._confirmedFSWs},t.prototype.setUser=function(e){var t=e.user;this._user=t,this.emit_change()},t.prototype.setBrowsePath=function(e){var t=e.path;this._path=t,this.emit_change()},t.prototype.setPath=function(e){var t=e.path,r=e.hasPermissionToUploadToFolder,s=void 0===r||r;this._path=t,this._hasPermissionToUploadToFolder=s,this._confirmedFSWs=[],this.emit_change()},t.prototype.initializeEverything=function(e){var t=e.user,r=e.path,s=e.context;this._user=t,this._path=r,this._hasPermissionToUploadToFolder=s.isCurrentPathWriteable(),this.emit_change()},t.prototype.queueUploads=function(e){for(var t=e.files,r={},s=0,o=t;s<o.length;s++){var i=o[s];r[i.uploadId]=i}this._fileList=this._fileList.merge(r),this.emit_change()},t.prototype.startUpload=function(e){var t=e.file;l.assert(null==this.currentUpload(),"can't start an unload while one is ongoing"),l.assert(null!=t,"missing file to upload"),l.assert(this._fileList.get(t.uploadId)===t,"failed to find file in file list"),this._fileList.get(t.uploadId)&&(this._fileList=this._fileList.update(t.uploadId,function(e){return e.set("status",n.FileStatusType.UPLOADING)}),this._currentUploadId=t.uploadId),this.emit_change()},t.prototype.completeUpload=function(e){var t=e.uploadId,r=this._fileList.get(t);r&&(t===this._currentUploadId&&r.status===n.FileStatusType.UPLOADING||l.reportStack("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:r.toString(),fileListLength:this._fileList.count(),uploadId:t,currentUploadId:this._currentUploadId}}),this._fileList=this._fileList.update(t,function(e){return e.set("status",n.FileStatusType.COMPLETE)})),this._currentUploadId=null,this.emit_change()},t.prototype.cancelUploads=function(e){for(var t=e.files,r=0,s=t;r<s.length;r++){var o=s[r];this._fileList=this._fileList.update(o.uploadId,function(e){return e.status===n.FileStatusType.PENDING||e.status===n.FileStatusType.UPLOADING?e.set("status",n.FileStatusType.CANCELLED):e}),o.uploadId===this._currentUploadId&&(this._currentUploadId=null)}this.emit_change()},t.prototype.setCurrentUploadProgress=function(e){var t=e.percentComplete,r=e.numSecondsLeft,s=this._currentUploadId;s&&(this._fileList=this._fileList.update(s,function(e){return e.set("percentUploaded",t)}),this._numSecondsLeft=r),this.emit_change()},t.prototype.handleUploadError=function(e){var t=e.uploadId,r=e.errorType,s=e.errorMessage,o=this._fileList.get(t);o&&(o.uploadId!==this._currentUploadId&&l.reportStack("Error reported for file upload that is not the current upload",{exc_extra:{file:o.toString(),fileListLength:this._fileList.count(),errorType:r,errorMessage:s}}),this._fileList=this._fileList.update(o.uploadId,function(e){return e.set("status",n.FileStatusType.FAILED).set("errorType",r).set("errorMessage",s)})),this._currentUploadId=null,this.emit_change()},t.prototype.setNumDraggingFiles=function(e){var t=e.numDraggingFiles,r=e.isInternalTransfer,s=void 0!==r&&r;this._numDraggingFiles=t,this._isInternalTransfer=s,this.emit_change()},t.prototype.setIsUploadModalOpen=function(e){var t=e.isUploadModalOpen;this._isUploadModalOpen=t,this.emit_change()},t.prototype.setIsInlineStatusDismissed=function(e){var t=e.isInlineStatusDismissed;this._isInlineStatusDismissed=t,this.emit_change()},t.prototype.addNewFailedFile=function(e){var t=e.file,r=e.errorType,s=e.errorMessage;null==t.uploadId&&(t=t.set("uploadId",a.generateUploadId())),t=t.set("status",n.FileStatusType.FAILED).set("errorType",r).set("errorMessage",s),this._fileList=this._fileList.set(t.uploadId,t),this.emit_change()},t.prototype.confirmFSW=function(e){var t=this;return e.fswIds.forEach(function(e){t._confirmedFSWs.includes(e)||t._confirmedFSWs.push(e)})},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case i.BrowseActionType.INITIALIZE_EVERYTHING:this.initializeEverything(t.data);break;case i.BrowseActionType.SET_USER:case n.UploaderActionType.SET_USER:this.setUser(t.data);break;case i.BrowseActionType.SET_PATH:this.setBrowsePath(t.data);break;case n.UploaderActionType.SET_PATH:this.setPath(t.data);break;case n.UploaderActionType.QUEUE_UPLOADS:this.queueUploads(t.data);break;case n.UploaderActionType.START_UPLOAD:this.startUpload(t.data);break;case n.UploaderActionType.COMPLETE_UPLOAD:this.completeUpload(t.data);break;case n.UploaderActionType.CANCEL_UPLOADS:this.cancelUploads(t.data);break;case n.UploaderActionType.SET_CURRENT_UPLOAD_PROGRESS:this.setCurrentUploadProgress(t.data);break;case n.UploaderActionType.UPLOAD_ERROR:this.handleUploadError(t.data);break;case n.UploaderActionType.SET_NUM_DRAGGING_FILES:this.setNumDraggingFiles(t.data);break;case n.UploaderActionType.SET_IS_UPLOAD_MODAL_OPEN:this.setIsUploadModalOpen(t.data);break;case n.UploaderActionType.SET_IS_INLINE_STATUS_DISMISSED:this.setIsInlineStatusDismissed(t.data);break;case n.UploaderActionType.ADD_NEW_FAILED_FILE:this.addNewFailedFile(t.data);break;case n.UploaderActionType.CONFIRM_FSW:this.confirmFSW(t.data)}},t})(o);t.UploaderStore=new c}),define("modules/clean/react/file_uploader/utils",["require","exports","modules/clean/base64","modules/clean/react/file_uploader/constants"],function(e,t,r,s){"use strict";function o(){for(var e="",t=0;t<16;++t)e+=String.fromCharCode(Math.floor(256*Math.random()));var s=r.encode(e);return s=s.replace(/\+/g,"-"),s=s.replace(/\//g,"_"),s=s.replace(/\=*$/,"")}function i(e){var t=e.fileList,r=e.uploadId;return!!t.find(function(e){return e.status in[s.FileStatusType.PENDING,s.FileStatusType.UPLOADING]&&e.uploadId!==r})}function n(e,t){var r=0;return e.forEach(function(e){t.indexOf(e.status)!==-1&&(r+=e.size)}),r}Object.defineProperty(t,"__esModule",{value:!0}),t.generateUploadId=o,t.checkIfThereArePendingUploadsWithoutCurrent=i,t.calculateSizeOfUploads=n}),define("modules/clean/react/fileops_actions",["require","exports","tslib","modules/core/notify","modules/core/i18n","modules/clean/react/async_file_modal_controller","modules/clean/file_operations/notifications","modules/clean/react/browse/api"],function(e,t,r,s,o,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.copyFiles=function(e){var s=e.files,l=e.newPath,c=e.checkFSWs,d=e.onSuccess,u=e.onRequestNotSent,p=e.onUndo,h=e.user,f=e.dataApi;!(void 0===f?a:f).copyFiles({files:s,newPath:l,checkFSWs:c,userId:h.id,onSuccess:function(a){var c=a.newFiles,u=a.changesets,f=a.rollbackHints,m=a.failureDetails;if(m){var _=function(){t.copyFiles(r.__assign({},e,{checkFSWs:!1}))};i.showFileSystemWarningsModal({fsws:m,onFinalAccept:_,confirmText:o._("Copy")})}else d&&d(c),n.notifyCopySuccess(s.length,h,u,l,f,function(){p&&p()})}})&&u&&u()},t.moveFiles=function(e){var l=e.path,c=e.files,d=e.newPath,u=e.checkFSWs,p=e.onSuccess,h=e.onRequestNotSent,f=e.onUndo,m=e.user,_=e.dataApi,S=void 0===_?a:_,g=function(s){var a=s.newFiles,l=s.changesets,u=s.rollbackHints,h=s.failureDetails;if(h){var _=function(){t.moveFiles(r.__assign({},e,{checkFSWs:!1}))};i.showFileSystemWarningsModal({fsws:h,onFinalAccept:_,confirmText:o._("Move")})}else n.notifyMoveSuccess(c.length,m,l,d,u,function(){f&&f()}),p&&p(a)},w=function(e){"This will result in losing ownership of these folders."===e&&(s.clear(),i.showConfirmOwnershipTransferModal(function(){S.moveFiles({path:l,files:c,newPath:d,userId:m.id,onSuccess:g,allowOwnershipTransfer:!0})}))};!S.moveFiles({path:l,files:c,newPath:d,checkFSWs:u,userId:m.id,onSuccess:g,onError:w,allowOwnershipTransfer:!1})&&h&&h()}}),define("modules/clean/search/api",["require","exports","modules/clean/ajax","modules/clean/analytics","modules/clean/react/browse/models","modules/clean/search/search_helpers","modules/clean/search/constants","modules/clean/search/types","modules/clean/search/models","modules/clean/search/api_helpers"],function(e,t,r,s,o,i,n,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(){function e(){this._activeRequest=null}return e.prototype.abortPreviousLoading=function(){null!=this._activeRequest&&this._activeRequest.abort()},e.prototype.loadResults=function(e){var t=e.user,r=e.path,s=e.query,o=e.start,a=e.maxResults,l=e.searchSessionID,d=e.nsid,u=e.fileNameOnly,p=e.loadDeleted,h=e.showPaperResults,f=e.isDropdown,m=e.isAdminConsole,_=e.webTimer,S=e.onSuccess,g=e.onError,w=c.getCurrentTimezoneOffset(),v={query:s,search_token:i.getSearchCsrfToken(),fq_path:r,ns_id:d,filename_only:!!u,max_results:a,deleted:!!p,start:o,show_paper_results:!!h,is_dropdown:!!f,is_admin_console:!!m,show_unmounted_results:!0,timezone_offset:w};this._fetchResults({requestData:v,user:t,searchSessionID:l,url:n.FULLTEXT_SEARCH_ENDPOINT,onSuccess:S,onError:g,webTimer:_})},e.prototype._extractSearchResultsList=function(e){for(var t=[],r=0,s=e;r<s.length;r++){var i=s[r];switch(i.search_result_type){case a.SearchResultTypes.FILE:t.push(o.File.fromServerObject(i));break;case a.SearchResultTypes.PAPER:t.push(o.Paper.fromServerObject(i));break;case a.SearchResultTypes.PAPER_FOLDER:t.push(o.PaperFolder.fromServerObject(i))}}return t},e.prototype._getSearchType=function(e){return e.is_dropdown?"dropdown":e.deleted?"full_page_deleted":"full_page"},e.prototype.loadPartialResults=function(e){var t=e.user,r=e.maxResults,s=e.start,o=e.path,a=e.query,l=e.searchSessionID,c=e.webTimer,d=e.onSuccess,u=e.onError,p={query:a,search_token:i.getSearchCsrfToken(),fq_path:o,start:s,max_results:r,show_paper_results:!0};this._fetchResults({requestData:p,user:t,searchSessionID:l,url:n.PARTIAL_SEARCH_ENDPOINT,onSuccess:d,onError:u,webTimer:c})},e.prototype._fetchResults=function(e){var t=this,o=e.requestData,i=e.user,n=e.searchSessionID,a=e.url,c=e.onSuccess,d=e.onError,u=e.webTimer;null!=this._activeRequest&&this._activeRequest.abort();var p={path_scoped:"/"!==o.fq_path,search_type:this._getSearchType(o),query_string:o.query,start:o.start,search_session_id:n,timezone_offset:o.timezone_offset};s.SearchClientActivityLogger.log("query_started",i.id,p);var h=(new Date).getTime();this._activeRequest=r.WebRequest({url:a,data:o,dataType:"json",subject_user:i,success:function(e,r,a){var d=l.extractBrowseContext(e),f=e.search_results,m=a.getResponseHeader("x-dropbox-request-id");f.forEach(function(e){return e.request_id=m});var _=!!f.find(function(e){return e.used_spellcorrect}),S=t._extractSearchResultsList(f);c({context:d,searchResults:S,deleted:!!o.deleted});var g=s.SearchClientActivityLogger.create_search_log_dict(p,_,m,h,o.query,S.length,null,n);s.SearchClientActivityLogger.log("query_completed",i.id,g),u&&u.end(m?m:void 0)},error:function(e,t,r){"abort"!==t&&"function"==typeof d&&d(r);var a=e.getResponseHeader("x-dropbox-request-id"),l=s.SearchClientActivityLogger.create_search_log_dict(p,null,a,h,o.query,null,t,n);s.SearchClientActivityLogger.log("query_failed",i.id,l),u&&u.abort()},complete:function(){this._activeRequest=null}})},e.prototype.fetchAdditionalFileMetadata=function(e){var t=e.searchResults,s=e.user,i=e.onSuccess,a=e.onError,l=t.filter(function(e){return e instanceof o.File}),c=l.map(function(e){return[e.ns_id,e.sjid]});c.length>0?r.WebRequest({url:n.SEARCH_METADATA_ENDPOINT,data:{nsid_sjid_pairs:JSON.stringify(c)},dataType:"json",subject_user:s,success:function(e,t,r){for(var s=[],n=0,a=e.search_results;n<a.length;n++){var l=a[n];s.push(o.File.fromServerObject(l))}i(s)},error:function(e,t,r){"abort"!==t&&"function"==typeof a&&a(r)}}):i(t)},e})();t.SearchApiClient=d,t.searchApiClient=new d}),define("modules/clean/search/emoji_utils",["require","exports"],function(e,t){"use strict";function r(e){var t=s();t.lastIndex=0;var r=t.exec(e);if(r&&0===r.index){var o=r[0];if("‍"===e[o.length])return"";var i=t.exec(e);return i&&i.index===o.length?"":o||""}return""}function s(){return o||(o=/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g),o}Object.defineProperty(t,"__esModule",{value:!0});var o;t.getFirstEmojiFromTitle=r}),define("modules/clean/search/paper_formatting_utils",["require","exports","modules/clean/search/emoji_utils","external/react","modules/clean/search/search_highlights","external/spectrum/icon_content"],function(e,t,r,s,o,i){"use strict";function n(e,t,s){var i=e.title,n=e.highlight_spans,l=e.title_highlights,c=n&&n.length>0,d=r.getFirstEmojiFromTitle(i);if(d)if(i=i.substr(d.length),c){var u={string:n[0].string.substr(d.length),is_highlighted:n[0].is_highlighted};n=[u].concat(n.slice(1))}else if(l){var p=d.length/2;l=l.slice().map(function(e){return{pos:e.pos-p,len:e.string.length,string:e.string}})}var h;return h=c?o.highlightReactFromHighlightSpans(i,n):o.highlightMatchReact(i,l),{title:i,highlightedTitle:h,icon:a(d,d?s:t)}}function a(e,t){return e?s.createElement("div",{className:"mc-media-cell-icon"},s.createElement(i.IconContent,{name:"blank-small"}),s.createElement("span",{className:t},e)):s.createElement(i.IconContent,{name:"paper-small",className:t})}Object.defineProperty(t,"__esModule",{value:!0}),t.getPaperDocTitleParts=n}),define("modules/clean/search/search_results/actions",["require","exports","modules/clean/search/constants","modules/core/i18n","modules/clean/search/search_results/dispatcher","modules/clean/search/api","modules/clean/search/search_results/store","modules/clean/search/constants"],function(e,t,r,s,o,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(){function e(e,t){void 0===e&&(e=i.searchApiClient),void 0===t&&(t=n.getSearchResultsStore()),this._searchApi=e,this._searchResultsStore=t}return e.prototype.runSearch=function(e){var t=this,s=e.user,i=e.path,n=e.query,l=e.qsid,c=e.webTimer,d=e.logOnceFetchedDataRequiredForTTI,u=e.fetchPartialSearchResult;o.SearchResultsDispatcher.dispatch({type:r.START_SEARCH_ACTION,data:{query:n,qsid:l}});var p=this._searchResultsStore.searchSessionID(),h=a.MaxResults.MAX_SEARCH_RESULTS;u?this._searchApi.loadPartialResults({user:s,path:i,query:n,start:0,searchSessionID:p,webTimer:c,maxResults:h,onSuccess:function(e){var r=e.searchResults,o=e.context;d(),t._setSearchResults({searchResults:r,context:o}),t._loadDeletedResults({path:i,user:s}),t._searchApi.fetchAdditionalFileMetadata({searchResults:r,user:s,onSuccess:function(e){t._setFullSearchResults({searchResults:e,context:o})}})}}):this._searchApi.loadResults({user:s,path:i,query:n,start:0,maxResults:h,showPaperResults:!0,searchSessionID:p,webTimer:c,onSuccess:function(e){var r=e.searchResults,o=e.context;d(),t._setSearchResults({searchResults:r,context:o}),t._loadDeletedResults({path:i,user:s})}})},e.prototype.fetchCompleteSearchResultSRP=function(e){var t=e.searchApiClient,r=e.searchResult,o=e.user,i=e.onSuccess,a=e.onError,l=n.getSearchResultsStore().fullSearchResults().get(r.fq_path,null);l?i(l):t.fetchAdditionalFileMetadata({searchResults:[r],user:o,onSuccess:function(e){if(e.length>0)i(e[0]);else if(a){var t=s._("There was a problem completing this request.");a(t)}},onError:a})},e.prototype.loadMoreResults=function(e){var t,s=this,i=e.path,n=e.user,l=e.fetchPartialSearchResult;if(this._searchResultsStore.loadingState()===r.SearchLoadingState.LOADED){if(this._searchResultsStore.hasMoreResults())t=!1;else{if(!this._searchResultsStore.hasMoreResults(!0))return;t=!0}o.SearchResultsDispatcher.dispatch({type:r.CONTINUE_SEARCH_ACTION,data:{didLoadDeletedResults:t}});var c=t?this._searchResultsStore.numDeletedResults():this._searchResultsStore.searchResults().size;l&&!t?this._searchApi.loadPartialResults({user:n,path:i,query:this._searchResultsStore.latestQuery(),start:c,searchSessionID:this._searchResultsStore.searchSessionID(),maxResults:a.MaxResults.MAX_SEARCH_RESULTS,onSuccess:function(e){var t=e.searchResults,r=e.context;s._appendSearchResults({searchResults:t,context:r,deleted:!1}),s._searchApi.fetchAdditionalFileMetadata({searchResults:t,user:n,onSuccess:function(e){s._setFullSearchResults({searchResults:e,context:r})}}),s._loadDeletedResults({path:i,user:n})}}):this._searchApi.loadResults({user:n,path:i,query:this._searchResultsStore.latestQuery(),fileNameOnly:!1,showPaperResults:!0,isDropdown:!1,isAdminConsole:!1,loadDeleted:t,start:c,maxResults:a.MaxResults.MAX_SEARCH_RESULTS,searchSessionID:this._searchResultsStore.searchSessionID(),onSuccess:function(e){var t=e.searchResults,r=e.context,o=e.deleted;s._appendSearchResults({searchResults:t,context:r,deleted:o}),s._loadDeletedResults({path:i,user:n})}})}},e.prototype._setSearchResults=function(e){var t=e.searchResults,s=e.context;o.SearchResultsDispatcher.dispatch({type:r.SET_SEARCH_RESULTS_ACTION,data:{searchResults:t,context:s}})},e.prototype._setFullSearchResults=function(e){var t=e.searchResults,s=e.context;o.SearchResultsDispatcher.dispatch({type:r.SET_FULL_SEARCH_RESULTS_ACTION,data:{searchResults:t,context:s}})},e.prototype._appendSearchResults=function(e){var t=e.searchResults,s=e.context,i=e.deleted;o.SearchResultsDispatcher.dispatch({type:r.APPEND_SEARCH_RESULTS_ACTION,data:{searchResults:t,context:s,deleted:i}})},e.prototype._loadDeletedResults=function(e){var t=e.path,r=e.user;this._searchResultsStore.hasMoreResults()||this._searchResultsStore.didLoadDeletedResults()||this.loadMoreResults({path:t,user:r})},e.prototype.setSearchSelection=function(e){var t=e.selection;o.SearchResultsDispatcher.dispatch({type:r.SET_SEARCH_SELECTION_ACTION,data:{selection:t}})},e.prototype.removeSearchResults=function(e){var t=e.fq_paths,s=t.map(function(e){return{before:e,after:null}});o.SearchResultsDispatcher.dispatch({type:r.CHANGE_FILES_ACTION,data:{fileDeltas:s}})},e.prototype.clearSearch=function(){o.SearchResultsDispatcher.dispatch({type:r.CLEAR_SEARCH_ACTION})},e})();t.SearchResultsActions=l,t.searchResultsActions=new l}),define("modules/clean/search/search_results/controller",["require","exports","tslib","external/react","external/react-dom","external/lodash","modules/clean/react/async_file_modal_controller","modules/clean/react/css","modules/clean/search/search_results/actions","modules/clean/search/search_results/store","modules/clean/search/search_results/view","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/search/api"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e._onSearchResultsStoreChanged=function(){e.setState(e._getStateFromSearchResultsStore()),e.deferredCheckForMissingStarredData&&e.deferredCheckForMissingStarredData()},e._onBrowseStoreChanged=function(){e.setState(e._getStateFromBrowseStore())},e._handleScroll=function(){if(o.findDOMNode(e).getBoundingClientRect().bottom<=window.innerHeight){var t=e.props.searchResultsExperiments&&e.props.searchResultsExperiments.expFetchPartialSearchResult;l.searchResultsActions.loadMoreResults({path:e.props.path,user:e.props.user,fetchPartialSearchResult:t})}},e._handleSelectionChange=function(e){l.searchResultsActions.setSearchSelection({selection:e})},e._handleDelete=function(t){n.showDelete(e.props.user,t,e.state.context,function(){})},e._handleRestore=function(t){n.showRestore(e.props.user,t,function(){})},e._handlePermanentDelete=function(t){var r=function(){l.searchResultsActions.removeSearchResults({fq_paths:t.map(function(e){return e.fq_path})})};n.showPermanentlyDelete(e.props.user,t,r)},e._onNavigateToFileOrFolder=function(t){
e.props.searchResultsExperiments&&e.props.searchResultsExperiments.expFetchPartialSearchResult?l.searchResultsActions.fetchCompleteSearchResultSRP({searchApiClient:h.searchApiClient,searchResult:t,user:e.props.user,onSuccess:e.props.onNavigateToFileOrFolder}):e.props.onNavigateToFileOrFolder(t)},e._actionHandlers={onDelete:e._handleDelete,onRestore:e._handleRestore,onPermanentDelete:e._handlePermanentDelete,onShowRename:e.props.actionHandlers.onShowRename},e}return r.__extends(a,t),a.prototype.componentWillMount=function(){this.state=this._getStateFromStores()},a.prototype.componentWillReceiveProps=function(e){e.arePostTTIModulesLoaded&&!this.props.arePostTTIModulesLoaded&&this.enableStarring()},a.prototype.componentDidMount=function(){c.getSearchResultsStore().add_change_listener(this._onSearchResultsStoreChanged),p.getBrowseStore().add_change_listener(this._onBrowseStoreChanged),this.props.arePostTTIModulesLoaded&&this.enableStarring(),this.setState(this._getStateFromStores())},a.prototype.componentWillUnmount=function(){c.getSearchResultsStore().remove_change_listener(this._onSearchResultsStoreChanged),p.getBrowseStore().remove_change_listener(this._onBrowseStoreChanged)},a.prototype.enableStarring=function(){var t=this,r=e("modules/clean/react/starred/browse_exports").checkForMissingStarredData;this.deferredCheckForMissingStarredData=function(){i.defer(function(){var e=[];c.getSearchResultsStore().searchResults().forEach(function(t){t instanceof u.File&&e.push(t)}),r({files:e,user:t.props.user})})},this.deferredCheckForMissingStarredData()},a.prototype._getStateFromStores=function(){return r.__assign({},this._getStateFromBrowseStore(),this._getStateFromSearchResultsStore())},a.prototype._getStateFromBrowseStore=function(){var e=p.getBrowseStore();return{viewType:e.viewType(),tilesPerRow:e.tilesPerRow()}},a.prototype._getStateFromSearchResultsStore=function(){var e=c.getSearchResultsStore();return{context:e.browseContext(),hasMoreResults:e.hasMoreResults(),loadingState:e.loadingState(),latestQuery:e.latestQuery(),searchSessionId:e.searchSessionID(),fullSearchResults:e.fullSearchResults(),searchResults:e.searchResults(),selection:e.selection(),selectedFiles:e.selectedFiles()}},a.prototype.render=function(){var e=this.props,t=e.searchResultsExperiments,r=e.maestroSearchBarProps,o=e.onSearch,n=e.setFileUploaderPath,a=e.path,l=e.user,c=e.handleComponentTTI,u=e.ensureFileViewerClosedIfNotPreviewing,p=e.getIsFileJumping,h=e.isFileViewerShown,f=e.fileRename,m=e.arePostTTIModulesLoaded,_=e.getFileActions,S=this.state,g=S.context,w=S.hasMoreResults,v=S.loadingState,T=S.latestQuery,b=S.searchSessionId,F=S.searchResults,E=S.selection,y=S.selectedFiles,C=S.viewType,R=S.tilesPerRow;return s.createElement(d.SearchResultsView,{searchResultsExperiments:t,maestroSearchBarProps:r,onSearch:o,onScroll:i.throttle(this._handleScroll,200),setFileUploaderPath:n,onSelectionChange:this._handleSelectionChange,path:a,user:l,actionHandlers:this._actionHandlers,handleComponentTTI:c,ensureFileViewerClosedIfNotPreviewing:u,getIsFileJumping:p,isFileViewerShown:h,fileRename:f,arePostTTIModulesLoaded:m,getFileActions:_,onNavigateToFileOrFolder:this._onNavigateToFileOrFolder,context:g,hasMoreResults:w,loadingState:v,latestQuery:T,searchSessionId:b,searchResults:F,selection:E,selectedFiles:y,viewType:C,tilesPerRow:R})},a})(s.Component);t.SearchResultsController=a(f,["/static/css/browse/browse-vflCop1k6.css","/static/css/search/search_results-vflL9DwI8.css","/static/css/scooter/scooter-scoped-vflhQ6850.css"])}),define("modules/clean/search/search_results/dispatcher",["require","exports","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/search/search_results/store"],function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResultsDispatcher={dispatch:function(e){r.assert(o.searchResultsStoreInstantiated(),"Must call getSearchResultsStore() before a dispatch"),s.Dispatcher.dispatch(e)}}}),define("modules/clean/search/search_results/log_helper",["require","exports","modules/clean/search/logger","modules/clean/search/search_results/store","modules/clean/search/search_bar/experiments","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/action_creators"],function(e,t,r,s,o,i,n){"use strict";function a(e){var t=e.result,a=e.user,l=e.action_type,c=e.view_type,d=s.getSearchResultsStore().searchSessionID();if(o.searchRecentHistoryEnabled(o.getSearchBarExperiments())){var u=s.getSearchResultsStore().latestQuery(),p={rawQuery:u,normalizedQuery:u};i.getStoreForSearchBar().dispatch(n.addQueryToHistory({user:a,query:p,searchSessionId:d,requestId:t.request_id||""}))}r.logSearchAction({searchSessionId:d,result:t,user:a,action_type:l,viewport:"full-view",view_type:c})}Object.defineProperty(t,"__esModule",{value:!0}),t.recordSearchResultsAction=a}),define("modules/clean/search/search_results/search_filter_sidebar",["require","exports","tslib","external/react","modules/core/i18n","external/spectrum/tertiary_link","modules/clean/react/async_folder_selector_modal","modules/clean/react/path_filter_button"],function(e,t,r,s,o,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(t){var r=e.call(this,t)||this;return r.showFolderFilterModal=function(){var e=r.props,t=e.user,s=e.path,i=e.onPathChanged;n.show({primaryAction:o._("Select"),secondaryAction:o._("Cancel"),title:o._("Select a folder"),ariaLabel:o._("Folder selector"),user:t,initialFolderSelection:s,onFolderSelected:i})},r.resetFilters=function(){r.props.onPathChanged("/")},r.renderResetButton=function(){return s.createElement("div",{className:"filter-item__reset-row"},s.createElement(i.TertiaryLink,{onClick:r.resetFilters},o._("Reset filters")))},r.renderPathFilter=function(){var e=r.props.path;return s.createElement("div",{className:"filter-item__row"},s.createElement("div",{className:"filter-item__column"},s.createElement("div",{className:"filter-item__desc"},o._("Folder")),s.createElement(a.PathFilterButton,{path:e,defaultText:o._("All folders"),dropdownClasses:"filter-item__filter",onClick:r.showFolderFilterModal})))},r}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.path;return s.createElement("div",{className:"filter-item"},this.renderPathFilter(),"/"!==e&&""!==e&&this.renderResetButton())},t})(s.Component);t.SearchFilterSidebar=l}),define("modules/clean/search/search_results/store",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/selection","modules/clean/search/constants","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/search/store_helpers"],function(e,t,r,s,o,i,n,a,l,c,d){"use strict";function u(){return null===f&&(f=new h),f}function p(){return null!==f}Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var r=e.call(this,t)||this;return r._resetSearchResults(),r}return r.__extends(t,e),t.prototype._resetSearchResults=function(){this._browseContext=void 0,this._rawQuery="",this._latestQuery="",this._loadingState=a.SearchLoadingState.LOADED,this._fullSearchResults=s.OrderedMap(),this._searchResults=s.List(),this._selection=void 0,this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1,this._tilesPerRow=1},t.prototype.rawQuery=function(){return this._rawQuery},t.prototype.searchSessionID=function(){return this._searchSessionID},t.prototype.browseContext=function(){return this._browseContext||(this._browseContext=new c.BrowseContext)},t.prototype.latestQuery=function(){return this._latestQuery},t.prototype.loadingState=function(){return this._loadingState},t.prototype.searchResults=function(){return this._searchResults},t.prototype.fullSearchResults=function(){return this._fullSearchResults},t.prototype.tilesPerRow=function(){return this._tilesPerRow},t.prototype.hasMoreResults=function(e){return void 0===e&&(e=!1),this._hasMoreLiveResults||e&&this._hasMoreDeletedResults},t.prototype.numDeletedResults=function(){return this._numDeletedResults},t.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},t.prototype.selection=function(){return this._selection||(this._selection=n.createSelection())},t.prototype.selectedFiles=function(){var e=this,t=this._searchResults.filter(function(t){return t instanceof c.File&&e.selection().selected.has(t.fq_path)});return s.OrderedMap(t.map(function(e){return[e.fq_path,e]}))},t.prototype._setRawQuery=function(e,t){t?this._searchSessionID=t:d.shouldStartNewSearchSession(this._rawQuery,e)&&(this._searchSessionID=d.generateRandomID()),this._rawQuery=e},t.prototype._setSearchQuery=function(e){var t=e.query;this._setRawQuery(t),this.emit_change()},t.prototype._startSearch=function(e){var t=e.query,r=e.qsid;this._resetSearchResults(),this._setRawQuery(t,r),this._latestQuery=d.normalize(t),this._loadingState=a.SearchLoadingState.LOADING_FIRST_PAGE,this.emit_change()},t.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context;this._setSearchResultsInternal(t),this._loadingState=a.SearchLoadingState.LOADED,this._browseContext=r,this._updateMoreResults(t),this.emit_change()},t.prototype._setFullSearchResults=function(e){for(var t=e.searchResults,r=e.context,s=0,o=t;s<o.length;s++){var i=o[s];i instanceof c.File&&(this._fullSearchResults=this._fullSearchResults.set(i.fq_path,i))}this._loadingState=a.SearchLoadingState.LOADED,this._browseContext=r,this._updateMoreResults(t),this.emit_change()},t.prototype._setSearchResultsInternal=function(e){this._searchResults=s.List(e)},t.prototype._continueSearch=function(e){e.didLoadDeletedResults&&(this._didLoadDeletedResults=!0),this._loadingState=a.SearchLoadingState.LOADING_ADDITIONAL_PAGE,this.emit_change()},t.prototype._appendSearchResults=function(e){var t=e.deleted,r=e.searchResults,s=e.context;t&&(this._numDeletedResults+=r.length),this._searchResults=this._searchResults.concat(r),this._loadingState=a.SearchLoadingState.LOADED,this._browseContext=s,this._updateMoreResults(r),this.emit_change()},t.prototype._clearSearch=function(){this._resetSearchResults(),this.emit_change()},t.prototype._updateMoreResults=function(e){var t=e.length===a.MaxResults.MAX_SEARCH_RESULTS;this._hasMoreLiveResults?this._hasMoreLiveResults=t:this._hasMoreDeletedResults&&(this._hasMoreDeletedResults=t)},t.prototype._setSearchSelection=function(e){var t=e.selection;this._selection=t,this.emit_change()},t.prototype._setTilesPerRow=function(e){var t=e.tilesPerRow;this._tilesPerRow=t,this.emit_change()},t.prototype._applyFileDeltas=function(e){var t=e.fileDeltas;if(t){for(var r=function(e,t){var r=void 0;!e&&t?s._searchResults=s._searchResults.push(t):e&&!t?(r=s._searchResults.findIndex(function(t){return t instanceof c.File&&o.paths_are_equal(t.fq_path,e)}),s._searchResults=s._searchResults.delete(r)):e&&t&&(r=s._searchResults.findIndex(function(t){return t instanceof c.File&&o.paths_are_equal(t.fq_path,e)}),s._searchResults=r>-1?s._searchResults.set(r,t):s._searchResults.push(t))},s=this,i=0,n=t;i<n.length;i++){var a=n[i];r(a.before,a.after)}this.emit_change()}},t.prototype._updateContext=function(e){this._browseContext=e.context},t.prototype._new_payload=function(e){switch(e.action.type){case a.START_SEARCH_ACTION:this._startSearch(e.action.data);break;case a.SET_SEARCH_RESULTS_ACTION:this._setSearchResults(e.action.data);break;case a.CONTINUE_SEARCH_ACTION:this._continueSearch(e.action.data);break;case a.APPEND_SEARCH_RESULTS_ACTION:this._appendSearchResults(e.action.data);break;case a.SET_FULL_SEARCH_RESULTS_ACTION:this._setFullSearchResults(e.action.data);break;case a.SET_SEARCH_SELECTION_ACTION:this._setSearchSelection(e.action.data);break;case a.CHANGE_FILES_ACTION:this._applyFileDeltas(e.action.data);break;case a.CLEAR_SEARCH_ACTION:this._clearSearch();break;case l.BrowseActionType.SET_URL_PREFIX:this._clearSearch();break;case l.BrowseActionType.LOAD_PATH:this._updateContext(e.action.data);break;case l.BrowseActionType.SET_TILES_PER_ROW:this._setTilesPerRow(e.action.data)}},t})(i);t.SearchResultsStore=h;var f=null;t.getSearchResultsStore=u,t.searchResultsStoreInstantiated=p}),define("modules/clean/search/search_results/view",["require","exports","tslib","external/lodash","external/react","modules/clean/browse_interface","modules/clean/history","modules/clean/react/browse/util","modules/clean/react/maestro/header","modules/clean/react/maestro/layout","modules/clean/react/maestro/file_list_empty_folder_table","modules/clean/filepath","modules/core/i18n","modules/core/uri","modules/clean/react/browse/constants","modules/clean/react/browse/files_view/constants","modules/clean/react/browse/files_view/controller","modules/clean/react/app_actions_view","modules/clean/search/types","modules/clean/search/constants","modules/clean/search/search_results/search_filter_sidebar"],function(e,t,r,s,o,i,n,a,l,c,d,u,p,h,f,m,_,S,g,w,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var T=(function(t){function T(r){var s=t.call(this,r)||this;return s._ensureFileViewerClosedIfNotPreviewing=function(){var e=n.deconstruct_url().qargs;s.props.ensureFileViewerClosedIfNotPreviewing(e)},s._handleFullSearchOnClick=function(e){e.preventDefault(),s.props.onSearch(s.props.latestQuery,"/")},s._handleSearchFilterPathChanged=function(e){s.props.onSearch(s.props.latestQuery,e)},s._handleEmptyFolderViewTTI=function(){s.props.handleComponentTTI("FilesViewController")},s._renderEmptyFolderView=function(){var e=u.paths_are_equal(s.props.path,"/"),t=p._("No results found"),r=e?p._("Please update your search and try again"):p._("Search all of my Dropbox instead"),i=e?void 0:s._getFullSearchLink(),n=e?void 0:s._handleFullSearchOnClick;return o.createElement(d.EmptyFolderTable,{title:t,subtitle:r,subtitleLink:i,subtitleOnClick:n,onTTI:s._handleEmptyFolderViewTTI})},s._maybeRenderMaestroActionMenu=function(t){var r=s.props,i=r.selectedFiles,n=r.arePostTTIModulesLoaded,l=r.user,c=r.path,d=r.context,u=r.actionHandlers,h=r.searchResultsExperiments;if(i.size){var f=[];if(n&&(f=e("modules/clean/react/browse/file_actions").getActionsForFileCollection({files:i,context:d,user:l,actionHandlers:u,isSearchMode:!0,arePostTTIModulesLoaded:n})),f.length>0){var m={displayName:f[0].label,handleClick:f[0].performAction,iconName:f[0].iconName,className:f[0].className},_=f.slice(1).map(function(e){return{displayName:e.label,handleClick:e.performAction,iconName:e.iconName,className:e.className,disabled:e.disabled}}),w=a.getSelectedFilesText(i,d);return o.createElement(S.AppActionsView,{headerText:w,popoverTriggerLabel:p._("Actions"),primaryMenuItem:m,secondaryMenuItems:_,responsive:t})}}return h&&h.expScopeFilterRightRail===g.ScopeFilterRightRailVariants.ON?o.createElement(v.SearchFilterSidebar,{user:l,path:c,onPathChanged:s._handleSearchFilterPathChanged}):o.createElement("div",null)},s._renderMaestroAppContent=function(e){return o.createElement("div",{className:"search-results"},s._renderSearchResultItems(e))},s.state={},s}return r.__extends(T,t),T.prototype.componentWillMount=function(){n.add_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},T.prototype.componentDidMount=function(){window.addEventListener("scroll",this.props.onScroll)},T.prototype.componentWillUnmount=function(){window.removeEventListener("scroll",this.props.onScroll),n.remove_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},T.prototype._getFullSearchLink=function(){var e="work"===this.props.user.role?i.WORK_ROOT:i.PERSONAL_ROOT;return h.parse("/search"+e).setQuery({path:"/",query:this.props.latestQuery,qsid:this.props.searchSessionId}).toString()},T.prototype._searchResultsTitle=function(){return u.paths_are_equal(this.props.path,"/")?p.ungettext("%(num_results)d result in files, folders, Paper docs, and content.","%(num_results)d results in files, folders, Paper docs, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size}):p.ungettext("%(num_results)d result in files, folders, and content.","%(num_results)d results in files, folders, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size})},T.prototype._getLoadingState=function(){return this.props.loadingState===w.SearchLoadingState.LOADING_FIRST_PAGE?f.LoadingState.LOADING_FIRST_PAGE:this.props.loadingState===w.SearchLoadingState.LOADING_ADDITIONAL_PAGE?f.LoadingState.LOADING_REMAINING_PAGES:f.LoadingState.LOADED},T.prototype._renderSearchResultItems=function(e){return o.createElement(_.FilesViewController,{getFileActions:this.props.getFileActions,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,actionHandlers:this.props.actionHandlers,context:this.props.context,customEmptyFolderView:this._renderEmptyFolderView,createNewFolderState:f.NewFolderCreationState.CREATE_FOLDER_INACTIVE,fileRename:this.props.fileRename,items:this.props.searchResults,getIsFileJumping:this.props.getIsFileJumping,isFileViewerShown:this.props.isFileViewerShown,isSearchMode:!0,arePostTTIModulesLoaded:this.props.arePostTTIModulesLoaded,isTextSelectable:!1,loadingState:this._getLoadingState(),onComponentTTI:this.props.handleComponentTTI,onSelectionChange:this.props.onSelectionChange,onSortChange:s.noop,path:this.props.path,selectedFiles:this.props.selectedFiles,selection:this.props.selection,setFileUploaderPath:this.props.setFileUploaderPath,showFileUploaderModal:s.noop,user:this.props.user,viewType:this.props.viewType,totalNumFiles:this.props.searchResults.size,responsive:e,columns:this._generateColumns(),tilesPerRow:this.props.tilesPerRow})},T.prototype._generateColumns=function(){var e=this;return m.SEARCH_LIST_VIEW_COLUMNS.map(function(t,s){return r.__assign({},t,{label:0===s?e._searchResultsTitle():t.label})})},T.prototype.render=function(){var e=this.props,t=e.user,r=e.maestroSearchBarProps;return o.createElement(c.MaestroChrome,{user:t,titleRegion:o.createElement(l.MaestroHeaderTitle,null,p._("Search results")),embeddedAppRegion:this._renderMaestroAppContent,actionSidebarRegion:this._maybeRenderMaestroActionMenu,searchBarProps:r})},T})(o.Component);t.SearchResultsView=T}),define("modules/core/framework_args",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FRAMEWORK_ARGS=["country_override","cProfile","public_mode_override","stormcrow_override","stormcrow_override_data_field","stormcrow_override_population","stormcrow_override_ttl","stormcrow_panel","uncompressed_js","use_packages"]});
//# sourceMappingURL=pkg-browse.min.js-vflsYRUiF.map