define("modules/clean/comments/comment_dom",["require","exports","external/react","modules/clean/referrer_cleansing_redirect"],function(e,t,n,r){"use strict";function i(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=null);var o=n.DOM,s=/@\[(?:\s*(?:dbid:)?[^:\[\]]+):(?:[^\[]+)\]/i,c="(?:[-a-zA-Z0-9@:%_+~#=]+[.])+[a-z]{2,6}(?:[:./?#][-a-zA-Z0-9@%_+~&=]+)*(?=[^a-zA-Z0-9_]|$)",l=new RegExp("http://"+c+"|https://"+c+"|www."+c+"|"+c,"i"),d=[s,/\n/];t&&d.push(l);for(var u=RegExp("("+Array.from(d).map(function(e){return e.source}).join("|")+")","gi"),h=[],m=0,p=Array.from(e.split(u));m<p.length;m++){var _=p[m];if(_)if(_.match(s)){var f=_.match(/@\[(\s*(?:dbid:)?[^:\[\]]+):([^\[]+)\]/i),g=f[2].trim();h.push(o.span({className:"comment-mention"},g))}else if(Array.from(d).includes(l)&&_.match(l)){var v=_;v.indexOf("http://")<0&&v.indexOf("https://")<0&&(v="http://"+v);try{v=r.get_redirect_uri(v),h.push(o.a({href:v,target:"_blank",rel:"noopener noreferrer"},_))}catch(e){h.push(_)}}else _.match(/\n/)?h.push(o.br({})):h.push(_)}return a(h,i)};t.convertRawCommentTextToReactDom=o;var a=function(e,t){if(void 0===t&&(t=null),!t)return e;var n=0,r=[];if(t<=0)return e.length>0?"…":e;for(var o=0,a=Array.from(e);o<a.length;o++){var s=a[o];if("object"==typeof s){if(null!=(null!=s.props?s.props.children:void 0)&&(n+=i(null!=s.props?s.props.children:void 0,function(e){return e.length})),r.push(s),n>=t)return r.push("…"),r}else{if(n+s.length>=t){var c=t-n;return r.push(s.substring(0,c)),r.push("…"),r}n+=s.length,r.push(s)}}return e}}),define("modules/clean/fileops",["require","exports","tslib","jquery","modules/clean/ajax","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,r,i,o,a,s){"use strict";function c(e,t){var n=r.Deferred(),s=o.ungettext("Deleted %(file_count)s item.","Deleted %(file_count)s items.",t.length).format({file_count:t.length});return a.success(s),i.WebRequest({url:"/cmd/delete",data:{files:t},subject_user:e,success:function(e){n.resolve(e)},error:function(e){a.error(o._("Failed to perform the delete. Please try again later.")),n.reject(e)}}),n.promise()}function l(e,t,r){return void 0===r&&(r={}),r=n.__assign((i={},i._subject_uid=String(t),i),r),new s({path:"/history"+e,query:r});var i}Object.defineProperty(t,"__esModule",{value:!0}),t.do_nonbrowse_delete=c,t.build_revisions_uri=l}),define("modules/clean/page_role_observer",["require","exports","modules/core/exception"],function(e,t,n){"use strict";return new((function(){function e(){this._listeners=[]}return e.prototype.addListener=function(e){return n.assert("function"==typeof e,"PageRoleState.addListener expects a function, got: "+typeof e),this._listeners.push(e)},e.prototype.removeListener=function(e){return n.assert("function"==typeof e,"PageRoleState.removeListener expects a function, got: "+typeof e),this._listeners=Array.from(this._listeners).filter(function(t){return t!==e})},e.prototype.removeAllListeners=function(){return this._listeners=[]},e.prototype.emit=function(e){return Array.from(this._listeners.slice()).map(function(t){return t(e)})},e})())}),define("modules/clean/react/file_icon_view",["require","exports","tslib","external/classnames","external/react","modules/clean/react/sprite"],function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={useIcon:!1},t.handleError=function(){t.setState({useIcon:!0})},t}return n.__extends(t,e),t.prototype.render=function(){var e,t=this.props,n=t.className,a=t.icon,s=t.src,c=[n,"file-icon"];return this.state.useIcon||!s?(e=i.createElement(o,{group:"web",name:a,alt:"",className:"file-icon__img"}),c.push("file-icon--sprite")):(e=i.createElement("img",{src:s,onError:this.handleError,alt:"",className:"file-icon__img"}),c.push("file-icon--thumbnail")),i.createElement("span",{className:r(c)},e)},t})(i.PureComponent);t.FileIconView=a}),define("modules/clean/recents/actions/error_actions",["require","exports","external/lodash","modules/clean/recents/recent_activity_constants","modules/clean/recents/recent_activity_dispatcher","modules/core/exception","modules/core/i18n","modules/core/notify"],function(e,t,n,r,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(e){var t=this;this._flushQueues=function(){t._rafId=null;var e=t._recentActivityQueue;t._recentActivityQueue=[],e.length&&t._dispatcher.dispatch({type:r.RAW_RECENT_ACTIVITY_PARSE_ERROR,errors:e});var n=t._relatedActivityQueue;t._relatedActivityQueue=[],n.length&&t._dispatcher.dispatch({type:r.RAW_RELATED_ACTIVITY_PARSE_ERROR,errors:n})},this._notify=n.throttle(function(){var e=a._("Sorry, we were unable to show some recent items. The team has been notified");s.error(e)},500,{trailing:!1}),this._dispatcher=e,this._recentActivityQueue=[],this._relatedActivityQueue=[],this._rafId=null}return e.prototype.recentActivityParseError=function(e,t){o.reportException({err:t}),this._notify(),this._enqueueError(this._recentActivityQueue,e,t)},e.prototype.relatedActivityParseError=function(e,t){o.reportException({err:t}),this._notify(),this._enqueueError(this._relatedActivityQueue,e,t)},e.prototype._enqueueError=function(e,t,n){e.push({activityKey:t,error:n}),this._rafId||(this._rafId=window.requestAnimationFrame(this._flushQueues))},e})();t.ErrorActions=c,t.errorActions=new c(i.recentActivityDispatcher)}),define("modules/clean/recents/actions/file_viewer_actions",["require","exports","tslib","external/lodash","modules/clean/recents/recent_activity_logger_utils","modules/clean/recents/store_utils","modules/clean/recents/stores/attachment_store","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/python","modules/constants/python","modules/clean/recents/actions/recent_activity_actions","modules/core/i18n","modules/core/notify"],function(e,t,n,r,i,o,a,s,c,l,d,u,h,m){"use strict";function p(e){return r.map(e,"previewInfo").filter(function(e){return e&&!e.is_dir})}function _(t,i,o){var a=s.Viewer.get_viewer().get_user_by_id(t),u=n.__assign({index:0,shouldFocusCommentInput:!1},o);c.waitForTTI().then(function(){e(["modules/clean/react/file_viewer/controller"],function(e){e.isShown()?e.updateFiles(i):e.open(i,u.index,a,"react-file-viewer",{disableRouting:!0,oref:l.OREF_CONSTANTS.RECENTS,fileViewTarget:d.FileViewTargetType.PRIVATE,fileViewOrigin:d.FileViewOriginType.RECENTS,fileViewAction:d.FileViewActionType.CLICK,shouldFocusCommentInput:u.shouldFocusCommentInput,onCloseViewer:u.onCloseViewer||r.noop})},function(){return m.error(h._("There was a problem completing this request."))})})}function f(e,t,i){void 0===i&&(i={});var o=!1,s=a.attachmentStore.getByIds(t);if(!r.every(r.map(s,"isLoaded"))){var c=n.__assign({},i),l=c.onCloseViewer||r.noop;c.onCloseViewer=function(){o=!0,l()};var d=p(s);d.length&&_(e,d,c)}return function(){return o}}function g(e,t,n,r){void 0===n&&(n={});var a=f(e,t,n);o.ensureAttachments(e,t,function(t){var o=t[0],s=u.getFqPaths(t),c=p(t);if(c.length){if(a()||_(e,c,n),r){var l=r.totalCount,d=r.cellView;n.shouldFocusCommentInput?i.logCommentFile(e,s[n.index||0],l,d):i.logPreviewFiles(e,s,l,d)}}else o.entityUri&&u.browseFile(o.entityUri)})}Object.defineProperty(t,"__esModule",{value:!0}),t.previewFiles=g}),define("modules/clean/recents/actions/recent_activity_action_permissions",["require","exports","modules/clean/recents/models/utils"],function(e,t,n){"use strict";function r(e,t){return n.isShareLinkRecentItem(e)?i(!!t.canOpen):{open:!!t.canOpen,delete:!t.isReadOnly,download:!0,comment:!t.isDir,versions:!t.isDir,archive:!1,share:!1}}function i(e){return{archive:!1,comment:!1,delete:!1,download:!1,open:e,share:!1,versions:!1}}function o(e,t,r){if(e.federatedRecentItem)return{archive:e.federatedRecentItem.isArchiveable(),comment:!1,delete:!1,download:!1,open:!1,share:e.federatedRecentItem.isShareable(),versions:!1};var o=e.attachmentIds.length>1,s=t[0],c=r.length,l=!o||1===c;if(n.isShareLinkRecentItem(e))return i(!!(l&&s&&s.canOpen));var d=a(t,r),u=c>0,h=!s||!s.isDir;return{archive:!1,comment:l&&h,delete:u&&d.allSelectedItemsAreNotReadOnly||o&&d.allItemsAreNotReadOnly||!o&&s&&!s.isReadOnly,download:l,open:!!(l&&s&&s.canOpen),share:!!(l||u&&d.allSelectedItemsAreInRootCollections||d.allItemsAreInRootCollection),versions:l&&h}}function a(e,t){for(var n={allItemsAreInRootCollection:!0,allItemsAreNotReadOnly:!0,allSelectedItemsAreInRootCollections:!0,allSelectedItemsAreNotReadOnly:!0},r=0,i=e;r<i.length;r++){var o=i[r];o.inRootCollection||(n.allItemsAreInRootCollection=!1),o.isReadOnly&&(n.allItemsAreNotReadOnly=!1),t.indexOf(o.id)>=0&&(o.inRootCollection||(n.allSelectedItemsAreInRootCollections=!1),o.isReadOnly&&(n.allSelectedItemsAreNotReadOnly=!1))}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.getDocAttachmentViewPermissions=r,t.getRecentActivityItemViewPermissions=o}),define("modules/clean/recents/actions/recent_activity_actions",["require","exports","external/lodash","modules/clean/dbmodal_stack","modules/clean/deprecated/dbmodal_loading","modules/clean/downloads","modules/clean/fileops","modules/clean/react/modal","modules/clean/recents/recent_activity_constants","modules/clean/recents/recent_activity_client","modules/clean/recents/recent_activity_dispatcher","modules/clean/recents/recent_activity_logger","modules/clean/recents/recent_activity_logger_utils","modules/clean/recents/store_utils","modules/clean/recents/stores/attachment_store","modules/clean/recents/stores/recent_activity_store","modules/clean/sharing/async_share_modal_util","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/recents/store_utils","modules/clean/recents/store_utils"],function(e,t,n,r,i,o,a,s,c,l,d,u,h,m,p,_,f,g,v,y,I,E,A,R,T){"use strict";function w(e,t,n,r){e.homeLogEventFunction(t,e.cellView,n,e.totalCount,r)}function S(e){return n.compact(n.map(e,"fqPath"))}function C(e){var t=_.recentActivityStore.cursorForUser(e);return t&&m.loadRecentItems(e,{cursor:t}),!!t}function b(e,t,n){m.ensureAttachments(e,[t],function(t){var r=t[0],i=r.fqPath||"",o=g.Viewer.get_viewer().get_user_by_id(e);if(f.asyncShowShareModal(o,{fqPath:i,isFolder:r.previewInfo.is_dir,origin:"RECENTS"}),n){var a=S(t);h.logShareFile(e,i,n.totalCount,n.cellView),w(n,u.ActionTypes.SHARE,a,a.indexOf(i))}})}function N(e,t,n){m.ensureAttachments(e,t,function(t){var o=t.map(function(e){return{ns_id:e.nsId,ns_path:e.nsPath}});l.createCollectionSharedLink(e,o).then(function(t){if(t.shareableItemCount<o.length){var n=o.length-t.shareableItemCount;E.error(I.ungettext("%(missing)s file can’t be shared.","%(missing)s files can’t be shared.",n).format({missing:n}))}var a=new A({path:"/sm/get_link_modal_content/"+t.tkey}).toString();r.DBModalStack.push(new i({element_id:"share-link-modal",endpoint_url:a,subject_user:e,parameters:{origin:"recents"}}))}),n&&h.logShareCollection(e,S(t),n.totalCount,n.cellView)})}function L(e){v.redirect(e)}function O(t,r,i,o){void 0===o&&(o=n.noop),e(["modules/clean/unity/features"],function(e){y.assert(!!e,"Unity is not supported by this browser"),m.ensureAttachments(t,[r],function(r){var a=r[0],s=a.nsId,c=a.nsPath,l=r[0].fqPath||"";if(e.open_file(s,c,t,n.noop,function(e){E.error("We were unable to open this file"),y.reportException({err:Error(e),tags:["recents"],severity:y.SEVERITY.NONCRITICAL})}),i){var d=S(r);h.logUnityOpenFile(t,l,i.totalCount,i.cellView),w(i,u.ActionTypes.OPEN,d,d.indexOf(l))}o()})})}function P(e,t,r){var i,o,l=function(){return m.ensureAttachments(e,t,function(i){var o=S(i);if(r){var s=r.totalCount,l=r.cellView;h.logDeleteFiles(e,o,s,l),w(r,u.ActionTypes.DELETE,o,void 0)}var m=n.uniqueId("DELETE_FILES");d.recentActivityDispatcher.dispatch({type:c.DELETE_FILES_PENDING,attachmentIds:t,transactionId:m});var p=function(){return d.recentActivityDispatcher.dispatch({type:c.DELETE_FILES_COMMIT,transactionId:m})},_=function(){return d.recentActivityDispatcher.dispatch({type:c.DELETE_FILES_ROLLBACK,transactionId:m})};a.do_nonbrowse_delete(e,o).then(p,_)})};if(1===t.length){o=I._("Delete file?");var _=p.attachmentStore.getById(t[0]);i=_&&_.isLoaded?I._("Do you want to delete <b>%(file_name)s</b>?").format({file_name:n.escape(_.displayName||"")}):I._("Do you want to delete this file?")}else o=I._("Delete files?"),i=I._("Do you want to delete <b>%(num)s files</b>?").format({num:n.escape(String(t.length))});s.SimpleModal.show({title_text:o,body_html:i,confirm_text:I._("Delete"),confirm_callback:l,cancel_text:I._("Cancel"),autoclose:!0})}function D(e,t){d.recentActivityDispatcher.dispatch({type:c.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:e,userId:t})}function x(e,t){d.recentActivityDispatcher.dispatch({type:c.SELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})}function V(e,t){d.recentActivityDispatcher.dispatch({type:c.DESELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})}function k(e,t,n){m.ensureAttachments(e,t,function(t){if(n){var r=S(t);h.logDownloadFile(e,r,n.totalCount,n.cellView),w(n,u.ActionTypes.DOWNLOAD,r)}for(var i=0,a=t;i<a.length;i++){var s=a[i];if(s.isDir&&s.fqPath&&null!=s.previewInfo&&null!=s.previewInfo.block_hash)o.get_zip({fq_paths:[s.fqPath],subject_uid:e,block_hash:s.previewInfo.block_hash,parent_path:s.fqPath});else{var c=null!=s.previewInfo?s.previewInfo.direct_blockserver_link:void 0;c&&o.get_blockserver_link({url:c})}}})}function F(e,t,n){m.ensureAttachments(e,[t],function(t){var r=t[0].fqPath||"",i=a.build_revisions_uri(r,e);if(n){var o=S(t);h.logOpenVersions(e,r,n.totalCount,n.cellView),w(n,u.ActionTypes.VERSIONS,o,o.indexOf(r))}v.redirect(i.toString())})}Object.defineProperty(t,"__esModule",{value:!0}),t.getFqPaths=S,t.loadNextPage=C,t.loadAttachmentsForRecentActivities=R.loadAttachmentsForRecentActivities,t.shareFile=b,t.shareCollection=N,t.browseFile=L,t.openFile=O,t.promptAndDeleteAttachments=P,t.loadAttachments=T.loadAttachments,t.updateRecentActivities=T.updateRecentActivities,t.updateRelatedActivities=D,t.selectAttachments=x,t.deselectAttachments=V,t.downloadFiles=k,t.openVersions=F}),define("modules/clean/recents/models/attachment",["require","exports"],function(e,t){"use strict";function n(e){var t=e.preview_jsinfo||null,n=null,r=null;if(t&&(t.thumbnail_url_tmpl&&(n=t.thumbnail_url_tmpl),t.thumbnail_dimensions)){var i=t.thumbnail_dimensions,o=i[0];r={height:i[1],width:o}}var a=e.comment||{},s=a.commenter_dict||{};return{id:e.activity_key,isLoaded:!0,viewingUserId:e.viewing_user.id,displayName:e.name||null,entityUri:e.entity_uri||null,previewInfo:e.preview_jsinfo||null,fqPath:e.fq_path||null,nsPath:e.ns_path||null,nsId:e.ns_id||null,thumbnailUrl:n||null,thumbnailDimensions:r||null,canOpen:!1,inRootCollection:!1,isReadOnly:!!e.is_read_only,isDir:!!e.is_dir,commentRawText:a.raw_comment_text||null,commenterId:s.id||null,commenterDisplayName:s.display_name||null,commenterPhotoUrl:s.photo_circle_url||null}}function r(e){return(e.related_activity_keys||[]).map(function(t){return{id:t,viewingUserId:e.viewing_user.id,displayName:null,isLoaded:!1,canOpen:!1,inRootCollection:!1,isReadOnly:!1,isDir:!1,entityUri:null,previewInfo:null,fqPath:null,nsPath:null,nsId:null,thumbnailUrl:null,thumbnailDimensions:null,commentRawText:null,commenterId:null,commenterDisplayName:null,commenterPhotoUrl:null}})}Object.defineProperty(t,"__esModule",{value:!0}),t.convertFileActivityToAttachmentItem=n,t.createPartialAttachmentsFromRecentActivity=r}),define("modules/clean/recents/models/recent_item",["require","exports","external/lodash","modules/clean/recents/actions/error_actions","modules/clean/recents/models/utils"],function(e,t,n,r,i){"use strict";function o(e){try{var t=e.skeleton_data;return{id:e.activity_key,type:e.recent_event_type||null,icon:t&&t.icon||null,when:e.when_milli||null,viewingUserId:e.viewing_user.id,displayName:t&&t.display_name||null,accountDisplayName:t&&t.account_display_name||null,contextDisplayName:t&&t.context_display_name||null,uniqueFilterTypes:t?n.uniq(n.values(t.filter_types_by_key)):[],attachmentIds:e.related_activity_keys||[],paths:i.getPathsByFqPath(t&&t.context_display_path||"",e.viewing_user.id,!0),order:s(e.activity_key),idType:e.id_type,resourceId:e.resource_id}}catch(t){return n.defer(function(){return r.errorActions.recentActivityParseError(e.activity_key,t)}),null}}Object.defineProperty(t,"__esModule",{value:!0});var a=0,s=n.memoize(function(e){return a+=1});t.convertRecentActivityToRecentItem=o}),define("modules/clean/recents/models/utils",["require","exports","external/lodash","modules/clean/browse_interface","modules/clean/recents/recent_activity_constants","modules/clean/viewer"],function(e,t,n,r,i,o){"use strict";function a(e){var t=n.values(e.filter_types_by_key);return c(t.length,n.uniq(t))}function s(e){return c(e.attachmentIds.length,e.uniqueFilterTypes)}function c(e,t){return!!(e>1&&t.every(function(e){return g.indexOf(e)>=0}))}function l(e){return n.map(e,"id")}function d(e){return e in v}function u(e){return null!==e.type&&d(e.type)}function h(e,t,i){void 0===i&&(i=!1);var a=o.Viewer.get_viewer().get_user_by_id(t);"/"===e&&(e="");var s=[],c=e.split("/");for(i||c.pop();c.length;){var l=n.last(c),d=c.join("/");1===c.length&&""===l&&(l=o.Viewer.get_root_name(a),d="");var u=r.browse_uri_for_fq_path(a,d).toString();s.push({name:l||"",url:u}),c.pop()}return s.reverse()}function m(e,t){return t.when-e.when||e.order-t.order||t.type-e.type}Object.defineProperty(t,"__esModule",{value:!0});var p=i.RECENT_EVENT_FILTER_TYPE.PHOTOS,_=i.RECENT_EVENT_FILTER_TYPE.VIDEOS,f=i.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES,g=[p,_,f];t.shouldShowThumbnailsForSkeletonData=a,t.shouldShowThumbnailsForRecentItem=s,t.extractAttachmentIds=l;var v=(y={},y[i.RECENT_EVENT_TYPES.FILE_SHARED_ADD]=!0,y[i.RECENT_EVENT_TYPES.FILE_SHARED_VIEW]=!0,y);t.isShareLinkEventType=d,t.isShareLinkRecentItem=u,t.getPathsByFqPath=h,t.compareRecentItems=m;var y}),define("modules/clean/recents/react/attachment_file_icon_view",["require","exports","tslib","external/classnames","external/react","external/lodash","modules/clean/em_string","modules/clean/react/sprite","modules/clean/recents/react/selectable_view"],function(e,t,n,r,i,o,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.preventDefault(),t.props.handleClick(t.props.id)},t.onContextMenu=function(e){e.preventDefault(),t.props.handleContextMenu(t.props.id)},t}return n.__extends(t,e),t.prototype.renderFilename=function(){var e=this.props.file.displayName.split("."),t="."+e.pop(),n=a.Emstring.em_snippet(e.join("."),10);return i.createElement("span",{className:"attachment-item__filename"},n,i.createElement("wbr",null),i.createElement("span",{className:"nowrap"},t))},t.prototype.renderIcon=function(){return i.createElement(s,{alt:"",group:"web",name:this.props.file.icon,className:"attachment-item__icon"})},t.prototype.render=function(){var e,t,n=this.renderIcon(),o=this.renderFilename(),a=this.props,s=a.overlayText,l=a.isSelected,d=a.file;return s&&(t=i.createElement("span",{className:"attachment-item__overlay"},s)),this.props.showCheckmark&&(e=i.createElement(c.SelectableView,{id:this.props.id,handleToggleSelect:this.props.handleToggleSelect,isSelected:l})),i.createElement("div",{className:r({"attachment-item":!0,"attachment-item--file-thumb":!0,"attachment-item--show-more":!!s,"attachment-item--selected":l})},i.createElement("a",{href:d.entityUri,title:d.displayName,className:"attachment-item__anchor",onClick:this.onClick,onContextMenu:this.onContextMenu},n,o,t,e))},t.defaultProps={handleClick:o.noop,handleContextMenu:o.noop},t})(i.Component);t.AttachmentFileIconView=l}),define("modules/clean/recents/react/attachment_grid",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t){this._gridWidth=e,this._gutterWidth=t}return e.create=function(t,n){return new e(t,n)},e.prototype.generate=function(e,t){void 0===t&&(t=1/0);for(var n=[],r=0;n.length<t&&r<e.length;){var i=this.buildRow(e.slice(r));r+=i.length,n.push(i)}return n},e.prototype.buildRow=function(e){for(var t=[],n=this._gridWidth+this._gutterWidth,r=0,i=e;r<i.length;r++){var o=i[r];if(n=n-o.width-this._gutterWidth,!(n>=0||0===t.length))break;t.push(o)}return t},e})();t.AttachmentGrid=n}),define("modules/clean/recents/react/attachment_image_expanded_view",["require","exports","tslib","external/react","modules/clean/accessibility/utils","modules/clean/recents/react/attachment_image_view"],function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCornerClick=function(e){e.preventDefault();var n=t.props.handleCornerClick;n&&n(t.props.id)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.image;return r.createElement("div",{className:"attachment-item attachment-item--expanded",style:{width:e.width,height:e.height}},r.createElement("div",{className:"attachment-item--expanded__image"},r.createElement(o.AttachmentImageView,n.__assign({},this.props))),r.createElement("a",n.__assign({},i.accessibleTriggerProps(this.handleCornerClick),{className:"attachment-item--expanded__corner"}),"-"))},t})(r.Component);t.AttachmentImageExpandedView=a}),define("modules/clean/recents/react/attachment_image_stack_view",["require","exports","tslib","external/react","modules/clean/recents/react/attachment_image_view"],function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCornerClick=function(e){e.preventDefault();var n=t.props.handleCornerClick;n&&n(t.props.id)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.image,t=e.width,o=e.height,a=t-4,s=o-4,c=n.__assign({},e,{width:a,height:s});return r.createElement("div",{className:"attachment-item attachment-item--stacked",style:{width:t,height:o}},r.createElement("div",{className:"attachment-item--stacked__front"},r.createElement(i.AttachmentImageView,n.__assign({},this.props,{image:c}))),r.createElement("div",{className:"attachment-item--stacked__back"},r.createElement(i.AttachmentImageView,{image:c})),r.createElement("a",{className:"attachment-item--stacked__corner",onClick:this.handleCornerClick},"+%(count)s".format({count:this.props.stackLength-1})))},t})(r.Component);t.AttachmentImageStackView=o}),define("modules/clean/recents/react/attachment_image_view",["require","exports","tslib","external/classnames","external/react","modules/clean/recents/react/selectable_view"],function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isLoading:!0},t.onClick=function(e){e.preventDefault(),t.props.handleClick(t.props.id)},t.onContextMenu=function(e){e.preventDefault(),t.props.handleContextMenu(t.props.id)},t.onLoad=function(){t.setState({isLoading:!1})},t.onError=function(){t.props.handleLoadError(t.props.id),t.setState({isLoading:!1})},t}return n.__extends(t,e),t.prototype.render=function(){var e,t,n=this.props,a=n.overlayText,s=n.showCheckmark,c=n.isSelected,l=n.badgeType,d=n.image;return a&&(t=i.createElement("span",{className:"attachment-item__overlay"},a)),s&&(e=i.createElement(o.SelectableView,{id:this.props.id,handleToggleSelect:this.props.handleToggleSelect,isSelected:c})),i.createElement("div",{className:r((u={"attachment-item":!0,"attachment-item--show-more":!!a,"attachment-item--is-loading":this.state.isLoading,"attachment-item--selected":c},u["attachment-item--badge-"+l]=!!l,u))},i.createElement("a",{href:d.entityUri,onClick:this.onClick,onContextMenu:this.onContextMenu,title:d.displayName,className:"attachment-item__anchor",style:{width:d.width,height:d.height},tabIndex:0},i.createElement("img",{alt:d.displayName,className:"attachment-item__thumbnail",src:d.thumbnailUrl,onLoad:this.onLoad,onError:this.onError}),t),e);var u},t.defaultProps={handleClick:function(){},handleContextMenu:function(){},handleLoadError:function(){},handleToggleSelect:function(){},showCheckmark:!1,isSelected:!1},t})(i.PureComponent);t.AttachmentImageView=a}),define("modules/clean/recents/react/attachment_list_layout",["require","exports","external/lodash","modules/clean/photos/thumbnail_url_util","modules/clean/recents/react/attachment_file_icon_view","modules/clean/recents/react/attachment_grid","modules/clean/recents/react/attachment_image_view","modules/core/browser","modules/core/exception"],function(e,t,n,r,i,o,a,s,c){"use strict";function l(e,t){var n,i,o,a=s.is_high_density_display();switch(t){case"aggregated-scaled":o=a?200:100,n=a?200:100,i=d;break;case"aggregated-cropped":o=a?200:100,n=a?200:100,i=u;break;case"aggregated-wide-cropped":o=a?718:359,n=a?200:100,i=u;break;default:return c.assert(!1,"invalid ThumbnailVariant: "+t),""}return r.thumbnailUrlForSize(e,o,n,i)}Object.defineProperty(t,"__esModule",{value:!0});var d=r.ThumbnailSizeMode.FIT_ONE,u=r.ThumbnailSizeMode.EXACT_NO_BACKGROUND,h=(function(){function e(e,t,n){this.gridWidth=e,this.columnWidth=t,this.gutterWidth=n,this._grid=o.AttachmentGrid.create(this.gridWidth,this.gutterWidth)}return e.create=function(t,n,r){return new e(t,n,r)},e.prototype.generate=function(e,t,n){var r=this.cellMetadata(e,n);return this._grid.generate(r,t)},e.prototype.cellMetadata=function(e,t){var r=this,i=n.zipObject(t,t);return e.map(function(e){return i[e.id]||e.isLoaded&&!e.thumbnailUrl?r.buildFileIconViewMetadata(e):e.isLoaded?r.buildImageViewMetadata(e):r.buildLoadingImageViewMetadata(e)})},e.prototype.buildFileIconViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:i.AttachmentFileIconView,width:92,height:100,attachment:e}},e.prototype.buildLoadingImageViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:null,width:100,height:100,attachment:e}},e.prototype.buildImageViewMetadata=function(e){var t=e.thumbnailUrl,n=this.calculateThumbnailDimensions(e.thumbnailDimensions),r=n.width,i=n.height,o=n.variant;return t.startsWith("data:")||(t=l(t,o)),{id:e.id,view:a.AttachmentImageView,scaledThumbnailUrl:t,width:r+6,height:i+6,attachment:e}},e.prototype.calculateThumbnailDimensions=function(e){var t,n,r;if(e){r="aggregated-scaled";var i=e.width/e.height;t=100,n=Math.floor(i*t),n>this.columnWidth-6&&(r="aggregated-wide-cropped",n=this.columnWidth-6)}return(!e||n<75)&&(r="aggregated-cropped",n=100,t=100),{width:n,height:t,variant:r}},e})();t.AttachmentListLayout=h}),define("modules/clean/recents/react/attachment_list_view",["require","exports","tslib","external/react","external/lodash","jquery","modules/clean/components/loading_indicator","modules/clean/previews/constants","modules/clean/recents/actions/recent_activity_actions","modules/clean/recents/react/attachment_file_icon_view","modules/clean/recents/react/attachment_image_expanded_view","modules/clean/recents/react/attachment_image_stack_view","modules/clean/recents/react/attachment_image_view","modules/clean/recents/react/attachment_list_layout","modules/clean/recents/recent_activity_constants","modules/core/exception","modules/core/i18n"],function(e,t,n,r,i,o,a,s,c,l,d,u,h,m,p,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setAttachmentListRef=function(e){return t.attachmentsList=e},t.state={rows:t.isAllSelected(t.props)?1/0:1,errored:[],containerWidth:null,expandedAttachments:{}},t.previewAttachment=function(e){var n=t.props.attachments,r={totalCount:n.length,cellView:t};t.props.renderingInfo.version.previewAttachment(e,n,r)},t.expandStack=function(e){for(var r=t.dedupeMetadata(),o=i.find(r,function(t){return t.attachment.id===e}),a=n.__assign({},t.state.expandedAttachments),s=t.props.attachments.indexOf(o.attachment),c=o.stackLength,l=s;l<s+c;l++)a[t.props.attachments[l].id]=e;t.setState({expandedAttachments:a})},t.collapseStack=function(e){for(var r=t.state.expandedAttachments[e],o=t.dedupeMetadata(),a=i.find(o,function(e){return e.attachment.id===r}),s=n.__assign({},t.state.expandedAttachments),c=t.props.attachments.indexOf(a.attachment),l=a.stackLength,d=c;d<c+l;d++)delete s[t.props.attachments[d].id];t.setState({expandedAttachments:s})},t.handleImageToggleSelect=function(e,n){var r=i.find(t.props.attachments,{id:e});t.props.handleToggleSelect(r,n)},t.handleImageLoadError=function(e){var n=t.state.errored.slice();n.push(e),t.setState({errored:n})},t.revealNextGroup=function(){t.setState({rows:t.state.rows+p.SHOW_MORE_THUMBNAIL_ROW_INCREMENT})},t}return n.__extends(t,e),t.prototype.isAllSelected=function(e){return i.size(e.selectedAttachmentIds)===e.attachments.length},t.prototype.componentDidMount=function(){this.updateLayoutController(),this.state.rows>1&&this.loadRemainingAttachments()},t.prototype.componentWillReceiveProps=function(e){this.isAllSelected(e)&&this.setState({rows:1/0})},t.prototype.componentDidUpdate=function(e){this.updateLayoutController(),this.state.rows>1&&this.loadRemainingAttachments()},t.prototype.updateLayoutController=function(){var e=o(this.attachmentsList),t=e.innerWidth();if(t!==this.state.containerWidth){var n=Math.abs(parseFloat(e.css("margin-left")))||0,r=Math.floor(t/2)-n;this.layoutController=m.AttachmentListLayout.create(t,r,n),this.setState({containerWidth:t})}},t.prototype.loadRemainingAttachments=function(){var e=this.props.attachments[0].viewingUserId,t=this.props.attachments.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});t.length&&c.loadAttachments(e,t)},t.prototype.renderFileIconView=function(e,t,n){var i=e.attachment;return r.createElement(l.AttachmentFileIconView,{key:"attachment-"+e.id,id:e.id,file:{icon:i.previewInfo.icon,displayName:i.displayName||"",entityUri:i.entityUri||""},overlayText:t,handleClick:n,showCheckmark:this.props.attachments.length>1&&!t,handleToggleSelect:this.handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.indexOf(i.id)>=0})},t.prototype.renderStackedImageView=function(e,t,i){var o=this.propsForImageView(e,i);return r.createElement(u.AttachmentImageStackView,n.__assign({},o,{key:"attachment-stacked-"+e.id,handleClick:this.expandStack,handleCornerClick:this.expandStack,stackLength:t}))},t.prototype.renderExpandedImageView=function(e,t,i){var o=this.propsForImageView(e,i);return r.createElement(d.AttachmentImageExpandedView,n.__assign({},o,{showCheckmark:this.props.attachments.length>1,handleCornerClick:this.collapseStack}))},t.prototype.renderImageView=function(e,t,i){var o=this.propsForImageView(e,i);return r.createElement(h.AttachmentImageView,n.__assign({},o,{key:"attachment-expanded-"+e.id,overlayText:t,showCheckmark:this.props.attachments.length>1&&!t}))},t.prototype.propsForImageView=function(e,t){var n=e.attachment,r=n.previewInfo,i=(r&&r.preview_type)===s.PreviewType.Video;return{id:e.id,image:{thumbnailUrl:e.scaledThumbnailUrl,entityUri:n.entityUri||"",displayName:n.displayName||"",width:e.width,height:e.height},badgeType:i?"video":void 0,handleClick:t,handleLoadError:this.handleImageLoadError,handleToggleSelect:this.handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.indexOf(n.id)>=0}},t.prototype.dedupeMetadata=function(){var e,t=[],n={},r={},i={};if(this.props.duplicateIds)for(var o=0;o<this.props.attachments.length;o++){e=this.props.attachments[o];var a=this.props.duplicateIds[o];n.hasOwnProperty(a)||(n[a]=[],i[e.id]=e),n[a].push(e),r[e.id]=n[a]}for(var s=0,c=this.props.attachments;s<c.length;s++){e=c[s];var l=this.state.expandedAttachments.hasOwnProperty(e.id),d=r[e.id],u=d&&d.length,h=i.hasOwnProperty(e.id),m=u>1&&h;u>1&&!h&&!l||t.push({
attachment:e,stackLength:u,isParentOfStack:h,isStacked:m,isExpanded:l})}return t},t.prototype.isLoading=function(){return this.state.rows>1&&this.props.attachments.some(function(e){return!e.isLoaded})},t.prototype.renderAttachmentItems=function(){if(!this.state.containerWidth)return[];for(var e=this.dedupeMetadata(),t=i.map(e,"attachment"),n=this.isLoading()?1:this.state.rows,o=this.layoutController.generate(t,n,this.state.errored),a=i.flattenDeep(o),s=this.previewAttachment,c=a.length,d=t.length,u=d-c+1,m=!this.isLoading()&&c<d,p=[],g=0;g<a.length;g++){var v=void 0,y=void 0,I=a[g],E=g===a.length-1,A=e[g],R=A.isStacked,T=A.isParentOfStack,w=A.isExpanded,S=A.stackLength;E&&m&&(s=this.revealNextGroup,y=f._("+%(count)s").format({count:u}));var C="attachment-item-"+I.attachment.id;switch(I.view){case l.AttachmentFileIconView:v=this.renderFileIconView(I,y,s);break;case h.AttachmentImageView:var b=m&&E;S>1&&!b?T&&w?v=this.renderImageView(I,y,s):R&&!w?v=this.renderStackedImageView(I,S,s):w&&(v=this.renderExpandedImageView(I,y,s)):v=this.renderImageView(I,y,s);break;default:I.view&&_.assert(!1,I.view.name+" is not supported by AttachmentListView")}p.push(r.createElement("li",{key:C},v))}return p},t.prototype.renderLoadingView=function(){return r.createElement("div",{className:"attachment-loading"},r.createElement(a.LoadingIndicator,{style:a.LoadingIndicator.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},t.prototype.render=function(){var e=null;return this.isLoading()&&(e=this.renderLoadingView()),r.createElement("div",{className:"recents-item__attachments"},r.createElement("ul",{ref:this.setAttachmentListRef,className:"attachment-list"},this.renderAttachmentItems()),e)},t.defaultProps={handleToggleSelect:function(){},selectedAttachmentIds:[]},t})(r.Component);t.AttachmentListView=g}),define("modules/clean/recents/react/comment_attachment_view",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/viewer_avatar","modules/clean/comments/comment_dom","modules/clean/viewer","modules/core/user_i18n"],function(e,t,n,r,i,o,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){t.props.handlePreview()},t}return n.__extends(t,e),t.prototype.renderCommentText=function(){var e=s.convertRawCommentTextToReactDom(this.props.attachment.commentRawText,!1);return r.createElement("div",{className:"comment-attachment-item__comment"},r.createElement("div",{className:"comment-bubble"},e))},t.prototype.renderAvatar=function(){var e=this.props.attachment,t={dimension:24,defaultAvatar:r.createElement(o.InitialsAvatar,{key:"commenter-"+e.commenterId,dimension:24,shape:"CIRCLE",initials:l.getInitials(e.commenterDisplayName)}),photoUrl:null};""!==e.commenterPhotoUrl&&(t.photoUrl=e.commenterPhotoUrl);var s;return s=c.Viewer.get_viewer().get_user_ids(!0).indexOf(e.commenterId)>=0?r.createElement(a,n.__assign({},t)):r.createElement(i,n.__assign({},t)),r.createElement("div",{className:"comment-attachment-item__avatar"},s)},t.prototype.render=function(){var e=this.renderAvatar(),t=this.renderCommentText();return r.createElement("div",{className:"comment-attachment-item",onClick:this.handleClick},e,t)},t.defaultProps={handlePreview:function(){}},t})(r.PureComponent);t.CommentAttachmentView=d}),define("modules/clean/recents/react/doc_attachment_list_view",["require","exports","tslib","external/classnames","external/react","modules/clean/components/loading_indicator","modules/clean/recents/actions/recent_activity_actions","modules/clean/recents/react/doc_attachment_view","modules/clean/recents/recent_activity_constants","modules/core/exception","modules/core/i18n"],function(e,t,n,r,i,o,a,s,c,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={numberOfRows:c.MAX_INITIAL_DOC_ATTACHMENTS},t.revealNextGroup=function(e){e.preventDefault(),t.setState({numberOfRows:t.state.numberOfRows+c.SHOW_MORE_DOC_ATTACHMENT_INCREMENT})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.state.numberOfRows>c.MAX_INITIAL_DOC_ATTACHMENTS&&this.loadRemainingAttachments()},t.prototype.componentDidUpdate=function(){this.state.numberOfRows>c.MAX_INITIAL_DOC_ATTACHMENTS&&this.loadRemainingAttachments()},t.prototype.componentWillReceiveProps=function(e){var t=this.props.attachments,n=this.state.numberOfRows,r=t.slice(0,n).filter(function(e){return e.isLoaded}).map(function(e){return e.id}),i=r.length,o=e.attachments.map(function(e){return e.id}).filter(function(e){return r.indexOf(e)>=0}).length;if(o<i){var a=n+o-i;l.assert(a>=0,"number of rows removed cannot be greater than the total number of rows"),this.setState({numberOfRows:n+o-i})}},t.prototype.loadRemainingAttachments=function(){var e=this.props.attachments;if(e.length){var t=e[0].viewingUserId,n=e.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});n.length&&a.loadAttachments(t,n)}},t.prototype.shouldShowSubheading=function(){return!1},t.prototype.renderFileView=function(e){return i.createElement(s.DocAttachmentView,{key:"attachment-"+e.id,attachment:e,recentItem:this.props.recentItem,showSubHeading:this.shouldShowSubheading(),renderingInfo:this.props.renderingInfo})},t.prototype.renderLoadMoreView=function(e){var t=d._("Show %(num)s more").format({num:e});return i.createElement("button",{key:"attachment-load-more",className:"attachment-load-more button-as-link",onClick:this.revealNextGroup},t)},t.prototype.renderLoadingView=function(){return i.createElement("li",{key:"attachment-loading",className:"attachment-loading"},i.createElement(o.LoadingIndicator,{style:o.LoadingIndicator.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},t.prototype.renderFooter=function(e){var t=Math.min(e,c.SHOW_MORE_DOC_ATTACHMENT_INCREMENT);return i.createElement("li",{key:"attachment-footer",className:"doc-attachment-list__footer"},i.createElement("div",{className:"doc-attachment-list__footer--cell"},this.renderLoadMoreView(t)))},t.prototype.renderAttachmentItems=function(){var e=this,t=this.props.attachments,n=t.slice(0,this.state.numberOfRows),r=n.filter(function(e){return e.isLoaded}).map(function(t){return e.renderFileView(t)}),i=t.length-r.length;return n.filter(function(e){return!e.isLoaded}).length>0?r.push(this.renderLoadingView()):i>0&&r.push(this.renderFooter(i)),r},t.prototype.render=function(){var e=this.renderAttachmentItems(),t=this.props.attachments,n=null;0!==t.length&&(n=i.createElement("div",{className:"doc-attachment-list__spacer"}));var o={"recents-item__doc-attachments":!0,"recents-item__doc-attachments--collapsed":this.props.isCollapsed};return i.createElement("div",{className:r(o)},n,i.createElement("ul",{className:"doc-attachment-list"},e))},t})(i.Component);t.DocAttachmentListView=u}),define("modules/clean/recents/react/doc_attachment_view",["require","exports","tslib","external/classnames","external/react","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/recents/actions/recent_activity_action_permissions","modules/clean/recents/actions/recent_activity_actions","modules/clean/recents/react/recent_activity_item_actions_view","modules/clean/recents/react/recent_activity_item_header_view","modules/clean/recents/models/utils","modules/clean/recents/recent_activity_view_helper","modules/core/exception","modules/core/i18n"],function(e,t,n,r,i,o,a,s,c,l,d,u,h,m,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.previewOrOpenFiles=function(e){n.getVersion().previewOrBrowseRecentItem(n.getRecentItem(),n.getAttachments(),{shouldFocusCommentInput:e},n.getLogData())},n.onBlur=function(e){n.setState({isFocused:!1})},n.onFocus=function(e){n.setState({isFocused:!0})},n.onMouseEnter=function(e){n.setState({isHovered:!0})},n.onMouseLeave=function(e){n.setState({isHovered:!1})},n.onPreview=function(e){e.preventDefault(),n.previewOrOpenFiles(!1)},n.handleArchive=function(){},n.handleComment=function(){n.previewOrOpenFiles(!0)},n.handleDelete=function(){n.getVersion().deleteRecentItem(n.getRecentItem(),n.getAttachments(),n.getLogData())},n.handleDeselectAll=function(){},n.handleDownload=function(){c.downloadFiles(n.getViewingUserId(),[n.getAttachmentId()],n.getLoggingInfo())},n.handleSelectAll=function(){},n.handleOpen=function(){m.assert(!!n.getAttachment().canOpen,"This item does not support opening"),c.openFile(n.getViewingUserId(),n.getAttachmentId(),n.getLoggingInfo())},n.handleShare=function(){n.getVersion().shareRecentItem(n.getRecentItem(),n.getAttachments(),n.getLogData())},n.handleVersions=function(){c.openVersions(n.getViewingUserId(),n.getAttachmentId(),n.getLoggingInfo())},n.onShowTooltip=function(){n.setState({tooltipShown:!0})},n.onHideTooltip=function(){n.setState({tooltipShown:!1})},n.state={tooltipShown:!1,isHovered:!1,isFocused:!1},n}return n.__extends(t,e),t.prototype.getVersion=function(){return this.props.renderingInfo.version},t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getAttachment=function(){return this.props.attachment},t.prototype.getAttachments=function(){return[this.props.attachment]},t.prototype.getAttachmentId=function(){return this.props.attachment.id},t.prototype.getViewingUserId=function(){return this.props.attachment.viewingUserId},t.prototype.getLogData=function(){return{totalCount:this.getRecentItem().attachmentIds.length,cellView:this}},t.prototype.getLoggingInfo=function(){return this.getVersion().getLoggingInfo(this.getLogData())},t.prototype.isSharedLink=function(){return u.isShareLinkRecentItem(this.getRecentItem())},t.prototype.getIcon=function(){var e=this.getAttachment().previewInfo;return e&&e.icon||"page_white_text"},t.prototype.getHeaderProps=function(){var e=this.getAttachment(),t={heading:e.displayName&&o.Emstring.em_snippet(e.displayName,35)||"",icon:this.getIcon(),star:this.getVersion().renderStar(this.props.renderingInfo.role,this.getRecentItem())};return this.props.showSubHeading&&(t.subheading=this.renderSubheading()),e.thumbnailUrl&&(t.thumbnailUrl=e.thumbnailUrl),t},t.prototype.renderSubheading=function(){return this.getRecentItem().paths.length?i.createElement(a.FilePathBreadcrumb,{handlePathClick:this.props.handlePathClick,paths:this.getRecentItem().paths}):null},t.prototype.renderShareButton=function(){return i.createElement("a",{ref:"shareLink",className:"recents-item__share-link button-secondary",href:"#share",onClick:this.handleShare},p._("Share"))},t.prototype.renderActions=function(){return i.createElement(l.RecentActivityItemActionsView,{ref:"recentsItemActionsView",permissions:s.getDocAttachmentViewPermissions(this.getRecentItem(),this.getAttachment()),handler:this,tooltipHandler:this,selectCount:0,attachmentCount:1,disableActions:!1,type:this.getRecentItem().type,rowIsHovered:this.state.isHovered,renderingInfo:this.props.renderingInfo})},t.prototype.renderHeading=function(){return i.createElement(d.RecentActivityItemHeaderView,{ref:"recentsItemHeader",header:this.getHeaderProps(),tooltipShown:this.state.tooltipShown,handleClick:this.onPreview,recentActivityType:null},this.isSharedLink()?null:i.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this.renderShareButton()),this.renderActions())},t.prototype.render=function(){return i.createElement("li",{className:r((e={},e["doc-attachment-item"]=!0,e["doc-attachment-item--focused-in"]=this.state.isFocused,e)),onClick:h.ensureUserIntentToClick(this.onPreview),onBlur:this.onBlur,onFocus:this.onFocus,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},this.renderHeading());var e},t.defaultProps={showSubheading:!1},t})(i.PureComponent);t.DocAttachmentView=_}),define("modules/clean/recents/react/pending_attachment_list_view",["require","exports","tslib","external/classnames","external/react","external/lodash"],function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.count,t=o.times(Math.min(e,4),function(){return i.createElement("li",{className:"attachment-item attachment-item--placeholder"})}),n={"attachment-list":!0,"attachment-list--is-pending":!0,"attachment-list--standalone":1===e};return i.createElement("div",{className:"recents-item__attachments"},i.createElement("ul",{className:r(n)},t))},t})(i.Component);t.PendingAttachmentListView=a}),define("modules/clean/recents/react/recent_activity_blank_slate_view",["require","exports","tslib","external/classnames","external/react","modules/clean/react/button","modules/clean/react/modal","modules/clean/recents/react/recent_activity_onboarding_modal","modules/clean/recents/recent_activity_constants","modules/core/i18n"],function(e,t,n,r,i,o,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=c.RECENT_EVENT_FILTER_TYPE.ALL,u=c.RECENT_EVENT_FILTER_TYPE.PHOTOS,h=c.RECENT_EVENT_FILTER_TYPE.VIDEOS,m=c.RECENT_EVENT_FILTER_TYPE.DOCUMENTS,p=c.RECENT_EVENT_FILTER_TYPE.COMMENTS,_=c.RECENT_EVENT_FILTER_TYPE.JUNK,f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleButtonClick=function(){a.Modal.showInstance(i.createElement(s.RecentActivityOnboardingModal,null))},t}return n.__extends(t,e),t.prototype.heading=function(){switch(this.props.filter){case d:return l._("Pick up where you left off");case u:return l._("You don’t have any recent images");case h:return l._("You don’t have any recent videos");case m:return l._("You don’t have any recent documents");case p:return l._("You don’t have any recent comments");case _:return l._("You don’t have any other recent files");default:return l._("You don’t have any files matching this filter")}},t.prototype.subheadingMarkup=function(){switch(this.props.filter){case d:return l._("Find what you need fast with Recents, a list of files you’ve worked on lately.");case u:return l._("When you add or edit an image, you’ll see it here.");case h:return l._("When you add or edit a video, you’ll see it here.");case m:return l._("When you add or edit an Office document or PDF, you’ll see it here.");case p:return l._("When someone comments on one of your documents, you’ll see it here.");case _:return l._("You’ll only see unimportant files here, like files created automatically by programs.");default:return""}},t.prototype.filterName=function(){switch(this.props.filter){case d:return"all";case u:return"photos";case h:return"videos";case m:return"documents";case p:return"comments";case _:return"junk";default:return""}},t.prototype.render=function(){var e=["recents-blankslate","recents-blankslate--"+this.filterName()];return i.createElement("div",{className:r(e)},i.createElement("h1",{className:"recents-blankslate__heading recents-blankslate--show-image"},this.heading()),i.createElement("p",{className:"recents-blankslate__subheading"},this.subheadingMarkup()),i.createElement(o.button,{className:"recents-blankslate__button",onClick:this.handleButtonClick},l._("Learn about recents")))},t})(i.PureComponent);t.RecentActivityBlankSlateView=f}),define("modules/clean/recents/react/recent_activity_container",["require","exports","tslib","jquery","external/lodash","external/react","modules/clean/page_role_observer","modules/clean/web_timing_logger","modules/clean/recents/actions/recent_activity_actions","modules/clean/recents/react/recent_activity_view","modules/clean/recents/recent_activity_constants","modules/clean/viewer"],function(e,t,n,r,i,o,a,s,c,l,d,u){"use strict";function h(e){var t=0,n=function(){var n=r(window).scrollTop()/(document.documentElement.scrollHeight-window.innerHeight);n>.8&&n>t&&e(),t=n};window.addEventListener("scroll",i.throttle(n,150,{trailing:!1}),!1)}function m(e){"function"==typeof e&&e()}Object.defineProperty(t,"__esModule",{value:!0});var p=(function(t){function r(e){var n=t.call(this,e)||this;return n.onShouldLoadMore=function(){var e=n.getCurrentUser();if(e&&!n.state.isPending&&n.getVersion().shouldLoadMore(e.id,n.state.filter)){var t=n.getRecentItems();t.length>n.state.items.length?n.setState({items:t}):c.loadNextPage(e.id)&&n.setState({isPending:!0})}},n.onUpdateFromStore=function(){var e=n.getRecentItems(),t=n.getVersion().isStoreReadyForUserId(n.getCurrentUserId(),n.hasRecentItems());n.setState({isPending:!t,items:e})},n.onRoleUpdate=function(e){if(e!==n.state.role){var t=n.getRecentItems(e);n.getVersion().loadPage(n.getUserId(e)),n.setState({role:e,items:t,filter:d.RECENT_EVENT_FILTER_TYPE.ALL,isPending:0===t.length,renderingInfo:n.createRenderingInfo(e,null)})}},n.removeStoreListeners=null,n.logTimeToInteractive=null,n._timer=0,n.state={items:[],role:n.props.initialRole,filter:d.RECENT_EVENT_FILTER_TYPE.ALL,isPending:!1,renderingInfo:n.createRenderingInfo(n.props.initialRole,!1)},n}return n.__extends(r,t),r.prototype.componentWillMount=function(){this.removeStoreListeners=this.getVersion().getRemoveStoreListeners(this.onUpdateFromStore),this.getVersion().prefetchOnMount(this.getCurrentUserId());var e=this.getRecentItems();this.didReceiveRecentActivities()?this.setState({isPending:!1,items:e}):this.setState({isPending:0===e.length,items:e}),a.addListener(this.onRoleUpdate),this.logTimeToInteractive=this.getVersion().maybeInitLoggingAndGetTTILogger()},r.prototype.hasRecentItems=function(){return this.state.items.length>0},r.prototype.componentDidMount=function(){var t=this;h(i.throttle(this.onShouldLoadMore,2e3,{trailing:!1})),s.waitForTTI().then(function(){t.getVersion().possiblyRequireFileViewer(),e(["modules/clean/sharing/share_modal_util","modules/clean/sharing/wizard/wizard_modals","modules/clean/unity/features"],function(e,n,r,i){null!=i&&t.setState({renderingInfo:t.createRenderingInfo(null,!0)})})}),!this.hasRecentItems()&&this.didReceiveRecentActivities()&&(m(this.logTimeToInteractive),this.setState({isPending:!1}))},r.prototype.clearLoadNewItemsTimer=function(){this._timer&&(clearInterval(this._timer),this._timer=null)},r.prototype.didReceiveRecentActivities=function(){return this.getVersion().didReceiveRecentActivities()},r.prototype.componentDidUpdate=function(){this.hasRecentItems()&&m(this.logTimeToInteractive)},r.prototype.componentWillUnmount=function(){this.clearLoadNewItemsTimer(),m(this.removeStoreListeners),a.removeListener(this.onRoleUpdate)},r.prototype.createRenderingInfo=function(e,t){return{isUnityAvailable:null===t?this.state.renderingInfo.isUnityAvailable:t,version:this.getVersion(),role:null===e?this.state.role:e}},r.prototype.getRecentItems=function(e){var t=this.getUserId(e||this.state.role);return this.getVersion().getRecentItems(t,this.state.filter)},r.prototype.getCurrentUser=function(){return u.Viewer.get_viewer().get_user_by_role(this.state.role)},r.prototype.getUserId=function(e){return u.Viewer.get_viewer().get_user_by_role(e).id},r.prototype.getCurrentUserId=function(){return this.getCurrentUser().id},r.prototype.getVersion=function(){return this.props.version},r.prototype.renderBody=function(){return o.createElement(l.RecentActivityView,{items:this.state.items,filter:this.state.filter,isPending:this.state.isPending,userId:this.getCurrentUserId(),localDatetime:this.props.localDatetime,renderingInfo:this.state.renderingInfo})},r.prototype.render=function(){return this.getVersion().renderRecentActivityContainer(this.renderBody(),this.props.user,this.getCurrentUser())},r.displayName="RecentActivityContainer",r.defaultProps={initialRole:"personal"},r})(o.PureComponent);t.RecentActivityContainer=p}),define("modules/clean/recents/react/recent_activity_item_actions_view",["require","exports","tslib","external/classnames","external/react","modules/core/i18n","modules/clean/recents/recent_activity_rendering_models","modules/clean/recents/models/utils"],function(e,t,n,r,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onOpen=function(e){e.preventDefault(),t.getHandler().handleOpen()},t.onDelete=function(e){e.preventDefault(),t.getHandler().handleDelete()},t.onArchive=function(e){e.preventDefault(),t.getHandler().handleArchive()},t.onSelectAll=function(e){e.preventDefault(),t.getHandler().handleSelectAll()},t.onDeselectAll=function(e){e.preventDefault(),t.getHandler().handleDeselectAll()},t.onDownload=function(e){e.preventDefault(),t.getHandler().handleDownload()},t.onComment=function(e){e.preventDefault(),t.getHandler().handleComment()},t.onVersions=function(e){e.preventDefault(),t.props.permissions.versions&&t.getHandler().handleVersions()},t}return n.__extends(t,e),t.prototype.getHandler=function(){return this.props.handler},t.prototype.canOpen=function(){return this.props.permissions.open&&this.props.renderingInfo.isUnityAvailable},t.prototype.canSelect=function(){var e=this.props;return e.attachmentCount>1&&e.selectCount>0&&e.selectCount<e.attachmentCount},t.prototype.canDeselect=function(){return this.props.attachmentCount>1&&this.props.selectCount>0},t.prototype.getDeleteLabel=function(){var e=this.props.selectCount;return e>1?o._("Delete (%(count)s)…").format({count:e}):0===e&&this.props.attachmentCount>1?o._("Delete all…"):o._("Delete…")},t.prototype.getDownloadLabel=function(){var e=this.props.selectCount;return e>1?o._("Download (%(count)s)").format({count:e}):o._("Download")},t.prototype.render=function(){if(this.props.renderingInfo.version.shouldRenderItemActions(this.props.permissions)){var e=r((t={},t["recents-item__more-actions"]=!0,t["recents-item__more-actions--disabled"]=this.props.disableActions,t));return s.isShareLinkEventType(this.props.type)?i.createElement("div",{className:e}):i.createElement("div",{className:e},this.props.renderingInfo.version.renderItemActionsPlaceholder(),i.createElement("div",{className:"recents-item__more-actions-button recents-item__action-button",tabIndex:-1},this.props.renderingInfo.version.renderMoreActionsElement(this)))}return null;var t},t.defaultProps={handler:a.getStubRecentActivityItemContainerHandler(),tooltipHandler:a.getStubRecentActivityTooltipHandler(),selectCount:0,attachmentCount:1,disableActions:!1},t})(i.PureComponent);t.RecentActivityItemActionsView=c}),define("modules/clean/recents/react/recent_activity_item_container",["require","exports","tslib","external/lodash","external/react","modules/core/exception","modules/clean/recents/recent_activity_logger","modules/clean/recents/actions/recent_activity_actions","modules/clean/recents/react/recent_activity_item_view","modules/clean/recents/recent_activity_logger_utils","modules/clean/recents/models/utils","modules/clean/recents/stores/attachment_store","modules/clean/recents/stores/selection_store"],function(e,t,n,r,i,o,a,s,c,l,d,u,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t){var n=e.call(this,t)||this;return n.onSelectionStoreChange=function(){n.setState({selectedAttachmentIds:h.selectionStore.getByRecentItemId(n.getRecentItemId())})},n.onAttachmentStoreChange=function(){n.setState({attachments:n.getAttachmentsFromStore()})},n.handleArchive=function(){n.getVersion().archiveRecentItem(n.getRecentItem(),n.getLogData()),n.clearSelection()},n.handleComment=function(){var e=n.getSingleAttachment("handleComment only supports a single attachment"),t=Math.max(0,n.getStateAttachments().indexOf(e));n.previewOrOpenFiles({index:t,shouldFocusCommentInput:!0})},n.handleDelete=function(){n.getVersion().deleteRecentItem(n.getRecentItem(),n.getSelectedAttachments(),n.getLogData()),n.clearSelection()},n.handleDeselectAll=function(){s.deselectAttachments(n.getRecentItemId(),n.getSelectedAttachmentIds())},n.handleDownload=function(){var e=n.getSingleAttachment("handleDownload only supports a single attachment");s.downloadFiles(n.getViewingUserId(),[e.id],n.getLoggingInfo())},n.handleHeaderClick=function(){if(n.isSubset()){var e=n.state.isCollapsed?a.ActionTypes.UNCOLLAPSE:a.ActionTypes.COLLAPSE;n.getVersion().logEvent(e,n,n.getStateAttachmentFqPaths(),n.getStateAttachments().length)}n.setState({isCollapsed:!n.state.isCollapsed})},n.handleOpen=function(){var e=n.getSingleAttachment("handleOpen only supports a single attachment");s.openFile(n.getViewingUserId(),e.id,n.getLoggingInfo())},n.handlePathClick=function(e){var t=n.getStateAttachmentFqPaths();l.logOpenPathUrl(n.getViewingUserId(),t,n.props.recentItem.attachmentIds.length,n),n.getVersion().handlePathClick(e,n.getRecentItem(),n.getLogData())},n.handlePreview=function(){n.previewOrOpenFiles({shouldFocusCommentInput:!1})},n.handleSelectAll=function(){var e=d.extractAttachmentIds(n.getStateAttachments());s.selectAttachments(n.getRecentItemId(),e)},n.handleShare=function(){n.getVersion().shareRecentItem(n.getRecentItem(),n.getSelectedAttachments(),n.getLogData())},n.handleToggleSelect=function(e,t){t?s.selectAttachments(n.getRecentItemId(),[e.id]):s.deselectAttachments(n.getRecentItemId(),[e.id])},n.handleVersions=function(){var e=n.getSingleAttachment("handleVersions only supports a single attachment");s.openVersions(n.getViewingUserId(),e.id,n.getLoggingInfo())},n.removeStoreListeners=null,n.state={attachments:[],selectedAttachmentIds:[],isCollapsed:!0},n}return n.__extends(t,e),t.prototype.getStateAttachments=function(){return this.state.attachments},t.prototype.getSelectedAttachmentIds=function(){return this.state.selectedAttachmentIds},t.prototype.getVersion=function(){return this.props.renderingInfo.version},t.prototype.isSubset=function(){return this.getRecentItem().uniqueFilterTypes.length>1},t.prototype.getViewingUserId=function(){return this.props.recentItem.viewingUserId},t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getRecentItemId=function(){return this.props.recentItem.id},t.prototype.getLogData=function(){return{totalCount:this.props.recentItem.attachmentIds.length,cellView:this}},t.prototype.getLoggingInfo=function(){return this.getVersion().getLoggingInfo(this.getLogData())},t.prototype.getStateAttachmentFqPaths=function(){return r.compact(r.map(this.getStateAttachments(),"fqPath"))},t.prototype.getAttachmentsFromStore=function(){return u.attachmentStore.getByIds(this.getRecentItem().attachmentIds)},t.prototype.getSelectedAttachments=function(){var e=this.getSelectedAttachmentIds();return e.length?this.getStateAttachments().filter(function(t){return e.indexOf(t.id)>=0}):this.getStateAttachments()},t.prototype.getSingleAttachment=function(e){var t=this.getSelectedAttachments();return o.assert(1===t.length,e),t[0]},t.prototype.previewOrOpenFiles=function(e){e.shouldBrowse=d.isShareLinkRecentItem(this.props.recentItem);var t=e.shouldBrowse?[this.getSingleAttachment("previewOrOpenFiles only supports a single shared link")]:this.getStateAttachments();this.getVersion().previewOrBrowseRecentItem(this.getRecentItem(),t,e,this.getLogData())},t.prototype.clearSelection=function(){s.deselectAttachments(this.getRecentItemId(),this.getSelectedAttachmentIds())},t.prototype.componentWillMount=function(){var e=h.selectionStore.addListener(this.onSelectionStoreChange),t=u.attachmentStore.addListener(this.onAttachmentStoreChange);this.removeStoreListeners=function(){e(),t()},this.setState({attachments:this.getAttachmentsFromStore(),selectedAttachmentIds:h.selectionStore.getByRecentItemId(this.getRecentItemId())})},t.prototype.componentWillUnmount=function(){this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.render=function(){return i.createElement(c.RecentActivityItemView,{recentItem:this.getRecentItem(),attachments:this.getStateAttachments(),handler:this,isCollapsed:this.state.isCollapsed,selectedAttachmentIds:this.getSelectedAttachmentIds(),renderingInfo:this.props.renderingInfo})},t.displayName="RecentActivityItemContainer",t})(i.PureComponent);t.RecentActivityItemContainer=m}),define("modules/clean/recents/react/recent_activity_item_header_view",["require","exports","tslib","external/classnames","external/react","modules/clean/accessibility/utils","modules/clean/react/helpers","modules/clean/react/file_icon_view","modules/clean/recents/models/utils","modules/clean/recents/recent_activity_view_helper"],function(e,t,n,r,i,o,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.stopPropagation(),e.preventDefault(),t.props.handleClick(e)},t}return n.__extends(t,e),t.prototype.getHeaderProps=function(){return this.props.header},t.prototype.renderIcon=function(){var e=this.getHeaderProps();return i.createElement("div",{className:"recents-item__icon"},i.createElement(s.FileIconView,{icon:e.icon,className:"recents-item__img",src:e.thumbnailUrl}))},t.prototype.renderHeading=function(){return i.createElement("a",n.__assign({ref:"heading",className:"recents-item__heading"},o.accessibleTriggerProps(this.props.handleClick)),this.getHeaderProps().heading)},t.prototype.renderSubheading=function(){var e=this.getHeaderProps().subheading;return e?i.createElement("div",{ref:"subheading",className:"recents-item__subheading"},e):null},t.prototype.renderDetails=function(){return i.createElement("div",{ref:"recentsItemDetails",className:"recents-item__details"},i.createElement("div",{className:"recents-item__heading-group"},this.renderHeading(),this.renderStar()),this.renderSubheading())},t.prototype.renderStar=function(){var e=this.getHeaderProps().star;return e?i.createElement("div",{className:"item__star"},e):null},t.prototype.renderActions=function(){if(this.props.recentActivityType&&c.isShareLinkEventType(this.props.recentActivityType)||0===i.Children.count(this.props.children))return null;var e=r((t={},t["recents-item__actions-inner"]=!0,t["recents-item__actions-inner--tooltip-shown"]=this.props.tooltipShown,t));return i.createElement("div",{ref:"actions",className:"recents-item__actions"},i.createElement("div",{className:e},this.props.children));var t},t.prototype.shouldComponentUpdate=function(e,t){return a.compareStateAndProps(e,t)},t.prototype.render=function(){return i.createElement("div",{className:"recents-item__wrapper",onClick:l.ensureUserIntentToClick(this.onClick)},this.renderIcon(),this.renderDetails(),this.renderActions())},t.defaultProps={handleClick:function(e){return null},tooltipShown:!1},t})(i.PureComponent);t.RecentActivityItemHeaderView=d}),define("modules/clean/recents/react/recent_activity_item_view",["require","exports","tslib","external/classnames","external/react","modules/core/i18n","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/react/helpers","modules/clean/recents/actions/recent_activity_action_permissions","modules/clean/recents/recent_activity_constants","modules/clean/recents/models/utils","modules/clean/recents/recent_activity_rendering_models","modules/clean/recents/recent_activity_view_helper","modules/clean/recents/recent_activity_text_helper","modules/clean/recents/react/attachment_list_view","modules/clean/recents/react/comment_attachment_view","modules/clean/recents/react/pending_attachment_list_view","modules/clean/recents/react/recent_activity_item_header_view","modules/clean/recents/react/recent_activity_item_actions_view","modules/clean/recents/react/doc_attachment_list_view"],function(e,t,n,r,i,o,a,s,c,l,d,u,h,m,p,_,f,g,v,y,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=(function(e){function t(t){var n=e.call(this,t)||this;return n.onDisabled=function(e){e.preventDefault()},n.handleBlur=function(){n.setState({isFocused:!1})},n.handleFocus=function(){n.setState({isFocused:!0})},n.handleMouseEnter=function(){n.setState({isHovered:!0})},n.handleMouseLeave=function(){n.setState({
isHovered:!1})},n.onShare=function(e){e.preventDefault(),n.getHandler().handleShare()},n.onSelectAll=function(e){e.preventDefault(),n.getHandler().handleSelectAll()},n.onShowTooltip=function(){n.setState({tooltipShown:!0})},n.onHideTooltip=function(){n.setState({tooltipShown:!1})},n.state={tooltipShown:!1,isFocused:!1,isHovered:!1},n}return n.__extends(t,e),t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getAttachments=function(){return this.props.attachments},t.prototype.getHandler=function(){return this.props.handler},t.prototype.getSelectedAttachmentIds=function(){return this.props.selectedAttachmentIds},t.prototype.shouldDisableActions=function(){var e=this.getRecentItem().federatedRecentItem;return e?!e.hasMenuActions():!this.hasLoadedAttachments()},t.prototype.isAggregation=function(){return this.props.recentItem.attachmentIds.length>1},t.prototype.shouldShowComment=function(){var e=this.getAttachments()[0];return!(!e||!e.commentRawText)},t.prototype.shouldShowThumbnails=function(){var e=this.getRecentItem();return!u.isShareLinkRecentItem(e)&&u.shouldShowThumbnailsForRecentItem(e)},t.prototype.getLoadedAttachmentsCount=function(){return this.getAttachments().filter(function(e){return e.isLoaded}).length},t.prototype.canRenderAttachmentView=function(){var e=this.getLoadedAttachmentsCount();return e===this.getRecentItem().attachmentIds.length||e>=d.MAX_INITIAL_THUMBNAIL_ATTACHMENTS},t.prototype.hasLoadedAttachments=function(){return!(!this.getAttachments().length||!this.getLoadedAttachmentsCount())},t.prototype.getHeading=function(){var e=this.getAttachments();if(e.length<2)return a.Emstring.em_snippet(this.getRecentItem().displayName||"",30);for(var t=this.getRecentItem(),n=t.attachmentIds.length,r=t.uniqueFilterTypes,i=[],s=0,c=e;s<c.length;s++){var l=c[s];l.isLoaded&&l.displayName&&i.push(l.displayName)}switch(r.length){case 1:switch(r[0]){case d.RECENT_EVENT_FILTER_TYPE.PHOTOS:return o.ungettext("%(count)s image","%(count)s images",n).format({count:n});case d.RECENT_EVENT_FILTER_TYPE.VIDEOS:return o.ungettext("%(count)s video","%(count)s videos",n).format({count:n});case d.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES:return o.ungettext("%(count)s visual note","%(count)s visual notes",n).format({count:n})}break;case 2:if(r.indexOf(d.RECENT_EVENT_FILTER_TYPE.PHOTOS)>=0&&r.indexOf(d.RECENT_EVENT_FILTER_TYPE.VIDEOS)>=0)return o._("%(count)s images and videos").format({count:n})}return i.length?p.snippetList(i,30,{totalCount:n}):o.ungettext("%(count)s file","%(count)s files",n).format({count:n})},t.prototype.getSubheading=function(){var e=this.getRecentItem();return u.isShareLinkRecentItem(this.props.recentItem)?e.type===d.RECENT_EVENT_TYPES.FILE_SHARED_ADD?i.createElement("a",{className:"recents-item__subheading-path",href:"/links/your_links",onClick:this.getHandler().handlePathClick},o._("Your links")):i.createElement("div",{className:"recents-item__subheading"},i.createElement("span",{className:"recents-item__subheading-path"},o._("Recently viewed"))):e.paths.length?i.createElement(s.FilePathBreadcrumb,{pathClassname:"recents-item__subheading-path",handlePathClick:this.getHandler().handlePathClick,paths:e.paths}):null},t.prototype.getIcon=function(){var e=this.getRecentItem(),t=e.icon+"_32";if(e.attachmentIds.length>1){for(var n=0,r=this.getAttachments();n<r.length;n++){var i=r[n];if(i.previewInfo){t=i.previewInfo.icon;break}}t=t.replace(/_32$/,"_stack_32")}return t},t.prototype.getThumbnailUrl=function(){var e=this.getAttachments();return 1===e.length&&e[0].thumbnailUrl||void 0},t.prototype.renderShareButton=function(){var e=this.props.renderingInfo.version.getShareButtonVisibility(this.getRecentItem(),this.hasLoadedAttachments());if(e!==d.RecentElementVisibilities.HIDDEN){var t=r({disabled:e===d.RecentElementVisibilities.DISABLED,"button-secondary":!0,"recents-item__share-link":!0});return i.createElement("a",{ref:"shareLink",className:t,href:"#share",onClick:e===d.RecentElementVisibilities.SHOWN?this.onShare:this.onDisabled},o._("Share"))}return null},t.prototype.renderAttachments=function(){return this.shouldShowThumbnails()?this.canRenderAttachmentView()?i.createElement(_.AttachmentListView,{ref:"attachments",attachments:this.getAttachments(),handleToggleSelect:this.getHandler().handleToggleSelect,selectedAttachmentIds:this.getSelectedAttachmentIds(),renderingInfo:this.props.renderingInfo}):i.createElement(g.PendingAttachmentListView,{ref:"pendingAttachments",count:this.getRecentItem().attachmentIds.length}):this.isAggregation()?i.createElement(I.DocAttachmentListView,{ref:"docAttachments",recentItem:this.getRecentItem(),attachments:this.getAttachments(),isCollapsed:this.props.isCollapsed,renderingInfo:this.props.renderingInfo}):this.shouldShowComment()?i.createElement(f.CommentAttachmentView,{ref:"commentAttachment",attachment:this.getAttachments()[0],handlePreview:this.getHandler().handlePreview}):null},t.prototype.renderActions=function(e){return i.createElement(y.RecentActivityItemActionsView,{ref:"recentsItemActionsView",handler:this.getHandler(),tooltipHandler:this,type:this.getRecentItem().type,permissions:e,selectCount:this.getSelectedAttachmentIds().length,attachmentCount:this.getRecentItem().attachmentIds.length,disableActions:this.shouldDisableActions(),rowIsHovered:this.state.isHovered,renderingInfo:this.props.renderingInfo})},t.prototype.renderButton=function(e){var t=this.shouldDisableActions(),n=this.props.renderingInfo.version.maybeRenderSelectAllButton(this.shouldShowThumbnails(),this.getRecentItem(),this.getSelectedAttachmentIds(),t?this.onDisabled:this.onSelectAll,t);return n?n:e.share?i.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this.renderShareButton()):null},t.prototype.getHeaderProps=function(){return{heading:this.getHeading(),subheading:this.getSubheading(),icon:this.getIcon(),thumbnailUrl:this.getThumbnailUrl(),star:this.props.renderingInfo.version.renderStar(this.props.renderingInfo.role,this.getRecentItem())}},t.prototype.renderHeader=function(){var e=l.getRecentActivityItemViewPermissions(this.getRecentItem(),this.getAttachments(),this.getSelectedAttachmentIds());return i.createElement(v.RecentActivityItemHeaderView,{ref:"header",header:this.getHeaderProps(),handleClick:this.isAggregation()?this.getHandler().handleHeaderClick:this.getHandler().handlePreview,tooltipShown:this.state.tooltipShown,recentActivityType:this.getRecentItem().type},this.renderButton(e),this.renderActions(e))},t.prototype.shouldComponentUpdate=function(e,t){return c.compareStateAndProps(e,t)},t.prototype.render=function(){var e=r((o={},o["recents-item"]=!0,o["recents-item--focused-in"]=this.state.isFocused,o["recents-item--loaded"]=this.hasLoadedAttachments(),o)),t=this.shouldShowThumbnails()||!this.isAggregation()?m.ensureUserIntentToClick(this.getHandler().handlePreview):void 0,n=this.getRecentItem();return i.createElement("li",{"data-item-id":n.id,"data-item-type":n.type,"data-item-date":n.when,className:e,onClick:t,onBlur:this.handleBlur,onFocus:this.handleFocus,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},this.renderHeader(),this.renderAttachments());var o},t.displayName="RecentActivityItemView",t.defaultProps={handler:h.getStubRecentActivityItemContainerHandler(),isCollapsed:!0,attachments:[],selectedAttachmentIds:[]},t})(i.PureComponent);t.RecentActivityItemView=E}),define("modules/clean/recents/react/recent_activity_list_view",["require","exports","tslib","external/classnames","external/react","modules/clean/recents/react/recent_activity_item_container"],function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.renderingInfo,t=this.props.items.map(function(t){return i.createElement(o.RecentActivityItemContainer,{key:t.id,recentItem:t,renderingInfo:e})});return i.createElement("ul",{className:r({"recents-list":!0,"recents-list--is-pending":this.props.isPending&&0===t.length})},t)},t})(i.Component);t.RecentActivityListView=a}),define("modules/clean/recents/react/recent_activity_onboarding_modal",["require","exports","tslib","external/react","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement(i.Modal,{className:"recents-onboarding-modal",style:"clean",acceptButtonText:o._("Got it"),onAccept:this.props.onConfirm,autoFocusPrimaryInput:!1},r.createElement("div",null,r.createElement("div",{className:"recents-onboarding-modal__header"},r.createElement("h1",{className:"recents-onboarding-modal__header__text"},o._("Get started with Recents"))),r.createElement("div",{className:"recents-onboarding-modal__body"},r.createElement("h2",{className:"recents-onboarding-modal__subheader"},o._("Find important files fast")),r.createElement("p",{className:"recents-onboarding-modal__p"},o._("Files you’re opening often will stay at the top of your Recents list, so you can get back to them when you need them.")),r.createElement("h2",{className:"recents-onboarding-modal__subheader"},o._("Share files you’ve just edited")),r.createElement("p",{className:"recents-onboarding-modal__p"},o._("When you add or edit files, you’ll see them in Recents. That way, you can find and share them right away.")),r.createElement("h2",{className:"recents-onboarding-modal__subheader"},o._("See photos you’ve just taken")),r.createElement("p",{className:"recents-onboarding-modal__p"},o._("If your photos are saved to Dropbox, you can get to them easily from Recents. You can open or download recent photos right from there.")))))},t.defaultProps={onConfirm:function(){}},t})(r.PureComponent);t.RecentActivityOnboardingModal=a}),define("modules/clean/recents/react/recent_activity_sections_view",["require","exports","tslib","external/react","external/lodash","modules/clean/datetime","modules/clean/recents/react/recent_activity_list_view","modules/clean/react/sticky/container","modules/clean/react/sticky/sticky","modules/core/i18n"],function(e,t,n,r,i,o,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d={today:l._("Today"),yesterday:l._("Yesterday"),thisWeek:l._("This week"),lastWeek:l._("Last week"),thisMonth:l._("This month"),lastMonth:l._("Last month"),lastThreeMonths:l._("Three months ago"),beforeLastThreeMonths:l._("Older")},u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={promptBannerIsVisible:!1},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){document.querySelector(".has-top-notification")&&this.setState({promptBannerIsVisible:!0})},t.prototype.getSections=function(){var e=o.getTimeBands(Date.parse(this.props.localDatetime));return i.groupBy(this.props.items,function(t){var n=t.when;return n>=e.today?"today":n>=e.yesterday?"yesterday":n>=e.thisWeek?"thisWeek":n>=e.lastWeek?"lastWeek":n>=e.thisMonth?"thisMonth":n>=e.lastMonth?"lastMonth":n>=e.lastThreeMonths?"lastThreeMonths":"beforeLastThreeMonths"})},t.prototype.render=function(){var e=this,t=this.getSections(),n=96;this.state.promptBannerIsVisible&&(n+=48);var i=this.props.renderingInfo,o=Object.keys(t).map(function(o){var l=t[o],u=r.createElement("h2",{className:"recents-section__title"},d[o]),h=r.createElement(a.RecentActivityListView,{items:l,isPending:e.props.isPending,renderingInfo:i});return r.createElement("li",{className:"recents-section",key:o},r.createElement(s.StickyContainer,{offsetTop:n},r.createElement(c.Sticky,{offsetHeight:40},u),h))});return r.createElement("ul",{className:"recents-view__sections"},o)},t.defaultProps={localDatetime:Date.now().toString()},t})(r.Component);t.RecentActivitySectionsView=u}),define("modules/clean/recents/react/recent_activity_view",["require","exports","tslib","external/classnames","external/react","modules/clean/components/loading_indicator","modules/clean/recents/recent_activity_constants"],function(e,t,n,r,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderLoadingView=function(){return i.createElement("div",{className:"recents-loading-view",key:"loading"},i.createElement(o.LoadingIndicator,{style:o.LoadingIndicator.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},t.prototype.renderItems=function(){return this.props.renderingInfo.version.renderItems({items:this.props.items,renderingInfo:this.props.renderingInfo,isPending:this.props.isPending,localDatetime:this.props.localDatetime})},t.prototype.renderPendingContent=function(){return[this.renderLoadingView(),this.renderItems()]},t.prototype.renderBlankSlateContent=function(){return[this.props.renderingInfo.version.renderEmptyState(this.props.filter)]},t.prototype.renderLoadedContent=function(){return[this.renderItems(),this.props.isPending?this.renderLoadingView():null]},t.prototype.renderContent=function(){return this.props.items.length?this.renderLoadedContent():this.props.isPending?this.renderPendingContent():this.renderBlankSlateContent()},t.prototype.render=function(){var e=r({"recents-view":!0,"recents-view--is-pending":this.props.isPending&&0===this.props.items.length});return i.createElement("div",{className:e},this.renderContent())},t.displayName="RecentActivityView",t.defaultProps={filter:a.RECENT_EVENT_FILTER_TYPE.ALL,isPending:!1},t})(i.PureComponent);t.RecentActivityView=s}),define("modules/clean/recents/react/recent_maestro_action_sidebar",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/file_uploader/file_uploader","modules/clean/web_timing_logger","modules/clean/react/app_actions_view","modules/clean/sharing/wizard/async_wizard_modals"],function(e,t,n,r,i,o,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleUploadFiles=function(){t.props.activeUser.is_cdm_member&&o.FileUploaderController.setPath(t.props.activeUser.cdm_tmf_path),o.FileUploaderController.showModal()},t.handleCreateSharedFolder=function(){c.asyncShowShareAFolderWizardModal(t.props.activeUser)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){o.FileUploaderController.setUser(this.props.activeUser),a.waitForTTI().then(function(){o.FileUploaderController.loadCoreComponent()})},t.prototype.render=function(){return r.createElement("div",{className:"maestro-recent-action-sidebar"},r.createElement(o.FileUploaderController,{loadOnRender:!1,needToSetStoreValues:!0}),r.createElement(s.AppActionsView,{primaryMenuItem:{displayName:i._("Upload files"),handleClick:this.handleUploadFiles,className:"action-upload"},secondaryMenuItems:[{displayName:i._("New shared folder"),iconName:"new-shared-folder",handleClick:this.handleCreateSharedFolder}]}))},t})(r.Component);t.MaestroRecentActionSidebar=l}),define("modules/clean/recents/react/recents",["require","exports","tslib","external/react","modules/clean/history","modules/clean/recents/actions/recent_activity_actions","modules/clean/recents/react/recents_view","modules/clean/recents/versions/recent_activity_version_1","modules/clean/viewer"],function(e,t,n,r,i,o,a,s,c){"use strict";return(function(e){function t(t){var n=e.call(this,t)||this,r=c.Viewer.get_viewer(),i=r.get_user_by_id(t.user_id);return n.state={viewer:r,user:i},n}return n.__extends(t,e),t.prototype.componentWillMount=function(){var e=this.props,t=e.related_activities_by_key,n=e.user_id;s.RecentActivityVersion1.loadPreFetchedPage(n),o.updateRelatedActivities(t,n)},t.prototype.componentDidMount=function(){i.remove_query_param("role")},t.prototype.render=function(){var e=this.state,t=e.user,n=e.viewer;return r.createElement(a.RecentsView,{user:t,viewer:n,localDatetime:this.props.local_datetime})},t})(r.Component)}),define("modules/clean/recents/react/recents_view",["require","exports","tslib","external/react","modules/clean/recents/react/recent_activity_container","modules/clean/recents/versions/recent_activity_version_1"],function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.localDatetime,n=e.user;return r.createElement("div",null,r.createElement(i.RecentActivityContainer,{user:n,initialRole:n.role,localDatetime:t,version:o.RecentActivityVersion1}),r.createElement("div",{id:"react-file-viewer"}))},t})(r.Component);t.RecentsView=a}),define("modules/clean/recents/react/selectable_view",["require","exports","tslib","external/react","modules/clean/accessibility/utils","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,r,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handletoggleSelected=function(e){e.preventDefault(),e.stopPropagation(),t.props.handleToggleSelect(t.props.id,!t.props.isSelected)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.isSelected?a._("Deselect"):a._("Select");return r.createElement("a",n.__assign({},i.accessibleTriggerProps(this.handletoggleSelected),{className:"attachment-item__checkmark"}),r.createElement("span",{className:"attachment-item__checkmark-inner"},r.createElement(o,{group:"web",name:"white_check",alt:e})))},t.defaultProps={isSelected:!1,handleToggleSelect:function(){}},t})(r.PureComponent);t.SelectableView=s}),define("modules/clean/recents/recent_activity_client",["require","exports","tslib","jquery","external/lodash","modules/clean/ajax","modules/constants/python","modules/core/exception","external/tracekit"],function(e,t,n,r,i,o,a,s,c){"use strict";function l(e,t){return function(n){"ok"===n.status?t(n.payload):e.reject(new Error("Payload not okay: "+n))}}function d(e){return"    "+e}function u(e){return e.split("\n").map(d).join("\n")}function h(e,t){return"abort"!==t&&0!==e.status}function m(e,t){return function(n,r,i){var o="\n      Failed XHR request for "+t+":\n      Exception: "+(i.stack?i:"")+"\n      Response Status: "+JSON.stringify(n.status)+" "+n.statusText+"\n      Response Headers:\n"+u(n.getAllResponseHeaders()||"[No Headers]")+"\n      Response Body:\n"+u(n.responseText?"[No Body]":"")+"\n      ";if(h(n,r)){var a=[],l=c.computeStackTrace(i);l&&l.stack&&(a=l.stack),s._reportException({msg:o,tags:["recents"],severity:i instanceof Error?s.SEVERITY.CRITICAL:s.SEVERITY.NONCRITICAL,stack:a})}e.reject(new T(o,n))}}function p(e){return function(t,n,r){if(h(t,n))throw new Error("Failed XHR request for "+e+": "+r)}}function _(e){return e?o.SilentBackgroundRequest:o.WebRequest}function f(e,t){void 0===t&&(t={});var n=r.Deferred();return _(t.isBackgroundRequest)({url:"/recents/json",type:"POST",subject_user:e,data:{num_activities:20,cursor:t.cursor},dataType:"json",success:l(n,function(e){n.resolve({recentActivities:e.recent_activities,cursor:e.cursor,encrypted:e.encrypted})}),error:m(n,"/recents/json")}),n.promise()}function g(e,t,n){void 0===n&&(n=!1);var i=r.Deferred();return _(n)({url:"/home_feed/retrieve_paper_recents",type:"POST",subject_user:e,data:{is_initial_fetch:t},dataType:"json",success:l(i,function(e){i.resolve({items:e.items,hasMore:e.has_more})}),error:m(i,"/home_feed/retrieve_paper_recents")}),i.promise()}function v(e,t,n){var a=r.Deferred();return o.SilentBackgroundRequest({url:"/activity/generate/json",type:"POST",subject_user:e,data:{activity_keys:JSON.stringify(i.uniq(t)),loading_modes:JSON.stringify([R.PREVIEW_INFO]),encrypted:n},dataType:"json",success:l(a,function(e){a.resolve(e.activities_by_activity_key)}),error:m(a,"/activity/generate/json")}),a.promise()}function y(e,t){o.SilentBackgroundRequest({url:"/recents/logger",type:"POST",subject_user:e,data:t,error:p("/recents/logger")})}function I(e,t){var n=r.Deferred();return o.SilentBackgroundRequest({url:"/recents/check_files_in_root_collection",type:"POST",subject_user:e,data:{files_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){n.resolve({fileInRootCollectionInfo:e.file_in_root_collection_info})}),error:m(n,"/recents/check_files_in_root_collection")}),n.promise()}function E(e,t){var n=r.Deferred();return o.WebRequest({url:"/home_feed/archive_paper_resources",type:"POST",subject_user:e,data:{resources_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){return n.resolve(e)}),error:m(n,"/home_feed/archive_paper_resources")}),n.promise()}function A(e,t){var n=r.Deferred();return o.WebRequest({url:"/recents/create_collection_shared_link",type:"POST",subject_user:e,data:{files_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){n.resolve({link:e.link,tkey:e.tkey,shareableItemCount:e.shareable_item_count})}),error:m(n,"/recents/create_collection_shared_link")}),n.promise()}Object.defineProperty(t,"__esModule",{value:!0});var R=a.FILE_ACTIVITY_LOADING_MODE,T=(function(e){function t(t,n){var r=e.call(this,t)||this;return r.xhr=n,r}return n.__extends(t,e),t})(Error);t.fetchRecentActivities=f,t.fetchPaperRecents=g,t.fetchActivitiesByKey=v,t.postLogEvent=y,t.checkFileInRootCollection=I,t.archivePaperResources=E,t.createCollectionSharedLink=A}),define("modules/clean/recents/recent_activity_constants",["require","exports","modules/constants/python"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RECENT_EVENT_TYPES=n.RECENT_EVENT_TYPES,t.RECENT_EVENT_FILTER_TYPE=n.RECENT_EVENT_FILTER_TYPE,t.RECENT_CREATE_FILTER="createFilter",t.ARCHIVE_PAPER_DOCUMENT_COMMIT="ARCHIVE_PAPER_DOCUMENT_COMMIT",t.ARCHIVE_PAPER_DOCUMENT_PENDING="ARCHIVE_PAPER_DOCUMENT_PENDING",t.ARCHIVE_PAPER_DOCUMENT_ROLLBACK="ARCHIVE_PAPER_DOCUMENT_ROLLBACK",t.DELETE_FILES_COMMIT="DELETE_FILES_COMMIT",t.DELETE_FILES_PENDING="DELETE_FILES_PENDING",t.DELETE_FILES_ROLLBACK="DELETE_FILES_ROLLBACK",t.DESELECT_ATTACHMENTS="DESELECT_ATTACHMENTS",t.RAW_RECENT_ACTIVITY_PARSE_ERROR="RAW_RECENT_ACTIVITY_PARSE_ERROR",t.RAW_RELATED_ACTIVITY_PARSE_ERROR="RAW_RELATED_ACTIVITY_PARSE_ERROR",t.RECEIVE_CAN_OPEN_INFO="RECEIVE_CAN_OPEN_INFO",t.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO="RECEIVE_FILE_IN_ROOT_COLLECTION_INFO",t.RECEIVE_PAPER_RECENT_ITEMS="RECEIVE_PAPER_RECENT_ITEMS",t.RECEIVE_RAW_RECENT_ACTIVITIES="RECEIVE_RAW_RECENT_ACTIVITIES",t.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY="RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY",t.SELECT_ATTACHMENTS="SELECT_ATTACHMENTS",t.MAX_INITIAL_DOC_ATTACHMENTS=3,t.SHOW_MORE_DOC_ATTACHMENT_INCREMENT=10,t.MAX_INITIAL_THUMBNAIL_ATTACHMENTS=8,t.SHOW_MORE_THUMBNAIL_ROW_INCREMENT=4,t.PaperRecentItemTypes={DOCUMENT:"DOCUMENT",FOLDER:"FOLDER",PROJECT:"PROJECT"},t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI=10,t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI=100,t.FederatedOrigins={PAPER:"PAPER"},t.RecentElementVisibilities={SHOWN:"SHOWN",HIDDEN:"HIDDEN",DISABLED:"DISABLED"}}),define("modules/clean/recents/recent_activity_dispatcher",["require","exports","external/flux"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recentActivityDispatcher=new n.Dispatcher}),define("modules/clean/recents/recent_activity_logger",["require","exports","tslib","external/lodash","modules/clean/recents/recent_activity_client","modules/core/exception"],function(e,t,n,r,i,o){"use strict";function a(e,t,r){if(void 0===r&&(r={}),E){var o=n.__assign({},r,{event_name:t});i.postLogEvent(e,o)}}function s(e,t,n){var i=Object.keys(n),a=r.difference(i,t);o.assert(0===a.length,e+" called with unsupported keys: "+a)}function c(){E=!0}function l(){E=!1}function d(){return E}function u(e,t){s("logPageLoaded",f,t),a(e,"client_page_loaded",t)}function h(e,t){s("logRequestFailed",g,t),a(e,"request_failed",t)}function m(e,t){s("logCellAction",v,t),a(e,"cell_action",t)}function p(e,t){s("logTimeToFirstAction",y,t),a(e,"time_to_first_action",t)}function _(e,t){s("logOnboardingAction",I,t),a(e,"onboarding_action",t)}Object.defineProperty(t,"__esModule",{value:!0});t.ActionScopes={SINGLE:"single",SUBSET:"subset",AGGREGATION:"aggregation"},t.ActionTypes={VIEW_FILE:"view",OPEN:"open",SHARE:"share",SHARE_COLLECTION:"share_collection",DELETE:"delete",HIDE:"hide",UNITY_OPEN:"unity_open",OPEN_DIR:"open_dir",OPEN_PATH:"open_path",REPORT_JUNK:"report_junk",COMMENT:"comment",DOWNLOAD:"download",VERSIONS:"versions",VIEW_SHARED_LINK:"view_shared_link",PAPER_ARCHIVE:"paper_archive",PAPER_OPEN:"paper_open",PAPER_SHARE:"paper_share",COLLAPSE:"collapse",UNCOLLAPSE:"uncollapse",ONBOARDING_DISMISSED:"onboarding_dismissed",FULL_ONBOARDING_OPENED:"full_onboarding_opened",FULL_ONBOARDING_DISMISSED:"full_onboarding_dismissed"},t.FilterViews={EVERYTHING:"everything"};var f=["is_full_page","item_count","contains_aggregation","latency","is_paginated"],g=["failure_type","is_paginated"],v=["in_aggregation","filter_view","action_type","target_activity_type","action_scope","position","file_extension","days_ago"],y=["latency","action_type","action_scope"],I=["action_type"],E=!0;t.enableLogging=c,t.disableLogging=l,t.isLoggingEnabled=d,t.logPageLoaded=u,t.logRequestFailed=h,t.logCellAction=m,t.logTimeToFirstAction=p,t.logOnboardingAction=_}),define("modules/clean/recents/recent_activity_logger_utils",["require","exports","tslib","external/react-dom","external/lodash","jquery","modules/clean/recents/recent_activity_logger","modules/clean/web_timing_logger"],function(e,t,n,r,i,o,a,s){"use strict";function c(e){return Math.floor((Date.now()-e)/864e5)}function l(e,t,n,s,l){var u,h=o(r.findDOMNode(l)),m=h.closest(".recents-item"),p=i.uniq(i.map(n,function(e){return null!=e?e.split(".").pop().toLowerCase():void 0})).filter(Boolean),_=s>1;u=1===s?E.SINGLE:n.length===s?E.AGGREGATION:E.SUBSET;var f={in_aggregation:_,filter_view:y.EVERYTHING,action_type:e,action_scope:u,target_activity_type:m.data("item-type"),position:m.prevAll().length,file_extension:p.join(","),days_ago:c(m.data("item-date"))};a.logCellAction(t,f),d(t,i.pick(f,"action_scope","action_type"))}function d(e,t){if(!A){var r=s.start_time();r&&(A=!0,a.logTimeToFirstAction(e,n.__assign({},t,{latency:Date.now()-r})))}}function u(e){return function(t,n,r,i){l(e,t,n,r,i)}}function h(e){return function(t,n,r,i){return u(e)(t,[n],r,i)}}function m(e){a.logOnboardingAction(e,{action_type:"onboarding_dismissed"})}function p(e){a.logOnboardingAction(e,{action_type:"full_onboarding_opened"})}function _(e){a.logOnboardingAction(e,{action_type:"full_onboarding_dismissed"})}function f(e,t){a.logRequestFailed(e,{failure_type:t.status,is_paginated:!1})}function g(){var e=Date.now(),t=!1;if(!R){var r=s.start_time();r&&(t=!0,e=r,R=!0)}return function(r,i){void 0===i&&(i={});var o=n.__assign({is_full_page:t},i,{latency:Date.now()-e});a.logPageLoaded(r,o)}}function v(){R=A=!1}Object.defineProperty(t,"__esModule",{value:!0});var y=a.FilterViews,I=a.ActionTypes,E=a.ActionScopes,A=!1,R=!1;t.logShareFile=h(I.SHARE),t.logShareCollection=u(I.SHARE_COLLECTION),t.logPreviewFiles=u(I.VIEW_FILE),t.logDeleteFiles=u(I.DELETE),t.logUnityOpenFile=h(I.UNITY_OPEN),t.logOpenPathUrl=u(I.OPEN_DIR),t.logOpenSharedLinkUrl=u(I.VIEW_SHARED_LINK),t.logCommentFile=h(I.COMMENT),t.logDownloadFile=u(I.DOWNLOAD),t.logOpenVersions=h(I.VERSIONS),t.logOnboardingClosed=m,t.logOnboardingLearnMore=p,t.logOnboardingModalClosed=_,t.logRequestFailed=f,t.startRequestTimer=g,t.reset=v}),define("modules/clean/recents/recent_activity_prefetch",["require","exports","jquery","modules/clean/recents/store_utils"],function(e,t,n,r){"use strict";function i(e,t){void 0===t&&(t=!1);var n=window;o(e,n.__REGISTER_RECENTS_PRELOAD_HANDLER),t&&a(e,n.__REGISTER_PAPER_RECENTS_PRELOAD_HANDLER)}function o(e,t){t?t(function(t){var i;try{i=JSON.parse(t)}catch(t){return void r.loadRecentItems(e)}var o=n.Deferred();o.resolve({recentActivities:i.payload.recent_activities,cursor:i.payload.cursor,encrypted:i.payload.encrypted}),r.handleAndLogFetchRecentActivitiesPromise(o.promise(),e)},function(){return r.loadRecentItems(e)}):r.loadRecentItems(e)}function a(e,t){t?t(function(t){var i;try{i=JSON.parse(t)}catch(t){return void r.loadPaperRecentItems(e,!0)}var o=n.Deferred();o.resolve({items:i.payload.items,hasMore:i.payload.has_more}),r.handleFetchPaperRecentsPromise(o.promise(),e,!0)},function(){return r.loadPaperRecentItems(e,!0)}):r.loadPaperRecentItems(e,!0)}Object.defineProperty(t,"__esModule",{value:!0}),t.preloadRecentItems=i}),define("modules/clean/recents/recent_activity_rendering_models",["require","exports"],function(e,t){"use strict";function n(){return{handleArchive:function(){},handleComment:function(){},handleDelete:function(){},handleDeselectAll:function(){},handleDownload:function(){},handleHeaderClick:function(){},handleOpen:function(){},handlePathClick:function(){},handlePreview:function(){},handleSelectAll:function(){},handleShare:function(){},handleToggleSelect:function(e,t){},handleVersions:function(){}}}function r(){return{onShowTooltip:function(){},onHideTooltip:function(){}}}Object.defineProperty(t,"__esModule",{value:!0}),t.getStubRecentActivityItemContainerHandler=n,t.getStubRecentActivityTooltipHandler=r}),define("modules/clean/recents/recent_activity_text_helper",["require","exports","modules/clean/em_string","modules/core/i18n"],function(e,t,n,r){"use strict";function i(e,t){return r.ungettext("%(name)s and %(num)s other","%(name)s and %(num)s others",t).format({name:e,num:t})}function o(e,t,o){void 0===o&&(o={});var a=Math.max(Math.floor(o.totalCount||0),e.length);if(1===a)return n.Emstring.em_snippet(e[0],t);var s=e[0],c=a-1,l=i(s,c);if(new n.Emstring(l).length>t){var d=Math.floor(t-new n.Emstring(i("",c)).length)-1;l=d<3?r.ungettext("%(num)s other","%(num)s others",a).format({num:a}):i(n.Emstring.em_snippet(s,d),c)}for(var u="",h=1;h<e.length&&(h+=1,u=e.slice(0,h).join(", "),h<a&&(u=i(u,a-h)),new n.Emstring(u).length<t);)l=u;return l}Object.defineProperty(t,"__esModule",{value:!0}),t.snippetList=o}),define("modules/clean/recents/recent_activity_view_helper",["require","exports"],function(e,t){"use strict";function n(e){return function(t){if(!window.getSelection().toString()){for(var n=t.target;n&&n.parentNode&&n!==t.currentTarget;){if(["a","button"].indexOf(n.nodeName.toLowerCase())>=0)return;n=n.parentNode}e.apply(this,arguments)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.ensureUserIntentToClick=n}),define("modules/clean/recents/store_utils",["require","exports","jquery","external/lodash","modules/core/i18n","modules/clean/recents/stores/attachment_store","modules/clean/web_timing_logger","modules/core/notify","modules/clean/recents/recent_activity_dispatcher","modules/clean/recents/recent_activity_logger_utils","modules/clean/recents/recent_activity_client","modules/clean/recents/recent_activity_constants","modules/clean/recents/models/utils"],function(e,t,n,r,i,o,a,s,c,l,d,u,h){"use strict";function m(e,t){return void 0===t&&(t={}),p(d.fetchRecentActivities(e,t),e,t.cursor)}function p(e,t,n){var r=l.startRequestTimer(),i=e.then(function(e){return f(t,e)}).then(function(){},_(t));return e.then(function(e){return i.then(function(){var i=!1,o=0;e.recentActivities.forEach(function(e){e.skeleton_data&&(o+=e.skeleton_data.num_related_activities||0,(e.skeleton_data.num_related_activities||0)>1&&(i=!0))}),r(t,{is_paginated:!!n,contains_aggregation:i,item_count:o})})})}function _(e){return function(t){l.logRequestFailed(e,t)}}function f(e,t){return g(e,t.recentActivities,t.cursor,t.encrypted),v(e,t.recentActivities)}function g(e,t,n,r){c.recentActivityDispatcher.dispatch({type:u.RECEIVE_RAW_RECENT_ACTIVITIES,rawRecentActivities:t,cursor:n||"",encrypted:r||"",userId:e})}function v(e,t){var r=[];return t.forEach(function(e){if(e.skeleton_data&&e.related_activity_keys){
var t=h.shouldShowThumbnailsForSkeletonData(e.skeleton_data)?u.MAX_INITIAL_THUMBNAIL_ATTACHMENTS:u.MAX_INITIAL_DOC_ATTACHMENTS;e.related_activity_keys.slice(0,t).forEach(function(e){return r.push(e)})}}),n.Deferred(function(t){return a.waitForTTI().then(function(){return E(e,r).then(function(e){return t.resolve(e)})})})}function y(e,t,n){void 0===n&&(n=!1),I(d.fetchPaperRecents(e,t,n),e,t)}function I(e,t,n){e.then(function(e){var r=n&&e.hasMore;c.recentActivityDispatcher.dispatch({type:u.RECEIVE_PAPER_RECENT_ITEMS,items:e.items,hasMore:r,userId:t}),r&&a.waitForTTI().then(function(){return y(t,!1)})},_(t))}function E(e,t){var i=o.attachmentStore.groupIdsByEncryptedToken(t),a=r.map(i,function(t,n){return d.fetchActivitiesByKey(e,t,n).then(function(t){return A(e,t)})});return n.when.apply(n,a).then(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={};return e.forEach(function(e){r.map(e,function(e,t){n[t]=e})}),n})}function A(e,t){return c.recentActivityDispatcher.dispatch({type:u.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:t,userId:e}),R(t,e),S(t,e),t}function R(e,t){if(e){T(w(e),t).then(function(e){c.recentActivityDispatcher.dispatch({type:u.RECEIVE_CAN_OPEN_INFO,canOpenInfo:e})})}}function T(t,i){var o=n.Deferred();return e(["modules/clean/unity/features"],function(e){r.isUndefined(e)||e.check_file_batch(t,i).then(function(e){o.resolve(e)})}),o.promise()}function w(e){return r.values(e).map(function(e){return{ns_id:e.ns_id,ns_path:e.ns_path}})}function S(e,t){if(e){var n=w(e);d.checkFileInRootCollection(t,n).then(function(e){c.recentActivityDispatcher.dispatch({type:u.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO,fileInRootCollectionInfo:e.fileInRootCollectionInfo})})}}function C(e,t,n){var a=o.attachmentStore.getByIds(t),c=a.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});c.length?E(e,c).then(function(){return C(e,t,n)},function(){return s.error(i._("There was a problem completing this request."))}):r.defer(function(){return n(a)})}Object.defineProperty(t,"__esModule",{value:!0}),t.loadRecentItems=m,t.handleAndLogFetchRecentActivitiesPromise=p,t.getOnFail=_,t.updateRecentActivities=g,t.loadAttachmentsForRecentActivities=v,t.loadPaperRecentItems=y,t.handleFetchPaperRecentsPromise=I,t.loadAttachments=E,t.ensureAttachments=C}),define("modules/clean/recents/stores/attachment_store",["require","exports","tslib","external/lodash","modules/clean/flux/flux_store","modules/clean/recents/actions/error_actions","modules/clean/recents/stores/flux_utils","modules/clean/recents/recent_activity_constants","modules/clean/recents/recent_activity_dispatcher","modules/clean/recents/models/attachment","modules/core/exception"],function(e,t,n,r,i,o,a,s,c,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this,t)||this;return r.onCommit=function(e){delete r.transactionHistory[e.transactionId]},r._onDeleteFilesPending=function(e){for(var t=[],n=0,i=e.attachmentIds;n<i.length;n++){var o=i[n];o in r.attachmentIdToAttachment&&(t.push(r.attachmentIdToAttachment[o]),delete r.attachmentIdToAttachment[o])}r.transactionHistory[e.transactionId]={deletedAttachments:t},a.emitChangeIfNeeded(r,!!t.length)},r._onDeleteFilesRollback=function(e){var t=r.transactionHistory[e.transactionId];d.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),t.deletedAttachments.forEach(function(e){return r.attachmentIdToAttachment[e.id]=e}),a.emitChangeIfNeeded(r,!!t.deletedAttachments.length)},r.attachmentIdToEncryptedToken={},r.attachmentIdToAttachment={},(n.attachments||[]).forEach(function(e){r.attachmentIdToAttachment[e.id]=e,n.encryptedToken&&(r.attachmentIdToEncryptedToken[e.id]=n.encryptedToken)}),r.transactionHistory={},r}return n.__extends(t,e),t.prototype.getById=function(e){return this.attachmentIdToAttachment[e]||null},t.prototype.getByIds=function(e){return r.values(r.pick(this.attachmentIdToAttachment,e))},t.prototype.getByFqPath=function(e){return this.getAll().find(function(t){return t.fqPath===e})||null},t.prototype.getAll=function(){return r.values(this.attachmentIdToAttachment)},t.prototype.groupIdsByEncryptedToken=function(e){var t=this;return r.groupBy(e.filter(function(e){return e in t.attachmentIdToEncryptedToken}),function(e){return t.attachmentIdToEncryptedToken[e]})},t.prototype.__onDispatch=function(e){switch(e.type){case s.DELETE_FILES_COMMIT:this.onCommit(e);break;case s.DELETE_FILES_PENDING:this._onDeleteFilesPending(e);break;case s.DELETE_FILES_ROLLBACK:this._onDeleteFilesRollback(e);break;case s.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case s.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case s.RECEIVE_CAN_OPEN_INFO:this._onReceiveCanOpenInfo(e);break;case s.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:this._onReceiveFileInRootCollectionInfo(e)}},t.prototype.mutateAttachmentInNsIdPath=function(e,t){if(e&&e.indexOf(":")>=0){var n=e.split(":"),r=n[0],i=n[1],o=this.getAll().find(function(e){return e.nsId===Number(r)&&e.nsPath===i})||null;if(o){var s=a.getMutatedOrOriginal(o,t);if(s!==o)return this.attachmentIdToAttachment[o.id]=s,!0}}return!1},t.prototype.onReceiveRawRecentActivities=function(e){var t=this,n=e.rawRecentActivities.map(l.createPartialAttachmentsFromRecentActivity),r=(i=[]).concat.apply(i,n).filter(function(e){var n=t.getById(e.id);return!n||!n.isLoaded});r.forEach(function(n){t.attachmentIdToAttachment[n.id]=n,t.attachmentIdToEncryptedToken[n.id]=e.encrypted}),a.emitChangeIfNeeded(this,!!r.length);var i},t.prototype.onReceiveRawRelatedActivitiesByKey=function(e){var t=this;e.rawRelatedActivitiesByKey&&a.iterateAndEmitChangesIfNeeded(this,e.rawRelatedActivitiesByKey,function(e,n){try{var i=l.convertFileActivityToAttachmentItem(e);return t.attachmentIdToAttachment[i.id]=i,!0}catch(e){return r.defer(function(){return o.errorActions.relatedActivityParseError(n,e)}),!1}})},t.prototype._onReceiveCanOpenInfo=function(e){var t=this;a.iterateAndEmitChangesIfNeeded(this,e.canOpenInfo,function(e,n){return t.mutateAttachmentInNsIdPath(n,{canOpen:e.is_locally_available})})},t.prototype._onReceiveFileInRootCollectionInfo=function(e){var t=this;a.iterateAndEmitChangesIfNeeded(this,e.fileInRootCollectionInfo,function(e,n){return t.mutateAttachmentInNsIdPath(n,{inRootCollection:e})})},t})(i);t.AttachmentStore=u,t.attachmentStore=new u(c.recentActivityDispatcher)}),define("modules/clean/recents/stores/flux_utils",["require","exports","tslib"],function(e,t,n){"use strict";function r(e,t,n){var r=!1;Object.keys(t).forEach(function(e){n(t[e],e)&&(r=!0)}),i(e,r)}function i(e,t){t&&e.__emitChange()}function o(e,t){for(var r in t)if(t[r]!==e[r])return n.__assign({},e,t);return e}Object.defineProperty(t,"__esModule",{value:!0}),t.iterateAndEmitChangesIfNeeded=r,t.emitChangeIfNeeded=i,t.getMutatedOrOriginal=o}),define("modules/clean/recents/stores/recent_activity_store",["require","exports","tslib","external/lodash","modules/clean/recents/recent_activity_constants","modules/clean/flux/flux_store","modules/clean/recents/recent_activity_constants","modules/clean/recents/recent_activity_dispatcher","modules/clean/recents/models/recent_item","modules/clean/recents/models/utils","modules/clean/recents/models/utils","modules/clean/recents/stores/flux_utils","modules/clean/recents/stores/attachment_store","modules/clean/web_timing_logger","modules/core/exception"],function(e,t,n,r,i,o,a,s,c,l,d,u,h,m,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=r.values(i.RECENT_EVENT_FILTER_TYPE),f=i.RECENT_EVENT_FILTER_TYPE.ALL,g=i.RECENT_EVENT_FILTER_TYPE.JUNK,v=(function(e){function t(t,n,i){void 0===i&&(i=[]);var o=e.call(this,t)||this;return o.removeItem=function(e){o.idToItem.hasOwnProperty(e.id)&&(delete o.idToItem[e.id],o.needsToRefreshCache=!0)},o.addItem=function(e){e!==o.idToItem[e.id]&&(o.idToItem[e.id]=e,o.needsToRefreshCache=!0)},o.idToItem={},o.userIdToCursor={},o.userIdToIsLoaded={},o.attachmentStore=n,o.didReceiveRawRecentActivities=!1,o.markReceivedDataForTTI=r.once(function(){return m.log_js_modules_fetched_data_required_for_tti()}),o.transactionIdToRestoreData={},i.forEach(o.addItem),o.cache={items:i},o.needsToRefreshCache=!1,o}return n.__extends(t,e),t.prototype.getAll=function(){return this.cache.sortedItems||(this.cache.sortedItems=this.cache.items.slice().sort(l.compareRecentItems))},t.prototype.didReceiveRecentActivities=function(){return this.didReceiveRawRecentActivities},t.prototype.cursorForUser=function(e){return this.userIdToCursor[e]||null},t.prototype.isLoadedForUser=function(e){return this.userIdToIsLoaded.hasOwnProperty(String(e))},t.prototype.getById=function(e){return this.idToItem[e]||null},t.prototype.filterItemsForUser=function(e,t){var n=e+":"+t;return this.cache.userIdFilterPairToSortedItems||(this.cache.userIdFilterPairToSortedItems={}),this.cache.userIdFilterPairToSortedItems.hasOwnProperty(n)||(p.assert(_.indexOf(t)>=0,"filter must be one of "+_),this.cache.userIdFilterPairToSortedItems[n]=this.getAll().filter(function(n){return n.viewingUserId===e&&(t===f&&n.uniqueFilterTypes.indexOf(g)<0||n.uniqueFilterTypes.indexOf(t)>=0)})),this.cache.userIdFilterPairToSortedItems[n]},t.prototype.__onDispatch=function(e){switch(e.type){case a.DELETE_FILES_COMMIT:this.onCommit(e);break;case a.DELETE_FILES_PENDING:this.onDeleteFilesPending(e);break;case a.DELETE_FILES_ROLLBACK:this.onDeleteFilesRollback(e);break;case a.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case a.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case a.RAW_RELATED_ACTIVITY_PARSE_ERROR:this.onRawRelatedActivityParseError(e);break;default:return}this.updateCache(!0)},t.prototype.updateCache=function(e){this.needsToRefreshCache&&(this.cache={items:r.values(this.idToItem)},this.needsToRefreshCache=!1,u.emitChangeIfNeeded(this,e))},t.prototype.onCommit=function(e){delete this.transactionIdToRestoreData[e.transactionId]},t.prototype.onReceiveRawRecentActivities=function(e){var t=this;this.didReceiveRawRecentActivities||e.rawRecentActivities.length||(this.didReceiveRawRecentActivities=!0,this.__emitChange()),this.didReceiveRawRecentActivities=!0,this.markReceivedDataForTTI();var n=!this.cache.items.length,i={};if(e.rawRecentActivities.forEach(function(e){var o=c.convertRecentActivityToRecentItem(e);if(o)if(n)t.idToItem[o.id]=o;else if(!i[o.id]){i[o.id]=o;var a=t.cache.items.find(function(e){return e.id!==o.id&&e.contextDisplayName===o.contextDisplayName});if(a){var s=r.intersection(a.attachmentIds,o.attachmentIds);s.length>0&&(t.removeItem(a),t.updateCache(!1))}var l=t.getById(o.id);t.updateItem(o,{paths:l&&l.paths||o.paths})}}),this.updateCache(!1),!n){var o={};this.getAll().forEach(function(e){if(e.attachmentIds.length>0){var n=Object.keys(o).length;e.attachmentIds.forEach(function(e){return o[e]=!0}),n===Object.keys(o).length&&t.removeItem(e)}})}this.userIdToIsLoaded[e.userId]=!0,this.userIdToCursor[e.userId]=e.cursor,this.needsToRefreshCache=!0},t.prototype.onReceiveRawRelatedActivitiesByKey=function(e){var t=this;this.waitForAttachmentStoreDispatcher();var n=Object.keys(e.rawRelatedActivitiesByKey||{});this.getRecentItemsByAttachmentIds(n).forEach(function(e){var n=e.id,r=t.getById(n);if(r){var i=r.attachmentIds;if(i&&i.length){var o=t.attachmentStore.getById(i[0]);if(o&&o.isLoaded){var a=o.fqPath||"";i.slice(1).forEach(function(e){var n=t.attachmentStore.getById(e);if(n.isLoaded){var r=n.fqPath||"";r.split("/").length<a.split("/").length&&(a=r)}});var s=a.split("/"),c=s[s.length-2];t.updateItem(r,{paths:d.getPathsByFqPath(a,r.viewingUserId),contextDisplayName:c||r.contextDisplayName})}}}})},t.prototype.onRawRelatedActivityParseError=function(e){this.getRecentItemsByAttachmentIds(r.map(e.errors,"activityKey")).forEach(this.removeItem)},t.prototype.onDeleteFilesPending=function(e){this.waitForAttachmentStoreDispatcher();var t=this.deleteAttachments(e.attachmentIds);t&&(this.transactionIdToRestoreData[e.transactionId]=t)},t.prototype.onDeleteFilesRollback=function(e){this.waitForAttachmentStoreDispatcher();var t=this.transactionIdToRestoreData[e.transactionId];p.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),delete this.transactionIdToRestoreData[e.transactionId],this.rollbackDelete(t)},t.prototype.deleteAttachments=function(e){var t=null;if(e.length){var n=this.getRecentItemsByAttachmentIds([e[0]])[0];if(n){var i=r.difference(n.attachmentIds,e);this.updateItem(n,{attachmentIds:i}),t={deletedAttachmentIds:e,item:n},0===i.length&&this.removeItem(n)}}return t},t.prototype.rollbackDelete=function(e){var t,n=this.getById(e.item.id);n?t=n.attachmentIds:(n=e.item,t=[]),this.updateItem(n,{attachmentIds:r.uniq(t.concat.apply(t,e.deletedAttachmentIds))})},t.prototype.getCachedAttachmentIdToIdToItem=function(){var e=this;return this.cache.attachmentIdToIdToItem||(this.cache.attachmentIdToIdToItem={},this.cache.items.forEach(function(t){return t.attachmentIds.forEach(function(n){e.cache.attachmentIdToIdToItem[n]?e.cache.attachmentIdToIdToItem[n][t.id]=t:e.cache.attachmentIdToIdToItem[n]=(r={},r[t.id]=t,r);var r})})),this.cache.attachmentIdToIdToItem},t.prototype.getRecentItemsByAttachmentIds=function(e){var t=this.getCachedAttachmentIdToIdToItem(),n={};return e.forEach(function(e){t.hasOwnProperty(e)&&r.values(t[e]).forEach(function(e){return n[e.id]=e})}),r.values(n)},t.prototype.waitForAttachmentStoreDispatcher=function(){this.getDispatcher().waitFor([this.attachmentStore.getDispatchToken()])},t.prototype.updateItem=function(e,t){this.addItem(u.getMutatedOrOriginal(e,t))},t})(o);t.RecentActivityStore=v,t.recentActivityStore=new v(s.recentActivityDispatcher,h.attachmentStore)}),define("modules/clean/recents/stores/selection_store",["require","exports","tslib","external/lodash","modules/clean/flux/flux_store","modules/clean/recents/recent_activity_constants","modules/clean/recents/recent_activity_dispatcher"],function(e,t,n,r,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(t,n,r){void 0===n&&(n=null),void 0===r&&(r=[]);var i=e.call(this,t)||this;return i.selectedAttachmentIds=r,i.recentItemId=n,i}return n.__extends(t,e),t.prototype.getByRecentItemId=function(e){return e===this.recentItemId?this.selectedAttachmentIds:[]},t.prototype.__onDispatch=function(e){switch(e.type){case o.SELECT_ATTACHMENTS:this._onReceiveSelectAttachments(e);break;case o.DESELECT_ATTACHMENTS:this._onReceiveDeselectAttachments(e)}},t.prototype._onReceiveSelectAttachments=function(e){this.recentItemId!==e.recentItemId&&(this.recentItemId=e.recentItemId,this.selectedAttachmentIds=[]),this.selectedAttachmentIds=r.uniq((t=this.selectedAttachmentIds).concat.apply(t,e.attachmentIds)),this.__emitChange();var t},t.prototype._onReceiveDeselectAttachments=function(e){this.recentItemId!==e.recentItemId&&(this.recentItemId=e.recentItemId,this.selectedAttachmentIds=[]),this.selectedAttachmentIds=this.selectedAttachmentIds.filter(function(t){return e.attachmentIds.indexOf(t)===-1}),this.__emitChange()},t})(i);t.SelectionStore=s,t.selectionStore=new s(a.recentActivityDispatcher)}),define("modules/clean/recents/versions/recent_activity_actions_menu_version_1",["require","exports","external/spectrum/popover","external/spectrum/overflow_button","external/react","modules/core/i18n","modules/clean/recents/versions/recent_activity_version_shared"],function(e,t,n,r,i,o,a){"use strict";function s(e,t,r,o){return e?i.createElement(n.PopoverContentItem,{className:"recents-item-action-"+r,onClick:o},t):null}function c(e){return i.createElement(n.PopoverTrigger,{"aria-label":o._("More actions"),disabled:e.props.disableActions},i.createElement(r.OverflowButton,{"aria-label":o._("More actions"),variant:e.props.rowIsHovered?"secondary":"borderless",disabled:e.props.disableActions,tagName:"span"}))}function l(e){var t=e.props.permissions;return i.createElement(n.PopoverContent,{className:"recents-overflow-menu-content",attachment:"right"},s(e.canOpen(),a.ACTION_LABELS.OPEN,"open",e.onOpen),s(t.download,e.getDownloadLabel(),"download",e.onDownload),s(t.comment,a.ACTION_LABELS.COMMENT,"comment",e.onComment),s(t.delete,e.getDeleteLabel(),"delete",e.onDelete),s(t.versions,a.ACTION_LABELS.VERSION,"versions",e.onVersions),s(e.canSelect(),a.ACTION_LABELS.SELECT,"select",e.onSelectAll),s(e.canDeselect(),a.ACTION_LABELS.DESELECT,"deselect",e.onDeselectAll))}function d(e){return i.createElement(n.Popover,{onSelection:u},c(e),l(e))}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){return null};t.renderMoreActionsMenu=d}),define("modules/clean/recents/versions/recent_activity_version_1",["require","exports","tslib","external/lodash","external/classnames","modules/core/i18n","external/react","modules/clean/recents/models/utils","modules/clean/web_timing_logger","modules/clean/recents/recent_activity_prefetch","modules/clean/recents/react/recent_activity_sections_view","modules/clean/recents/recent_activity_constants","modules/clean/recents/react/recent_activity_blank_slate_view","modules/clean/recents/actions/file_viewer_actions","modules/clean/recents/stores/recent_activity_store","modules/clean/recents/versions/recent_activity_version_shared","modules/clean/react/maestro/header","modules/clean/react/maestro/layout","modules/clean/recents/react/recent_maestro_action_sidebar","modules/clean/recents/versions/recent_activity_actions_menu_version_1"],function(e,t,n,r,i,o,a,s,c,l,d,u,h,m,p,_,f,g,v,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=(function(t){function I(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(I,t),I.prototype.renderStar=function(e,t){return null},I.prototype.renderEmptyState=function(e){return a.createElement(h.RecentActivityBlankSlateView,{ref:"blankslate",filter:e})},I.prototype.maybeRenderSelectAllButton=function(e,t,n,r,s){if(e&&t.attachmentIds.length>1&&0===n.length){var c=i({disabled:s,"button-secondary":!0,"recents-action-button":!0});return a.createElement("div",{className:"recents-item__select-all recents-item__action-button"},a.createElement("a",{ref:"selectAllButton",className:c,href:"#select-all",onClick:r},o._("Select all")))}return null},I.prototype.getRecentItems=function(e,t){return _.getRecentItemsFromAntenna(e,t)},I.prototype.didReceiveRecentActivities=function(){return p.recentActivityStore.didReceiveRecentActivities()},I.prototype.isStoreReadyForUserId=function(e,t){var n=p.recentActivityStore.isLoadedForUser(e);return this.didReceiveRecentActivities()&&!t&&(n=!0),n},I.prototype.loadPreFetchedPage=function(e){l.preloadRecentItems(e,!1)},I.prototype.shouldLoadMore=function(e,t){return!0},I.prototype.handlePathClick=function(e,t,n){},I.prototype.shouldRenderItemActions=function(e){return!0},I.prototype.previewRecentItem=function(e,t,n,r){m.previewFiles(e.viewingUserId,s.extractAttachmentIds(t),{index:n.index||0,shouldFocusCommentInput:n.shouldFocusCommentInput===!0},this.getLoggingInfo(r))},I.prototype.possiblyRequireFileViewer=function(){e(["modules/clean/react/file_viewer/controller"],function(){return null})},I.prototype.getShareButtonVisibility=function(e,t){return t?u.RecentElementVisibilities.SHOWN:u.RecentElementVisibilities.DISABLED},I.prototype.maybeInitLoggingAndGetTTILogger=function(){return c.log_js_modules_application_code_start(),r.once(function(){return c.mark_time_to_interactive()})},I.prototype.renderRecentActivityContainer=function(e,t,n){return a.createElement(g.MaestroChrome,{user:t,titleRegion:a.createElement(f.MaestroHeaderTitle,null,o._("Recents")),embeddedAppRegion:e,actionSidebarRegion:a.createElement(v.MaestroRecentActionSidebar,{activeUser:n})})},I.prototype.renderItems=function(e){return a.createElement(d.RecentActivitySectionsView,n.__assign({key:"sections"},e))},I.prototype.prefetchOnMount=function(e){},I.prototype.renderItemActionsPlaceholder=function(){return null},I.prototype.renderMoreActionsElement=function(e){return y.renderMoreActionsMenu(e)},I.prototype.previewAttachment=function(e,t,n){var r=t.find(function(t){return t.id===e});m.previewFiles(r.viewingUserId,s.extractAttachmentIds(t),{index:t.indexOf(r)},this.getLoggingInfo(n))},I.prototype.logEvent=function(e,t,n,r,i){},I})(_.RecentActivityVersionShared);t.RecentActivityVersion1=new I}),define("modules/clean/recents/versions/recent_activity_version_shared",["require","exports","tslib","modules/core/i18n","modules/clean/recents/actions/recent_activity_actions","modules/clean/recents/models/utils","modules/clean/recents/store_utils","modules/clean/recents/stores/recent_activity_store","modules/core/exception"],function(e,t,n,r,i,o,a,s,c){"use strict";function l(e,t){return s.recentActivityStore.filterItemsForUser(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var d=(function(){function e(){}return e.prototype.getRemoveStoreListeners=function(e){return s.recentActivityStore.addListener(e)},e.prototype.loadPage=function(e,t){void 0===t&&(t=!1),a.loadRecentItems(e,{isBackgroundRequest:t})},e.prototype.getLoggingInfo=function(e){return n.__assign({homeLogEventFunction:this.logEvent},e)},e.prototype.shareRecentItem=function(e,t,n){var r=e.viewingUserId;if(1===e.attachmentIds.length||1===t.length)i.shareFile(r,t[0].id,this.getLoggingInfo(n));else{var a=o.extractAttachmentIds(t);i.shareCollection(r,a,this.getLoggingInfo(n))}},e.prototype.previewOrBrowseRecentItem=function(e,t,n,r){if(n.shouldBrowse){var o=t[0].entityUri;o?i.browseFile(o):c.reportStack("Missing entityUri. Cannot browse/preview",{severity:c.SEVERITY.NONCRITICAL,exc_extra:{recent_item:e,attachments:t}})}else this.previewRecentItem(e,t,n,r)},e.prototype.deleteRecentItem=function(e,t,n){i.promptAndDeleteAttachments(e.viewingUserId,o.extractAttachmentIds(t),this.getLoggingInfo(n))},e.prototype.archiveRecentItem=function(e,t){c.reportStack("Archiving is not supported",{severity:c.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e}})},e})();t.RecentActivityVersionShared=d,t.getRecentItemsFromAntenna=l,t.ACTION_LABELS={OPEN:r._("Open"),COMMENT:r._("Comment"),ARCHIVE:r._("Archive"),VERSION:r._("Version history"),SELECT:r._("Select all"),DESELECT:r._("Deselect all")}});
//# sourceMappingURL=pkg-recents.min.js-vflqjTq0Z.map