define("modules/clean/auth/u2f",["require","exports","external/u2f-api","modules/core/browser"],function(e,t,o,i){"use strict";function r(){var e=i.chrome===!0&&parseInt(i.version,10)>=38||Boolean(a),t=i.is_mobile_or_tablet();return e&&!t}function n(e,t,i,r){(a?a:o).register(e,t,i,r)}function s(e,t,i,r){(a?a:o).sign(e,t,i,r)}Object.defineProperty(t,"__esModule",{value:!0});(function(e){var t;(function(e){e.bt="bt",e.ble="ble",e.nfc="nfc",e.usb="usb"})(t||(t={}));(function(e){e[e.OK=0]="OK",e[e.OTHER_ERROR=1]="OTHER_ERROR",e[e.BAD_REQUEST=2]="BAD_REQUEST",e[e.CONFIGURATION_UNSUPPORTED=3]="CONFIGURATION_UNSUPPORTED",e[e.DEVICE_INELIGIBLE=4]="DEVICE_INELIGIBLE",e[e.TIMEOUT=5]="TIMEOUT"})(e.ErrorCode||(e.ErrorCode={}))})(t.FidoU2f||(t.FidoU2f={}));var a=window.u2f;t.U2F_PROTOCOL="u2f_js1.1",t.isSupportedBrowser=r,t.register=n,t.sign=s}),define("modules/clean/auth_event_logger",["require","exports","modules/clean/api_v2/client","modules/core/browser"],function(e,t,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthEventLogger={log_intent:function(){(new o.ApiV2Client).ns("auth_logger").rpc("log_auth_event",{event_name:{".tag":"web_login_intent"},event_url:i.get_href()},{subjectUserId:null})}}}),define("modules/clean/legacy_pyxl_controllers/login_form",["require","exports","tslib","external/pixie","jquery","modules/clean/ajax","modules/clean/auth_event_logger","modules/clean/captcha","modules/clean/dbmodal","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/sso_login_checks","modules/constants/pixie","modules/core/browser","modules/core/html","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/abuse/recaptcha_helper","modules/clean/auth/u2f","modules/constants/login_and_register","modules/clean/web_timing_logger","modules/clean/react/paper/paper_log"],function(e,t,o,i,r,n,s,a,l,c,h,u,d,p,g,m,f,_,F,w,b,y,v,E,T){"use strict";return(function(){function t(t,l,h,u,m,y,T,S,$,C,k,O){void 0===u&&(u=!1),void 0===m&&(m=!0),void 0===y&&(y=!1),void 0===T&&(T=null),void 0===S&&(S=null),void 0===$&&($=!0),void 0===C&&(C=!0),void 0===k&&(k=!1),void 0===O&&(O=!1);var P=this;this.captchaLoadedCallback=function(){if(P.$loginForm.find(".recaptcha_invisible_challenge").length){var e={preventDefault:function(){}},t=function(){var t=r(r("body").find("[title='recaptcha challenge']")).css("visibility");P.loginController.add_additional_data({invisible_captcha_present:P.$loginForm.find(".recaptcha_invisible_challenge").length>0,invisible_captcha_shown:"visible"===t}),P.loginController._submit_form(e)},o=r(P.$loginForm.find(".recaptcha_invisible_challenge"));v.IS_SELENIUM_TEST||(P.invisible_widget_id=window.grecaptcha.render(o.attr("id"),{sitekey:o.attr("data-sitekey"),badge:"inline",callback:t},!0))}},this.loginType=l,this.variant=h,this.inlineGoogleLoginErrors=y,this.signupTag=T,this.signupEndpoint=S,this.canRedirect=$,this.keepUrlFragment=C,this.useCurrentUri=k,this.multiLogin="multi"===this.loginType,this.pairing="pairing"===this.loginType,this.$loginForm=t.find(".login-form"),this.$rebrandLoginSubContainer=t.find(".login-form-container--subcontainer"),this.$googleAuthContainer=t.find(".login-form-container__google-div"),this.$allTwoFactorForms=t.find(".two-factor-form"),this.$twoFactorPhoneForm=t.find(".two-factor-form.2fa-phone-form"),this.$twoFactorSeckeyForm=t.find(".two-factor-form.2fa-seckey-form"),this.$loginViaEmailForm=t.find(".login-via-email-link"),this.$signUpButton=t.find(".sign-up-button"),this.$loginForm.is(":visible")&&s.AuthEventLogger.log_intent();try{var R=t.find('[name="login_sd"]').attr("id");O?E.waitForTTI().then(function(){new Promise(function(t,o){e(["external/cyfd"],t,o)}).then(function(e){P.cyberfend=e,P.cyberfend.listFunctions._setSDFieldNames(R)})}):new Promise(function(t,o){e(["external/cyfd"],t,o)}).then(function(e){P.cyberfend=e,P.cyberfend.listFunctions._setSDFieldNames(R)})}catch(e){f.reportStack("cyberfend module exception",{tags:["cyberfend"]})}this.$twoFactorForm=this.$twoFactorPhoneForm,u||e(["modules/clean/unity/features/web_destiny_ui"],function(e){new e(t).maybe_show_web_destiny()}),this.loginController=new c(this.$loginForm,this.beforeSubmit.bind(this),{should_submit_once:!0}),b.LoadRecaptcha().then(function(){P.captchaLoadedCallback()});var L={preventDefault:function(){}};if(this.$loginForm.find(".recaptcha_invisible_challenge").length)this.$loginForm.off("submit"),this.$loginForm.submit(function(e){e.preventDefault(),e.stopImmediatePropagation(),n.WebRequest({type:"POST",url:"/needs_captcha",data:{email:P.$loginForm.find("input[name='#login_email']").val(),invisible:!0},success:function(e){JSON.parse(e).captcha_whitelisted?P.loginController._submit_form(L):window.grecaptcha.execute(P.invisible_widget_id)},error:function(){F.error(_._("There was a problem completing this request."))}})});else if(this.$loginForm.find(".recaptcha_v2_challenge").length){var I=r(this.$loginForm.find(".recaptcha_v2_challenge"));this.$captchaComponent=new a(this.$loginForm,I.attr("id"),null,"/needs_captcha","login_email",this.variant,!0)}else this.$captchaComponent=new a(this.$loginForm,"#react-login-recaptcha-challenge-div","#react-signup-recaptcha-challenge-div","/needs_captcha","login_email",this.variant);this.$loginForm.on(c.SUCCESS_EVENT,this.loginSuccess.bind(this)),this.$loginForm.on(c.ERROR_EVENT,function(e,t){if(P.$loginForm.find(".recaptcha_invisible_challenge").length)window.grecaptcha.reset(P.invisible_widget_id);else{var o=null!=t?t.recaptcha_response:void 0;P.$captchaComponent.captcha_display_handler(o)}return P.$loginForm.find(".login-via-email-blade-link").click(P.loginViaEmailStart.bind(P))}),this.$loginForm.is(":visible")&&0===this.$loginForm.find(".recaptcha_invisible_challenge").length&&this.$captchaComponent.captcha_display_handler();var U=w.parse(this.$loginForm.find("input[name='cont']").val());this.useCurrentUri&&(U=w.parse(g.get_href())),this.keepUrlFragment&&U.setFragment(window.location.hash.substr(1)),this.cont=U.toString(),this.twoFactorPhoneController=new c(this.$twoFactorPhoneForm,function(){return null},{should_submit_once:!0}),this.twoFactorSeckeyController=new c(this.$twoFactorSeckeyForm,function(){return null},{should_submit_once:!0}),this.twoFactorController=this.twoFactorPhoneController,this.$twoFactorPhoneForm.on(c.SUCCESS_EVENT,this.twoFactorSuccess.bind(this)),this.$twoFactorSeckeyForm.on(c.SUCCESS_EVENT,this.twoFactorSuccess.bind(this)),this.$twoFactorSeckeyForm.on(c.ERROR_EVENT,function(e,t){return P.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions .error-msg").text(t.u2f.message_text),P.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions").toggle()}),this.$twoFactorPhoneForm.find(".resend-two-factor-code").click(this.resendCode.bind(this)),this.$twoFactorSeckeyForm.find(".two-factor-use-phone-instead").click(this.usePhoneInstead.bind(this)),this.$twoFactorSeckeyForm.find(".two-factor-seckey-retry").click(this.retryU2fChallenge.bind(this)),null!=this.$loginViaEmailForm&&this.$loginViaEmailForm.click(this.loginViaEmailStart.bind(this)),this.$googleAuthContainer.find(".auth-google").click(this.googleLogin.bind(this)),this.$googleAuthContainer.find(".auth-google").prop("disabled",!1);var A=this.$twoFactorSeckeyForm.find("input[name='u2f_challenge']").val();A&&this.signU2fChallenge(A),this.$loginForm.find(".sso-optout a").click(function(){return P.hideSso(!0)}),this.$loginForm.find(".login-button").attr("disabled",null),this.$loginForm.find(".sign-up-button").attr("disabled",null),this.$loginForm.find(".login-button.disabled-button").prop("disabled",!0),m&&t.find(".login-need-help a").click(function(e){e.preventDefault();var t=r(e.target).attr("href"),o=encodeURIComponent(P.$loginForm.find("input[name='login_email']").val());return g.redirect(t+"?email_from_login="+o)}),this.setFocusToPassword(),new d.SsoLoginChecks(this.$loginForm.find("input[name='login_email']"),this.showSso.bind(this),this.hideSso.bind(this)),this.specterLoader=(function(){return o.__awaiter(P,void 0,void 0,function(){return o.__generator(this,function(e){return this.specter=new i.Pixie(p).get_specter(),this.specter.start(),[2]})})})(),this.$signUpButton.on("click",this.handleSignUpClick.bind(this))}return t.prototype.ie8SafeFocus=function(e){try{e.focus()}catch(e){}},t.prototype.setFocusToPassword=function(){this.$loginForm.find("input[name='login_email']").first().val()&&this.ie8SafeFocus(this.$loginForm.find("input[name='login_password']")[0])},t.prototype.isRememberMeChecked=function(){return"on"===this.$loginForm.find("input[name='remember_me']:checked").val()},t.prototype.setFocusToTwofactor=function(){this.ie8SafeFocus(this.$twoFactorForm.find("input[name='code']").val(""))},t.prototype.googleLogin=function(){c.clear_errors(this.$loginForm);var e=this.isRememberMeChecked(),t=new u.ProfileServicesLinkingHandler,o=this.$googleAuthContainer.find(".auth-google").data("is-popup");t.auth_service_login_web(h.GOOGLE,this.googleLoginCallback.bind(this),"login_form",o,e,this.cont,this.pairing)},t.prototype.googleLoginCallback=function(e){if(e.success)F.success(_._("Log in successful! Your browser will be redirected in a few seconds.")),n.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success"}}),g.redirect(this.cont?this.cont:"/h");else if(n.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error"}}),"emails_do_not_match_redirect"===e.err_msg){var t=this.getThirdPartyAuthUrl(e,!0);g.redirect(t)}else"emails_do_not_match"===e.err_msg&&this.inlineGoogleLoginErrors&&!this.pairing?this.handleEmailsDoNotMatch(e):"tfa_required"===e.err_msg?this.redirectToPath(e,"/verify_code"):"not_verified"===e.err_msg?this.redirectToPath(e,"/show_password_form"):(e.localized_error&&F.error(e.localized_error),"google_login_not_allowed"!==e.err_msg&&"sso_required"!==e.err_msg||this.fillInEmail(e.profile.email))},t.prototype.handleEmailsDoNotMatch=function(e){var t=this.getThirdPartyAuthUrl(e,!1);this.$googleAuthContainer.find(".third-party-signup-link").attr("href",t),this.$googleAuthContainer.find(".google-login-error").removeClass("u-l-dn")},t.prototype.getThirdPartyAuthUrl=function(e,t){var o={fname:e.profile.given_name,lname:e.profile.family_name,email:e.profile.email,picture_url:e.profile.picture_url,refresh_token:e.refresh_token,email_sig:e.email_sig,automatic_redirect:t.toString(),cont:this.cont};return this.signupTag&&(o.signup_tag=this.signupTag),this.signupEndpoint&&(o.signup_endpoint=this.signupEndpoint),String(new w({path:"/third_party_signup"}).updateQuery(o))},t.prototype.fillInEmail=function(e){this.$loginForm.find("input[name='login_email']").val(e),this.$loginForm.find("input[name='login_email']").trigger("input"),this.setFocusToPassword()},t.prototype.redirectToPath=function(e,t){var o=new w({path:t}).updateQuery({cont:this.cont,remember_me:e.remember_me.toString(),pair_user:e.pair_user.toString()});g.redirect(o.toString())},t.prototype.beforeSubmit=function(){var t=this;this.cyberfend?this.cyberfend.cfsubmit():(f.reportStack("Cyberfend module is null in login_form submit",{tags:["cyberfend"]}),new Promise(function(t,o){e(["external/cyfd"],t,o)}).then(function(e){t.cyberfend=e,t.cyberfend.cfsubmit()})),this.specterLoader.then(function(){t.loginController.add_additional_data({specter_login_tm:t.specter.dump()})})},t.prototype.showSso=function(e){this.$loginForm.find("input[name='login_password']").val(""),this.$loginForm.addClass("sso-required"),this.$rebrandLoginSubContainer.addClass("sso-required"),e&&(this.$loginForm.addClass("sso-optional"),this.$rebrandLoginSubContainer.addClass("sso-optional"))},t.prototype.hideSso=function(e){if(void 0===e&&(e=!1),this.$loginForm.removeClass("sso-required sso-optional"),this.$rebrandLoginSubContainer.removeClass("sso-required sso-optional"),e)try{this.$loginForm.find("input[name='login_password']").focus()}catch(e){}},t.prototype.browserSupportsU2f=function(){return y.isSupportedBrowser()},t.prototype.showLogin=function(){this.$twoFactorForm.hide(),r(".login-register-header, .login-register-switch").show(),this.$loginForm.show(),this.$loginForm.find("input[name='login_password']").val(""),this.$googleAuthContainer.show()},t.prototype.setupTwoFactor=function(e){e.u2f_challenge&&this.browserSupportsU2f()&&(this.$twoFactorForm=this.$twoFactorSeckeyForm,this.twoFactorController=this.twoFactorSeckeyController,this.signU2fChallenge(e.u2f_challenge)),e.last_two_digits?(this.$allTwoFactorForms.addClass("hide-authenticator"),this.$twoFactorPhoneForm.find(".last-two-digits").text(e.last_two_digits)):this.$allTwoFactorForms.addClass("hide-sms"),this.$twoFactorForm.find("input[name='remember_me']").val(e.remember_me),e.remember_me&&this.$twoFactorForm.find("a[class='twofactor_recovery_url']").attr("href",function(e,t){return w.parse(t).updateQuery({remember_me:"true"}).toString()}),this.showTwoFactor()},t.prototype.showTwoFactor=function(){r(".login-register-header, .login-register-switch").hide(),this.$loginForm.hide(),this.$googleAuthContainer.hide(),this.$twoFactorForm.show(),this.setFocusToTwofactor()},t.prototype.loginSuccess=function(e,t){switch(t.status){case"OK":return this.finishLogin(t);case"TWOFACTOR":return this.setupTwoFactor(t);case"TWOFACTOR_REQUIRED":return g.redirect(t.cont);case"LOGIN_VIA_EMAIL_REQUIRED":var o=t.email,i=new w({path:t.cont}).updateQuery({email:o});return g.redirect(i.toString());case"SSO":return g.unsafeRedirect(t.sso_url);case"RATELIMIT":return this.fillLoginError(_._("You’ve tried to log in too many times. Please try again in a few minutes."));case"ERROR":var r=t.html_response?new m(t.message):t.message;return F.error(r),this.loginController._clear_pending(!0);case"PASSWORD_EXPIRED":return this.fillLoginError(_._("The password of the account associated with this email has expired.\n             Please login to this account and update its password before pairing."));case"EXPIRED":return g.redirect(t.cont);default:return F.error(_._("There was a problem completing this request."))}},t.prototype.twoFactorSuccess=function(e,t){switch(t.status){case"OK":return this.$twoFactorSeckeyForm.find(".seckey-loading-status").toggle(),this.finishLogin(t);case"EXPIRED":return this.switchFromTwoFactorToLoginError(t.message);case"REQUIRES_ROLE":return this.switchFromTwoFactorToLoginError(t.message);case"ERROR":return F.error(t.message);default:return F.error(_._("There was a problem completing this request."))}},t.prototype.switchFromTwoFactorToLoginError=function(e){this.twoFactorController._clear_pending(!0),this.loginController._clear_pending(!0),this.showLogin(),this.fillLoginError(e),this.setFocusToPassword()},t.prototype.resendCodeSuccess=function(e){switch(e){case"OK":return F.success(_._("We sent you a code. It may take a few minutes to arrive."));case"RATELIMIT":return this.fillTwoFactorError(_._("You’ve tried to log in too many times. Please try again in a few minutes."));case"UNREACHABLE":return this.fillTwoFactorError(_._("We couldn’t reach your phone number. Are you sure it’s correct?"));case"EXPIRED":return this.fillTwoFactorError(_._("Sorry, your phone code has expired. Please log in again."));case"BADCARRIER":return this.fillTwoFactorError(_._("Unfortunately, your carrier isn’t supported at this time."));case"INVALIDNUMBER":return this.fillTwoFactorError(_._("That isn’t a valid phone number."));case"NOTAMOBILE":return this.fillTwoFactorError(_._("That phone number doesn’t appear to be a valid mobile number."));default:return F.error(_._("There was a problem completing this request."))}},t.prototype.resendCode=function(){return n.WebRequest({url:"/twofactor_resend",data:{backup:this.$twoFactorForm.find("input[name='backup']").val(),mobile_push:this.$twoFactorForm.find("input[name='mobile_push']").val()},success:this.resendCodeSuccess.bind(this),error:function(){return F.error(_._("There was a problem completing this request."))}}),!1},t.prototype.usePhoneInstead=function(){return this.$twoFactorSeckeyForm.hide(),this.$twoFactorPhoneForm.show(),this.$twoFactorForm=this.$twoFactorPhoneForm,this.$twoFactorPhoneForm.hasClass("hide-authenticator")&&this.resendCode(),this.setFocusToTwofactor(),!1},t.prototype.retryU2fChallenge=function(){var e=this;return n.WebRequest({url:"/account/twofactor/u2f_start_authentication",success:function(t){e.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions").toggle(),e.signU2fChallenge(t)},error:function(){F.error(_._("There was a problem completing this request."))}}),!1},t.prototype.signU2fChallenge=function(e){var t=this;if(this.browserSupportsU2f()){var o=JSON.parse(e);if(o[y.U2F_PROTOCOL]){var i=JSON.parse(o[y.U2F_PROTOCOL]);return y.sign(i.appId,i.challenge,i.registeredKeys,function(e){e.protocol=y.U2F_PROTOCOL,t.$twoFactorSeckeyForm.find(".text-input-input").val(JSON.stringify(e)),t.$twoFactorSeckeyForm.submit()})}}},t.prototype.loginViaEmailStart=function(){var e=this;return c.clear_errors(this.$loginForm),n.WebRequest({url:"/ajax_login_via_email_start",data:{login_email:this.$loginForm.find("input[name='login_email']").val(),remember_me:this.isRememberMeChecked()},success:function(){F.success(_._("We emailed you a sign in link. Please check your inbox."))},error:function(t,o,i){return c.fill_errors(e.$loginForm,JSON.parse(i))}}),!1},t.prototype.fillLoginError=function(e){c.fill_errors(this.$loginForm,{login_email:{message_text:e}})},t.prototype.fillTwoFactorError=function(e){c.fill_errors(this.$twoFactorForm,{code:{message_text:e}})},t.prototype.finishLogin=function(e){var o=this.$loginForm.find("input[type='hidden'][name=refresh_token]").val(),i=this.$loginForm.find("input[type='hidden'][name=email_sig]").val();o&&i&&n.WebRequest({url:"/profile_services/link_google_service_with_user",subject_user:e.id,data:{service:h.GOOGLE,refresh_token:o,email_sig:i}});var r=this.multiLogin?t.MULTI_LOGIN_SUCCESS:t.LOGIN_SUCCESS;this.$loginForm.trigger(r,e),this.cont&&this.canRedirect&&g.redirect(this.cont)},t.prototype.handleSignUpClick=function(e){return e.preventDefault(),T.default(T.PaperEventTypes.CTA_CLICK,{cta:"sign_up_header"},function(){return new l.DBModal({element_id:"paper-sign-in-modal"}).show()})},t.LOGIN_SUCCESS="db:login:success",t.MULTI_LOGIN_SUCCESS="db:multilogin:success",t})()}),define("modules/clean/react/flag",["require","exports","tslib","external/classnames","external/react","modules/clean/react/css"],function(e,t,o,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r.DOM,a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.render=function(){var e=(n={"o-flag":!0},n["o-flag--"+this.props.alignment]=this.props.alignment,n),t=(a={"o-flag__flex":!0},a["u-pad-left-"+this.props.spacing]=this.props.spacing&&this.props.leftAttachment,a["u-pad-right-"+this.props.spacing]=this.props.spacing&&this.props.rightAttachment,a),o=this.props.leftAttachment?s.div({className:"o-flag__fix"},this.props.leftAttachment):void 0,r=this.props.rightAttachment?s.div({className:"o-flag__fix"},this.props.rightAttachment):void 0;return s.div({className:i(e)},o,s.div({className:i(t)},this.props.children),r);var n,a},t.displayName="Flag",t.propTypes={alignment:r.PropTypes.oneOf(["top","middle","bottom"]),leftAttachment:r.PropTypes.oneOfType([r.PropTypes.element,r.PropTypes.node]),rightAttachment:r.PropTypes.oneOfType([r.PropTypes.element,r.PropTypes.node]),spacing:r.PropTypes.oneOf(["xs","s","m","l","xl"]),children:r.PropTypes.oneOfType([r.PropTypes.element,r.PropTypes.node])},t.defaultProps={alignment:"middle"},t})(r.Component);t.FlagWithoutCss=a;var l=n(a,["/static/css/scooter/scooter-scoped-vflhQ6850.css"]);t.Flag=l}),define("modules/clean/react/paper/paper_log",["require","exports","modules/clean/ajax"],function(e,t,o){"use strict";function i(e,t,i){o.SilentBackgroundRequest({url:"/log/paper",data:{event_type:e,extra_params:JSON.stringify(t)},success:i,error:i})}Object.defineProperty(t,"__esModule",{value:!0}),t.PaperEventTypes={VIDEO_PLAY:"main_video_play",VIDEO_PERCENT_PLAYED:"main_video_percent_played",CTA_CLICK:"cta_click",CTA_SEEN:"cta_seen"},t.default=i});
//# sourceMappingURL=pkg-login-pages.min.js-vflobe6OY.map