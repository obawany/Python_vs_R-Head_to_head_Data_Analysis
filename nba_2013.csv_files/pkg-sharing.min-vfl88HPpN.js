define("modules/clean/api_v2/team_actions_client",["require","exports","tslib","modules/clean/api_v2/client","modules/core/i18n","modules/core/notify"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.rpc=function(e,t,n,r,s){return void 0===s&&(s=!1),this._rpc(t,n,{subjectUserId:e,headers:r,flashError:s})},t.prototype._rpc=function(t,n,r){return e.prototype._rpc.call(this,t,n,{subjectUserId:r.subjectUserId,headers:r.headers}).catch(function(e){var t;return t=null!=e.error?e.error.console_error:e.message?e.message:s._("There was a problem completing this request."),r.flashError&&i.error(t),Promise.reject(e)})},t})(r._ApiV2Client);t.TeamActionsClient=o}),define("modules/clean/api_v2/types",["require","exports","tslib","modules/clean/datetime"],function(e,t,n,r){"use strict";function s(e){return r.format_date_utc(e,"yyyy-MM-ddTHH:mm:ssZ")}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e,t,n){this.type=e,this.value=t,this.isScalar=n}return e.parse=function(e){var t=e[".tag"];return 2===Object.keys(e).length&&null!=e[t]?new o(t,e[t]):new a(t,e)},e})();t.Union=i;var o=(function(e){function t(t,n){return void 0===n&&(n=null),e.call(this,t,n,!0)||this}return n.__extends(t,e),t.prototype.toJSON=function(){var e={".tag":this.type};return null!=this.value&&(e[this.type]=this.value),e},t})(i);t.UnionScalar=o;var a=(function(e){function t(t,n){return void 0===n&&(n={}),e.call(this,t,n,!1)||this}return n.__extends(t,e),t.prototype.toJSON=function(){return n.__assign({".tag":this.type},this.value)},t})(i);t.UnionStruct=a;t.formatTimestamp=s}),define("modules/clean/avatar/contact_avatar",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/size","modules/clean/contacts/contact","modules/clean/contacts/types","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,r,s,i,o,a,l,c,d){"use strict";var u=r.createElement;return(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e,t,n=this.props.contact,r=n.name||n.email,a=n.photo_url;n.type===l.FB&&(a="https://graph.facebook.com/"+n.fb_id+"/picture");var p="";return this.props.dimension!==o.AVATAR_DIMENSION_BY_SIZE.XSMALL&&(p=d.getInitials(r)),n.type===l.NEW_STYLE_GROUP?(e=c._("Group"),t="SQUARE"):(e=c._("User"),t="CIRCLE"),u(s,{alt:e,dimension:this.props.dimension,photoUrl:a,shape:t,optionalClass:this.props.optionalClass,defaultAvatar:u(i.InitialsAvatarWithColorDerivedFromName,{alt:e,dimension:this.props.dimension,name:r,initials:p,shape:t,optionalClass:this.props.optionalClass})})},t.displayName="ContactAvatar",t.propTypes={dimension:r.PropTypes.oneOf(o.VALID_AVATAR_DIMENSIONS).isRequired,contact:r.PropTypes.instanceOf(a.Contact).isRequired,optionalClass:r.PropTypes.string},t})(r.Component)}),define("modules/clean/avatar/list",["require","exports","tslib","external/classnames","external/react","modules/clean/avatar/overflow_count_pill","modules/clean/avatar/size","modules/clean/react/css"],function(e,t,n,r,s,i,o,a){"use strict";var l=s.createElement,c=s.DOM;return a((function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._defaultRenderOverflowCount=function(e){var n=e.overflowCount;return l(i,{count:n,dimension:t.props.avatarDimension,key:"overflow_pill:"+n,onClick:t.props.onOverflowCountClick})},t.getClassName=function(){return r(["horizontal-avatar-list",t.props.className,t.props.animation?["animation","is-animated"]:null])},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.avatars,t=this.props.maxVisible,n=0;if(this.props.undisplayableCount&&(n+=this.props.undisplayableCount),(this.props.undisplayableCount||e.length>t)&&(t--,n+=e.length-t,e=e.slice(0,t)),n){var s=null!=this.props.overflowCountRenderer?this.props.overflowCountRenderer:this._defaultRenderOverflowCount;e.push(s({overflowCount:n,avatarArgs:{avatarDimension:this.props.avatarDimension,onAvatarClick:this.props.onOverflowCountClick,titleButtonDirection:"south"}}))}return c.div({className:r({"c-facepile":!0})},[c.div({className:this.getClassName(),key:"facepile"},e)])},t.displayName="HorizontalAvatarList",t.propTypes={avatars:s.PropTypes.array.isRequired,avatarDimension:s.PropTypes.oneOf(o.VALID_AVATAR_DIMENSIONS).isRequired,maxVisible:s.PropTypes.number.isRequired,undisplayableCount:s.PropTypes.number.isRequired,onOverflowCountClick:s.PropTypes.func,overflowCountRenderer:s.PropTypes.func,animation:s.PropTypes.bool,className:s.PropTypes.string},t.defaultProps={className:""},t})(s.Component),["/static/css/avatar_list-vflqHc0nR.css"])}),define("modules/clean/avatar/shared_link_avatar",["require","exports","tslib","external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l){"use strict";var c=r.DOM;return(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){return o.require_css("/static/css/scooter/scooter-scoped-vflhQ6850.css")},t.prototype.render=function(){var e=c.img({src:a.static_url("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||l._("Shared link"),width:12,className:"u-mar-horizontal-xs"}),t=["c-avatar--meta"];null!=this.props.optionalClass&&t.push(this.props.optionalClass),null!=this.props.onClick&&t.push("u-unbutton");var n=i.getClassName(this.props.dimension,t);return null!=this.props.onClick?c.button({className:n,onClick:this.props.onClick},e):c.div({className:n,onClick:this.props.onClick},e)},t.displayName="SharedLinkAvatar",t.propTypes={alt:r.PropTypes.string,dimension:r.PropTypes.oneOf(s.VALID_AVATAR_DIMENSIONS).isRequired,onClick:r.PropTypes.func,optionalClass:r.PropTypes.string},t})(r.Component)}),define("modules/clean/beacon",["require","exports","tslib","external/lodash","jquery","modules/clean/beacon_nodeps","modules/clean/bolt_nodeps","modules/core/exception"],function(e,t,n,r,s,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(t,n,i){var o=e.call(this,t,n,i,"beacon.dropbox.com",s.ajax,r,a)||this;return o._token=t,o._authn_cb=n,o._authz_cb=i,o}return n.__extends(t,e),t})(i.Transmitter);t.Transmitter=l;var c=(function(e){function t(t,n,i){return e.call(this,t,n,i,o,"thunder.dropbox.com",s.ajax,r,a)||this}return n.__extends(t,e),t})(i.Receiver);t.Receiver=c,t.Agent=i.Agent,t.AgentStatus=i.AgentStatus,t.Platforms=i.Platforms,t.PresenceParams=i.PresenceParams,t.PresenceType=i.PresenceType,t.Source=i.Source,t.UserAppPresence=i.UserAppPresence,t.UserContextPresence=i.UserContextPresence}),define("modules/clean/beacon_nodeps",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={WEB:0,IOS:1,ANDROID:2,DESKTOP:3};t.Platforms=n;var r=(function(){function e(e,t,r){void 0===r&&(r=null),this.platform=e,this.surface=t,this.identifier=r;var s=!1;for(var i in n){var o=n[i];if(this.platform===o){s=!0;break}}if(!s)throw new Error("platform must be from Beacon.Platforms");if(this.surface.length>32||0===this.surface.length)throw new Error("surface must be populated and <= 32 chars.");if((null!=this.identifier?this.identifier.length:void 0)>128)throw new Error("identifier must be <= 128 chars.");null===this.identifier&&(this.identifier="")}return e.from_json=function(t){return new e(t.platform,t.surface,t.identifier)},e})();t.Source=r;var s=(function(){function e(e,t,n,r){if(this.user_id=e,this.app=t,this.context=n,this.source=r,this.user_id.length>256)throw new Error("user_id must be <= 256 chars.");if(this.app.length>32||0===this.app.length)throw new Error("app must be populated and <= 32 chars.");if(this.context.length>64||0===this.context.length)throw new Error("context must be populated and <= 64 chars.")}return e.from_json=function(t){var n=r.from_json(t.source);return new e(t.user_id,t.app,t.context,n)},e})();t.Agent=s;var i=(function(){function e(e,t,n){if(void 0===n&&(n=null),this.agent=e,this.status=t,this.auth_key=n,this.status.length>32)throw new Error("status must be <= 32 chars")}return e.from_json=function(t){return new e(s.from_json(t.agent),t.status)},e})();t.AgentStatus=i;var o={UserContext:"UserContext",UserApp:"UserApp",Context:"Context"};t.PresenceType=o;var a=(function(){function e(e,t,n,r,s){if(this.type=e,this.user_id=t,this.app=n,this.context=r,this.token=s,this.type!==o.UserContext&&this.type!==o.UserApp&&this.type!==o.Context)throw new Error("Unsupported type: "+this.type+".");if((null!=this.user_id?this.user_id.length:void 0)>256)throw new Error("user_id must be <= 256 chars.");if(this.app.length>32)throw new Error("app must be <= 32 chars.");if((null!=this.context?this.context.length:void 0)>64)throw new Error("context must be <= 64 chars.")}return e})();t.PresenceParams=a;var l=(function(){function e(e,t){this.presence_params=e,this.agents=t}return e})();t.UserContextPresence=l;var c=(function(){function e(e,t){this.presence_params=e,this.status=t}return e.initClass=function(){this.Status={Offline:1,Online:2}},e})();t.UserAppPresence=c,c.initClass();var d=(function(){function e(e,t,n){this.presence_params=e,this.snapshot=t,this.delta=n}return e})(),u=(function(){function e(e,t,n,r,s,i,o){void 0===o&&(o=null),this._heartbeat=this._heartbeat.bind(this),this._handle_heartbeat_success=this._handle_heartbeat_success.bind(this),this._handle_heartbeat_error=this._handle_heartbeat_error.bind(this),this._token=e,this._authn_cb=t,this._authz_cb=n,this._beacon_server=r,this._ajax=s,this._lodash=i,this._exclog=o,this._started=!1,this._heartbeat_xhr=null,this._timeout_id=null,this._presence_data=[],this._offline_agents=[],this._has_changes=!1}return e.prototype.start=function(){if(!this._started)return this._backoff_window=5e3,this._started=!0,this._has_changes=!1,this._heartbeat()},e.prototype.stop=function(){return this._started=!1,this._heartbeat_xhr=null,window.clearTimeout(this._timeout_id),this._timeout_id=null},e.prototype.add_or_update_agents=function(e){for(var t=0,n=Array.from(e);t<n.length;t++){var r=n[t];this._has_changes=this._add_or_update_agent(r)||this._has_changes}if(!this._heartbeat_xhr&&this._started)return window.clearTimeout(this._timeout_id),this._timeout_id=window.setTimeout(this._heartbeat,0)},e.prototype.update_token=function(e){this._token=e},e.prototype._add_or_update_agent=function(e){for(var t=0;t<this._presence_data.length;t++){var n=this._presence_data[t];if(this._lodash.isEqual(n.agent,e.agent))return(n.status!==e.status||n.auth_key!==e.auth_key)&&(this._presence_data[t]=e,!0)}return this._presence_data.push(e),!0},e.prototype._heartbeat=function(){if(this._started&&0!==this._presence_data.length)return this._offline_agents=this._presence_data.filter(function(e){return""!==e.status}).map(function(e){return e.agent}),this._has_changes=!1,this._heartbeat_xhr=this._ajax({url:"https://"+this._beacon_server+"/1/update",type:"POST",data:JSON.stringify({token:this._token,updates:this._presence_data}),contentType:"application/json; charset=utf-8",dataType:"json",timeout:5e3,success:this._handle_heartbeat_success,error:this._handle_heartbeat_error,xhrFields:{withCredentials:!0}})},e.prototype._handle_heartbeat_success=function(e,t,n){var r,i,o=this;if(this._heartbeat_xhr=null,this._started){for(var a=[],l=0,c=Array.from(e.agent_errors||[]);l<c.length;l++){var d=c[l],u=d.error;r=s.from_json(d.agent),"authorization_error"===u?a.push(r):"invalid_agent"===u&&null!=this._exclog&&this._exclog.reportStack("Input error: "+d),this._presence_data=this._presence_data.filter(function(e){return!o._lodash.isEqual(e.agent,r)})}if(a.length){var p=this._authz_cb;window.setTimeout(function(){return p(a)},0)}for(var h=0,m=Array.from(this._offline_agents);h<m.length;h++)for(var _=m[h],f=0;f<this._presence_data.length;f++){var g=this._presence_data[f];if(this._lodash.isEqual(g.agent,_)&&""===g.status){this._presence_data.splice(f,1);break}}return i=this._has_changes?0:6e4,this._backoff_window=5e3,this._timeout_id=window.setTimeout(this._heartbeat,i)}},e.prototype._handle_heartbeat_error=function(e,t,n){if(this._heartbeat_xhr=null,this._started){if(e.status>=400&&e.status<500){if(401===e.status)return window.setTimeout(this._authn_cb,0),void this.stop();400===e.status&&null!=this._exclog&&this._exclog.reportStack("Bad request: "+e.responseText)}var r=Math.random()*this._backoff_window;return this._backoff_window=Math.min(2*this._backoff_window,12e4),this._timeout_id=window.setTimeout(this._heartbeat,r)}},e})();t.Transmitter=u;var p=(function(){function e(e,t,n,r,s,i,o,a){void 0===a&&(a=null);var l=this;this._compact_context_updates=this._compact_context_updates.bind(this),this._on_update=this._on_update.bind(this),this._on_refresh=this._on_refresh.bind(this),this._presence_params=e,this._update_callback=t,this._refresh_callback=n,this._bolt=r,this._thunder_hostname=s,this._ajax=i,this._lodash=o,this._exclog=a;var c=Array.from(this._presence_params).map(function(e){return l._presence_params_to_bolt_channel(e)});this._thunder_client=new this._bolt.ThunderClient(c,this._on_update,this._on_refresh,this._thunder_hostname,this._ajax,this._lodash,this._exclog)}return e.prototype.start=function(){return this._thunder_client.start()},e.prototype.stop=function(){return this._thunder_client.unsubscribe()},e.prototype.add_presence_params=function(e){var t=this,n=this._presence_params.length;if(this._presence_params=this._lodash.union(e,this._presence_params),this._presence_params.length===n)return!1;this._thunder_client.unsubscribe();var r=Array.from(this._presence_params).map(function(e){return t._presence_params_to_bolt_channel(e)});return this._thunder_client=new this._bolt.ThunderClient(r,this._on_update,this._on_refresh,this._thunder_hostname,this._ajax,this._lodash,this._exclog),this._thunder_client.start(),!0},e.prototype._presence_params_to_bolt_channel=function(e){switch(e.type){case o.UserContext:return new this._bolt.SignedChannelState("beacon_uc-"+e.app,e.user_id+"|"+e.context,"0",e.token);case o.UserApp:return new this._bolt.SignedChannelState("beacon_ua-"+e.app,e.user_id,"0",e.token);case o.Context:return new this._bolt.SignedChannelState("beacon_c-"+e.app,e.context,"0",e.token);default:throw new Error("Unknown type: "+e.type)}},e.prototype._bolt_channel_to_presence_params=function(e){var t,n=e.app_id.split("-"),r=e.unique_id.split("|");if(2!==n.length)throw new Error("Unexpected format of Bolt app_id: "+e.app_id+".");var s=n[1],i="",l="";switch(n[0]){case"beacon_uc":if(2!==r.length)throw new Error("Unexpected format of beacon_uc: "+e.unique_id+".");t=o.UserContext,i=r[0],l=r[1];break;case"beacon_ua":if(1!==r.length)throw new Error("Unexpected format of beacon_ua: "+e.unique_id+".");t=o.UserApp,i=r[0];break;case"beacon_c":if(1!==r.length)throw new Error("Unexpected format of beacon_c: "+e.unique_id+".");t=o.Context,l=r[0];break;default:throw new Error("Unknown Bolt app_id: "+e.app_id+".")}return new a(t,i,s,l,null)},e.prototype._compact_context_updates=function(e,t){for(var n,r,s=!1,i=[],o=0,a=Array.from(t);o<a.length;o++){var l=a[o];if(null!=l.snapshot)s=!0,i=l.snapshot;else if(null!=l.delta)for(var c=0,u=Array.from(l.delta);c<u.length;c++){for(var p=u[c],h=!1,m=0;m<i.length;m++){var _=i[m];if(this._lodash.isEqual(_.agent,p.agent)){h=!0,i[m]=p;break}}h||i.push(p)}}return s?(r=i,n=null):(r=null,n=i),new d(e,r,n)},e.prototype._on_update=function(e){for(var t,n,a=this,d=[],u=0,p=Array.from(e);u<p.length;u++){var h=p[u],m=h.channel_state,_=new this._bolt.ChannelId(m.app_id,m.unique_id),f=this._bolt_channel_to_presence_params(_);d.push((function(){var e;switch(f.type){case o.UserContext:return n=h.payloads.slice(-1)[0].payload,e=null!=n.agents?(function(){for(var e=[],r=0,s=Array.from(n.agents);r<s.length;r++)t=s[r],e.push(i.from_json(t));return e})():[],new l(f,e);case o.UserApp:return n=h.payloads.slice(-1)[0].payload,new c(f,n.status);case o.Context:var d=function(e){var n=r.from_json(e.source);return t=new s(e.user_id,f.app,f.context,n),new i(t,e.status)},u=function(e){var t;return{snapshot:null!=(null!=e.snapshot?e.snapshot.agents:void 0)?(function(){for(var n=[],r=0,s=Array.from(e.snapshot.agents);r<s.length;r++)t=s[r],n.push(d(t));return n})():void 0,delta:null!=(null!=e.delta?e.delta.agents:void 0)?(function(){for(var n=[],r=0,s=Array.from(e.delta.agents);r<s.length;r++)t=s[r],n.push(d(t));return n})():void 0}},p=(function(){for(var e=[],t=0,r=Array.from(h.payloads);t<r.length;t++)n=r[t],e.push(u(n.payload));return e})();return a._compact_context_updates(f,p)}})())}return this._update_callback(d)},e.prototype._on_refresh=function(e){var t=this;return this._refresh_callback(Array.from(e).map(function(e){return t._bolt_channel_to_presence_params(e)}))},e})();t.Receiver=p}),define("modules/clean/clipboard",["require","exports","external/swfobject","jquery","modules/clean/static_urls","modules/core/dom"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return"swf_"+(new Date).getTime()+"_"+("00000"+Math.floor(1e6*Math.random())).slice(-6)},a=function(e,t){return e.on("mouseover",function(){return t.addClass("hovered")}),e.on("mousedown",function(){return t.addClass("pressed")}),e.on("mouseout",function(){return t.removeClass("hovered pressed")}),e.on("mouseup",function(){return t.removeClass("pressed")})},l=function(e,t){return window.ClipboardSWFRegister=window.ClipboardSWFRegister||{},window.ClipboardSWFRegister[e]=function(){return t()},"ClipboardSWFRegister."+e};t.clipboard_overlay=function(e,t,c,d){void 0===c&&(c=null),void 0===d&&(d=null),d=d||r(document.body);var u=o(),p=r("<div />",{id:"flash_copy_container"}).append(r("<div />",{id:u})).css({position:"absolute",zIndex:1});a(p,t),d.append(p),i.clone_position(p,t,{});var h=l(u,c);return window.copyLoaded=function(){var t=r("#"+u)[0];return t.setCopyText(e),t.setCallbackFunction(h)},n.embedSWF(s.static_url("/static/swf/copy_clipboard-vflvMcZTC.swf"),u,"100%","100%","6.0.65",!1,!1,{wmode:"transparent",scale:"exactfit",allowScriptAccess:"always"}),p}}),define("modules/clean/clipboard_v2",["require","exports","external/flash_detect","jquery","modules/clean/clipboard","modules/core/browser","external/react","modules/core/exception"],function(e,t,n,r,s,i){"use strict";return(function(){function e(e,t,n,r){this.do_copy=this.do_copy.bind(this),this.copyText=e,this.onSuccess=t,this.onError=n,this.clickHandler=r}return e.prototype.setupCopy=function(t,n){var i=this,o=r(n),a=r(t);if(!e.is_flashless_clipboard_supported()){var l=function(){return"function"==typeof i.onSuccess&&i.onSuccess(),"function"==typeof i.clickHandler?i.clickHandler():void 0};return s.clipboard_overlay(this.copyText,a,l,o)}},e.prototype.do_copy=function(){if(e.is_supported()&&e.is_flashless_clipboard_supported()){return document.execCommand("copy",!1)?"function"==typeof this.onSuccess?this.onSuccess():void 0:"function"==typeof this.onError?this.onError():void 0}},e.is_supported=function(){return e.is_flashless_clipboard_supported()||n.installed},e.is_flashless_clipboard_supported=function(){var e=parseInt(i.version);return i.chrome?e>=42:i.mozilla?e>=41:i.opera?e>=29:i.msie?e>=9:!!i.edge||!!i.safari&&e>=10},e})()}),define("modules/clean/components/title_bubble",["require","exports","tslib","external/classnames","external/react","external/react-dom","jquery","modules/clean/react/css"],function(e,t,n,r,s,i,o,a){"use strict";var l=s.DOM;return a((function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isChildFocused:!1},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;return o(i.findDOMNode(this)).on("focusin.title-bubble",function(t){return e.setState({isChildFocused:!0})}).on("focusout.title-bubble",function(t){return e.setState({isChildFocused:!1})}).on("mouseenter.title-bubble",function(){return"function"==typeof e.props.onMouseEnter?e.props.onMouseEnter():void 0})},t.prototype.componentWillUnmount=function(){return o(i.findDOMNode(this)).off("focusin.title-bubble").off("focusout.title-bubble").off("mouseenter.title-bubble")},t.prototype.render=function(){var e=this,t={"c-title-bubble":!0,"is-child-focused":this.state.isChildFocused,"c-title-bubble--respect-line-break":this.props.respectLineBreaks};return t["c-title-bubble--"+this.props.direction.slice(0,1)]=!0,l.div({className:r([t,this.props.className]),"data-title":this.props.text,onClick:function(t){if(t.detail>0)return e.setState({isChildFocused:!1})}},this.props.children)},t.displayName="TitleBubble",t.propTypes={text:s.PropTypes.string.isRequired,direction:s.PropTypes.oneOf(["north","south","east","west"]).isRequired,onMouseEnter:s.PropTypes.func,respectLineBreaks:s.PropTypes.bool,className:s.PropTypes.string},t})(s.Component),["/static/css/scooter/scooter-scoped-vflhQ6850.css"])}),define("modules/clean/contacts/bloodhound_contacts_v2",["require","exports","external/bloodhound","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/profile_services/profile_services_link","modules/clean/viewer","modules/core/cookies"],function(e,t,n,r,s,i,o,a){"use strict";function l(e,t){c(e,t.includeForUser(e.id).contacts)}function c(e,t){if(e.id in u){var n=u[e.id];t=t.filter(s.ContactCommon.is_valid),n.clearRemoteCache(),n.clear(),n.add(t)}}function d(e){var t=document.createElement("a");t.href=e;var n=t.hostname||window.location.hostname;if(n.indexOf(".dropbox.com",n.length-".dropbox.com".length)===-1)throw new Error("Cannot send the CSRF token to "+n);return e}Object.defineProperty(t,"__esModule",{value:!0});var u={};t.BloodhoundContactsV2={getOrCreateForUser:function(e){if(e.id in u)return u[e.id];var t,c=r.getSearchConfigForUser(e);if(c.remoteEndpoint){var p=String(e.id);t={url:d(c.remoteEndpoint),prepare:function(e,t){return t.type="POST",t.headers={"X-CSRF-Token":a.read("__Host-js_csrf"),"X-Dropbox-Uid":p},t.data={query:JSON.stringify(e)},t.data._subject_uid=p,t},rateLimitBy:"debounce",rateLimitWait:c.remoteDebounceWait}}var h=new n({datumTokenizer:s.ContactCommon.get_index_tokens,queryTokenizer:n.tokenizers.whitespace,identify:s.ContactCommon.get_key,sufficient:c.sufficientResults,sorter:s.ContactCommon.sorter,local:[],remote:t});if(u[e.id]=h,o.Viewer.get_viewer().is_user_signed_in(e)){var m=c.localCacheStore.getOrCreateForUser(e);m.load_contacts(!1,function(t){l(e,t),m.register_for_updates("bloodhound_contacts_v2",function(t){l(e,t)})})}return i.LinkedProfileServices.get_linked_profile_services_for_user(e.id).register_for_service_changes("bloodhound_contacts_v2",function(e){h.clearRemoteCache()}),u[e.id]},search:function(e,n,s,i){var o=t.BloodhoundContactsV2.getOrCreateForUser(e),a=r.getSearchConfigForUser(e);if(!n)return s([]),void(i&&a.remoteEndpoint&&i([]));var l=a.localCacheStore.getOrCreateForUser(e);l.is_loaded()?o.search(n,s,i):l.load_contacts(!1,function(e){o.search(n,s,i)}),l.refresh_contacts(!1)}}}),define("modules/clean/contacts/cache",["require","exports","tslib","modules/clean/ajax","modules/clean/bolt","modules/clean/contacts/cache_type","modules/clean/contacts/list","modules/clean/viewer","modules/core/browser","modules/core/exception"],function(e,t,n,r,s,i,o,a,l,c){"use strict";function d(e,t,n){return void 0!==e&&null!==e&&"function"==typeof e[t]?n(e,t):void 0}Object.defineProperty(t,"__esModule",{value:!0});var u=(function(){function e(e){this.callbacks={},this.one_time_callbacks=[],this.cached_contacts=null,this._cache_download_name=e,this.should_force_refresh=!1,this.request_perf_records=[],this._config=null}return e.initClass=function(){this.MAX_REQUEST_PERF_RECORDS=20},e.prototype.register_for_updates=function(e,t){this.callbacks[e]=t},e.prototype.unregister_for_updates=function(e){null!=this.callbacks[e]&&delete this.callbacks[e]},e.prototype.get_contacts_count=function(){return null!=this.cached_contacts?this.cached_contacts.length():0},e.prototype.get_downloaded_time=function(){var e=this,t=d(l.performance(),"getEntriesByName",function(t){return t.getEntriesByName(e._get_contacts_downloaded_mark_name())});return t&&t.length?t[0].startTime:null},e.prototype.get_request_perf_records=function(){return this.request_perf_records},e.prototype._is_contact_get_or_check_ajax_request=function(e){var t=e.initiatorType,n=e.name;return"xmlhttprequest"===t&&n.endsWith(this._config.getUrl)},e.prototype._find_last_perf_entry=function(e){void 0===e&&(e=500);var t=d(l.performance(),"getEntriesByType",function(e){return e.getEntriesByType("resource")});if(null!=t?t.length:void 0)for(var n=Math.min(t.length-1,e),r=n;r>=0;r--)if(this._is_contact_get_or_check_ajax_request(t[r]))return t[r];return null},e.prototype._record_perf_stats=function(t){void 0===t&&(t={});var n=this._find_last_perf_entry();if(n&&(t.ttfb=n.responseStart-n.requestStart,t.downloading_time=n.responseEnd-n.responseStart,t.duration=n.duration,this.request_perf_records.push(t),this.request_perf_records.length>e.MAX_REQUEST_PERF_RECORDS))return this.request_perf_records=this.request_perf_records.slice(this.request_perf_records.length-1)},e.prototype._get_request_url=function(){throw new Error("method unimplemented")},e.prototype._get_request_params=function(){throw new Error("method unimplemented")},e.prototype._contacts_loaded_callback=function(e){throw new Error("method unimplemented")},e.prototype._fetch_contacts=function(){var e=this;return r.BackgroundRequest({url:this._get_request_url(),data:this._get_request_params(),success:function(t,n,r){var s=JSON.parse(t);if(e._contacts_loaded_callback(s),e._schedule_fetch)return e._schedule_fetch()}})},e.prototype._get_versioned_params=function(e,t){void 0===t&&(t=!0);var n={version:e};return t&&(n.force_refresh=this.should_force_refresh,this.should_force_refresh=!1),null!=this.digest&&(n.digest=this.digest),null!=this.limit&&(n.limit=this.limit),n},e.prototype._get_contacts_downloaded_mark_name=function(){return this._cache_download_name+"-"+this.instance},e.prototype._is_page_hidden=function(){return null!=window.document.visibilityState&&window.document.hidden},e.prototype._add_one_time_callback=function(e){if(null!=e&&!Array.from(this.one_time_callbacks).includes(e))return this.one_time_callbacks.push(e)},e.prototype._invoke_all_callbacks=function(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0),this._invoke_callbacks(this.callbacks,e,!1)},e.prototype._invoke_one_time_callbacks=function(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0)},e.prototype._invoke_callbacks=function(e,t,n){return(function(){for(var r=[],s=0,i=Array.from(Object.keys(e));s<i.length;s++){var o=i[s];e[o](t),n?r.push(delete e[o]):r.push(void 0)}return r})()},e})();t.ContactsCacheProto=u,u.initClass();var p=(function(e){function t(n,r,s){void 0===r&&(r=null),void 0===s&&(s=null);var o=e.call(this,"BoltContactsCache download")||this;return o.bolt_update_callback=o.bolt_update_callback.bind(o),o.bolt_refresh_callback=o.bolt_refresh_callback.bind(o),o.cache_type=n,o.limit=r,o.user_id=s,o.instance=t.INSTANCE++,o.loading_state=t.BOLT_NEED_TO_SEND_REQUEST,o._config=i.CONTACT_CACHE_TYPE_TO_CONFIG[i.ContactCacheType[o.cache_type]],o.current_bolt_states=null,o._notified_states={},o._bolt=null,o._last_refresh_ts=null,o}return n.__extends(t,e),t.initClass=function(){this.INSTANCE=0,this.BOLT_NEED_TO_SEND_REQUEST=0,this.BOLT_REQUEST_SENT=1,this.REFRESH_THRESHOLD=36e5},t.prototype.load_contacts=function(e,n){a.Viewer.get_viewer().is_signed_in&&(this._add_one_time_callback(n),(this.loading_state===t.BOLT_NEED_TO_SEND_REQUEST||e)&&(this.loading_state=t.BOLT_REQUEST_SENT,e&&(this.should_force_refresh=!0),this._fetch_contacts()),!this._should_update_contacts()&&this.is_loaded()&&this._invoke_one_time_callbacks(this.cached_contacts))},t.prototype.refresh_contacts=function(e){void 0===e&&(e=!1);var n=d(l.performance(),"now",function(e){return e.now()});if(this._last_refresh_ts||(e=!0),!(!e&&this._last_refresh_ts&&n-this._last_refresh_ts<t.REFRESH_THRESHOLD))return r.BackgroundRequest({url:this._get_refresh_url(),data:this._get_refresh_params({force_refresh:e})}),this._last_refresh_ts=n},t.prototype.is_loaded=function(){return null!=this.cached_contacts},t.prototype.bolt_update_callback=function(e){for(var n=0,r=Array.from(e);n<r.length;n++){var s=r[n];(!Array.from(this._notified_states).includes(s.unique_id)||+this._notified_states[s.unique_id].revision<+s.revision)&&(this._notified_states[s.unique_id]=s)}return this._should_update_contacts()&&(this.loading_state=t.BOLT_NEED_TO_SEND_REQUEST),this.load_contacts()},t.prototype.bolt_refresh_callback=function(e){if(null!=this._bolt&&this._bolt.unsubscribe(),this._bolt=null,this.loading_state=t.BOLT_NEED_TO_SEND_REQUEST,!this._is_page_hidden())return this.load_contacts()},t.prototype._contacts_loaded_callback=function(e){var t=this;if(!this._is_old_contacts(e.bolt_info)){var n=this._is_new_contacts(e.bolt_info);if(this.current_bolt_states=e.bolt_info,null==this._bolt&&this._subscribe_to_bolt(),n&&(null!=e.contacts?e.contacts.length:void 0))return this._record_perf_stats({num_contacts:e.contacts.length}),this.digest=e.digest,this._create_contacts_list(e.contacts),this._invoke_all_callbacks(this.cached_contacts),d(l.performance(),"mark",function(e){return e.mark(t._get_contacts_downloaded_mark_name())})}},t.prototype._create_contacts_list=function(e){return this.cached_contacts=o.create_contacts_list(e)},t.prototype._subscribe_to_bolt=function(){var e=[];for(var t in this.current_bolt_states){var n=this.current_bolt_states[t];e.push(new s.SignedChannelState(this._config.boltAppId,t.toString(),n.revision,n.token))}return this._bolt=new s.BoltClient(e,this.bolt_update_callback,this.bolt_refresh_callback),this._bolt.start()},t.prototype._is_new_contacts=function(e){return this._first_contacts_are_newer(e,this.current_bolt_states)},t.prototype._is_old_contacts=function(e){return this._first_contacts_are_newer(this.current_bolt_states,e)},t.prototype._first_contacts_are_newer=function(e,t){if(!t)return!0;for(var n in t){var r=t[n];for(var s in e){var i=e[s];if(s===n&&+r.revision<+i.revision)return!0}}return!1},t.prototype._should_update_contacts=function(){return this._is_new_contacts(this._notified_states)},t.prototype._get_request_params=function(){return this._get_versioned_params(1)},t.prototype._get_request_url=function(){return this._config.getUrl},t.prototype._get_refresh_params=function(e){return void 0===e&&(e={}),e},t.prototype._get_refresh_url=function(){return this._config.refreshUrl},t})(u);t.BoltContactsCache=p,p.initClass();var h=(function(e){function t(t,n){var r=this;return c.assert(null!=n.id,"user has invalid id"),r=e.call(this,t,null)||this,r.cache_type=t,r.user=n,r}return n.__extends(t,e),t.prototype._get_request_params=function(){var e=this._get_versioned_params(1);return e._subject_uid=this.user.id,e},t.prototype._get_refresh_params=function(e){return void 0===e&&(e={}),e._subject_uid=this.user.id,e},t.prototype._create_contacts_list=function(e){return this.cached_contacts=o.create_per_user_contacts_list(e,this.user.id)},t})(p);t.PerUserBoltContactsCache=h}),define("modules/clean/contacts/cache_store",["require","exports","tslib","modules/clean/contacts/cache_type","modules/clean/contacts/cache","modules/constants/contacts","modules/clean/viewer"],function(e,t,n,r,s,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e){this.cacheType=e}return e})();t.BoltContactsCacheStore=a;var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getOrCreateForUser=function(e){if(!o.Viewer.get_viewer().is_uid_associated(e.id))throw new Error("Requested contacts cache for a user not associated with the current viewer.");return this.getOrCreateForViewer()},
t.prototype.getOrCreateForViewer=function(){return null==this.contactsCache&&(this.contactsCache=new s.BoltContactsCache(this.cacheType)),this.contactsCache},t})(a);t.PerViewerBoltContactsCacheStore=l;var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uidToContactsCache={},t}return n.__extends(t,e),t.prototype.getOrCreateForUser=function(e){return e.id in this.uidToContactsCache||(this.uidToContactsCache[e.id]=new s.PerUserBoltContactsCache(this.cacheType,e)),this.uidToContactsCache[e.id]},t})(a);t.PerUserBoltContactsCacheStore=c,t.DefaultContactsCacheStore=new l(r.ContactCacheType.ALL);var d=t.DefaultContactsCacheStore;"OFF"!==i.LEGACY_CACHE_LIMIT&&(d=new l(r.ContactCacheType.ALL),d.contactsCache=new s.BoltContactsCache(r.ContactCacheType.ALL,+i.LEGACY_CACHE_LIMIT)),t.LegacyContactsCacheStore=d,t.IndividualContactsCacheStore=new c(r.ContactCacheType.INDIVIDUAL)}),define("modules/clean/contacts/cache_type",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.ALL=0]="ALL",e[e.INDIVIDUAL=1]="INDIVIDUAL"})(t.ContactCacheType||(t.ContactCacheType={})),t.CONTACT_CACHE_TYPE_TO_CONFIG={ALL:{getUrl:"/contacts/get",refreshUrl:"/contacts/refresh",boltAppId:"contacts_cache_notify"},INDIVIDUAL:{getUrl:"/contacts/get_individual_for_user",refreshUrl:"/contacts/refresh_individual_for_user",boltAppId:"individual_contacts_cache_notify"}}}),define("modules/clean/contacts/config",["require","exports","modules/constants/contacts","modules/clean/contacts/cache_store"],function(e,t,n,r){"use strict";function s(e){return n.MERGE_SEARCH_ALLOWED[e.id]?o.INDIVIDUAL_LOCAL_TEAM_REMOTE:o.ALL_LOCAL}function i(e){return t.CONTACTS_SEARCH_MODE_TO_CONFIG[o[s(e)]]}Object.defineProperty(t,"__esModule",{value:!0});var o;(function(e){e[e.ALL_LOCAL=0]="ALL_LOCAL",e[e.INDIVIDUAL_LOCAL_TEAM_REMOTE=1]="INDIVIDUAL_LOCAL_TEAM_REMOTE"})(o=t.ContactsSearchMode||(t.ContactsSearchMode={})),t.LOCAL_ONLY_SEARCH_MODES=[o.ALL_LOCAL],t.CONTACTS_SEARCH_PREEMPTED_THRESHOLD=300,t.CONTACTS_SEARCH_DEBOUNCE_WAIT=10,t.CONTACTS_SEARCH_MODE_TO_CONFIG={ALL_LOCAL:{localCacheStore:r.DefaultContactsCacheStore,sufficientResults:1e3,remoteDebounceWait:t.CONTACTS_SEARCH_DEBOUNCE_WAIT},INDIVIDUAL_LOCAL_TEAM_REMOTE:{localCacheStore:r.IndividualContactsCacheStore,remoteEndpoint:"/team/search_contacts",remoteBatchEndpoint:"/team/search_contacts_batch",sufficientResults:1e3,remoteDebounceWait:t.CONTACTS_SEARCH_DEBOUNCE_WAIT}},t.getSearchModeForUser=s,t.getSearchConfigForUser=i}),define("modules/clean/contacts/contact",["require","exports","modules/clean/contacts/types","modules/core/exception"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(){}return e.sorter=function(e,t){return t.domain_contact&&!e.domain_contact?-1:e.domain_contact&&!t.domain_contact?1:e.sort_key||t.sort_key?e.sort_key?t.sort_key?e.sort_key>t.sort_key?-1:e.sort_key<t.sort_key?1:0:-1:1:0},e.is_valid=function(e){return e.dbx_account_id?e.type===n.DBX_ID||e.type===n.EMAIL:e.group_id?e.type===n.NEW_STYLE_GROUP:!!e.email&&e.type===n.EMAIL},e.get_key=function(t){return r.assert(e.is_valid(t),"invalid contact: type: "+t.type),t.dbx_account_id?"DBX_USER-"+t.dbx_account_id:t.group_id?"DBX_GROUP-"+t.group_id:"CONTACT-"+t.type+"-"+t.email},e.get_index_tokens=function(e){var t=[];return e.name&&t.push(e.name),e.email&&t.push(e.email),e.fname&&t.push(e.fname),e.lname&&t.push(e.lname),e.name_tokens&&(t=t.concat(e.name_tokens)),t},e})();t.ContactCommon=s;var i=(function(){function e(e){var t=e.dbx_account_id,n=e.type,r=e.name,s=e.email,i=e.fb_id,o=e.group_id,a=e.group_size,l=e.photo_url,c=e.members,d=e.avatar_url,u=e.invalid,p=e.on_team,h=e.domain_contact,m=e.dbx_team_id,_=e.nameMatch,f=e.emailMatch,g=e.pending,y=e.join_state,v=e.query;this.dbx_account_id=t,this.type=n,this.name=r,this.email=s,this.fb_id=i,this.group_id=o,this.group_size=a,this.photo_url=l,this.members=c,this.avatar_url=d,this.invalid=u,this.on_team=p,this.domain_contact=h,this.dbx_team_id=m,this.nameMatch=_,this.emailMatch=f,this.pending=g,this.join_state=y,this.query=v,this.team=this.on_team}return e.prototype.getKey=function(){return s.get_key(this)},e.prototype.getContactID=function(){switch(this.type){case n.FB:return this.fb_id;case n.NEW_STYLE_GROUP:return this.group_id;default:return this.email}},e})();t.Contact=i}),define("modules/clean/contacts/contact_token_state",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContactTokenState={invalid:"invalid",warn:"warn",pending:"pending",ok:"ok"}}),define("modules/clean/contacts/data_v2",["require","exports","modules/clean/ajax","modules/clean/contacts/bloodhound_contacts_v2","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/contacts/types","modules/clean/fuzzy"],function(e,t,n,r,s,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(){function e(e,t,n){void 0===n&&(n=!0),this.query=this.search,this.query_batch=this.searchBatch,this.user=e,this.filterFunc=t,this.excludeDomainContacts=n,this.searchConfig=s.getSearchConfigForUser(e),this.searchMode=s.getSearchModeForUser(e),this.searchModeName=s.ContactsSearchMode[this.searchMode],r.BloodhoundContactsV2.getOrCreateForUser(this.user)}return e.prototype.search=function(e,t,n){var s=this;if(e=this.normalizeQuery(e),""===e)return t([]),void(n&&n([]));var i=function(n){return s.processMatches(n,t,e)},o=function(t){return s.processMatches(t,n,e)};r.BloodhoundContactsV2.search(this.user,e,i,o)},e.prototype.searchBatch=function(e,t,n){var r=this,s=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);if(s.is_loaded())return this.searchBatchInternal(e,t,n);s.load_contacts(!0,function(s){return r.searchBatchInternal(e,t,n)})},e.prototype.searchBatchInternal=function(e,t,n){for(var s=this,o=e.map(this.normalizeQuery).filter(function(e){return e.length>0}),a={},l=function(e){var t=function(t){a[e]=s.processMatches(t)};r.BloodhoundContactsV2.search(c.user,e,t)},c=this,d=0,u=o;d<u.length;d++){l(u[d])}if(t(a),this.searchConfig.remoteBatchEndpoint){var p=function(e){if(n){var t={},r=function(n){if(e.hasOwnProperty(n)){var r=a[n].map(i.ContactCommon.get_key),o=e[n].filter(function(e){var t=i.ContactCommon.get_key(e);return r.every(function(e){return e!==t})});t[n]=s.processMatches(o)}};for(var o in e)r(o);n(t)}};this.searchRemoteBatch(o,p)}},e.prototype.normalizeQuery=function(e){return e.trim().toLowerCase()},e.prototype.isSearchLocalOnly=function(){return s.LOCAL_ONLY_SEARCH_MODES.indexOf(this.searchMode)!==-1},e.prototype.getStats=function(){var e=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);return{numLocalContacts:e.get_contacts_count(),localContactsDownloadedTime:e.get_downloaded_time()}},e.prototype.searchRemoteBatch=function(e,t){n.WebRequest({url:this.searchConfig.remoteBatchEndpoint,type:"post",subject_user:this.user.id,dataType:"json",data:{queries:JSON.stringify(e)},success:t})},e.prototype.isTeamContact=function(e){return this.user.is_team&&null!=e.team&&e.team},e.prototype.processMatches=function(e,t,n){for(var r=[],s=0,l=e;s<l.length;s++){var c=l[s];n&&(c.nameMatch=a.match(n,c.name||""),c.emailMatch=a.match(n,c.email||"")),c.on_team=!(c.type===o.FB||!this.isTeamContact(c));var d=new i.Contact(c);d.pending=!1,this.excludeDomainContacts&&d.domain_contact||this.filterFunc&&!this.filterFunc(d)||r.push(d)}return t&&t(r),r},e})();t.ContactsDataSourceV2=l}),define("modules/clean/contacts/list",["require","exports","modules/clean/contacts/types","jquery","modules/clean/em_string"],function(e,t,n){"use strict";return(function(){function e(e,t){var n=this;this.filterContacts=this.filterContacts.bind(this),this.length=this.length.bind(this),this.slice=this.slice.bind(this),this.includeForUser=this.includeForUser.bind(this),this.includeForViewer=this.includeForViewer.bind(this),this.excludeByEmail=this.excludeByEmail.bind(this),this.excludeMe=this.excludeMe.bind(this),this.excludeNewStyleGroups=this.excludeNewStyleGroups.bind(this),this.excludeFacebook=this.excludeFacebook.bind(this),this.excludeTeamMembers=this.excludeTeamMembers.bind(this),this.excludePairedUserDuplicates=this.excludePairedUserDuplicates.bind(this),this.excludeNonTeam=this.excludeNonTeam.bind(this),this.excludeNonTeamActive=this.excludeNonTeamActive.bind(this),this.excludeSuspended=this.excludeSuspended.bind(this),this.sortByTeamFirst=this.sortByTeamFirst.bind(this),this._excludeType=this._excludeType.bind(this),this._lowercaseContact=this._lowercaseContact.bind(this),this.contacts=e,this.owningUserId=t,this.lcontacts=Array.from(this.contacts).map(function(e){return n._lowercaseContact(e)})}return e.create_contacts_list=function(t){return new e(t,null)},e.create_per_user_contacts_list=function(t,n){return new e(t,n)},e.prototype.filterContacts=function(t){return new e(this.contacts.filter(t),this.owningUserId)},e.prototype.length=function(){return this.contacts.length},e.prototype.slice=function(t,n){return new e(this.contacts.slice(t,n),this.owningUserId)},e.prototype.includeForUser=function(t){return null!=this.owningUserId?this.owningUserId===t?this:new e([],t):(this.owningUserId=t,this.filterContacts(function(e){return e.owning_user_id===t}))},e.prototype.includeForViewer=function(e){var t=e.get_user_ids();return this.filterContacts(function(e){return Array.from(t).includes(e.owning_user_id)})},e.prototype.excludeByEmail=function(e){return e=e?e.toLowerCase():"",this.filterContacts(function(t){return!(e===t.email.toLowerCase())})},e.prototype.excludeMe=function(){return this.filterContacts(function(e){return!e.is_owner})},e.prototype.excludeNewStyleGroups=function(){return this._excludeType(n.NEW_STYLE_GROUP)},e.prototype.excludeFacebook=function(){return this._excludeType(n.FB)},e.prototype.excludeTeamMembers=function(){return this.filterContacts(function(e){return!e.team})},e.prototype.excludePairedUserDuplicates=function(){return this.filterContacts(function(e){return!e.paired_user_duplicate})},e.prototype.excludeNonTeam=function(){return this.filterContacts(function(e){return e.team})},e.prototype.excludeNonTeamActive=function(){return this.filterContacts(function(e){return e.team&&"active"===e.join_state})},e.prototype.excludeSuspended=function(){return this.filterContacts(function(e){return"suspended"!==e.join_state})},e.prototype.sortByTeamFirst=function(){return new e(e.sortContactsByTeamFirst(this.contacts),this.owningUserId)},e.sortContactsByTeamFirst=function(e){for(var t=[],n=[],r=0,s=Array.from(e);r<s.length;r++){var i=s[r];i.team?t.push(i):n.push(i)}return t.concat(n)},e.prototype._excludeType=function(e){return this.filterContacts(function(t){return t.type!==e})},e.prototype._lowercaseContact=function(e){var t={};for(var n in e){var r=e[n];("string"==typeof r||r instanceof String)&&(r=r.toLowerCase()),t[n]=r}return t},e})()}),define("modules/clean/contacts/tokenizer",["require","exports","tslib","external/classnames","external/react","jquery","modules/clean/analytics","modules/clean/avatar/contact_avatar","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/contacts/contact_token_state","modules/clean/contacts/data_v2","modules/clean/contacts/typeahead","modules/clean/contacts/types","modules/clean/em_string","modules/clean/tokenizer","modules/clean/validators/validators","modules/core/browser","modules/core/i18n","modules/constants/contacts"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y){"use strict";function v(e,t,n){return void 0!==e&&null!==e&&"function"==typeof e[t]?n(e,t):void 0}function S(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.ContactTokenState=d.ContactTokenState;var E,b,I=s.createElement,T=s.DOM;t.SLOW_CONTACT_SEARCH_THRESHOLD=100;var C=f.check(f.create(["EmailValidator"])),w=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getTokenName=function(){switch(t.props.contact.type){case h.FB:return"fb_ids";case h.EMAIL:return"emails";case h.NEW_STYLE_GROUP:return"new_style_group_ids";default:return"invalids"}},t._getTokenValue=function(){switch(t.props.contact.type){case h.FB:return t.props.contact.fb_id;case h.NEW_STYLE_GROUP:return t.props.contact.group_id;default:return t.props.contact.email}},t._renderIcon=function(){return t.props.contact.type===h.FB?T.img({className:"token-icon",src:"/static/images/icons/fb_16-vflbiYTkC.png"}):t.props.contact.type===h.NEW_STYLE_GROUP||t.props.contact.dbx_account_id?I(a,{dimension:16,contact:t.props.contact,optionalClass:"token-icon"}):""},t._renderInput=function(){return T.input({type:"hidden",name:t._getTokenName(),value:t._getTokenValue()})},t._renderText=function(){var e=t.props.contact.name||t.props.contact.email;return m.Emstring.em_snippet(e,22)},t._makeCloseButton=function(){return t.props.onRemove?T.span({className:"tokenizer-token-close",onClick:function(){return t.props.onRemove(t.props.contact),!1},dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""},t}return n.__extends(t,e),t.prototype.render=function(){var e={"tokenizer-token":!0,"contact-token":!0,invalid:this.props.tokenState===d.ContactTokenState.invalid,warned:this.props.tokenState===d.ContactTokenState.warn,pending:this.props.tokenState===d.ContactTokenState.pending};e[this.props.customClass]=null!=this.props.customClass,e[this.props.className]=null!=this.props.className;var t=r(e);return T.a(i.extend({tabIndex:-1},this.props,{className:t}),this._renderInput(),this._renderIcon(),this._renderText(),this._makeCloseButton())},t.displayName="ContactsToken",t.propTypes={customClass:s.PropTypes.string,className:s.PropTypes.string,contact:s.PropTypes.object.isRequired,onRemove:s.PropTypes.func,tabIndex:s.PropTypes.number,tokenState:s.PropTypes.oneOf((function(){var e=[];for(E in d.ContactTokenState)b=d.ContactTokenState[E],e.push(b);return e})()).isRequired},t})(s.Component),A={basic:function(e){var t=e.name&&!e.invalid&&e.email!==e.name;return{state:e.invalid?d.ContactTokenState.invalid:d.ContactTokenState.ok,msg:t?e.email:null}},warn:function(e){return{state:e.pending?d.ContactTokenState.pending:e.on_team?d.ContactTokenState.ok:e.invalid?d.ContactTokenState.invalid:d.ContactTokenState.warn,msg:null}},forbid:function(e){return{state:e.pending?d.ContactTokenState.pending:e.on_team?d.ContactTokenState.ok:d.ContactTokenState.invalid,msg:null}}};t.ContactTokenValidator=A;var M=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._initContactsDataSource=function(e,t,n){return new u.ContactsDataSourceV2(e,t,n)},t._validateTokens=function(e,t){if(void 0===t&&(t=!1),(null!=e?e.length:void 0)>0)return(function(){for(var n=[],r=0,s=Array.from(e);r<s.length;r++){var i=s[r];i.type===h.EMAIL&&(i.invalid=!C(i.email)),t?(i.query=i.query||i.email||i.name,n.push(i.pending=!0)):n.push(void 0)}return n})()},t.finishLogging=function(e){var n=t.contactsDataSource.getStats().numLocalContacts;if(t._flush_unfinished_queries_cache(),t.props.shouldLogContactSearch)return t.contact_search_logger.log_records(t.props.user.id,e,n)},t._logTokenChangeEvent=function(e,n,r){if(void 0===n&&(n=!1),void 0===r&&(r={}),t.contact_search_logger){if(n)return t.contact_search_logger.flag_record_as_removed(e.getContactID());var s={context:t._getLoggingContext(),contact_type:e.type,contact_id:e.getContactID(),contact_name:e.name,sort_variant:null,event_ts:v(g.performance(),"now",function(e){return e.now()})};for(E in r)b=r[E],s[E]=b;return t.contact_search_logger.add_record(s)}},t._logSearchComplete=function(e,n,r){if(void 0===r&&(r=!0),t._shouldLogSearch()&&e){var s=g.performance().now(),i=t.unfinished_contact_search_queries[e];if(i){var o=i.begin_time;!("ttfr"in i)&&n>0&&(i.ttfr=Math.floor(s-o)),r?(i.local_duration=Math.floor(s-o),i.num_local_results=n):(i.remote_duration=Math.floor(s-o),i.num_additional_remote_results=n),i.num_results+=n;return(function(){return t.contactsDataSource.isSearchLocalOnly()&&r||!r})()?(i=t._prepareSearchStatsForLogging(i,e,s,!0),t.contact_search_logger.add_timing_record(i),t.contact_search_logger.count_search(i.is_slow),delete t.unfinished_contact_search_queries[e]):void 0}}},t._logSearchBegin=function(e){if(t._shouldLogSearch()&&e){var n=g.performance().now();return t._flush_unfinished_queries_cache(n),t.unfinished_contact_search_queries[e]={begin_time:n,num_results:0}}},t._shouldLogSearch=function(){return t.props.shouldLogContactSearch&&null!=t.contact_search_logger&&null!=S(g.performance(),function(e){return e.now})},t._flush_unfinished_queries_cache=function(e){if(t._shouldLogSearch()){null==e&&(e=g.performance().now());for(var n in t.unfinished_contact_search_queries){var r=t.unfinished_contact_search_queries[n];e-r.begin_time<l.CONTACTS_SEARCH_PREEMPTED_THRESHOLD&&(r.is_preempted=!0),r=t._prepareSearchStatsForLogging(r,n,e,!1),t.contact_search_logger.add_timing_record(r),t.contact_search_logger.count_search(r.is_slow)}return t.unfinished_contact_search_queries={}}},t._prepareSearchStatsForLogging=function(e,n,r,s){var i=e.begin_time;e.duration=Math.floor(r-i),"ttfr"in e?e.is_slow=e.ttfr>100:s&&0===e.num_results?e.is_slow=!1:e.is_slow=e.duration>100;var o=t.contactsDataSource.getStats().localContactsDownloadedTime;return e.started_before_download=null==o||i<o,"is_preempted"in e||(e.is_preempted=!1),e.context=t._getLoggingContext(),e.query_length=n.length,e.is_finished=s,e},t._getLoggingContext=function(){var e="react_tokenizer";return null!=t.props.context&&(e+="_"+t.props.context),e},t.addExternalContacts=function(e){return t.refs.tokenizer.addExternalTokens(e)},t._renderToken=function(e){return I(w,{contact:e,tabIndex:t.props.disableAdditionalInput?0:-1,tokenState:t.props.customContactValidator(e).state})},t._renderTokenHover=function(e){return t.props.customContactValidator(e).msg},t._autoSelectMatch=function(e,n){if(!n||!e)return null;e=t.contactsDataSource.normalizeQuery(e);for(var r={email:[],name:[]},s=0,i=Array.from(n);s<i.length;s++){var o=i[s],a=o.email?t.contactsDataSource.normalizeQuery(o.email):null,l=o.name?t.contactsDataSource.normalizeQuery(o.name):null;e===a?r.email.push(o):e===l&&r.name.push(o)}for(var c=0,d=["email","name"];c<d.length;c++){var u=d[c];if(1===r[u].length)return r[u][0]}return null},t._queryTokens=function(e,n){var r=e.filter(function(e){return e.pending&&e.query});if(r.length){var s=Array.from(r).map(function(e){return e.query}),i=function(r){var s=[];e=[];for(var i=t.serializeInputData(n).tokens,o=0,a=Array.from(i);o<a.length;o++){var l=a[o],c=l;if(l.pending&&l.query){var d=t.contactsDataSource.normalizeQuery(l.query),u=t._autoSelectMatch(d,r[d]);u&&(c=u)}E=c.getKey(),Array.from(s).includes(E)||(s.push(E),e.push(c))}return n.replaceTokens(e)},o=i,a=i;return t.contactsDataSource.searchBatch(s,o,a)}},t.tokenizeEmails=function(e,t){void 0===t&&(t=!1);var n,r=e.split(/[,|;\n ]+/);2===r.length&&C(r[0]+r[1])?(n=[r[0]+r[1]],t=!0):n=2===r.length&&C(r[0])&&""===r[1]?r:e.split(/[,|;\n]+/);var s="";t||(s=n.pop());for(var i=[],o=0,a=Array.from(n);o<a.length;o++){var l=a[o],d=l.trim();""!==d&&i.push(new c.Contact({name:d,email:d,type:h.EMAIL,invalid:!C(d),on_team:!1,pending:!0,query:d}))}return{tokens:i,value:s}},t.serializeInputData=function(e){return e=e||t.refs.tokenizer,e.serializeInputData()},t.getContacts=function(){var e=t.serializeInputData(),n=e.tokens,r=e.value,s=t.tokenizeEmails(r,!0);return n.concat(s.tokens)},t.tokenizeAll=function(){return t.refs.tokenizer.tokenizeAll()},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){e.user===this.props.user&&e.customContactFilter.toString()===this.props.customContactFilter.toString()||(this.contactsDataSource=this._initContactsDataSource(e.user,e.customContactFilter,e.excludeDomainContacts)),this._validateTokens(null!=e.populatedInputData?e.populatedInputData.tokens:void 0)},t.prototype.componentWillMount=function(){this.contactsDataSource=this._initContactsDataSource(this.props.user,this.props.customContactFilter,this.props.excludeDomainContacts),this._validateTokens(null!=this.props.populatedInputData?this.props.populatedInputData.tokens:void 0,!0)},t.prototype.componentDidMount=function(){if(this.props.shouldLogContactSearch&&(this.contact_search_logger=new o.ContactSearchLogger(this._getLoggingContext(),this.contactsDataSource.searchModeName),this.unfinished_contact_search_queries={}),(null!=this.props.populatedInputData.tokens?this.props.populatedInputData.tokens.length:void 0)>0||(null!=this.props.populatedInputData.value?this.props.populatedInputData.value.length:void 0)>0){var e=this.serializeInputData(),t=e.tokens,n=e.value;return"function"==typeof this.props.onContentsChange?this.props.onContentsChange(t,n):void 0}},t.prototype.render=function(){var e=this;return I(_.Tokenizer,{ref:"tokenizer",dataSource:this.contactsDataSource,customClass:this.props.customClass,initialInputText:this.props.populatedInputData.value,placeholderText:this.props.placeholder,renderSelector:function(){return I(p.ContactsTypeaheadSelector,{showContactImport:e.props.showContactImport,teamGroupInfo:e.props.teamGroupInfo,user:e.props.user})},renderInput:function(){return T.textarea({className:"contacts-tokenizer-input",id:e.props.id,rows:1})},renderToken:this._renderToken,renderTokenHover:this._renderTokenHover,onContentsChange:this.props.onContentsChange,onTokensAdd:this._queryTokens,stringTokenizer:this.tokenizeEmails,populatedTokenData:this.props.populatedInputData.tokens,tabIndex:this.props.tabIndex,tokenSpacing:this.props.tokenSpacing,focusOnMount:this.props.focusOnMount,logSearchBegin:this._logSearchBegin,logSearchComplete:this._logSearchComplete,logTokenChangeEvent:this._logTokenChangeEvent,disableAdditionalInput:this.props.disableAdditionalInput,disabled:this.props.disabled},this.props.children)},t.displayName="ContactsTokenizer",t.propTypes={user:s.PropTypes.object.isRequired,context:s.PropTypes.string,customClass:s.PropTypes.string,customContactFilter:s.PropTypes.func,excludeDomainContacts:s.PropTypes.bool,customContactValidator:s.PropTypes.func,focusOnMount:s.PropTypes.bool,id:s.PropTypes.string,onContentsChange:s.PropTypes.func,placeholder:s.PropTypes.string,populatedInputData:s.PropTypes.shape({tokens:s.PropTypes.array,value:s.PropTypes.string}),tabIndex:s.PropTypes.number,showContactImport:s.PropTypes.bool,shouldLogContactSearch:s.PropTypes.bool,teamGroupInfo:s.PropTypes.shape({id:s.PropTypes.string,name:s.PropTypes.string}),tokenSpacing:s.PropTypes.number,disableAdditionalInput:s.PropTypes.bool,disabled:s.PropTypes.bool},t.defaultProps={customContactFilter:function(e){return!0},customContactValidator:A.basic,excludeDomainContacts:!0,focusOnMount:!1,id:null,placeholder:y._("Invite more people"),populatedInputData:{tokens:[],value:""},tokenSpacing:4,showContactImport:!1,shouldLogContactSearch:!1,teamGroupInfo:null,disableAdditionalInput:!1,disabled:!1},t})(s.Component);t.ContactsTokenizer=M}),define("modules/clean/contacts/typeahead",["require","exports","tslib","external/classnames","external/create-react-class","external/react","external/lodash","modules/clean/avatar/contact_avatar","modules/clean/contacts/types","modules/clean/contacts/util","modules/clean/css","modules/clean/em_string","modules/clean/profile_services/popup_handler","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/paging_list","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/clean/static_urls","modules/clean/typeahead","modules/core/exception","modules/core/i18n","modules/core/notify","jquery"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y,v,S,E,b,I,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var C=i.DOM,w=i.createElement,A=function(e,t){return o.assignIn({},e,t)},M=A(E.TypeaheadSelectorMixin,{getOptions:function(){var e=this;if(null==this.props.queryOptions)return[];if(this.state.importsExpanded)return Array.from(h.importable_contact_services()).map(function(t){return new R({provider:t,connected:e.profile_services.service_is_connected(t)})});var t=this.props.queryOptions.slice();return this.props.teamGroupInfo?t.push(c.teamGroupInfoToContact(this.props.teamGroupInfo)):(null!=this.profile_services?this.profile_services.has_unconnected_services(!0):void 0)&&t.push(new P),t},renderOption:function(e){return e instanceof P?w(L):e instanceof R?w(O,{import:e}):this.props.renderQueryOption(e)},onSelect:function(e){if(e instanceof P)return this._changeSelectionIndex(0),this.setState({importsExpanded:!0});if(e instanceof R){var t=void 0;if(b.assert((t=e.provider,Array.from(h.importable_contact_services()).includes(t)),"invalid party contact provider "+e.provider),this.profile_services.service_is_connected(e.provider)){var n=I._("You're already connected to %(service_name)s").format({service_name:h.to_name(e.provider)});return void T.success(n)}return this.link_handler.auth_service_with_user(e.provider,this.props.user.id,function(e){return m.ProfileServicesLinkingHandler.show_import_notifications(e)})}return this.props.onSelect(e)},reset:function(){return this._changeSelectionIndex(0),this.setState({importsExpanded:!1})}}),k=s({displayName:"ContactsTypeaheadSelector",mixins:[M],propTypes:{customClass:i.PropTypes.string,onSelect:i.PropTypes.func.isRequired,queryOptions:i.PropTypes.array,renderQueryOption:i.PropTypes.func.isRequired,showContactImport:i.PropTypes.bool,teamGroupInfo:i.PropTypes.shape({id:i.PropTypes.string,name:i.PropTypes.string}),user:i.PropTypes.object.isRequired},componentWillMount:function(){if(this.link_handler=new m.ProfileServicesLinkingHandler,this.profile_services=null,null===this.props.teamGroupInfo&&this.props.showContactImport&&null!=this.props.user)return this.profile_services=m.LinkedProfileServices.get_linked_profile_services_for_user(this.props.user.id)},componentWillReceiveProps:function(e){return 0===(null!=e.queryOptions?e.queryOptions.length:void 0)?this._changeSelectionIndex(-1):(null!=e.queryOptions?e.queryOptions.length:void 0)>0&&this.state.selectionIndex===-1?this._changeSelectionIndex(0):void 0},shouldComponentUpdate:function(e,t){return!o.isEqual(e,this.props)||!o.isEqual(t,this.state)},getDefaultProps:function(){return{showContactImport:!1,teamGroupInfo:null,onSelect:function(e){},renderQueryOption:function(e){return w(N,{contact:e})}}},onSelectionIndexChange:function(e){return null!=this.refs.pagingList?this.refs.pagingList.scrollAround(e):void 0},render:function(){if(d.require_css("/static/css/react/contacts_typeahead-vfl-C8Z8J.css"),!this.getOptions().length)return C.div({});var e={"typeahead-selector":!0,"contacts-selector":!0};return e[this.props.customClass]=null!=this.props.customClass,w(g,{customClass:r(e),pageSize:4,itemSize:54,ref:"pagingList"},this.renderOptions())}});t.ContactsTypeaheadSelector=k;var N=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderPrimary=function(){return t._renderMatch(t.props.contact.name,t.props.contact.nameMatch)},t._renderSecondary=function(){switch(t.props.contact.type){case l.EMAIL:return t.props.contact.email===t.props.contact.name?"":t._renderMatch(t.props.contact.email,t.props.contact.emailMatch);case l.FB:return I._("Facebook message");case l.NEW_STYLE_GROUP:return t.props.contact.members;default:return""}},t._renderMatch=function(e,t){if(e&&(e=u.Emstring.em_snippet(e,22)),!t)return e;for(var n=e.indexOf("…"),r=0,s=[],i=0,o=Array.from(t.highlighted);i<o.length;i++){var a=o[i],l=a[0],c=a[1];l>r&&s.push(e.slice(r,l));var d=l+c;d>n&&n!==-1&&(d=n);var p=e.slice(l,d);s.push(C.strong({key:"highlight-"+p+"-"+l},p)),r=d}return r<e.length&&s.push(e.slice(r)),s},t._renderIcon=function(){return C.div({className:"u-pad-right-xs"},w(a,{dimension:32,contact:t.props.contact,optionalClass:"contact-icon"}))},t._renderDomainTooltip=function(){return C.div({className:"u-pad-right-xs"},w(v.TitleBubble,{content:I._("Suggested contact from your domain"),position:v.TitleBubble.POSITIONS.BOTTOM},w(y,{group:"web",name:"info",alt:I._("Domain contact")})))},t}return n.__extends(t,e),t.prototype.render=function(){var e;e={"contacts-typeahead-option":!0},e[this.props.customClass]=null!=this.props.customClass,null!=this.props.className&&(e[this.props.className]=!0);var t={primary:this._renderPrimary(),secondary:this._renderSecondary()};return t=o.pickBy(t,function(e){return""!==e}),C.li(A(this.props,{className:r(e)}),w(_.Flag,{leftAttachment:this._renderIcon(),rightAttachment:this.props.contact.domain_contact?this._renderDomainTooltip():void 0},(function(){var n=[];for(var s in t){var i=t[s];e={"option-only":1===o.size(t)},e["option-"+s]=!0,n.push(C.div({className:r(e),key:"option-"+s},i))}return n})()))},t.displayName="ContactsTypeaheadSelectorOption",t.propTypes={contact:i.PropTypes.object.isRequired,customClass:i.PropTypes.string},t})(i.Component);t.ContactsTypeaheadSelectorOption=N;var P=(function(){function e(){}return e.prototype.getKey=function(){return"expand-importer"},e})(),L=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e={"expand-imports-option":!0,"contacts-typeahead-option":!0};return null!=this.props.className&&(e[this.props.className]=!0),C.li(A(this.props,{className:r(e)}),w(_.Flag,{leftAttachment:w(f.Image,{className:"u-pad-right-xs",src:S.static_url("/static/images/icons/icon-import-vflOL9sCs.png"),srcHiRes:S.static_url("/static/images/icons/icon-import@2x-vfluE8TBO.png")})},C.div({className:"option-primary option-only"},I._("Import contacts"))))},t.displayName="ExpandImportOption",t})(i.Component);t.ExpandImportOption=L;var R=(function(){function e(e){var t=e.provider,n=e.connected;this.provider=t,this.connected=n}return e.prototype.getKey=function(){return"third-party-import"+this.provider},e})(),O=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showSpinner:!1},t.show_contact_import_spinner=function(e){if(t.props.import.provider===e.provider)return t.setState({showSpinner:!0})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){return this.authCompleteListenerToken=p.addAuthCompleteListener(this.show_contact_import_spinner)},t.prototype.componentWillUnmount=function(){return p.removeAuthCompleteListener(this.authCompleteListenerToken)},t.prototype.render=function(){var e=this.props.import,t=e.provider,n=e.connected,s=h.to_name(t);!n&&this.state.showSpinner&&(s=I._("Importing %(service_name)s Contacts").format({service_name:s}));var i=n?I._("Connected"):"",o={"third-party-option":!0,"contacts-typeahead-option":!0};return null!=this.props.className&&(o[this.props.className]=!0),C.li(A(this.props,{className:r(o)}),!n&&this.state.showSpinner?C.div({className:"option-spinner"},C.img({src:"/static/images/icons/ajax-loading-small-blue-vflVk_QNP.gif"})):void 0,w(_.Flag,{spacing:"xs",leftAttachment:w(f.Image,{alt:"",src:S.static_url(h.to_img(t)[0]),srcHiRes:S.static_url(h.to_img(t)[1])})},C.div({className:r({"option-primary":!0,"option-only":!n})},s,n?C.div({className:"option-secondary u-font-meta"},i):void 0)))},t.displayName="ThirdPartyImportOption",t.propTypes={import:i.PropTypes.object.isRequired},t})(i.Component);t.ThirdPartyImportOption=O}),define("modules/clean/contacts/types",["require","exports"],function(e,t){"use strict";var n;return(function(e){e[e.EMAIL=0]="EMAIL",e[e.FB=1]="FB",e[e.INVALID_ID=2]="INVALID_ID",e[e.NEW_STYLE_GROUP=4]="NEW_STYLE_GROUP",e[e.DBX_ID=5]="DBX_ID"})(n||(n={})),n}),define("modules/clean/contacts/util",["require","exports","modules/clean/contacts/contact","modules/clean/contacts/types"],function(e,t,n,r){"use strict";return(function(){function e(){}return e.activityUserToContact=function(e,t){return void 0===t&&(t=0),{dbx_account_id:e.unique_id,fname:e.fname,lname:e.lname,name:e.display_name,name_tokens:[e.fname,e.lname],email:e.email,type:r.DBX_ID,
priority:t,photo_url:e.photo_circle_url}},e.teamGroupInfoToContact=function(e){return new n.Contact({group_id:e.id,group_size:e.group_size,type:r.NEW_STYLE_GROUP,name:e.name,on_team:!0,pending:!1})},e})()}),define("modules/clean/flux/store_listener",["require","exports","external/create-react-class","external/react"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t,s){return n({displayName:"StoreListener("+(null!=e.displayName?e.displayName:"Unknown")+")",getInitialState:function(){return{childProps:s(this.props,t)}},componentDidMount:function(){for(var e=0,n=Object.keys(t||{});e<n.length;e++){t[n[e]].add_change_listener(this._handleStoreChanged)}return this.setState({childProps:s(this.props,t)})},componentWillUnmount:function(){var e=this;return(function(){for(var n=[],r=0,s=Object.keys(t||{});r<s.length;r++){var i=s[r],o=t[i];n.push(o.remove_change_listener(e._handleStoreChanged))}return n})()},render:function(){for(var t={ref:"wrapped"},n=0,s=Object.keys(this.state.childProps||{});n<s.length;n++){var i=s[n],o=this.state.childProps[i];t[i]=o}return r.createElement(e,t,this.props.children)},getWrappedComponent:function(){return this.refs.wrapped},getStores:function(){return t},_handleStoreChanged:function(){if(this.isMounted()){var e=s(this.props,t);if(null!=e)return this.setState({childProps:e})}}})};t.listenToStores=s}),define("modules/clean/react/bubble",["require","exports","tslib","external/react","external/lodash","modules/clean/css"],function(e,t,n,r,s,i){"use strict";var o,a=r.DOM,l={TOP:"top",TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM:"bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",RIGHT:"right",RIGHT_TOP:"right-top",RIGHT_BOTTOM:"right-bottom",LEFT:"left",LEFT_TOP:"left-top",LEFT_BOTTOM:"left-bottom"};c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderArrow=function(){return null!=t.props.arrow?[a.div({className:"react-bubble-box__arrow-border",key:"arrow-border"}),a.div({className:"react-bubble-box__arrow",key:"arrow"})]:[]},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){if("undefined"!=typeof window&&null!==window)return i.require_css("/static/css/react/bubble_box-vflpfsqHZ.css")},t.prototype.render=function(){var e=["react-bubble-box","react-bubble-box--arrow-"+this.props.arrow,this.props.className],t=s.assignIn({},s.omit(this.props,["arrow","className"]),{className:e.join(" ")});return a.div(t,this._renderArrow(),this.props.children)},t})(r.Component),c.displayName="Bubble",c.ARROW=l,c.propTypes={arrow:r.PropTypes.oneOf(s.values(l)),className:r.PropTypes.string},c.defaultProps={arrow:null,className:""},o=c;var c;return o}),define("modules/clean/react/calendar",["require","exports","tslib","external/classnames","external/spectrum/dropdown_button","external/react","external/react-dom","modules/clean/datetime","modules/clean/react/css","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l,c,d){"use strict";function u(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}Object.defineProperty(t,"__esModule",{value:!0});var p=function(){},h=0,m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={currentDate:t.props.initDate,calendarIsVisible:t.props.calendarIsInitiallyVisible},t.setCalendarDateViewRef=function(e){t.refCalendarDateView=o.findDOMNode(e)},t.setCalendarViewRef=function(e){t.refCalendarView=o.findDOMNode(e)},t._handleDocumentClick=function(e){if(t.refCalendarView&&t.refCalendarDateView){var n=e.target;!t.state.calendarIsVisible||t.refCalendarView.contains(n)||t.refCalendarDateView.contains(n)||(e.preventDefault(),e.stopPropagation(),t.closeCalendar())}},t.toggleCalendarView=function(){t.setState({calendarIsVisible:!t.state.calendarIsVisible})},t.handleDateSelected=function(e){t.setState({currentDate:e}),t.props.onDateChange(e),t.closeCalendar()},t.closeCalendar=function(){t.setState({calendarIsVisible:!1}),t.refCalendarDateView&&t.refCalendarDateView.focus(),t.props.onCalendarClose&&t.props.onCalendarClose()},t._startOfDay=function(e){var t=new Date(e.getTime());return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},t._getDateViewText=function(){var e=function(e){return a.format_date(e,a.localized_date_format)};return t.props.placeholderText&&!t.props.initDate?t.props.placeholderText:e(t.state.currentDate?t.state.currentDate:new Date)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){document.addEventListener("click",this._handleDocumentClick)},t.prototype.componentWillUnmount=function(){document.removeEventListener("click",this._handleDocumentClick)},t.prototype.componentWillReceiveProps=function(e){e.initDate!==this.state.currentDate&&this.setState({currentDate:e.initDate})},t.prototype.render=function(){var e,t={"c-datepicker":!0,"scooter-css u-l-fl clearfix":!this.props.isMaestroDesign};return this.state.calendarIsVisible&&(e=i.createElement(f,{ref:this.setCalendarViewRef,alignAtLeft:this.props.alignAtLeft,firstDay:this._startOfDay(this.props.firstDay),lastDay:this._startOfDay(this.props.lastDay),initDate:this.state.currentDate||new Date,onDateChange:this.handleDateSelected,onCalendarClose:this.props.onCalendarClose,onEscapePressed:this.closeCalendar})),i.createElement("div",{className:r(t)},i.createElement(_,{buttonText:this._getDateViewText(),ref:this.setCalendarDateViewRef,calendarVisible:this.state.calendarIsVisible,disabled:this.props.disabled,isMaestroDesign:this.props.isMaestroDesign,onClick:this.toggleCalendarView}),e)},t.displayName="Calendar",t.defaultProps=(function(){var e=new Date,t=new Date(e.getTime());t.setFullYear(t.getFullYear()-1);var n=new Date(e.getTime());return n.setFullYear(n.getFullYear()+1),{disabled:!1,isMaestroDesign:!1,firstDay:t,lastDay:n,alignAtLeft:!0,onDateChange:p,calendarIsInitiallyVisible:!1}})(),t})(i.Component),_=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderLegacyCaret=function(){return i.createElement(c,{group:"web",name:"calendar_view_month",className:"u-l-fr",alt:t.props.description})},t}return n.__extends(t,e),t.prototype.render=function(){var e={"is-active":this.props.calendarVisible,"c-input":!this.props.isMaestroDesign,"filter-item__filter-input":this.props.isMaestroDesign};if(this.props.isMaestroDesign)return i.createElement(s.DropdownButton,{disabled:this.props.disabled,onClick:this.props.onClick,"aria-expanded":this.props.calendarVisible},this.props.buttonText);var t=i.createElement("span",{className:"c-calendar__date-text"},this.props.buttonText);return i.createElement("button",{className:r(e),disabled:this.props.disabled,onClick:this.props.onClick,"aria-expanded":this.props.calendarVisible},this.renderLegacyCaret(),t)},t.displayName="CalendarDateView",t.defaultProps={isMaestroDesign:!1,calendarVisible:!0,onClick:function(){},disabled:!1,description:d._("Change deadline")},t})(i.Component),f=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={viewDate:n.props.initDate,currentlyActiveDate:n.props.initDate},n.clampToFirstLastDate=function(e){e<n.props.firstDay?e.setTime(n.props.firstDay.getTime()):e>n.props.lastDay&&e.setTime(n.props.lastDay.getTime())},n.getDaysInMonth=function(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()},n.setPrevMonthButtonRef=function(e){n.refPrevButton=e},n.setNextMonthButtonRef=function(e){n.refNextButton=e},n.setCurrentDayButtonRefAndMaintainFocus=function(e){var t=document.activeElement&&document.activeElement.getAttribute("data-day-in-month");n.refCurrentDayButton=e,n.refCurrentDayButton&&t&&n.refCurrentDayButton.focus()},n.handleDayClicked=function(e){var t=e.target,r=parseInt(t.getAttribute("data-day-in-month")||"",10),s=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),r);n.setState({currentlyActiveDate:s}),n.props.onDateChange(s)},n.handleKeyDownOnDay=function(e){if(27===e.which)return n.props.onEscapePressed(),void e.preventDefault();if(9===e.which){var t=void 0,r=n.refNextButton.classList.contains("u-l-dn")?null:n.refNextButton,s=n.refPrevButton.classList.contains("u-l-dn")?null:n.refPrevButton;return t=e.shiftKey?r||s:s||r,t&&t.focus(),void e.preventDefault()}if([38,39,40,37].indexOf(e.which)!==-1){var i=n.getDaysInMonth(n.props.initDate),o=(n.state.currentlyActiveDate||n.props.initDate).getDate(),a=null;switch(e.which){case 38:a=Math.max(1,o-7);break;case 39:a=Math.min(i,o+1);break;case 40:a=Math.min(i,o+7);break;case 37:a=Math.max(1,o-1)}if(null!=a){var l=new Date(n.state.viewDate.getTime());l.setDate(a),n.clampToFirstLastDate(l),n.setState({currentlyActiveDate:l})}e.preventDefault()}},n.renderDay=function(e,t){var s=!t;n.props.lastDay&&(t=t||e>n.props.lastDay),n.props.firstDay&&(t=t||e<n.props.firstDay);var o=u(n.state.currentlyActiveDate,e),l=u(n.props.initDate,e),c={"button-as-link":!t,"c-calendar__date":!0,"c-calendar__date--disabled":t,"current-month":s,"c-calendar__date--was-initially-active":l,"c-calendar__date--is-active":o},d=p;u(n.state.currentlyActiveDate,e)&&(d=n.setCurrentDayButtonRefAndMaintainFocus);var h="day"+e.getDate()+"-"+e.getMonth(),m=a.nice_date_with_month_name(e,!0,!0,!0);return i.createElement("td",{key:h},i.createElement("button",{className:r(c),disabled:t,onClick:t?void 0:n.handleDayClicked,onKeyDown:n.handleKeyDownOnDay,"data-day-in-month":e.getDate(),"aria-label":m,ref:d},e.getDate()))},n.renderDays=function(){for(var e=[],t=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),1),r=t.getDay(),s=r;s>0;s--){var o=new Date(t.getFullYear(),t.getMonth(),t.getDate());o.setDate(o.getDate()-s),e.push(n.renderDay(o,!0))}for(var a=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),1);a.getMonth()===n.state.viewDate.getMonth();)e.push(n.renderDay(a)),a=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),a.getDate()+1);for(var l=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth()+1,0);6!==l.getDay();)l=new Date(l.getFullYear(),l.getMonth(),l.getDate()+1),e.push(n.renderDay(l,!0));var c=[],d=[];return e.forEach(function(e,t){d.push(e),(t+1)%7===0&&(c.push(i.createElement("tr",{key:"week-"+t},d)),d=[])}),c},n.offsetViewDateByMonth=function(e){n.setState({viewDate:new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth()+e,1)})},n.handleClickNextMonth=function(){n.offsetViewDateByMonth(1)},n.handleClickPrevMonth=function(){n.offsetViewDateByMonth(-1)},n.handleKeyDownMonthButton=function(e){if(27===e.which)return n.props.onEscapePressed(),void e.preventDefault();if(9===e.which){var t=!e.shiftKey,r=void 0,s=n.refNextButton.classList.contains("u-l-dn")?void 0:n.refNextButton,i=n.refPrevButton.classList.contains("u-l-dn")?void 0:n.refPrevButton,o=n.refCurrentDayButton;r=e.target===n.refPrevButton?t?s||o:o||s:t?o||i:i||o,r&&r.focus(),e.preventDefault()}},n.renderMonthChangers=function(){var e=[],t=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),1),s=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),n.getDaysInMonth(n.state.viewDate)),o={"arrow-select":!0,"u-l-dn":t<=n.props.firstDay,"ax-focusable":!0,"u-l-fl":!0};e.push(i.createElement("button",{className:r(o),onClick:n.handleClickPrevMonth,ref:n.setPrevMonthButtonRef,onKeyDown:n.handleKeyDownMonthButton},i.createElement("span",{className:"c-arrow c-arrow--left u-thide"},d._("Previous month"))));var a={"arrow-select":!0,"u-l-dn":s>=n.props.lastDay,"ax-focusable":!0,"u-l-fr":!0};return e.push(i.createElement("button",{className:r(a),onClick:n.handleClickNextMonth,ref:n.setNextMonthButtonRef,onKeyDown:n.handleKeyDownMonthButton},i.createElement("span",{className:"c-arrow c-arrow--right u-thide"},d._("Next month")))),e},n.renderWeekdayRows=function(){return[d._("Sunday"),d._("Monday"),d._("Tuesday"),d._("Wednesday"),d._("Thursday"),d._("Friday"),d._("Saturday")].map(function(e){return i.createElement("th",{key:e},i.createElement("abbr",{title:e},e.slice(0,3)))})},n.calendarId=++h,n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.refCurrentDayButton&&this.refCurrentDayButton.focus()},t.prototype.componentWillUpdate=function(e,t){if(t.viewDate&&t.viewDate.getMonth()!==this.state.viewDate.getMonth()){var n=new Date(t.viewDate.getTime()),r=this.getDaysInMonth(t.viewDate);n.setDate(Math.min(r,this.state.currentlyActiveDate.getDate())),this.clampToFirstLastDate(n),this.setState({currentlyActiveDate:n})}},t.prototype.render=function(){var e={"c-calendar":!0,"c-card":!0,"u-pad-xs":!0,"u-left":this.props.alignAtLeft,"u-right":!this.props.alignAtLeft},t="calendar-header-"+ ++this.calendarId,n=this.renderMonthChangers(),s=n[0],o=n[1],l=i.createElement("strong",{id:t,"aria-live":"assertive","aria-atomic":"true"},d._("%(month)s %(year)s",{comment:"For example 'January 2010'. This is used as part of a calendar."}).format({month:a.month_name(this.state.viewDate.getMonth()),year:this.state.viewDate.getFullYear()}));return i.createElement("div",{className:r(e)},i.createElement("div",{className:"c-calendar__nav u-mar-bottom-s u-font-center u-cf"},s,o,l),i.createElement("table",{className:"c-calendar__picker"},i.createElement("thead",{className:"ax-visually-hidden"},i.createElement("tr",null,this.renderWeekdayRows())),i.createElement("tbody",null,this.renderDays())))},t.displayName="CalendarView",t.defaultProps={onDateChange:p,onEscapePressed:p,alignAtLeft:!1},t})(i.Component);t.CalendarView=f,t.Calendar=l(m,["/static/css/scooter/scooter-scoped-vflhQ6850.css","/static/css/components/calendar-vflO2TC4l.css"])}),define("modules/clean/react/content_manager/api",["require","exports","external/react","external/lodash","jquery","modules/clean/ajax","modules/clean/analytics","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/sort_helpers","modules/clean/react/browse/store","modules/clean/react_format","modules/clean/sharing/api/util/types","modules/clean/sharing/ui_util","modules/clean/teams/admin/api/admin_console_api_client","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=function(e){try{return JSON.parse(e)}catch(e){if(!(e instanceof SyntaxError))throw e}return null},v=function(e){var t=!1;return e.sync_setting?"default"===e.sync_setting[".tag"]?(e.content_sync_settings&&e.content_sync_settings.some(function(e){return"not_synced"===e.sync_setting[".tag"]})&&(t=!0),t?"sync_partial":"sync"):"not_synced"===e.sync_setting[".tag"]?"nosync":"sync":"sync"},S=function(e){return{fq_path:"/"+e.name,href:"/work/"+e.name,is_dir:!0,bytes:0,target_ns:e.team_folder_id,icon:G[e.status[".tag"]],team_folder_status:e.status[".tag"],sync_setting:v(e),type:l.FileTypes.TEAM_SHARED_FOLDER}},E="undefined"!=typeof window&&null!==window?s(window):null,b=new RegExp('([\\u0000-\\u001F]|\\\\|\\/|:|\\?|\\*|<|>|\\"|\\|)'),I=new RegExp('([\\u0000-\\u001F]|\\\\|\\/|:|\\?|\\*|\\"|\\|)'),T=new RegExp("[\\ufffe-\\uffff\\ud800-\\udfff]"),C=[".",".."],w=function(e,t){return void 0===t&&(t=!1),""===e?"":e.length>255?_._("The folder name should be under 255 characters"):t&&e.startsWith(".")?_._("The folder name can’t start with a dot (.)"):e.endsWith(".")?_._("The folder name can’t end with a dot (.)"):Array.from(C).includes(e)?_._("The names dot (.) and dot dot (..) are’t allowed"):b.test(e)?_._("The following characters aren’t allowed: \\ / : ? * < > ” |"):T.test(e)?_._("The folder name contains invalid characters"):null};t.validateFolderName=w;var A=function(e){return""===e?"":e.length>255?_._("The file name should be under 255 characters"):I.test(e)?_._("The following characters aren’t allowed: \\ / : ? * ” |"):T.test(e)?_._("The file name contains invalid characters"):null},M=function(e,t){return Array.from(e).map(function(e){return e.fq_path="/"+t+e.fq_path})},k=function(){var e=h.GoldenGate.hasContentManagerCdm(d.getBrowseStore().user().id);return new m.AdminConsoleApiClient(e,!1)},N=function(e){var t=e.path,n=e.userId,s=e.sortFoldersFirst,o=e.includeDeletedFiles,a=e.nsId,l=e.onSuccess,d=e.onError,u=h.GoldenGate.hasContentManagerCdm(n),p=k();if("/"!==t||u){var m=t.split("/"),_=m[1],f=u?1:2,y="/"+m.slice(f).join("/");return i.WebRequest({data:{show_deleted:o||"",admin_console:!0,ns_id:a,sort_folders_first:s},url:new g({path:"/browse"+y}),subject_user:n,success:function(e){try{return r.isString(e)&&(e=JSON.parse(e)),u||(e.paginated?M(e.first_page.items,_):M(e.file_info,_)),E.scrollTop(0),void l({path:t,data:e})}catch(e){}},error:function(e,t,n){return"function"==typeof d?d(e,t,n):void 0}})}return p.teamFoldersList().then(function(e){return e.team_folders=e.team_folders.sort(function(e,t){return c.compare(e.name.toUpperCase(),t.name.toUpperCase(),1)}),l({path:t,data:{file_info:Array.from(e.team_folders).map(function(e){return S(e)}),paginated:!1,inside_team_folder_root:!0,is_non_user_relative_context:!0}})}).catch(function(e){if(!e.headers)throw e;return"function"==typeof d?d(e.headers,e.raw.status,e.raw.responseBody):void 0})};t.loadPath=N;var P=function(t,r){var s=t.files,i=t.newPath,o=t.userId,a=t.onSuccess;void 0===r&&(r=!0);var l,c=e("modules/clean/react/content_manager/actions/browse_actions").browseActions,p=e("modules/clean/react/modal").Modal,h=k(),m=d.getBrowseStore().context(),g=m.rootNSID;return f.info(_._("Copying files...",180)),l=r?{".tag":"check"}:null,h.bulkFileCopy(g,s,i,l).then(function(e){return f.success(_._("Copy completed.")),c.setPath({path:d.getBrowseStore().path(),nsId:m.rootNSID}),j(1===s.length?"copy":"copyBatch")}).catch(function(e){if("cant_copy_shared_folder"===(null!=e.error?e.error[".tag"]:void 0))return f.error(_._("Copying a shared folder isn’t supported for beta."));if("to"===(null!=e.error?e.error[".tag"]:void 0)&&"file_system_warnings"===(null!=e.error?e.error.to[".tag"]:void 0)){f.clear();var t=null!=e.error?e.error.to.details[0]:void 0,r=_._;return t.blocking?f.error(r(t.text)):p.showInstance(n.createElement(p,{title:r(t.title),submitting:!1,acceptButtonText:_._("Copy"),dismissButtonText:_._("Cancel"),onAccept:function(){return P({files:s,newPath:i,userId:o,onSuccess:a},!1)},onDismiss:null},u.reactFormat(r(t.text+" <learnMoreLink>Learn more</learnMoreLink>"),{learnMoreLink:n.DOM.a({target:"_blank",href:t.learn_more})})))}return f.error(_._("There was a problem completing this request."))})};t.copyFiles=P;var L=function(t){var n=t.files,r=t.context,s=e("modules/clean/react/content_manager/actions/browse_actions").browseActions,i=k();return f.info(_._("Deleting files...",180)),i.bulkFileDelete(n).then(function(e){var t=_.ungettext("Deleted %d item.","Deleted %d items.",n.length).format(n.length);return f.success(t),s.setPath({path:d.getBrowseStore().path(),nsId:r.rootNSID}),j(1===n.length?n[0].is_dir?"deleteFolder":"deleteFile":"deleteBatch")}).catch(function(e){return f.error(_._("There was a problem completing this request."))})};t.deleteFiles=L;var R=function(t){var n,r=t.file,s=(t.userId,t.onSuccess,t.onError),i=t.newName,o=e("modules/clean/react/content_manager/actions/browse_actions").browseActions,a=d.getBrowseStore().context();return(n=r.is_dir?w(i):A(i))?(f.error(n),void s()):k().fileRename(r.ns_id,r.ns_path,i).then(function(e){return r.is_dir?f.success(_._("Folder renamed.")):f.success(_._("File renamed.")),o.setPath({path:d.getBrowseStore().path(),nsId:a.rootNSID}),o.setFileRenameComplete({file:r}),j("rename")}).catch(function(e){return f.error(_._("There was a problem completing this request."))})};t.renameFile=R;var O=function(t){var n=(t.path,t.files),r=t.newPath,s=(t.userId,t.onSuccess,e("modules/clean/react/content_manager/actions/browse_actions").browseActions),i=k(),o=d.getBrowseStore().context(),a=o.rootNSID;return f.info(_._("Moving files...",180)),i.bulkFileMove(a,n,r).then(function(e){return f.success(_._("Move completed.")),s.setPath({path:d.getBrowseStore().path(),nsId:o.rootNSID}),j(1===n.length?"move":"moveBatch")}).catch(function(e){return"cant_move_folder_into_itself"===(null!=e.error?e.error[".tag"]:void 0)?f.error(_._("Moving a folder into itself isn’t allowed.")):f.error(_._("There was a problem completing this request."))})};t.moveFiles=O;var F=function(e){var t=e.path,n=e.userId,s=e.namespaceToJournalIdMap,o=e.onSuccess,a=e.includeDeletedFiles,l="/"===t?"":t,c={fq_dir:l,ns_map:r.map(s,function(e,t){return t+"_"+e}).join(","),show_deleted:!!a,admin_console:!0};return i.WebRequest({url:"/update/list_dir",subject_user:n,data:c,dataType:"text",success:function(e){var t=y(e);t&&o(t)}})};t.getChangesForDirectory=F;var D=function(t){var n=t.pathName,r=t.folderName,s=t.nsId,i=(t.userId,t.onSuccess),o=t.onError,a=e("modules/clean/react/content_manager/actions/browse_actions").browseActions,l=w(r);return l?(f.error(l),void o()):k().folderCreate(s,n,r).then(function(e){return f.success(_._("Folder created.")),i({changesets:null,createdFolder:{fq_path:"/"+r}}),a.setPath({path:d.getBrowseStore().path(),nsId:s}),j("createFolder")}).catch(function(e){return o(),"path"===(null!=e.error?e.error[".tag"]:void 0)&&"disallowed_name"===(null!=e.error.path?e.error.path[".tag"]:void 0)?f.error(_._("The folder name is invalid.")):"path"===(null!=e.error?e.error[".tag"]:void 0)&&"conflict"===(null!=e.error.path?e.error.path[".tag"]:void 0)?f.error(_._("A folder with the same name exists.")):f.error(_._("Failed to create the folder."))})};t.createNewFolder=D;var x=function(e){var t=e.nsId,n=e.nsPath,r=e.policyUpdate,s=e.onSuccess;e.onError;return(new k).shareFolder(t,n,r).then(p.folderMetadataApiToRecord).then(s)};t.shareFolder=x;var U=function(e){var t=e.nsId,n=e.nsPath,r=e.actions,s=e.listMembersArg;return j("validateFolderPath"),k().validateFolderPath(t,n,r,s)};t.validateFolderPath=U;var B=function(e){var t=e.files,n=e.onSuccess,r=t[0];return r.is_dir||t.length>1?H(t,n):q(r.ns_id,r.ns_path,r.latest_rev,n)};t.restoreFiles=B;var q=function(e,t,n,r){return k().restoreFile(e,t,n).then(r)},H=function(e,t){return k().restorePaths(e).then(function(n){return 1===n.ignored_mounts.length&&0===n.count?f.error(_._("Can’t restore “%(folder_name)s” here because it was moved").format({folder_name:a.filename(e[0].fq_path)})):n.ignored_mounts.length>0?f.warning(_.ungettext("“%(folder_name)s” restored, but an item inside it was previously moved","“%(folder_name)s” restored, but %(num)s items inside were previously moved",n.ignored_mounts.length).format({num:e.length,folder_name:a.filename(e[0].fq_path)})):t()}).catch(function(e){return f.error(_._("There was a problem completing this request."))})},V=function(e,t,n){return k().permanentDeleteFile(e,t).then(n)};t.permanentDeleteFile=V;var j=function(e){return o.ContentManagerActionsLogger.log(d.getBrowseStore().context().rootNSID,e)},G={},K=function(e){return G=e};t.setIcons=K;var W=function(e){return"/"===e.path&&!h.GoldenGate.hasContentManagerCdm(e.user.id)};t.isInCMGoldenGateRoot=W}),define("modules/clean/react/home/resource_id_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HOME_RESOURCE_ID_TYPE={ENCODED_FILE_OBJ_ID:"ENCODED_FILE_OBJ_ID",FQ_PATH:"FQ_PATH",PAPER_DOCUMENT_ID_PATH:"PAPER_DOCUMENT_ID_PATH",PAPER_FOLDER_ID_PATH:"PAPER_FOLDER_ID_PATH",EXTERNAL_RESOURCE_ID:"EXTERNAL_RESOURCE_ID"}}),define("modules/clean/react/pass/action_timestamps",["require","exports","modules/clean/react/pass/constants","modules/core/exception"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=[n.LoggingActions.PRESENCE_RECEIVE,n.LoggingActions.TRANSMITTER_TOKEN_BEGIN,n.LoggingActions.TRANSMITTER_TOKEN_RECEIVE,n.LoggingActions.RECEIVER_TOKEN_BEGIN,n.LoggingActions.RECEIVER_TOKEN_RECEIVE,n.LoggingActions.SEEN_STATE_USERS_BEGIN,n.LoggingActions.SEEN_STATE_USERS_RECEIVE],i=(function(){function e(){this.allTimestamps={}}return e.prototype.record=function(e,t){if(t){var n=(new Date).getTime()/1e3;this.allTimestamps[t]=this.allTimestamps[t]||{};var r=this.allTimestamps[t];r.hasOwnProperty(e)?this.reportStackForRepeatedAction(r,e,t,n):r[e]=n}},e.prototype.get=function(e){return e?this.allTimestamps[e]||{}:{}},e.prototype.reportStackForRepeatedAction=function(e,t,n,i){if(!(s.indexOf(t)>=0)){var o=e[t];r.reportStack("Attempted to record action for which there existed a previous record",{severity:r.SEVERITY.NONCRITICAL,tags:["pass:actionTimestampsTracker"],exc_extra:{preview_session_id:n,action:t,oldTimestamp:o,newTimestamp:i}})}},e})();t.ActionTimestampsTracker=new i}),define("modules/clean/react/pass/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/pass/constants"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(){}return e.passPermissionRequest=function(e,t,s){n.Dispatcher.dispatch({type:r.ActionTypes.PASS_PERMISSION_REQUEST,data:{fileId:e,nsId:t,sjid:s}})},e.updatePermissions=function(e,t,s,i){n.Dispatcher.dispatch({type:r.ActionTypes.UPDATE_PERMISSIONS,data:{nsId:e,sjid:t,fileId:s,partialPermission:i}})},e.fetchPassError=function(e,t){n.Dispatcher.dispatch({type:r.ActionTypes.FETCH_PASS_ERROR,data:{nsId:e,sjid:t}})},e.fetchPassConcluded=function(e,t){n.Dispatcher.dispatch({type:r.ActionTypes.FETCH_PASS_CONCLUDED,data:{nsId:e,sjid:t}})},e.receivePresenceDelta=function(e,t,s,i,o){n.Dispatcher.dispatch({type:r.ActionTypes.RECEIVE_PRESENCE_DELTA,data:{userId:e,nsId:t,sjid:s,onlineUniqueUsers:i,offlineUniqueUsers:o}})},e.receivePresenceSnapshot=function(e,t,s,i){n.Dispatcher.dispatch({type:r.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT,data:{userId:e,nsId:t,sjid:s,onlineUniqueUsers:i}})},e.resetPassInfo=function(e,t,s){n.Dispatcher.dispatch({type:r.ActionTypes.RESET_PASS_INFO,data:{nsId:e,sjid:t,fileId:s}})},e.updateSeenStateInfo=function(e,t,s,i){n.Dispatcher.dispatch({type:r.ActionTypes.UPDATE_SEEN_STATE_INFO,data:{nsId:e,sjid:t,seenStateInfo:s,seenStateCursor:i}})},e.updateSeenStateInfoContinue=function(e,t,s,i){n.Dispatcher.dispatch({type:r.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE,data:{nsId:e,sjid:t,seenStateInfo:s,seenStateCursor:i}})},e.discontinueSeenStateInfo=function(e,t){n.Dispatcher.dispatch({type:r.ActionTypes.DISCONTINUE_SEEN_STATE_INFO,data:{nsId:e,sjid:t}})},e.updateSeenStateUnavailable=function(e,t,s){n.Dispatcher.dispatch({type:r.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE,data:{userId:e,nsId:t,sjid:s}})},e})();t.PassActions=s}),define("modules/clean/react/pass/constants",["require","exports"],function(e,t){"use strict";function n(e){return[o.SEEN_STATE_SUCCESS,o.SEEN_STATE_DISALLOWED,o.PASS_SUCCESS,o.PASS_MIXED_SUCCESS,o.CONCLUDED].indexOf(e)!==-1}function r(e){return[o.PASS_SUCCESS,o.PASS_MIXED_SUCCESS,o.CONCLUDED].indexOf(e)!==-1}function s(e){return[o.PASS_SUCCESS,o.PASS_MIXED_SUCCESS,o.ERROR,o.CONCLUDED].indexOf(e)!==-1}function i(e){return e===o.ERROR}Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTypes={PASS_PERMISSION_REQUEST:"PASS_PERMISSION_REQUEST",UPDATE_PERMISSIONS:"UPDATE_PERMISSIONS",FETCH_PASS_CONCLUDED:"FETCH_PASS_CONCLUDED",FETCH_PASS_ERROR:"FETCH_PASS_ERROR",RECEIVE_PRESENCE_DELTA:"RECEIVE_PRESENCE_DELTA",RECEIVE_PRESENCE_SNAPSHOT:"RECEIVE_PRESENCE_SNAPSHOT",RESET_PASS_INFO:"RESET_PASS_INFO",UPDATE_SEEN_STATE_INFO:"UPDATE_SEEN_STATE_INFO",UPDATE_SEEN_STATE_INFO_CONTINUE:"UPDATE_SEEN_STATE_INFO_CONTINUE",DISCONTINUE_SEEN_STATE_INFO:"DISCONTINUE_SEEN_STATE_INFO",UPDATE_SEEN_STATE_UNAVAILABLE:"FETCH_SEEN_STATE_UNAVAILABLE"},t.EventTypes={PASS_CLICK:"PASS_CLICK",PASS_SHOWN:"PASS_SHOWN",PASS_HOVER:"PASS_HOVER"},t.LoggingActions={STATUS_BEGIN:"status_begin",STATUS_RECEIVE:"status_receive",SEEN_STATE_BEGIN:"seen_state_begin",SEEN_STATE_RECEIVE:"seen_state_receive",SEEN_STATE_USERS_BEGIN:"seen_state_users_begin",SEEN_STATE_USERS_RECEIVE:"seen_state_users_receive",TRANSMITTER_TOKEN_BEGIN:"transmitter_token_begin",TRANSMITTER_TOKEN_RECEIVE:"transmitter_token_receive",RECEIVER_TOKEN_BEGIN:"receiver_token_begin",RECEIVER_TOKEN_RECEIVE:"receiver_token_receive",PRESENCE_RECEIVE:"presence_receive",MEMBER_COUNTS_BEGIN:"member_counts_begin",MEMBER_COUNTS_RECEIVE:"member_counts_receive",LIST_MEMBERS_BEGIN:"list_members_begin",LIST_MEMBERS_RECEIVE:"list_members_receive",LIST_MEMBERS_NO_SEEN_STATE:"list_members_no_seen_state"};var o;(function(e){e[e.NOT_YET_KNOWN=0]="NOT_YET_KNOWN",e[e.FETCHING=1]="FETCHING",e[e.ERROR=2]="ERROR",e[e.SEEN_STATE_SUCCESS=3]="SEEN_STATE_SUCCESS",e[e.SEEN_STATE_DISALLOWED=4]="SEEN_STATE_DISALLOWED",e[e.PRESENCE_SUCCESS=5]="PRESENCE_SUCCESS",e[e.PASS_SUCCESS=6]="PASS_SUCCESS",e[e.PASS_MIXED_SUCCESS=7]="PASS_MIXED_SUCCESS",e[e.CONCLUDED=8]="CONCLUDED"})(o=t.PASS_FETCHING_STATUS||(t.PASS_FETCHING_STATUS={})),t.fetchingStatusSeenStateIsComplete=n,t.fetchingStatusIsSuccessful=r,t.fetchingStatusIsComplete=s,t.fetchingStatusIsError=i,t.MAX_FACES_NORMAL=5,t.MAX_FACES_COMPACT=3,t.MAX_OVERFLOW_BUTTON_INDICATOR=99,t.FACEPILE_CLASSNAME="react-pass__facepile",t.FACEPILE_DELAYED_CLASSNAME="react-pass__facepile--delayed",t.PRESENCE_RECEIVED_CLASSNAME="facepile-presence-received"}),define("modules/clean/react/pass/data_helpers",["require","exports","jquery","external/lodash","modules/clean/ajax","modules/clean/api_v2/client","modules/clean/api_v2/root_aware_client","modules/clean/api_v2/error","modules/clean/api_v2/types","modules/clean/beacon","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/store","modules/clean/react/pass/action_timestamps","modules/clean/react/pass/actions","modules/clean/react/pass/constants","modules/clean/previews/util","modules/clean/sharing/actions/sharing_actions","modules/clean/uuid","modules/clean/viewer","modules/constants/file_viewer","modules/constants/python"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y,v,S,E,b){"use strict";function I(e,t,n){_.PassActions.resetPassInfo(e,t,n),_.PassActions.fetchPassError(e,t)}function T(e,t,n){_.PassActions.resetPassInfo(e,t,n),_.PassActions.fetchPassConcluded(e,t)}function C(e,t,n,r,s,a){return e?new o.ApiV2RootAwareClient(s,a).rpc(e.id,t,r):new i.ApiV2Client(s,a).rpc(null,n,r)}function w(e){return"sjid:"+e.toString()}function A(e,t,n){return{ns_id:e,file_identifier:w(t),url:n}}Object.defineProperty(t,"__esModule",{value:!0});var M=f.MAX_FACES_NORMAL+f.MAX_OVERFLOW_BUTTON_INDICATOR+1,k=(function(){function e(){}return e.setup=function(t){var n=t.user,r=t.fileData,s=t.prevFileData,i=t.shouldWritePresence,o=void 0===i||i,a=t.skipSharingEndpoints,l=void 0!==a&&a,c=t.limit,d=void 0===c?150:c;this.shouldInitializePass(n,o)&&setTimeout(function(){var t=r.file,i=t.file_id,a=t.ns_id,c=t.sjid;_.PassActions.passPermissionRequest(i,a,c),g.isPassPerfExperiment()?e.makeAllRequests({user:n,fileData:r,prevFileData:s,shouldWritePresence:o,skipSharingEndpoints:l,limit:d}):e.fetchPassStatus({user:n,fileData:r,prevFileData:s,shouldWritePresence:o,skipSharingEndpoints:l,limit:d})},0)},e.teardown=function(e){var t=e.user,r=e.fileData,s=e.async,i=e.shouldWritePresence,o=void 0===i||i,a=r.file,l=r.url;if(this.shouldInitializePass(t,o)){n(window).off("beforeunload.passpresence");var c=new N(a,l);P.shutdown({beaconFileData:c,user:t,async:s,shouldWritePresence:o})}},e.shouldInitializePass=function(e,t){return d.determinePathContext()!==u.PathContext.SharedLinkCollection&&(null!==e||t)},e.fetchPassStatus=function(e){var t=this,n=e.user,r=e.fileData,s=e.prevFileData,i=e.shouldWritePresence,o=void 0===i||i,l=e.skipSharingEndpoints,c=void 0!==l&&l,d=e.limit,u=void 0===d?150:d,h=r.file.ns_id,_=r.file.sjid,g=r.file.file_id,y=r.url,v=p.FilePreviewSession.currentSession&&p.FilePreviewSession.currentSession.id;return m.ActionTimestampsTracker.record(f.LoggingActions.STATUS_BEGIN,v),C(n,"seen_state/get_pass_status","seen_state/logged_out/get_pass_status",{file_infos:[{ns_id:h,file_identifier:w(_),url:y}]}).then(function(e){m.ActionTimestampsTracker.record(f.LoggingActions.STATUS_RECEIVE,v);var i=e[0],a={
canReadPresence:i.can_read_presence,canReadSeenState:i.can_read_seen_state,canWritePresence:i.can_write_presence||i.can_write_anonymous_presence};t.kickoffPassRequests({user:n,fileData:r,prevFileData:s,passPermissionObject:a,limit:u,previewSessionId:v,shouldWritePresence:o,skipSharingEndpoints:c})}).catch(a.catchApiError(function(){I(h,_,g)}))},e.kickoffPassRequests=function(e){var t=this,r=e.user,s=e.fileData,i=e.prevFileData,o=e.passPermissionObject,a=e.limit,l=e.previewSessionId,c=e.shouldWritePresence,d=void 0===c||c,u=e.skipSharingEndpoints,p=void 0!==u&&u,h=s.file,m=s.url;_.PassActions.updatePermissions(h.ns_id,h.sjid,h.file_id,o);var f=h.file_id||h.fq_path,g=r&&r.account_id,v=new N(h,m);if(r&&(f&&o.canReadPresence&&!p&&(y.SharingActions.fetchFileMemberCount({user:r,contentId:f,limit:M,countGroupsAsMembers:!1,url:m,previewSessionId:l,runViewerInfoChecks:!0}),y.SharingActions.listMembers({user:r,contentId:f,isFolder:!1,limit:6,url:m,previewSessionId:l,includeSeenState:!1})),o.canReadSeenState?L.fetchSeenStateInfo(r,h.ns_id,h.sjid,h.file_id,a,m,l):_.PassActions.updateSeenStateUnavailable(r.id,h.ns_id,h.sjid),o.canReadPresence&&P.receiveBeaconData({beaconFileData:v,fileId:h.file_id,user:r,previewSessionId:l})),d&&o.canWritePresence){var S=i&&new N(i.file,i.url);P.transmitBeaconData({beaconFileData:v,prevBeaconFileData:S,fileId:h.file_id,accountId:g,previewSessionId:l}),n(window).off("beforeunload.passpresence"),n(window).on("beforeunload.passpresence",function(e){t.teardown({user:r,fileData:s,async:!1,shouldWritePresence:!0}),e.returnValue=void 0})}o.canReadPresence||o.canReadSeenState||T(h.ns_id,h.sjid,h.file_id)},e.makeAllRequests=function(e){var t=this,r=e.user,s=e.fileData,i=e.prevFileData,o=e.limit,a=void 0===o?150:o,l=e.shouldWritePresence,c=void 0===l||l,d=e.skipSharingEndpoints,u=void 0!==d&&d,h=p.FilePreviewSession.currentSession&&p.FilePreviewSession.currentSession.id,m=s.file,f=s.url,g=m.file_id||m.fq_path,v=r&&r.account_id,E=new N(m,f);r?(g&&!u&&(y.SharingActions.fetchFileMemberCount({user:r,contentId:g,limit:M,countGroupsAsMembers:!1,url:f,previewSessionId:h,runViewerInfoChecks:!0}),y.SharingActions.listMembers({user:r,contentId:g,isFolder:!1,limit:6,url:f,previewSessionId:h,includeSeenState:!1})),L.fetchSeenStateInfo(r,m.ns_id,m.sjid,m.file_id,a,f,h),P.receiveBeaconData({beaconFileData:E,fileId:m.file_id,user:r,previewSessionId:h})):_.PassActions.updatePermissions(m.ns_id,m.sjid,m.file_id,{canReadPresence:!1,canReadSeenState:!1});var b=S.Viewer.get_viewer().is_assume_user_session;if(!c||b)_.PassActions.updatePermissions(m.ns_id,m.sjid,m.file_id,{canWritePresence:!1});else{var I=i&&new N(i.file,i.url);P.transmitBeaconData({beaconFileData:E,prevBeaconFileData:I,fileId:m.file_id,accountId:v,previewSessionId:h}),n(window).off("beforeunload.passpresence"),n(window).on("beforeunload.passpresence",function(e){t.teardown({user:r,fileData:s,async:!1,shouldWritePresence:!0}),e.returnValue=void 0})}},e})();t.PassHelpers=k;var N=(function(){function e(e,t){this.nsId=e.ns_id,this.sjid=e.sjid,this.context=e.beacon_context,this.url=t}return e})();t.BeaconFileData=N;var P=(function(){function e(){}return e.shutdown=function(e){var t=e.beaconFileData,n=e.user,r=e.async,s=e.shouldWritePresence,i=void 0===s||s,o=[];this.transmitterData&&(o.push([this.transmitterData.beaconUserId,this.transmitterData.identifier]),this.transmitterData.transmitter.stop()),delete this.transmitterData,o.length>0&&!S.Viewer.get_viewer().is_assume_user_session&&i&&L.updateSeenStateOnResign(n,t,r,o),this.receiverData&&this.receiverData.receiver&&(this.receiverData.receiver.stop(),delete this.receiverData)},e.receiveBeaconData=function(e){var t=this,n=e.beaconFileData,r=e.fileId,i=e.user,o=e.previewSessionId;if(!n.context||0===n.context.length)return void _.PassActions.updatePermissions(n.nsId,n.sjid,r,{canReadPresence:!1});m.ActionTimestampsTracker.record(f.LoggingActions.RECEIVER_TOKEN_BEGIN,o),s.SilentBackgroundRequest({url:"/get_pass_receiver_token",type:"GET",dataType:"json",data:{account_id:i.account_id,context:n.context,shared_link_url:n.url},success:function(e){var s=!0;if(g.isPassPerfExperiment()&&(s=!(!e.auth_key||!e.token||e.error),_.PassActions.updatePermissions(n.nsId,n.sjid,r,{canReadPresence:s})),e.error){if(g.isPassPerfExperiment()&&"no_permission"===e.error)return;I(n.nsId,n.sjid,r)}else{m.ActionTimestampsTracker.record(f.LoggingActions.RECEIVER_TOKEN_RECEIVE,o);var a=e.token,l=[new c.PresenceParams(c.PresenceType.Context,i.account_id,t.APP,n.context,a)];t.receiverData&&t.receiverData.receiver&&t.receiverData.receiver.stop(),t.receiverData={authKey:e.auth_key,receiver:new c.Receiver(l,function(e){m.ActionTimestampsTracker.record(f.LoggingActions.PRESENCE_RECEIVE,o),t.onUpdate(e,i.id,n)},function(){return t.receiveBeaconData({beaconFileData:n,fileId:r,user:i,previewSessionId:o})})},t.receiverData.receiver.start()}}})},e.onUpdate=function(e,t,n){var r=e[0];if(r.delta){var s=this.parseBeaconUpdates(r.delta);_.PassActions.receivePresenceDelta(t,n.nsId,n.sjid,s.onlineUniqueUsers,s.offlineUniqueUsers)}else if(r.snapshot){var s=this.parseBeaconUpdates(r.snapshot);_.PassActions.receivePresenceSnapshot(t,n.nsId,n.sjid,s.onlineUniqueUsers)}},e.parseBeaconUpdates=function(e){for(var t={},n={},r=0,s=e;r<s.length;r++){var i=s[r],o=i.agent,a=o.user_id,l=o.source.identifier;i.status===b.BEACON_ONLINE_STATUS?(a in t||(t[a]={}),t[a][l]=!0):i.status===b.BEACON_OFFLINE_STATUS&&(a in n||(n[a]={}),n[a][l]=!0)}return{onlineUniqueUsers:t,offlineUniqueUsers:n}},e.transmitBeaconData=function(e){var t=this,n=e.beaconFileData,r=e.prevBeaconFileData,s=e.fileId,i=e.accountId,o=e.previewSessionId;this.transmitterData&&r&&(this.transmitterData.transmitter.add_or_update_agents([this.getAgentStatusForFile(this.transmitterData.beaconUserId,this.transmitterData.identifier,this.transmitterData.authKey,r,b.BEACON_OFFLINE_STATUS)]),setTimeout(function(){t.transmitterData.transmitter.stop()},1)),this.fetchTransmitterToken(i,n,r,s,o)},e.getAgentStatusForFile=function(e,t,n,r,s){var i=new c.Source(this.PLATFORM,this.SURFACE,t),o=new c.Agent(e,this.APP,r.context,i);return new c.AgentStatus(o,s,n)},e.fetchTransmitterToken=function(e,t,n,i,o){var a=this;if(!t.context||0===t.context.length)return void _.PassActions.updatePermissions(t.nsId,t.sjid,i,{canWritePresence:!1});m.ActionTimestampsTracker.record(f.LoggingActions.TRANSMITTER_TOKEN_BEGIN,o),s.SilentBackgroundRequest({url:"/get_pass_transmitter_token",type:"GET",dataType:"json",data:{account_id:e,context:t.context,shared_link_url:t.url},success:function(n){var s=!0;if(g.isPassPerfExperiment()&&(s=!(n.error||!n.beacon_user_id||!n.auth_key||!n.token),_.PassActions.updatePermissions(t.nsId,t.sjid,i,{canWritePresence:s})),s&&m.ActionTimestampsTracker.record(f.LoggingActions.TRANSMITTER_TOKEN_RECEIVE,o),n.error){if(g.isPassPerfExperiment()&&"no_permission"===n.error)return;I(t.nsId,t.sjid,i)}else{var l=n.token;a.transmitterData={identifier:v.v4({allowInsecure:!0}),beaconUserId:n.beacon_user_id,authKey:n.auth_key,transmitter:new c.Transmitter(l,function(){return a.fetchTransmitterToken(e,t,null,i,o)},r.noop)},t&&a.transmitterData.transmitter.add_or_update_agents([a.getAgentStatusForFile(a.transmitterData.beaconUserId,a.transmitterData.identifier,a.transmitterData.authKey,t,b.BEACON_ONLINE_STATUS)]),a.transmitterData.transmitter.start()}}})},e.APP="harmony",e.PLATFORM=c.Platforms.WEB,e.SURFACE="file_viewer",e.receiverData=null,e.transmitterData=null,e})();t.BeaconPresenceHelpers=P,t.DEFAULT_SYNCHRONOUS_MODE_TIMEOUT=9e3;var L=(function(){function e(){}return e.constructFakeSeenStateInfo=function(e,t,n){for(var r=n.seen_states,s=[],i=0,o=r;i<o.length;i++){var a=o[i];s.push(a.seen_state_user.user_id)}for(var l=0,c=e;l<c.length;l++){var d=c[l];if(!s.includes(d.user_id)){d.sharing_access_type&&(d.sharing_access_type=this.convertToUnion(d.sharing_access_type));var u=[],p={seen_state_user:d,when_last_seen:t,seen_events:u};r.unshift(p)}}return n.seen_states=r,n},e.convertToUnion=function(e){return e?l.Union.parse(e):null},e.fetchSeenStateUsers=function(e,t,n,r,s,i){var l=this,c=Date.now()/1e3,d=void 0;h.FileViewerStore.instance.getCurrentFile()&&h.FileViewerStore.instance.getSharedLinkInfo()&&(d=h.FileViewerStore.instance.getSharedLinkInfo().url);var u=p.FilePreviewSession.currentSession&&p.FilePreviewSession.currentSession.id;return m.ActionTimestampsTracker.record(f.LoggingActions.SEEN_STATE_USERS_BEGIN,u),(new o.ApiV2RootAwareClient).rpc(e,"seen_state/get_seen_state_users",{user_ids:n,file_info:A(r,s,d)}).catch(a.catchApiError(function(){return I(r,s,i),Promise.reject(void 0)})).then(function(e){m.ActionTimestampsTracker.record(f.LoggingActions.SEEN_STATE_USERS_RECEIVE,u);var n=l.constructFakeSeenStateInfo(e,c,t);_.PassActions.updateSeenStateInfo(r,s,n)})},e.processAndUpdateSeenStateInfo=function(e,t,n,r,s,i){var o=s[0],a=o.seen_state_info,c=o.seen_state_error,d=o.seen_state_cursor;if(c)if(i)_.PassActions.discontinueSeenStateInfo(t,n);else{if(g.isPassPerfExperiment()&&"no_permission"===l.Union.parse(c).type)return;I(t,n,r)}else{for(var u=0,p=a.seen_states;u<p.length;u++){var h=p[u];h.seen_state_user.sharing_access_type=this.convertToUnion(h.seen_state_user.sharing_access_type)}i?_.PassActions.updateSeenStateInfoContinue(t,n,a,d):_.PassActions.updateSeenStateInfo(t,n,a,d)}},e.fetchSeenStateInfo=function(e,t,n,r,s,i,l){var c=this;return m.ActionTimestampsTracker.record(f.LoggingActions.SEEN_STATE_BEGIN,l),(new o.ApiV2RootAwareClient).rpc(e.id,"seen_state/get_seen_state_info",{file_infos:[A(t,n,i)],limit:s}).catch(a.catchApiError(function(){return I(t,n,r),Promise.reject(void 0)})).then(function(s){var o=!0;if(g.isPassPerfExperiment()){var a=s[0],d=a.seen_state_info,u=a.seen_state_error;o=!(!d||u),_.PassActions.updatePermissions(t,n,r,{canReadSeenState:o}),o||_.PassActions.updateSeenStateUnavailable(e.id,t,n)}o&&m.ActionTimestampsTracker.record(f.LoggingActions.SEEN_STATE_RECEIVE,l),c.processAndUpdateSeenStateInfo(e,t,n,r,s,!1),o&&c.fetchRemainingSeenStateInfo(e,t,n,r,s,i)})},e.fetchRemainingSeenStateInfo=function(e,t,n,r,s,i){var o=s[0],a=o.seen_state_cursor;if(a&&a.has_next){var l=a.cursor_state;l&&this.fetchSeenStateInfoContinue(e,t,n,r,l,1e5,i)}},e.fetchSeenStateInfoContinue=function(e,t,n,r,s,i,l){var c=this;return(new o.ApiV2RootAwareClient).rpc(e.id,"seen_state/get_seen_state_info/continue",{file_infos:[A(t,n,l)],cursor:s,limit:i}).catch(a.catchApiError(function(){return _.PassActions.discontinueSeenStateInfo(t,n),Promise.reject(void 0)})).then(function(s){c.processAndUpdateSeenStateInfo(e,t,n,r,s,!0)})},e.getCoachmark=function(e,t,n,r,s){return(new o.ApiV2RootAwareClient).rpc(e,"seen_state/get_coachmark_info",{file_info:A(t,n,r)}).catch(a.catchApiError(function(){return Promise.reject(void 0)})).then(function(e){s(e.type_with_data[".tag"])})},e.logCoachmarkInteraction=function(e,t,n,r,s,i){return(new o.ApiV2RootAwareClient).rpc(e,"seen_state/log_coachmark_interaction",{type:s,interaction:i,file_info:A(t,n,r)}).catch(a.catchApiError(function(){return Promise.reject(void 0)}))},e.updateSeenStateOnResign=function(e,n,r,s){var i=r?"async":"sync",o=void 0;r||(o=E.PASS_RESIGN_ONBEFOREUNLOAD_TIMEOUT||t.DEFAULT_SYNCHRONOUS_MODE_TIMEOUT);for(var a=[],l=0,c=s;l<c.length;l++){var d=c[l],u=d[0],p=d[1];a.push({beacon_user_id:u,context:n.context,shared_link_url:n.url,identifier:p})}return C(e,"seen_state/update_timestamps_and_mark_offline","seen_state/logged_out/mark_offline",{beacon_infos:a},i,o)},e})();t.SeenStateHelpers=L}),define("modules/clean/react/pass/store",["require","exports","tslib","external/lodash","modules/clean/flux/base_store","modules/clean/previews/util","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/core/exception"],function(e,t,n,r,s,i,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(){this.userIdToUniqueIds={}}return e.prototype.addUniqueUser=function(e,t){e in this.userIdToUniqueIds||(this.userIdToUniqueIds[e]={}),this.userIdToUniqueIds[e][t]=!0},e.prototype.removeUniqueUser=function(e,t){e in this.userIdToUniqueIds&&t in this.userIdToUniqueIds[e]&&(delete this.userIdToUniqueIds[e][t],Object.keys(this.userIdToUniqueIds[e]).length||delete this.userIdToUniqueIds[e])},e.prototype.getOnlineUserIds=function(){return Object.keys(this.userIdToUniqueIds)},e})(),d=(function(e){function t(t){var n=e.call(this,t)||this;return n.seenStateInfos={},n.seenStateCursors={},n.presenceInfos={},n.passFetchingStatusMap={},n.userIdsWithoutSeenStateInfoMap={},n.passPermissions={},n}return n.__extends(t,e),t.prototype.presence=function(e,t){var n=this.fileKey(e,t);return n in this.presenceInfos?this.presenceInfos[n].getOnlineUserIds():null},t.prototype.seenStateInfo=function(e,t){var n=this.fileKey(e,t);return this.seenStateInfos[n]||null},t.prototype.identifiedSeenStateInfo=function(e,t){var n=this.fileKey(e,t);if(n in this.seenStateInfos){return{seen_states:r.reject(this.seenStateInfos[n].seen_states,a.AnonymousViewerUtils.isAnonymousSeenState)}}return null},t.prototype.seenStateCursorHasNext=function(e,t){var n=this.fileKey(e,t);return n in this.seenStateCursors?this.seenStateCursors[n].has_next:null},t.prototype.seenStateCursorState=function(e,t){var n=this.fileKey(e,t);return n in this.seenStateCursors?this.seenStateCursors[n].cursor_state:null},t.prototype.passFetchingStatus=function(e,t){var n=this.fileKey(e,t);return this.passFetchingStatusMap[n]||o.PASS_FETCHING_STATUS.NOT_YET_KNOWN},t.prototype.getLinkAndGroupSeenStateInfo=function(e,t){var n=null,r=null,s=this.fileKey(e,t);if(!this.seenStateInfos[s])return{linkSeenStateInfo:n,groupSeenStateInfo:r};n=[],r={};for(var i=0,o=this.seenStateInfos[s].seen_states;i<o.length;i++){var l=o[i];if(!a.AnonymousViewerUtils.isAnonymousSeenState(l)){var c=l.seen_state_user.sharing_access_type;if(c)switch(c.type){case"link_only":n.push(l);break;case"view_member_access":case"edit_member_access":for(var d=c.value.group_ids,u=0,p=d;u<p.length;u++){var h=p[u];h in r||(r[h]=[]),r[h].push(l)}}}}return{linkSeenStateInfo:n,groupSeenStateInfo:r}},t.prototype.anonymousPresence=function(e,t){var n=this.fileKey(e,t);return n in this.presenceInfos?a.AnonymousViewerUtils.getAnonymousUserIds(this.presenceInfos[n].getOnlineUserIds()):null},t.prototype.userIdsWithoutSeenStateInfo=function(e,t){return this.userIdsWithoutSeenStateInfoMap[this.fileKey(e,t)]||[]},t.prototype.isPassPermissionsPending=function(e){var t=this.passPermissions[e];return null!=t&&!(t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState")&&t.hasOwnProperty("canWritePresence"))},t.prototype.getPassPermissions=function(e){var t=this.passPermissions[e];return null==t||this.isPassPermissionsPending(e)?null:t},t.prototype.resetPassInfo=function(e,t,n){var r=this.fileKey(e,t);delete this.seenStateInfos[r],delete this.seenStateCursors[r],delete this.presenceInfos[r],delete this.passFetchingStatusMap[r],delete this.passPermissions[n],delete this.userIdsWithoutSeenStateInfoMap[r],this.emit_change()},t.prototype.fileKey=function(e,t){return e+":"+t},t.prototype.setPassPermissionRequest=function(e,t,n){this.passPermissions[e]={},this.setPassFetchingStatus(t,n,o.PASS_FETCHING_STATUS.FETCHING)},t.prototype.updatePermissions=function(e,t){this.passPermissions.hasOwnProperty(e)&&(this.passPermissions[e]=n.__assign({},this.passPermissions[e],t),this.emit_change())},t.prototype.markPassConcludedIfNecessary=function(e,t,n){var r=this.passPermissions[n];!(r&&r.hasOwnProperty("canReadPresence")&&r.hasOwnProperty("canReadSeenState"))||r.canReadPresence||r.canReadSeenState||(this.resetPassInfo(e,t,n),this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.CONCLUDED),this.updateSeenStateInfoWithEmptyData(e,t))},t.prototype.receivePresenceDelta=function(e,t,n,r,s){l.assert([o.PASS_FETCHING_STATUS.FETCHING,o.PASS_FETCHING_STATUS.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t,n))===-1,"Before handling a presence delta, you must call assurePresenceSuccessRegistered");var i=this.fileKey(t,n),a=this.getOnlineUsersForFileKey(i);this.updatePresenceInfos(i,r,s),this.updateUserIdsWithoutSeenStateInfo(e,t,n,a),this.emit_change()},t.prototype.receivePresenceSnapshot=function(e,t,n,r){l.assert([o.PASS_FETCHING_STATUS.FETCHING,o.PASS_FETCHING_STATUS.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t,n))===-1,"Before handling a presence delta, you must call assurePresenceSuccessRegistered");var s=this.fileKey(t,n),i=this.getOnlineUsersForFileKey(s);this.presenceInfos[s]=new c,this.updatePresenceInfos(s,r,{}),this.updateUserIdsWithoutSeenStateInfo(e,t,n,i),this.emit_change()},t.prototype.getOnlineUsersForFileKey=function(e){return e in this.presenceInfos||(this.presenceInfos[e]=new c),this.presenceInfos[e].getOnlineUserIds()},t.prototype.updatePresenceInfos=function(e,t,n){for(var r=0,s=Object.keys(n);r<s.length;r++)for(var i=s[r],o=0,a=Object.keys(n[i]);o<a.length;o++){var l=a[o];this.presenceInfos[e].removeUniqueUser(i,l)}for(var c=0,d=Object.keys(t);c<d.length;c++)for(var u=d[c],p=0,h=Object.keys(t[u]);p<h.length;p++){var l=h[p];this.presenceInfos[e].addUniqueUser(u,l)}},t.prototype.updateUserIdsWithoutSeenStateInfo=function(e,t,n,s){var i,l=this.fileKey(t,n),c=a.AnonymousViewerUtils.filterAnonymousUserIds(this.getOnlineUsersForFileKey(l)),d=a.AnonymousViewerUtils.filterAnonymousUserIds(s),u=r.difference(d,c),p=r.difference(c,d);if(l in this.seenStateInfos){var h=void 0,m=this.passFetchingStatus(t,n);[o.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED,o.PASS_FETCHING_STATUS.PASS_MIXED_SUCCESS].indexOf(m)!==-1?(_=this.createMinimalBaseSeenStateInfo(l,c),i=_.userIdsWithoutSeenStateInfo,h=_.baseSeenStateInfo,this.updateSeenStateInfo(t,n,h)):(f=this.makeSeenStateAgreeWithUpdatedPresence(l,c,u,p),i=f.userIdsWithoutSeenStateInfo,h=f.baseSeenStateInfo)}else i=[];this.userIdsWithoutSeenStateInfoMap[l]=i;var _,f},t.prototype.makeSeenStateAgreeWithUpdatedPresence=function(e,t,n,r){for(var s=[],i=this.seenStateInfos[e],o=i.seen_states,a=[],l=[],c=[],d=Date.now()/1e3,u=0,p=o;u<p.length;u++){var h=p[u],m=h.seen_state_user.user_id;m&&(s.push(m),r.includes(m)?(h.when_last_seen=d,h.seen_events=h.seen_events||[],l.push(h)):n.includes(m)?(h.when_last_seen=d,h.seen_events=h.seen_events||[],h.seen_events.push({ts:d}),c.push(h)):a.push(h))}return i.seen_states=l.concat(c,a),{userIdsWithoutSeenStateInfo:t.filter(function(e){return!s.includes(e)}),baseSeenStateInfo:i}},t.prototype.createMinimalBaseSeenStateInfo=function(e,t){for(var n=[],s=[],i=0,o=this.seenStateInfos[e].seen_states;i<o.length;i++){var a=o[i],l=a.seen_state_user.user_id;l&&t.includes(l)&&(n.push(a),s.push(l))}return{userIdsWithoutSeenStateInfo:r.difference(t,s),baseSeenStateInfo:{seen_states:n}}},t.prototype.updateSeenStateInfo=function(e,t,n,r){void 0===r&&(r=!1),l.assert([null,o.PASS_FETCHING_STATUS.FETCHING].indexOf(this.passFetchingStatus(e,t))===-1,"Before updating seen state info, you must call assureSeenStateSuccessRegistered or onFetchSeenStateDisabled");var s=this.fileKey(e,t);r&&s in this.seenStateInfos?this.seenStateInfos[s].seen_states=this.seenStateInfos[s].seen_states.concat(n.seen_states):this.seenStateInfos[s]=n,this.userIdsWithoutSeenStateInfoMap[s]=[],this.emit_change()},t.prototype.updateSeenStateInfoWithEmptyData=function(e,t){var n={seen_states:[]};this.updateSeenStateInfo(e,t,n)},t.prototype.setPassFetchingStatus=function(e,t,n){var r=this.fileKey(e,t);this.passFetchingStatusMap[r]=n,this.emit_change()},t.prototype.updateSeenStateCursor=function(e,t,n){var r=this.fileKey(e,t);n&&(this.seenStateCursors[r]=n,this.emit_change())},t.prototype.assureSeenStateSuccessRegistered=function(e,t){switch(this.passFetchingStatus(e,t)){case o.PASS_FETCHING_STATUS.FETCHING:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.SEEN_STATE_SUCCESS);break;case o.PASS_FETCHING_STATUS.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.PASS_SUCCESS);break;case o.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED:var n=this.fileKey(e,t);l.reportStack("Debugging FETCHING_STATUS: pass fetching status is seen state disallowed",{severity:l.SEVERITY.NONCRITICAL,tags:["pass:fetch_seen_state_disallowed"],exc_extra:{storeHasPresence:n in this.presenceInfos,storeHasSeenState:n in this.seenStateInfos,passPermissions:JSON.stringify(this.passPermissions[this.fileKey(e,t)]),fetchingStatus:this.passFetchingStatusMap[this.fileKey(e,t)]}});break;case o.PASS_FETCHING_STATUS.NOT_YET_KNOWN:l.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[this.fileKey(e,t)]}})}},t.prototype.onFetchSeenStateDisabled=function(e,t){switch(this.passFetchingStatus(e,t)){case o.PASS_FETCHING_STATUS.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.PASS_MIXED_SUCCESS);break;case o.PASS_FETCHING_STATUS.FETCHING:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED);break;case o.PASS_FETCHING_STATUS.NOT_YET_KNOWN:l.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[this.fileKey(e,t)]}})}},t.prototype.assurePresenceSuccessRegistered=function(e,t){switch(this.passFetchingStatus(e,t)){case o.PASS_FETCHING_STATUS.SEEN_STATE_SUCCESS:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.PASS_SUCCESS);break;case o.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.PASS_MIXED_SUCCESS);break;case o.PASS_FETCHING_STATUS.FETCHING:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.PRESENCE_SUCCESS);break;case o.PASS_FETCHING_STATUS.NOT_YET_KNOWN:l.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_presence_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[this.fileKey(e,t)]}})}},t.prototype._new_payload=function(e){var t,n,r,s=e.action,a=s.type,l=s.data;switch(a){case o.ActionTypes.FETCH_PASS_ERROR:this.setPassFetchingStatus(l.nsId,l.sjid,o.PASS_FETCHING_STATUS.ERROR);break;case o.ActionTypes.FETCH_PASS_CONCLUDED:n=l.nsId,r=l.sjid,this.setPassFetchingStatus(n,r,o.PASS_FETCHING_STATUS.CONCLUDED),this.updateSeenStateInfoWithEmptyData(n,r);break;case o.ActionTypes.PASS_PERMISSION_REQUEST:this.setPassPermissionRequest(l.fileId,l.nsId,l.sjid);break;case o.ActionTypes.RECEIVE_PRESENCE_DELTA:this.assurePresenceSuccessRegistered(l.nsId,l.sjid),this.receivePresenceDelta(l.userId,l.nsId,l.sjid,l.onlineUniqueUsers,l.offlineUniqueUsers);break;case o.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT:this.assurePresenceSuccessRegistered(l.nsId,l.sjid),this.receivePresenceSnapshot(l.userId,l.nsId,l.sjid,l.onlineUniqueUsers);break;case o.ActionTypes.RESET_PASS_INFO:this.resetPassInfo(l.nsId,l.sjid,l.fileId);break;case o.ActionTypes.UPDATE_PERMISSIONS:this.updatePermissions(l.fileId,l.partialPermission),i.isPassPerfExperiment()&&this.markPassConcludedIfNecessary(l.nsId,l.sjid,l.fileId);break;case o.ActionTypes.DISCONTINUE_SEEN_STATE_INFO:var c={cursor_state:"",has_next:!1};this.updateSeenStateCursor(l.nsId,l.sjid,c);break;case o.ActionTypes.UPDATE_SEEN_STATE_INFO:this.assureSeenStateSuccessRegistered(l.nsId,l.sjid),this.updateSeenStateInfo(l.nsId,l.sjid,l.seenStateInfo),this.updateSeenStateCursor(l.nsId,l.sjid,l.seenStateCursor);break;case o.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE:this.assureSeenStateSuccessRegistered(l.nsId,l.sjid),this.updateSeenStateInfo(l.nsId,l.sjid,l.seenStateInfo,!0),this.updateSeenStateCursor(l.nsId,l.sjid,l.seenStateCursor);break;case o.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE:t=l.userId,n=l.nsId,r=l.sjid,this.onFetchSeenStateDisabled(n,r),this.updateSeenStateInfoWithEmptyData(n,r),this.updateUserIdsWithoutSeenStateInfo(t,n,r,[])}},t})(s);t.PassStore=d,t.passStore=new d}),define("modules/clean/react/pass/utils",["require","exports","external/lodash","modules/core/user_i18n"],function(e,t,n,r){"use strict";function s(e){if(e)switch(e.type){case"link_only":return!0;case"view_member_access":case"edit_member_access":return e.value.group_access_only}return!1}Object.defineProperty(t,"__esModule",{value:!0});(function(e){function t(e){return e.startsWith("dbafvid:")}function s(e){return t(e.seen_state_user.user_id)}function i(e){return n.filter(e,t)}function o(e){return n.reject(e,t)}function a(e){return r.isCjkLocale()&&1===e.split(" ").length?e.substring(0,1):r.getInitials(e)}e.isAnonymousUserId=t,e.isAnonymousSeenState=s,e.getAnonymousUserIds=i,e.filterAnonymousUserIds=o,e.getAnonymousViewerInitials=a})(t.AnonymousViewerUtils||(t.AnonymousViewerUtils={})),t.shouldIncrementOverflowBasisForAccessType=s}),define("modules/clean/react/select",["require","exports","tslib","external/classnames","external/create-react-class","external/react","external/react-dom","external/lodash","jquery","modules/clean/keycode","modules/clean/react/form_error_mixin","modules/clean/react/hidden","modules/clean/react/sprite","modules/clean/react/util","modules/core/dom"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m){"use strict";function _(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var f=i.DOM,g=i.createElement,y=function(e,t){var n=e.scrollTop(),r=n+e.height(),s=t.position().top+n,i=s+t.height();return s<n?e.scrollTop(s):i>r?e.scrollTop(i-e.height()):void 0},v=i.PropTypes.oneOfType([i.PropTypes.string,i.PropTypes.number]),S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={id:a.uniqueId("option")},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){if(null!=e.id)return this.setState({id:e.id})},t.prototype.render=function(){var e={"list-item":!0,"select-option":!0,"select-option-disabled":this.props.disabled};null!=this.props.className&&(e[this.props.className]=!0);var t=this.props.value,n=l.extend(!0,{},this.props);return delete n.value,f.div(l.extend({"data-value":t},n,{id:this.state.id,role:"option",className:r(e),"aria-disabled":this.props.disabled}),this.props.children)},t.displayName="selectOption",t.propTypes={id:i.PropTypes.string,className:i.PropTypes.string,disabled:i.PropTypes.bool,title:i.PropTypes.string,value:v,error:i.PropTypes.shape({message_text:i.PropTypes.string,message_html:i.PropTypes.string})},t})(i.Component);t.option=S;var E=s({displayName:"selectInput",mixins:[d],mouseInput:!0,propTypes:{name:i.PropTypes.string,onChange:i.PropTypes.func,defaultValue:v,style:i.PropTypes.object,value:v,variant:i.PropTypes.string,className:i.PropTypes.string,ariaLabelId:i.PropTypes.string,ariaDescriptionId:i.PropTypes.string,valueLink:i.PropTypes.object,isDisabled:i.PropTypes.bool,headerElement:i.PropTypes.element},getDefaultProps:function(){return{errorWrapperClassName:"select-input-error-wrapper",ariaLabelId:"",ariaDescriptionId:"",style:null,headerElement:null}},getInitialState:function(){return{open:!1,focused:null,keyboarsSelectPrefix:"",selectOptionId:a.uniqueId("selected-option"),listboxId:a.uniqueId("listbox"),value:this.props.defaultValue}},_getFilteredChildren:function(){return a.isArray(this.props.children)?a.filter(this.props.children,function(e){return e}):this.props.children},render:function(){var e=this,t={"select-input":!0,"select-input-dropdown-shown":this.state.open,"select-input-disabled":this.props.isDisabled};this.props.variant&&(t[this.props.variant]=!0),this.props.className&&(t[this.props.className]=!0);var n={"list-menu":!0,"select-input-dropdown":!0,"select-input-disable-error":this.props["disable-errors"]},s=this.renderErrorIfEnabled(),o=this.props.ariaDescriptionId;((null!=this.props.error?this.props.error.message_text:void 0)||null!=(null!=this.props.error?this.props.error.message_html:void 0))&&(o=s.props.id);var a=this.selectedOption();return f.div({className:r(t),style:this.props.style,ref:"wrapperDiv"},s,f.button({className:"select-input-button","aria-expanded":this.state.open,"aria-describedby":o,"aria-controls":this.state.listboxId,"aria-labelledby":this.props.ariaLabelId+" "+a.props.id,ref:"selectButton",tabIndex:0,onClick:this.handleClickOnInputButton},f.div({className:"select-input-input filter-item__filter-input",ref:"label"},a,f.div({className:"select-input-dropdown-arrow"},g(p,{group:"web",name:"arrow-down-gray",alt:""})))),g(u.HiddenSelect,{name:this.props.name,defaultValue:this.props.defaultValue,value:this.getValue(),options:(function(){var t=[];return i.Children.forEach(e._getFilteredChildren(),function(e){return t.push(e.props.value)}),t})()}),f.div({className:"hidden-option-container"},f.div({id:this.state.listboxId,className:r(n),role:"listbox",onKeyDown:this.handleKeydown,onMouseMove:this.handleMouseMove,tabIndex:-1,ref:"dropdown"},this.menuChildren())))},handleMouseMove:function(e){var t;if(!this.props.isDisabled){e.pageX===n&&e.pageY===t||(this.mouseInput=!0);var n=e.pageX;return t=e.pageY}},_commonPrefixLen:function(e,t){e=e.trim().toLowerCase(),t=t.trim().toLowerCase();for(var n=0;n<e.length&&n<t.length&&e.charAt(n)===t.charAt(n);)n++;return n},_keyboardSelect:function(e){var t=a.sortedIndexBy(this.sortedOptions,{text:e.toLowerCase()},"text"),n=this.sortedOptions[Math.max(t-1,0)],r=this.sortedOptions[Math.min(t,this.sortedOptions.length-1)];return this._commonPrefixLen(e,n.text)>=this._commonPrefixLen(e,r.text)?this.setState({keyboarsSelectPrefix:e,focused:n.value}):this.setState({keyboarsSelectPrefix:e,focused:r.value})},handleKeydown:function(e){var t=this;if(!this.props.isDisabled){switch(this.mouseInput=!1,e.keyCode){case c.KeyCode.TAB:return this.setState({open:!1,focused:null}),!0;case c.KeyCode.ENTER:case c.KeyCode.SPACE:this.state.open&&this.state.focused?(this.setValue(this.state.focused),this.setState({open:!1})):this.toggle();break;case c.KeyCode.ESC:if(this.state.open){var n=this.getValue();this.setValue(n),this.setState({open:!1})}break;case c.KeyCode.UP:this.state.open?this.setState({focused:this.prev(this.state.focused)}):this.setState({open:!0});break;case c.KeyCode.DOWN:this.state.open?this.setState({focused:this.next(this.state.focused)}):this.setState({open:!0});break;default:if(!this.state.open)return!0;if(!a.values(c.KeyCode).includes(e.keyCode)){var r=String.fromCharCode(e.which),s=this.state.keyboarsSelectPrefix+r;this._keyboardSelect(s),this._keyboardSelect_timeout&&clearTimeout(this._keyboardSelect_timeout),this._keyboardSelect_timeout=setTimeout(function(){return t.setState({keyboarsSelectPrefix:""}),t._keyboardSelect_timeout=null},500)}}return!1}},prev:function(e){var t=null,n=null;return i.Children.forEach(this._getFilteredChildren(),function(r){if(n||r.props.disabled||(n=r),r.props.value===e&&(t=n),!r.props.disabled)return n=r}),null!=t?t.props.value:void 0},next:function(e){var t=null,n=null;return i.Children.forEach(this._getFilteredChildren(),function(r){if(!r.props.disabled)return(null!=n?n.props.value:void 0)===e&&(t=r),n=r}),_(t||n,function(e){return e.props.value})},menuChildren:function(){var e=this,t=this.getValue();return i.Children.map(this._getFilteredChildren(),function(n){return i.cloneElement(n,{onMouseEnter:function(){if(m.scroll_lock_document(),e.mouseInput)return e.setState({focused:n.props.value})},onMouseOut:function(){return m.scroll_unlock_document()},onClick:function(){if(!n.props.disabled)return e.setState({open:!1}),e.setValue(n.props.value)},className:r({"focused-option":null!=e.state.focused&&e.state.focused===n.props.value,"selected-option":t===n.props.value},n.props.className)})})},componentWillMount:function(){var e=i.Children.map(this._getFilteredChildren(),function(e){return{value:e.props.value,text:h.getText(e).trim().toLowerCase()}});return this.sortedOptions=a.sortBy(e,"text")},componentDidMount:function(){var e=this;return this.globalMenuCloser=function(t){if(e.state.open){var n=l(t.target).closest(".select-input")
;if(!n.length||n[0]!==o.findDOMNode(e.refs.wrapperDiv))return e.setState({open:!1,focused:null})}},l(document).on("click",this.globalMenuCloser)},componentWillUnmount:function(){return l(document).off("click",this.globalMenuCloser)},componentDidUpdate:function(e,t){var n,r=l(o.findDOMNode(this.refs.dropdown)),s=l(o.findDOMNode(this.refs.selectButton));this.state.open&&(n=r.find("[data-value='"+this.state.focused+"']"),r.attr("aria-activedescendant",n.attr("id"))),this.state.open&&this.state.focused&&null==this.props.headerElement&&(n=r.find("[data-value='"+this.state.focused+"']"),r.attr("aria-activedescendant",n.attr("id")),y(r,n));var i=t.open&&!this.state.open;if(!t.open&&this.state.open&&r.focus(),i)return s.focus()},selectedOption:function(){var e=this,t=null;return null!=this.props.headerElement?this.props.headerElement:(i.Children.forEach(this._getFilteredChildren(),function(n){if(t||(t=n),(null!=n?n.props.value:void 0)===e.getValue())return t=n}),t?i.cloneElement(t,{id:this.state.selectOptionId}):null)},handleClickOnInputButton:function(e){return e.preventDefault(),this.toggle()},toggle:function(){if(!this.props.isDisabled)return this.state.open?this.setState({open:!1,focused:null}):this.setState({open:!0,focused:this.getValue()})},getValue:function(){var e,t;return null!=(e=null!=(t=null!=this.props.value?this.props.value:null!=this.props.valueLink?this.props.valueLink.value:void 0)?t:this.state.value)?e:this.props.defaultValue},setValue:function(e){var t=this.getValue();if(this.props.valueLink?this.props.valueLink.requestChange(e):this.setState({value:e}),t!==e||null!=this.props.headerElement)return"function"==typeof this.props.onChange?this.props.onChange(t,e):void 0}});t.input=E}),define("modules/clean/react/starred/browse_exports",["require","exports","modules/clean/react/starred/store","modules/clean/react/starred/browse_update","modules/clean/react/starred/star","modules/clean/react/starred/actions","modules/clean/react/home/resource_id_types","modules/clean/react/starred/overflow_menu_with_star","modules/clean/react/starred/constants"],function(e,t,n,r,s,i,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarredStore=n.StarredStore,t.checkForMissingStarredData=r.checkForMissingStarredData,t.Star=s.Star,t.StarredActions=i.StarredActions,t.HOME_RESOURCE_ID_TYPE=o.HOME_RESOURCE_ID_TYPE,t.OverflowMenuWithStar=a.OverflowMenuWithStar,t.StarredSource=l.StarredSource}),define("modules/clean/react/starred/browse_update",["require","exports","modules/clean/react/home/home_access/home_access_util","modules/clean/react/home/resource_id_types","modules/clean/react/starred/actions","modules/clean/react/starred/store"],function(e,t,n,r,s,i){"use strict";function o(e){var t=e.files,o=e.isNonUserRelativeContext,a=e.user;if(n.isHomeEnabled()&&!o){var l=t.map(function(e){return{type:r.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID,id:e.file_id}}).filter(function(e){return!(!e.id||i.StarredStore.hasIdTypePair(e))});l.length&&s.StarredActions.fetchStatuses(a.role,l)}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkForMissingStarredData=o}),define("modules/clean/react/starred/overflow_menu_with_star",["require","exports","tslib","external/react","modules/clean/react/starred/store","modules/clean/react/browse/overflow_menu"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(t){var n=e.call(this,t)||this;return n.onStoreUpdate=function(){var e=n.getStateFromProps();n.setState(e)},n.state=n.getStateFromProps(),n.removeStoreListener=s.StarredStore.addListener(n.onStoreUpdate),n}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){this.props.canDisplayFolderSizes!==e.canDisplayFolderSizes&&this.setState(this.getStateFromProps(e))},t.prototype.componentWillUnmount=function(){this.removeStoreListener&&this.removeStoreListener()},t.prototype.getStateFromProps=function(e){void 0===e&&(e=this.props);var t=e.file,n=e.canDisplayFolderSizes;return{actionItems:(0,e.getFileActions)(t,!!n)}},t.prototype.render=function(){var e=this.props,t=e.file,n=e.attachment,s=e.showBorders,o=e.size,a=this.state.actionItems;return r.createElement(i.BrowseOverflowMenu,{file:t,attachment:n,actionItems:a,size:o,showBorders:s})},t})(r.PureComponent);t.OverflowMenuWithStar=o}),define("modules/clean/react/tabs/tab_nav",["require","exports","tslib","external/classnames","external/react","external/lodash","modules/clean/react/css","modules/clean/react/tabs/tab_bar","modules/clean/react/tabs/tab_util","modules/clean/react/tabs/tabs","jquery"],function(e,t,n,r,s,i,o,a,l,c){"use strict";var d=s.DOM,u=s.PropTypes;return o((function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={selectedIndex:t.props.defaultSelectedIndex},t._onChange=function(e,n){return t.props.onChange(e,n),t.setState({selectedIndex:n})},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){if(this.props.defaultSelectedIndex!==e.defaultSelectedIndex)return this.setState({selectedIndex:e.defaultSelectedIndex})},t.prototype.render=function(){var e=this.props.idPrefix?this.props.idPrefix:"tabset"+i.uniqueId();return d.div({className:r(this.props.variant,this.props.className)},s.createElement(a,{tabs:this.props.tabs,onChange:this._onChange,idPrefix:e,selectedIndex:this.state.selectedIndex}),s.createElement(c.TabContent,{isSelected:!0,id:l.getTabContentId(e),tabId:l.getTabId(e,this.state.selectedIndex)},this.props.children))},t.displayName="TabNav",t.propTypes={tabs:u.arrayOf(u.oneOfType([u.string,u.number,u.shape({value:u.oneOfType([u.string,u.number]),label:u.string,rightAlign:u.bool})])),defaultSelectedIndex:u.number,onChange:u.func,idPrefix:u.string,variant:u.string,className:u.string},t.defaultProps={defaultSelectedIndex:0,variant:l.TabVariant.DEFAULT,onChange:function(){}},t})(s.Component),["/static/css/legacy_packages/components-vflC9ETTX.css"])}),define("modules/clean/react/teams/modals/limited_team_folder_settings_modal",["require","exports","external/react","external/underscore","modules/clean/analytics","modules/clean/react/modal","modules/clean/react/teams/modals/limited_team_upsell_modal_banner","modules/clean/sharing/folder_settings_modal","modules/constants/trademark","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l,c){"use strict";function d(e){var t={altAction:u(o,{upsellText:c._("Want to access these settings as well as other admin controls? Upgrade to %(trademark_business)s.").format({trademark_business:l.TRADEMARK_BUSINESS}),upgradeButtonText:c._("Upgrade now"),redirectQuery:{tk:"team_settings",_camp:"modal"},logEventName:"team_folder_settings_upsell"})},n=i.Modal.showInstance(u(a.SharedFolderSettingsModal,r(e).extend(t)));return s.TeamsWebActionsLogger.log("team_folder_settings",null,null,null,!1,s.TeamsWebActionsLogger.LOG_CATEGORY.TEAM_INFO),n}Object.defineProperty(t,"__esModule",{value:!0});var u=n.createElement;t.showWithProps=d}),define("modules/clean/react/teams/modals/limited_team_share_folder_modal",["require","exports","external/create-react-class","external/react","modules/clean/analytics","modules/clean/filepath","modules/clean/react/modal","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,r,s,i,o,a,l,c){"use strict";function d(e){var t=o.Modal.showInstance(p(m,e));return h("team_folder_share"),t}Object.defineProperty(t,"__esModule",{value:!0});var u=r.DOM,p=r.createElement,h=function(e){return s.TeamsWebActionsLogger.log(e,null,null,null,!1,s.TeamsWebActionsLogger.LOG_CATEGORY.TEAM_INFO)},m=n({mixins:[r.addons.PureRenderMixin],displayName:"LimitedTeamShareFolderModal",propTypes:{fqPath:r.PropTypes.string.isRequired},_navigateToTeam:function(){return h("team_folder_share_invite"),a.redirect(new c({path:"/team",query:{invite_members:"",tk:"team_folder_share_invite",_camp:"modal"}}))},render:function(){var e=i.filename(this.props.fqPath);return p(o.Modal,{title:l._("Share %(folder_name)s").format({folder_name:e}),acceptButtonText:l._("Invite"),onAccept:this._navigateToTeam,showButtonDivider:!0},u.div({},l._("To share the %(folder_name)s with someone, invite them to join your team!").format({folder_name:e})))}});t.showModalInstance=d}),define("modules/clean/react/teams/modals/limited_team_upsell_modal_banner",["require","exports","external/create-react-class","external/react","modules/clean/analytics","modules/clean/react/button","modules/core/browser","modules/core/uri"],function(e,t,n,r,s,i,o,a){"use strict";var l=r.DOM,c=r.createElement,d=r.PropTypes;return n({mixins:[r.addons.PureRenderMixin],propTypes:{upgradeButtonText:d.string.isRequired,upsellText:d.string.isRequired,logEventName:d.string,redirectUrl:d.string,redirectQuery:d.shape({tk:d.string,_camp:d.string})},displayName:"LimitedTeamUpsellModalBanner",_handleCTAClick:function(){return this.props.logEventName&&s.TeamsWebActionsLogger.log(this.props.logEventName,{},null,null,!1,s.TeamsWebActionsLogger.LOG_CATEGORY.UPGRADE),o.redirect(new a({path:this.props.redirectUrl?this.props.redirectUrl:"/team/upgrade",query:this.props.redirectQuery}))},render:function(){return l.div({className:"modal-upsell-bar"},l.div({className:"modal-upsell-bar__message"},this.props.upsellText),l.div({className:"modal-upsell-bar__action"},c(i.button,{className:"modal-upsell-bar__cta-button",onClick:this._handleCTAClick},this.props.upgradeButtonText)))}})}),define("modules/clean/sharing/action_types",["require","exports","modules/clean/flux/action_type"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShareModalActionTypes=n.withActionNamespace("share-modal-actions",{SHARE_MODAL_OPEN:"share-modal-open",SHARE_MODAL_CLOSE:"share-modal-close",RESET_MODAL_STATE:"reset-modal-state",OPEN_LINK_SETTINGS_MODAL:"open-link-settings-modal",OPEN_FOLDER_SETTINGS_MODAL:"open-folder-settings-modal",OPEN_SHARED_LINK_MODAL:"open-shared-link-modal",CLOSE_LINK_SETTINGS_MODAL:"close-link-settings-modal",CLOSE_FOLDER_SETTINGS_MODAL:"close-folder-settings-modal",CLOSE_SHARED_LINK_MODAL:"close-shared-link-modal",CLEAR_METADATA:"clear-metadata",FETCH_METADATA_REQUEST:"metadata-request",FETCH_METADATA_SUCCESS:"metadata-success",FETCH_METADATA_FAILURE:"metadata-failure",CLEAR_LINK_METADATA:"clear-link-metadata",FETCH_LINK_METADATA_REQUEST:"link-metadata-request",FETCH_LINK_METADATA_SUCCESS:"link-metadata-success",FETCH_LINK_METADATA_FAILURE:"link-metadata-failure",CLEAR_SHARING_PREFS:"clear-sharing-prefs",FETCH_SHARING_PREFS_REQUEST:"sharing-prefs-request",FETCH_SHARING_PREFS_SUCCESS:"sharing-prefs-success",FETCH_SHARING_PREFS_FAILURE:"sharing-prefs-failure",FETCH_UPSELL_EXPERIMENT_VARIANT:"fetch-upsell-experiment-variant",ERROR_MESSAGE:"error-message",ERROR_MESSAGE_CLEAR:"error-message-clear",CLEAR_FILE_MEMBERSHIP:"clear-file-membership",FETCH_FILE_MEMBERSHIP_REQUEST:"fetch-file-membership-request",FETCH_FILE_MEMBERSHIP_SUCCESS:"fetch-file-membership-success",FETCH_FILE_MEMBERSHIP_FAILURE:"fetch-file-membership-failure",CLEAR_FOLDER_MEMBERSHIP:"clear-folder-membership",FETCH_FOLDER_MEMBERSHIP_REQUEST:"fetch-folder-membership-request",FETCH_FOLDER_MEMBERSHIP_SUCCESS:"fetch-folder-membership-success",FETCH_FOLDER_MEMBERSHIP_FAILURE:"fetch-folder-membership-failure",FETCH_USER_ACCOUNTS_REQUEST:"fetch-user-accounts-request",FETCH_USER_ACCOUNTS_SUCCESS:"fetch-user-accounts-success",FETCH_USER_ACCOUNTS_FAILURE:"fetch-user-accounts-failure",FETCH_USER_ACCOUNTS_CONTINUED_REQUEST:"fetch-user-accounts-continued-request",FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:"fetch-user-accounts-continued-success",CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:"clear-file-membership-last-seen-info",FETCH_FILE_MEMBER_COUNT_REQUEST:"fetch-file-member-count-request",FETCH_FILE_MEMBER_COUNT_SUCCESS:"fetch-file-member-count-success",CHANGE_RECIPIENTS:"change-recipients",CHANGE_RECIPIENT_MESSAGE:"change-recipient-message",CHANGE_RECIPIENT_ACCESS:"change-recipient-access",CREATE_LINK_REQUEST:"create-link-request",CREATE_LINK_SUCCESS:"create-link-success",CREATE_LINK_FAILURE:"create-link-failure",DISPLAY_CONTENT_NAME_INFO:"display-content-name-info",SEND_SHARE_REQUEST:"send-share-request",SEND_SHARE_SUCCESS:"send-share-success",SEND_SHARE_FAILURE:"send-share-failure",SHARE_FOLDER_REQUEST:"share-folder-request",SHARE_FOLDER_SUCCESS:"share-folder-success",SHARE_FOLDER_FAILURE:"share-folder-failure",SEND_FOLDER_SHARE_REQUEST:"send-folder-share-request",SEND_FOLDER_SHARE_SUCCESS:"send-folder-share-success",SEND_FOLDER_SHARE_FAILURE:"send-folder-share-failure",CHANGE_MEMBER_ACCESS_REQUEST:"change-member-access-request",CHANGE_MEMBER_ACCESS_SUCCESS:"change-member-access-success",CHANGE_MEMBER_ACCESS_FAILURE:"change-member-access-failure",MEMBER_ACTION_PENDING:"member-action-pending",MEMBER_ACTION_COMPLETE:"member-action-complete",REMOVE_MEMBER_SUCCESS:"remove-member-success",REMOVE_MEMBER_KEEP_ACCESS:"remove-member-keep-access",TRANSFER_OWNER_SUCCESS:"transfer-owner-success",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",FETCH_MEMBER_COUNTS_REQUEST:"fetch-member-counts-request",FETCH_MEMBER_COUNTS_SUCCESS:"fetch-member-counts-success",HANDLE_CONTENT_NAME_CHANGE:"handle-content-name-change",HANDLE_CONTENT_NAME_FOCUS_CHANGE:"handle-content-name-focus-change",UPDATE_BANNER:"update-banner",VALIDATE_CONTENT_NAME_SUCCESS:"validate-content-name-success",VALIDATE_CONTENT_NAME_ERROR:"validate-content-name-error",CHANGE_LINK_AUDIENCE_REQUEST:"change-link-audience-request",CHANGE_LINK_AUDIENCE_SUCCESS:"change-link-audience-success",CHANGE_LINK_AUDIENCE_FAILURE:"change-link-audience-failure",UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:"unblock-member-list-on-pass-load",UPDATE_SHARING_SETTINGS_SUCCESS:"update-sharing-settings-success"}),t.SharingActionTypes=n.withActionNamespace("sharing-actions",{CLEAR_EVERYTHING:"clear-everything",FETCH_METADATA_BATCH_ATTEMPT:"fetch-metadata-batch-attempt",FETCH_METADATA_BATCH_SUCCESS:"fetch-metadata-batch-success",FETCH_METADATA_BATCH_FAIL:"fetch-metadata-batch-fail"})}),define("modules/clean/sharing/actions/share_modal",["require","exports","tslib","jquery","external/react","external/react-dom","modules/clean/ajax","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/browse/nav_actions","modules/clean/react/browse/store","modules/clean/react/content_manager/api","modules/clean/react/file_viewer/store","modules/clean/react/modal","modules/clean/react/pass/actions","modules/clean/react/pass/constants","modules/clean/react/pass/data_helpers","modules/clean/react/pass/store","modules/clean/react_format","modules/clean/sharing/action_types","modules/clean/sharing/actions/sharing_actions","modules/clean/sharing/api","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/clean/sharing/confirmation_modals/member_access_change_confirmation_modal","modules/clean/sharing/confirmation_modals/relinquish_membership_confirmation_modal","modules/clean/sharing/confirmation_modals/simple_confirm_modal","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/clean/sharing/link_settings_modal","modules/clean/sharing/parent_folder_access_modal","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/stores/sharing_info_util","modules/clean/sharing/ui_util","modules/clean/sharing/ui_notifications_util","modules/clean/sharing/views/inherited_members","modules/clean/teams/membership_discovery_util","modules/clean/teams/modals/create_team_prompt_modal","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/zendesk_feedback","modules/constants/teams","modules/constants/sharing","modules/core/browser","modules/core/i18n","modules/core/uri","modules/clean/react/snackbar"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y,v,S,E,b,I,T,C,w,A,M,k,N,P,L,R,O,F,D,x,U,B,q,H,V,j,G,K,W,Y,z,Q,X,Z){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var J=s.createElement,$=Q.i18n_default_project("sharing")._,ee=(function(){function t(t,r,i){var o=this;this.groupSeenStateInfo=null,this.presentAccountIds=null,this.hasLoggedSet={},this.changeAccess=function(e,t,n){void 0===n&&(n=!1);var r=Promise.resolve({}),s=e.memberId(),i=o.getContentInfo(),a=i.id,l=_.getBrowseStore().context().isNonUserRelativeContext;if(t===R.MEMBER_ACTION.REMOVE)s!==o.user.account_id||l?(r=(i.isFileFolder()?o.client.getParentFolderAccess({contentId:o.sharingInfo.parentSharedFolderId(),memberId:s}):o.removeMember(a,e,n,i.isFolder())).then(function(t){o.showParentFolderAccessModalIfQualified("remove",e,t)}),o.openShareModal()):o.relinquishMembership(a,n);else if(t===L.ACCESS_LEVEL.OWNER)r=o.client.transferContent({contentId:a,memberId:s}).then(function(){o.dispatch(T.ShareModalActionTypes.TRANSFER_OWNER_SUCCESS),q.sharingNotificationSuccess($("Made %(name)s the owner").format({name:e.displayName()})),o.fetchDataAndShowShareModal()});else{var c=void 0;if(i.isFileFolder()&&t===L.ACCESS_LEVEL.READER)c=o.client.getParentFolderAccess({contentId:o.sharingInfo.parentSharedFolderId(),memberId:s,accessLevel:t});else{var d=o.getContentInfo().isFileFolder();d&&o.dispatch(T.ShareModalActionTypes.MEMBER_ACTION_PENDING,{member:e}),c=o.shareIfFileFolder($("Updating member access...")).then(function(){return d&&o.dispatch(T.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:e}),o.changeMemberAccess(o.getContentInfo().id,e,t)}).catch(function(t){o.reportShareFailure(t),d&&o.dispatch(T.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:e})})}r=c.then(function(t){Z.Snackbar.complete($("Member access updated.")),o.showParentFolderAccessModalIfQualified("update",e,t)})}return r.then(o.refreshSharedWithColumnContentData)},this.changeLinkAudience=function(e){var t=new A.CombinedPolicy({audience:e});if(o.getContentInfo().isFileFolder())return o.shareIfFileFolder(I.reactFormat($("Changing link settings for <st>%(folder_name)s</st>..."),{st:s.createElement("strong",null),folder_name:d.Emstring.em_snippet(o.getContentInfo().name(),R.SNIPPET_SIZES.FILENAME)}),t).then(function(){Z.Snackbar.complete(I.reactFormat($("Changed link settings for <st>%(folder_name)s</st>."),{st:s.createElement("strong",null),folder_name:d.Emstring.em_snippet(o.getContentInfo().name(),R.SNIPPET_SIZES.FILENAME)}))}).catch(function(e){return o.reportShareFailure(e),Promise.reject(e)});var n=o.sharingInfo.linkMetadata(),r=n&&n.current_audience||A.LinkAudience.members;o.dispatch(T.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_REQUEST,{newAudience:e});var i,a;return o.getContentInfo().isFile()?(i=R.ALPHA_FILE_METADATA_PERMISSIONS,a=o.client.updatePolicy.bind(o.client)):(i=R.ALPHA_FOLDER_METADATA_PERMISSIONS,a=o.client.updatePolicyAlpha.bind(o.client)),a({actions:Object.keys(i),contentId:o.getContentInfo().id,newPolicy:t}).then(function(e){o.dispatch(T.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_SUCCESS,{metadata:e})}).catch(l.catchApiError(function(){return o.dispatch(T.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_FAILURE,{prevAudience:r}),Promise.reject({})}))},this.changeRecipientAccess=function(e){o.dispatch(T.ShareModalActionTypes.CHANGE_RECIPIENT_ACCESS,{newAccess:e})},this.changeRecipientMessage=function(e){o.dispatch(T.ShareModalActionTypes.CHANGE_RECIPIENT_MESSAGE,{message:e})},this.createSharedLink=function(){return o.log("CLICK_TIB_CREATE_LINK"),o.dispatch(T.ShareModalActionTypes.CREATE_LINK_REQUEST),Z.Snackbar.sync($("Creating link...")),o.client.createSharedLink({fileIdOrPath:o.getContentInfo().displayPath()}).then(function(e){o.dispatch(T.ShareModalActionTypes.CREATE_LINK_SUCCESS,{linkMetadata:e}),o.refreshSharedWithColumnLinkData(),Z.Snackbar.complete($("Link created."))}).catch(l.catchApiError(function(e){return e instanceof l.AppError&&e.error&&"access_denied"===e.error[".tag"]&&(o.getContentInfo().isFolder()?q.sharingNotificationError($("You don’t have permission to create a link to this folder")):q.sharingNotificationError($("You don’t have permission to create a link to this file"))),o.dispatch(T.ShareModalActionTypes.CREATE_LINK_FAILURE),Promise.reject(e)}))},this.fetchMetadataForFile=function(e){return C.SharingActions.loadFileMetadata({user:o.user,contentId:e.id,sourceUrl:e.url(),client:o.client}).catch(l.catchApiError(o.handleLoadingError))},this.fetchMetadataForFileFolder=function(e){var t,r,s=R.MEMBER_ACTION.ALL,i=o.user.is_cdm_member?R.VALIDATE_PATH_PERMISSIONS_CONFIDENTIAL_AWARE:R.VALIDATE_PATH_PERMISSIONS,a={actions:Object.keys(i),listMembersArg:{actions:s},shouldParseMetadataFromError:!0};return _.getBrowseStore().context().isNonUserRelativeContext&&!o.user.is_cdm_member?(t=function(e){var t=f.validateFolderPath(e);return o.client.validatePathContinue(t,!1)},r={nsId:e.nsId(),nsPath:e.nsPath()}):(t=o.client.validateFqPath,r={fqPath:e.displayPath(),shareAsConfidential:o.sharingInfo.shareAsConfidential()}),t(n.__assign({},r,a)).then(function(e){var t=e.metadata,n=e.inheritedMembers;o.handleGetMetadataSuccess(t);var r=o.getContentInfo();o.listMembers(r.id,r.url(),r.isFileFolder()&&n||void 0)}).catch(l.catchApiError(o.handleLoadingError))},this.fetchMetadataForSharedFolder=function(e){return o.client.getMetadata({contentId:e.id,actions:Object.keys(R.ALPHA_FOLDER_METADATA_PERMISSIONS)}).then(o.handleGetMetadataSuccess).catch(l.catchApiError(o.handleLoadingError))},this.handleInheritedMemberAccessChange=function(e,t,n,r,i){var a=o.getContentInfo();y.Modal.showInstance(s.createElement(H.SingleInheritedUserAccessChangeModal,{actionHandler:o,member:e,inheritedMembers:t,teamName:n,parentFolderName:a.parentFolderName(),currentFolderName:a.name(),isUserSelf:e.memberId()===o.user.account_id,isDowngrading:r,newAccessLevel:i}))},this.handleMemberAccessChange=function(e,t){var n=e.displayName();if(t===R.MEMBER_ACTION.REMOVE||t===L.ACCESS_LEVEL.OWNER){var r=t===R.MEMBER_ACTION.REMOVE&&e.memberId()===o.user.account_id,s=o.getContentInfo().isFolder(),i=o.getContentInfo().isNestedSharedFolder(),a=e.permissions.leave_a_copy&&e.permissions.leave_a_copy.allow,l=function(n){o.changeAccess(e,t,n===!0)},c=o.openShareModal,d=o.getContentInfo().parentFolderName(),u=o.getSharingInfo().isConfidentialFolder();r?N.showRelinquishMembershipConfirmationModal(s,i,l,c,a,u):k.showMemberAccessChangeConfirmationModal(n,t,s,i,a,l,c,u,d)}else o.changeAccess(e,t)},this.handleGetMetadataSuccess=function(e){o.dispatch(T.ShareModalActionTypes.FETCH_METADATA_SUCCESS,{metadata:e}),p.Dispatcher.dispatch({type:D.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:o.user})},this.handleLinkSettingsClick=function(){var e=function(){o.refreshSharedWithColumnLinkData(),o.setLinkMetadata(void 0),o.openShareModal()},t=o.sharingInfo.getInitialProps().onDeleteLink||e,n=function(e){o.setLinkMetadata(e),o.refreshSharedWithColumnLinkData()},r=O.showUpgradeToBizBanner(o.user);a.TeamsWebActionsLogger.log("open_link_settings_modal"),y.Modal.showInstance(s.createElement(O.SharedLinkSettingsModal,{client:o.client,isFile:o.getContentInfo().isFile(),linkMetadata:o.sharingInfo.linkMetadata(),onClose:o.openShareModal,onDeleteLink:t,onPolicySet:n,showUpgradeToBiz:r,isTeam:o.user.is_team}))},this.handleLoadingError=function(e){e instanceof l.AppError?("not_a_member"===e.error[".tag"]||"no_access"===e.error[".tag"]?(q.sharingNotificationError($("You don’t have permission to share this folder")),y.Modal.close()):"invalid_id"===e.error[".tag"]&&(q.sharingNotificationError($("This folder can’t be shared")),y.Modal.close()),o.dispatch(T.ShareModalActionTypes.FETCH_METADATA_FAILURE,{reason:e.error&&e.error.bad_path&&e.error.bad_path[".tag"]})):(q.sharingNotificationError(e.message||$("There was a problem completing this request.")),y.Modal.close())},this.handleSelectLinkAudience=function(e){if(o.sharingInfo.contentInfo().isFile())return o.changeLinkAudience(e);var t=o.sharingInfo.linkMetadata(),n=t&&t.current_audience||A.LinkAudience.members,r=t.audience_options.toArray().indexOf(n),i=t.audience_options.toArray().indexOf(e);if(i<r){var a="";if(e===A.LinkAudience.public)a=$("All items in this folder will become viewable by anyone with the link.");else{if(e!==A.LinkAudience.team)throw"audience type not supported: %(newAudience)s".format({newAudience:e});a=$("All items in this folder will become viewable by anyone on your team.")}y.Modal.showInstance(s.createElement(P.SimpleConfirmModal,{title:$("Change link audience?"),confirmText:$("Change audience"),onConfirm:function(){o.changeLinkAudience(e),o.openShareModal()},onCancel:o.openShareModal},a))}else if(i>r)return o.changeLinkAudience(e)},this.handleSetConfidential=function(e){var t,n=o.getContentInfo(),r=n.isSharedFolder()?n.sharedFolderId().toString():void 0;return t=r?o.client.setConfidentiality({contentId:r,confidential:e}):o.client.share({fqPath:n.displayPath(),confidential:e}),t.then(function(e){return o.handleGetMetadataSuccess(e),e})},this.openShareModal=function(){y.Modal.showInstance(J(o.shareModalClass,{actionHandler:o}))},this.recipientsChange=function(e,t){return void 0===t&&(t=""),Promise.resolve({}).then(function(){o.dispatch(T.ShareModalActionTypes.CHANGE_RECIPIENTS,{recipientTokens:e,recipientRawInput:t})})},this.redirectToPath=function(t,n){if(!_.getBrowseStore().user()){var r=c.browse_uri_for_fq_path(o.user,t);return n&&r.updateQuery({shareoptions:"1"}),void z.redirect(r.toString())}var s=function(){n&&e(["modules/clean/sharing/share_modal_util"],function(e){(0,e.showShareModal)(o.user,_.getBrowseStore().context(),{origin:"PARENT_FOLDER_MODAL"})})},i=_.getBrowseStore().sortLabel(),a=_.getBrowseStore().sortIsAscending();t!==_.getBrowseStore().context().currentFQPath?(m.browseNavActions.setUrl({path:t}),m.browseNavActions.setPath({path:t,sortLabel:i,sortIsAscending:a,onPathLoaded:s})):s()},this.refreshSharedWithColumnContentData=function(){o.getContentInfo().isFolder()?p.Dispatcher.dispatch({type:h.SharedWithActionType.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{}}):p.Dispatcher.dispatch({type:h.SharedWithActionType.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,data:{fileIds:[o.getContentInfo().id]}})},this.handleShareClick=function(e,t){return o.sharingInfo.contentInfo().pathExists()?o.sendShare(e):Promise.resolve().then(function(){o.setContentNameAndSendShare(e,t)})},this.failSnackbarWithHelpCenter=function(e,t){var n=function(){z.open_tab(t)};Z.Snackbar.show(s.createElement(Z.Snackbar,{actionButtonText:$("Learn more"),closeButtonText:$("Close"),onActionClick:n,title:e,variant:"fail"}))},this.shareIfFileFolder=function(e,t){if(Z.Snackbar.sync(e,!0),!o.getContentInfo().isFileFolder())return Promise.resolve({});if(o.sharingInfo.shareFolderPromise())return o.sharingInfo.shareFolderPromise();var n;if(n=o.sharingInfo.isNonUserRelativeContext()&&!o.user.is_cdm_member?"ns:"+o.getContentInfo().nsId()+o.getContentInfo().nsPath():o.getContentInfo().displayPath(),Y.TRUELINK.TRUELINK_UI[o.user.id]){var r=o.sharingInfo.linkMetadata();r&&r.current_audience!==A.LinkAudience.members&&(t||(t=new A.CombinedPolicy),t.audience||(t=t.set("audience",r.current_audience)))}var s={fqPath:n,folderPolicy:t,confidential:!1,shouldSync:o.sharingInfo.shouldSyncThisFolder()};o.sharingInfo.shareAsConfidential()&&(s.confidential=!0);var i=o.client.share(s);return o.dispatch(T.ShareModalActionTypes.SHARE_FOLDER_REQUEST,{promise:i}),i.then(function(e){return o.dispatch(T.ShareModalActionTypes.SHARE_FOLDER_SUCCESS,{metadata:e}),p.Dispatcher.dispatch({type:D.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:o.user}),e}).catch(function(e){return o.dispatch(T.ShareModalActionTypes.SHARE_FOLDER_FAILURE),Promise.reject(e)})},this.reportShareFailure=function(e){e instanceof l.RateLimitError?o.failSnackbarWithHelpCenter($("Couldn’t share. Folder updates in progress."),"/help/9259"):e instanceof l.AppError&&"internal_error"===e.error[".tag"]?o.failSnackbarWithHelpCenter($("Sharing unsuccessful. This folder has too many files."),"/help/files-folders/share-with-others#foldersize"):Z.Snackbar.fail(B.convertIfHTML(B.genAddMemberErrorMessage(e)))},this.showParentFolderAccessModalIfQualified=function(e,t,n){null!=n&&y.Modal.showInstance(s.createElement(F.ParentFolderAccessModal,{contentInfo:o.getContentInfo(),memberAccessLevelResult:n,memberDisplayName:t.displayName()||"",originalAction:e,isInContentManager:o.sharingInfo.isNonUserRelativeContext(),onClose:o.openShareModal,onParentFolderClicked:o.redirectToPath}))},this.parseParentFolderAccessError=function(e){var t=e.error;if("member_error"===e.error[".tag"]&&(t=e.error.member_error),"no_explicit_access"===t[".tag"])return M.memberAccessLevelApiToRecord(o.user.id,t);q.sharingNotificationError(e.message||$("There was a problem completing this request."))},this.turnLinkOnIfQualified=function(){var e=o.sharingInfo.linkMetadata();return!Y.TRUELINK.TRUELINK_UI[o.user.id]||!Y.TRUELINK.BROAD_AUDIENCE[o.user.id]||o.sharingInfo.parentSharedFolderId()||e&&e.current_audience!==A.LinkAudience.members?Promise.resolve({}):o.waitForAllMembersLoaded().then(function(){if(!o.sharingInfo.hasNonOwnerMembers())return o.changeLinkAudience(A.LinkAudience.default_on)})},this.updateLinkSettings=function(){},this.waitForAllMembersLoaded=function(){if(o.sharingInfo.areMembersFullyLoaded())return Promise.resolve({});var e=o.sharingInfo.fetchingMembersRequest();return e&&e.promise||Promise.resolve({})},this.client=t,this.user=r,this.shareModalClass=i}return t.prototype.initializeShareModal=function(e,t){void 0===t&&(t={});var n=e.contentInfo;return p.Dispatcher.dispatch({type:T.ShareModalActionTypes.SHARE_MODAL_OPEN,data:{shareModalInfo:e,initialProps:t},contentIds:U.getContentIdsForContentInfo(n),user:this.user}),this.sharingInfo=x.sharingInfoStore.getSharingInfo(this.user.id,n.id),this.fetchInitialData()},t.prototype.fetchDataAndShowShareModal=function(){this.fetchInitialData(),this.openShareModal()},t.prototype.fetchInitialData=function(){var e=this.sharingInfo.contentInfo(),t=this.sharingInfo.isNonUserRelativeContext();this.beginTime=Date.now(),this.fetchPassInfo(),this.fetchUpsellExperimentVariant();var n=[];return e.isFileFolder()?n.push(this.fetchMetadataForFileFolder(e)):(n.push(this.listMembers(e.id,e.url())),e.isFile()?n.push(this.fetchMetadataForFile(e)):e.isSharedFolder()&&n.push(this.fetchMetadataForSharedFolder(e))),n.push(this.fetchMemberCounts()),Y.TRUELINK.TRUELINK_UI[this.user.id]?(this.sharingInfo.isTeamPolicyLoaded()||n.push(this.fetchTeamPolicy()),this.sharingInfo.areSharingPrefsLoaded()||n.push(this.fetchSharingPrefs())):(n.push(this.fetchTeamPolicy()),n.push(this.fetchSharingPrefs()),this.sharingInfo.canShareLink()&&!t&&e.isMounted()&&n.push(this.fetchLinkMetadata())),Promise.all(n)},t.prototype.fetchPassInfo=function(){var e=this;this.sharingInfo.shouldBlockMemberListOnPassLoad()&&setTimeout(function(){return e.dispatch(T.ShareModalActionTypes.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD)},4e3);var t=this.getPassFileInfo(),n=t.nsId,r=t.sjid;if(t.fromBrowse){this.clearCachedPassInfo();var s=b.passStore.passFetchingStatus(n,r);S.fetchingStatusIsSuccessful(s)?(this.groupSeenStateInfo=b.passStore.getLinkAndGroupSeenStateInfo(n,r).groupSeenStateInfo,this.presentAccountIds=b.passStore.presence(n,r)):s===S.PASS_FETCHING_STATUS.NOT_YET_KNOWN&&E.PassHelpers.setup({user:this.user,fileData:this.getFileData(),prevFileData:null,shouldWritePresence:!1,skipSharingEndpoints:!0})}},t.prototype.getSharingInfo=function(){return this.sharingInfo},t.prototype.clearCachedPassInfo=function(){e=[null,null],this.groupSeenStateInfo=e[0],this.presentAccountIds=e[1];var e},t.prototype.getPassInfo=function(){var e=this.getContentInfo();if(e.isFolder())return{groupSeenStateInfo:{},presentAccountIds:[],passFetchingStatus:S.PASS_FETCHING_STATUS.ERROR};if(this.groupSeenStateInfo&&this.presentAccountIds)return{groupSeenStateInfo:this.groupSeenStateInfo,presentAccountIds:this.presentAccountIds,
passFetchingStatus:S.PASS_FETCHING_STATUS.PASS_SUCCESS};var t=this.getPassFileInfo(),n=t.nsId,r=t.sjid;if(!n||!r)return l=[{},[]],this.groupSeenStateInfo=l[0],this.presentAccountIds=l[1],{groupSeenStateInfo:{},presentAccountIds:[],passFetchingStatus:S.PASS_FETCHING_STATUS.ERROR};var s=b.passStore.getPassPermissions(e.id),i=b.passStore.passFetchingStatus(n,r);if(!S.fetchingStatusIsComplete(i))return{groupSeenStateInfo:{},presentAccountIds:[],passFetchingStatus:S.PASS_FETCHING_STATUS.FETCHING};if(null==s||!s.canReadPresence)return{groupSeenStateInfo:{},presentAccountIds:[],passFetchingStatus:S.PASS_FETCHING_STATUS.ERROR};var o=b.passStore.getLinkAndGroupSeenStateInfo(n,r),a=b.passStore.presence(n,r);return this.groupSeenStateInfo=o.groupSeenStateInfo,this.presentAccountIds=a?a.slice():[],this.isContentInfoForFilePreview(e)&&this.presentAccountIds.indexOf(this.user.account_id)<0&&this.presentAccountIds.push(this.user.account_id),{groupSeenStateInfo:this.groupSeenStateInfo,presentAccountIds:this.presentAccountIds,passFetchingStatus:i};var l},t.prototype.getPassFileInfo=function(){var e,t,n,r=this.getContentInfo(),s=r.extras.origin&&!r.isFolder()&&["BROWSE_FILE_ACTIONS","BROWSE_FILE_FACEPILE","BROWSE_FILE_ROW"].indexOf(r.extras.origin)>=0,i=r.extras.origin&&["BROWSE_FILE_ACTIONS","BROWSE_FILE_FACEPILE","BROWSE_FILE_ROW","PREVIEW_PAGE","PREVIEW_PAGE_FACEPILE"].indexOf(r.extras.origin)>=0;return i&&!r.isSharedFolder()?(e=r.nsId(),t=r.sjid(),n=r.beaconContext()):(o=[null,null,null],e=o[0],t=o[1],n=o[2]),{nsId:e,sjid:t,beaconContext:n,fromBrowse:s,contentInfoId:r.id};var o},t.prototype.getUrl=function(){return this.getPassFileInfo().fromBrowse?void 0:g.FileViewerStore.instance.getSharedLinkInfo()&&g.FileViewerStore.instance.getSharedLinkInfo().url},t.prototype.getFileData=function(e){var t=this.getPassFileInfo();return{file:{ns_id:t.nsId,sjid:t.sjid,beacon_context:t.beaconContext,file_id:t.contentInfoId},url:e}},t.prototype.getContentInfo=function(){return this.sharingInfo.contentInfo()},t.prototype.dispatch=function(e,t){void 0===t&&(t={}),p.Dispatcher.dispatch({type:e,data:t,contentIds:[this.getContentInfo().id],user:this.user})},t.prototype.changeMemberAccess=function(e,t,n){var r=this,s=t.access_type;return this.dispatch(T.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_REQUEST,{member:t,newAccess:n}),this.client.updateMember({contentId:e,memberId:t.memberId(),accessLevel:n}).then(function(e){if(e.access_level&&e.warning)return r.dispatch(T.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:e.access_level}),e}).catch(l.catchApiError(function(e){return r.dispatch(T.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:s}),r.parseParentFolderAccessError(e)}))},t.prototype.fetchLinkMetadata=function(){var e=this;return"/"===this.getContentInfo().displayPath()||Y.TRUELINK.TRUELINK_UI[this.user.id]?Promise.resolve({}):(this.dispatch(T.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST),this.client.sharedLinkInfo({fileIdOrPath:this.getContentInfo().idForLink()}).then(function(t){e.dispatch(T.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:t})}).catch(function(){e.dispatch(T.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE),_.getBrowseStore().context().isNonUserRelativeContext||(q.sharingNotificationError($("There was a problem completing this request.")),y.Modal.close())}))},t.prototype.fetchMemberCounts=function(){var e=this,t=this.getContentInfo();return this.dispatch(T.ShareModalActionTypes.FETCH_MEMBER_COUNTS_REQUEST),t.isSharedFolder()||t.isFolder()&&t.isInSharedFolder()?this.client.getMemberCounts({contentId:t.isSharedFolder()?t.sharedFolderId():t.nsId()}).then(function(t){e.dispatch(T.ShareModalActionTypes.FETCH_MEMBER_COUNTS_SUCCESS,{memberCounts:t})}):Promise.resolve({})},t.prototype.fetchSharingPrefs=function(){var e=this;return this.dispatch(T.ShareModalActionTypes.FETCH_SHARING_PREFS_REQUEST),this.client.getSharingPrefs().then(function(t){e.dispatch(T.ShareModalActionTypes.FETCH_SHARING_PREFS_SUCCESS,{sharingPrefs:t})})},t.prototype.fetchUpsellExperimentVariant=function(){var e=this;o.SilentBackgroundRequest({url:"/get_sl_upsell_variant",data:{_subject_uid:this.user.id},success:function(t){var n=JSON.parse(t);n&&n.variant&&e.dispatch(T.ShareModalActionTypes.FETCH_UPSELL_EXPERIMENT_VARIANT,n)}})},t.prototype.onShareModalUnmount=function(e){this.teardownPass();var t=e&&e.serializeInputData()||{};this.dispatch(T.ShareModalActionTypes.SHARE_MODAL_CLOSE,t)},t.prototype.fetchTeamPolicy=function(){var e=this;return this.dispatch(T.ShareModalActionTypes.FETCH_TEAM_POLICY_REQUEST),this.client.getCurrentAccountCached().then(function(t){e.dispatch(T.ShareModalActionTypes.FETCH_TEAM_POLICY_SUCCESS,{teamPolicy:t.team&&t.team.sharing_policies})})},t.prototype.getSuggestableUsers=function(t){var n=this;V.filterSuggestableUsers(t,function(t){var r=t.contacts,i=t.is_admin,o=n.getContentInfo().id;r.length>0?e(["modules/clean/teams/membership_suggestion_modal"],function(e){var t=e.MembershipSuggestionModal;y.Modal.showInstance(s.createElement(t,{isAdmin:i,isFile:n.sharingInfo.contentInfo().isFile(),contacts:r,nsId:o,accessLevel:n.sharingInfo.recipientAccess()}))}):y.Modal.close()},function(){return y.Modal.close()})},t.prototype.handleContentNameChange=function(e){var t="SIMPLIFIED_WIZARD_UI::CONTENT_NAME_CHANGE";this.hasLoggedSet[t]||(this.sharingExperimentsLog(t),this.hasLoggedSet[t]=!0),this.dispatch(T.ShareModalActionTypes.HANDLE_CONTENT_NAME_CHANGE,{name:e})},t.prototype.handleContentNameFocusChange=function(e){this.dispatch(T.ShareModalActionTypes.HANDLE_CONTENT_NAME_FOCUS_CHANGE,{focus:e})},t.prototype.handleUpdateFilePolicy=function(e,t){this.handleUpdateSharingSettings(e);var n=this.getSharingInfo().filePolicy(),r=this.getPassFileInfo(),s=r.nsId,i=r.sjid,o=r.fromBrowse,a=r.contentInfoId;if(null!=s&&null!=i)if(n.viewer_info_policy===A.ViewerInfoPolicy.disabled&&t.viewer_info_policy===A.ViewerInfoPolicy.enabled)this.clearCachedPassInfo(),v.PassActions.resetPassInfo(s,i,a),v.PassActions.fetchPassError(s,i),this.dispatch(T.ShareModalActionTypes.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO);else{var l=n.audience===A.LinkAudience.members!=(t.audience===A.LinkAudience.members),c=n.viewer_info_policy===A.ViewerInfoPolicy.enabled&&t.viewer_info_policy===A.ViewerInfoPolicy.disabled;if(l||c){this.clearCachedPassInfo();var d=this.getUrl();c&&this.listMembers(a,d),E.PassHelpers.setup({user:this.user,fileData:this.getFileData(d),prevFileData:null,shouldWritePresence:!o,skipSharingEndpoints:!0})}}},t.prototype.handleUpdateSharingSettings=function(e){this.dispatch(T.ShareModalActionTypes.UPDATE_SHARING_SETTINGS_SUCCESS,{metadata:e})},t.prototype.listMembers=function(e,t,n){return C.SharingActions.listMembers({user:this.user,contentId:this.getContentInfo().id,isFolder:this.sharingInfo.isFolder(),url:t,members:n,client:this.client})},t.prototype.addMembers=function(e,t,n,r){void 0===n&&(n=!1);var s=e.map(function(e){return{member:M.createUnionScalar(e.contactType(),e.contactId()),access_level:M.accessLevelConstToApi(e.access_type)}});return this.client.addMembersWithAccessLevel({contentId:t,members:s,customMessage:r,quiet:n})},t.prototype.isContentInfoForFilePreview=function(e){return("PREVIEW_PAGE"===e.extras.origin||"PREVIEW_PAGE_FACEPILE"===e.extras.origin)&&!e.isFolder()},t.prototype.log=function(e,t){void 0===t&&(t={}),B.logTiburonEvent(this.getContentInfo(),this.user.id,e,t)},t.prototype.logIfHaventBefore=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=!0),this.hasLoggedSet[e]||(this.hasLoggedSet[e]=!0,n&&(t.timing=Date.now()-this.beginTime),this.log(e,t))},t.prototype.onClickX=function(e){e&&e.finishLogging(!0),this.showTruelinkFeedbackIfQualified(),y.Modal.close()},t.prototype.redirectToBrowseUrl=function(e){m.browseNavActions.setUrl({path:e})},t.prototype.redirectToUpgrade=function(){z.redirect("/upgrade?oqa=spw")},t.prototype.refreshSharedWithColumnLinkData=function(){p.Dispatcher.dispatch({type:h.SharedWithActionType.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this.getContentInfo().displayPath()]}})},t.prototype.relinquishMembership=function(e,t){var n=this,r=this.getContentInfo();this.client.relinquishMembership({contentId:e,leaveACopy:t}).then(function(){r.isFolder()?q.sharingNotificationSuccess($("Folder access removed.")):q.sharingNotificationSuccess($("File access removed.")),y.Modal.close(),n.redirectToBrowseUrl("/")})},t.prototype.removeMember=function(e,t,n,r){var s=this;return this.dispatch(T.ShareModalActionTypes.MEMBER_ACTION_PENDING,{member:t}),this.client.removeMember({contentId:e,memberId:t.memberId(),leaveACopy:n}).then(function(n){return s.fetchMemberCounts().then(function(){if(n&&null!=n.access_level&&null!=n.warning)return s.dispatch(T.ShareModalActionTypes.REMOVE_MEMBER_KEEP_ACCESS,{member:t,access:n.access_level}),n;r?q.sharingNotificationSuccess($("Folder access removed.")):q.sharingNotificationSuccess($("File access removed.")),s.dispatch(T.ShareModalActionTypes.REMOVE_MEMBER_SUCCESS,{member:t})}).then(function(t){return s.listMembers(e),t})}).catch(l.catchApiError(function(e){return s.dispatch(T.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:t}),s.parseParentFolderAccessError(e)}))},t.prototype.setContentNameAndSendShare=function(e,t){var n=this,s=i.findDOMNode(t),o=s&&s.value,a=u.parent_dir(this.sharingInfo.fqPath());new w.SharingApi(this.user).validate_new_sf_path(o,B.getNewFolderPathFromContentName(o,a),function(){n.dispatch(T.ShareModalActionTypes.VALIDATE_CONTENT_NAME_SUCCESS,{contentName:o}),n.sendShare(e)},function(e){n.sharingExperimentsLog("SIMPLIFIED_WIZARD_UI::INVALID_CONTENT_NAME");var t=G.extract_errors(e.responseText);n.dispatch(T.ShareModalActionTypes.VALIDATE_CONTENT_NAME_ERROR,{errorMsg:t.folder_name&&t.folder_name.message_text});var i=r(s);i&&i.select()})},t.prototype.setLinkMetadata=function(e){this.dispatch(T.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:e})},t.prototype.sendShare=function(e){var t=this;this.log("CLICK_TIB_SEND_BUTTON");var n,r=Date.now(),i=this.isNewlySharedContent();return this.recipientsChange(e&&e.getContacts()).then(function(){return t.sharingInfo.contactsError().level===B.CONTACT_ERROR_LEVEL.ERROR?Promise.reject({}):(t.dispatch(T.ShareModalActionTypes.SEND_SHARE_REQUEST),t.prefetchShowcaseUpsell(),n=M.contactsToMembers(t.sharingInfo.recipientTokens()),t.shareIfFileFolder(I.reactFormat($("Sharing <st>%(folder_name)s</st>..."),{st:s.createElement("strong",null),folder_name:d.Emstring.em_snippet(t.getContentInfo().name(),R.SNIPPET_SIZES.FILENAME)})))}).then(function(){return t.turnLinkOnIfQualified(),t.client.addMembers({accessLevel:t.sharingInfo.recipientAccess(),contentId:t.sharingInfo.contentInfo().id,customMessage:t.sharingInfo.recipientMessage(),members:n})}).catch(l.catchApiError(function(e){return t.dispatch(T.ShareModalActionTypes.SEND_SHARE_FAILURE),t.reportShareFailure(e),t.log("SHARE_MODAL_SEND_FAIL",{timing:Date.now()-r,num_recipients:n.length}),Promise.reject({})})).then(function(){if(t.dispatch(T.ShareModalActionTypes.SEND_SHARE_SUCCESS),Z.Snackbar.complete(I.reactFormat($("Shared <st>%(folder_name)s</st>."),{st:s.createElement("strong",null),folder_name:d.Emstring.em_snippet(t.getContentInfo().name(),R.SNIPPET_SIZES.FILENAME)})),t.log("SHARE_MODAL_SEND_SUCCESS",{timing:Date.now()-r,num_recipients:n.length}),t.sharingInfo.getInitialProps().onSuccessSharing&&t.sharingInfo.getInitialProps().onSuccessSharing(),e&&e.finishLogging(!1),t.refreshSharedWithColumnContentData(),W.SHOW_CREATE_TEAM_MODAL_AFTER_SHARING&&i&&n.length>=2)y.Modal.showInstance(s.createElement(j.CreateTeamPromptModal,{invitedMembers:t.sharingInfo.recipientTokens().filter(function(e){return e.email!==t.user.email})}));else if(t.sharingInfo.ownerTeam()&&W.SUBGROWTH_PROJECT_MAGNET){var o=t.sharingInfo.recipientTokens().map(function(e){return e.email});t.getSuggestableUsers(o)}else if(Y.SHARING_EXPERIMENTS.SHOW_COPY_SCL_LINK[t.user.id]&&t.sharingInfo.isFolder()&&t.sharingInfo.recipientAccess()===L.ACCESS_LEVEL.WRITER){t.sharingExperimentsLog("COPY_SCL_LINK::SHOW_MODAL");var a=X.parse(t.sharingInfo.metadata().preview_url);a.updateQuery("oref","cslm");var l,c=function(){l.select(),document.execCommand("copy"),q.sharingNotificationSuccess("Link copied to clipboard")},u=s.createElement("input",{onClick:function(){t.sharingExperimentsLog("COPY_SCL_LINK::CLICK_INPUT_ATTEMPT"),c(),t.sharingExperimentsLog("COPY_SCL_LINK::CLICK_INPUT_SUCCESS")},readOnly:!0,ref:function(e){return l=e},style:{width:"96.5%",padding:"7px 0px 7px 15px"},type:"text",value:a.toString()});y.Modal.showInstance(s.createElement(y.Modal,{acceptButtonText:"Copy",autoClose:!1,dismissButtonText:"No thanks",onAccept:function(){t.sharingExperimentsLog("COPY_SCL_LINK::CLICK_COPY_ATTEMPT"),c(),t.sharingExperimentsLog("COPY_SCL_LINK::CLICK_COPY_SUCCESS")},title:"Share via link"},s.createElement("div",{style:{"font-size":"14px",color:"#536170","padding-bottom":"5px"}},"Copy and paste this link if you'd like to send it via email or chat."),s.createElement("div",{style:{"font-size":"12px",color:"#7A8994","margin-bottom":"25px"}},"Only members of the folder can use this link."),u))}else t.showTruelinkFeedbackIfQualified(),t.showShowcaseUpsellIfQualified(),y.Modal.close()})},t.prototype.isNewlySharedContent=function(){var e=this.getContentInfo();return e.isFileFolder()||e.isFile()&&!this.sharingInfo.hasNonOwnerMembers()},t.prototype.sharingExperimentsLog=function(e,t){void 0===t&&(t={});var n=this.getContentInfo().extras.modalSessionId;t.modalSessionId=t.modalSessionId||n,a.SharingExperimentsLogger.log(this.user.id,e,t)},t.prototype.showTruelinkFeedbackIfQualified=function(){Y.TRUELINK.TRUELINK_UI[this.user.id]&&(this.sharingInfo.hasChangedSharingSettings()?K.showFeedbackFlyoutIfAllowed("settings"):this.sharingInfo.hasChangedLinkAudience()&&K.showFeedbackFlyoutIfAllowed("sender"))},t.prototype.teardownPass=function(){this.clearCachedPassInfo(),this.getPassFileInfo().fromBrowse&&E.PassHelpers.teardown({user:this.user,fileData:this.getFileData(),async:!0,shouldWritePresence:!1})},t.prototype.updateBanner=function(e){this.dispatch(T.ShareModalActionTypes.UPDATE_BANNER,{banner:e})},t.prototype.prefetchShowcaseUpsell=function(){"personal"!==this.user.role||this.user.paid||new Promise(function(t,n){e(["modules/clean/growth/showcase_upsell/post_share_controller"],t,n)})},t.prototype.showShowcaseUpsellIfQualified=function(){return n.__awaiter(this,void 0,void 0,function(){var t,r,s,i;return n.__generator(this,function(n){switch(n.label){case 0:return"personal"!==this.user.role||this.user.paid?[3,3]:(t=this.getContentInfo(),[4,new Promise(function(t,n){e(["modules/clean/growth/showcase_upsell/post_share_controller"],t,n)})]);case 1:return r=n.sent(),s=r.ShowcaseUpsellPostShareController,[4,s.shouldShow(this.user,t)];case 2:i=n.sent(),i&&s.show(this.user,t),n.label=3;case 3:return[2]}})})},t})();t.ShareModalActionHandler=ee}),define("modules/clean/sharing/actions/sharing_actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/browse/store","modules/clean/react/pass/action_timestamps","modules/clean/react/pass/constants","modules/clean/sharing/action_types","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/stores/sharing_info_util","modules/constants/sharing","modules/core/exception"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharingActions={loadFileMetadataBatch:function(e,t){return new a.FileShareApiClient({userId:e.id}).getMetadataBatchAlpha({contentIds:t,actions:Object.keys(l.ALPHA_FILE_METADATA_PERMISSIONS)}).then(function(t){return n.Dispatcher.dispatch({type:o.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:e,data:t})})},loadFolderLinkMetadataBatch:function(e,t){var s=r.getBrowseStore().context().isNonUserRelativeContext;return Promise.resolve({}).then(function(){return t.forEach(function(t){return n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST,user:e,contentIds:[t]})})}),new a.FolderShareApiClient({userId:e.id,isNonUserRelativeContext:s}).validateFolderPathBatch({paths:t}).then(function(t){t.forEach(function(t){var r=t.metadata,s=t.path;r&&r.link_metadata?n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,data:{linkMetadata:r.link_metadata},user:e,contentIds:u.getContentIdsForMetadata(r).concat([s])}):n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE,user:e,contentIds:[s]})})})},loadFileMetadata:function(e){var t=e.user,r=e.contentId,s=e.sourceUrl,i=e.client,u=d.sharingInfoStore.getSharingInfo(t.id,r);if(u&&u.fetchingMetadataPromise())return u.fetchingMetadataPromise();i=i||new a.FileShareApiClient({userId:t.id});var p=i.getMetadataAlpha({contentId:r,actions:Object.keys(l.ALPHA_FILE_METADATA_PERMISSIONS),sourceURL:s}).then(function(e){n.Dispatcher.dispatch({type:o.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:t,data:[e]}),n.Dispatcher.dispatch({type:c.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:t})});return n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_METADATA_REQUEST,contentIds:[r],data:{promise:p},user:t}),p},listMembers:function(e){var t=e.user,l=e.contentId,c=e.isFolder,u=e.limit,p=e.url,m=e.members,_=e.client,f=e.previewSessionId,g=void 0===f?null:f,y=e.includeSeenState,v=void 0===y||y;h.assert(!u||u<=100,"listMembers not implemented for limit > 100");var S=u||9999999,E=d.sharingInfoStore.getSharingInfo(t.id,l);if(E){var b=E.fetchingMembersRequest();if(b&&S<=b.limitNonNull)return b.promise;if(E.hasDisplayableMembers()&&S<E.members().getMemberCount())return Promise.resolve({})}var I=Math.random().toString(),T=!c,C=r.getBrowseStore().context().isNonUserRelativeContext;_||(_=c?new a.FolderShareApiClient({userId:t.id,isNonUserRelativeContext:C}):new a.FileShareApiClient({userId:t.id,isNonUserRelativeContext:C}));var w,A=function(e){return e?(n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_REQUEST,contentIds:[l],user:t}),_.listMembersContinue({cursor:e,url:p,isAlpha:T}).then(function(e){n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS,contentIds:[l],data:{members:e,requestId:I},user:t}),A(e.cursor)})):Promise.resolve({})};return s.ActionTimestampsTracker.record(i.LoggingActions.LIST_MEMBERS_BEGIN,g),w=m?Promise.resolve(m):_.listMembers({contentId:l,url:p,limit:u,isAlpha:T,includeSeenState:v}),w=w.then(function(e){s.ActionTimestampsTracker.record(i.LoggingActions.LIST_MEMBERS_RECEIVE,g),n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_USER_ACCOUNTS_SUCCESS,contentIds:[l],data:{members:e,requestId:I},user:t}),u||A(e.cursor)}),n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_USER_ACCOUNTS_REQUEST,contentIds:[l],data:{limitNonNull:S,requestId:I,promise:w},user:t}),w},fetchFileMemberCount:function(e){var t=e.user,r=e.contentId,l=e.limit,c=e.url,d=e.client,u=e.countGroupsAsMembers,p=void 0!==u&&u,h=e.previewSessionId,m=void 0===h?null:h,_=e.runViewerInfoChecks,f=void 0!==_&&_;d=d||new a.FileShareApiClient({userId:t.id}),s.ActionTimestampsTracker.record(i.LoggingActions.MEMBER_COUNTS_BEGIN,m);var g=d.getMemberCounts({contentId:r,limit:l,url:c,countGroupsAsMembers:p,runViewerInfoChecks:f});return n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_REQUEST,contentIds:[r],user:t}),g.then(function(e){s.ActionTimestampsTracker.record(i.LoggingActions.MEMBER_COUNTS_RECEIVE,m),n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_SUCCESS,contentIds:[r],data:e,user:t})})},fetchLinkMetadata:function(e){var t=e.user,r=e.contentId,s=e.client;p.TRUELINK.TRUELINK_UI[t.id]||(s=s||new a.ShareApiClient({userId:t.id}),n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST,contentIds:[r],data:{},user:t}),s.sharedLinkInfo({fileIdOrPath:r}).then(function(e){n.Dispatcher.dispatch({type:o.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,contentIds:[r],data:{linkMetadata:e},user:t})}))}}}),define("modules/clean/sharing/api",["require","exports","jquery","modules/clean/ajax"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e){this.user=e}return e.prototype.get_sync_vars_for_ns_id=function(e,t,n){var r={ns_id:e,sub_path:t};this._make_request("/sharing/get_sync_vars_for_ns_id",r,n,null,!0)},e.prototype.validate_new_sf_path=function(e,t,n,r){var s={share_type:"new",folder_name:e,path:t};this._make_request("/share_ajax/validate_folder",s,n,r,!0)},e.prototype.validate_shareable_existing_sf_path=function(e,t,n){var r={share_type:"shareable_existing",path:e};this._make_request("/share_ajax/validate_folder",r,t,n,!0)},e.prototype._make_request=function(t,s,i,o,a,l){void 0===a&&(a=!1),void 0===l&&(l=!0);var c={url:t,data:s,success:function(r,o,a){i(a),n(document).trigger(e.REQUEST_SUCCEEDED_EVENT,{request_url:t,ns_id:s.ns_id||null})},error:function(e){o&&o(e)}};l&&(c.subject_user=this.user.id),a?r.FormWebRequest(c):r.WebRequest(c)},e.REQUEST_SUCCEEDED_EVENT="db:sharing_api:request_succeeded",e})();t.SharingApi=s}),define("modules/clean/sharing/api/client",["require","exports","tslib","external/immutable","external/lodash","modules/clean/api_v2/error","modules/clean/api_v2/root_aware_client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/clean/viewer","modules/core/exception"],function(e,t,n,r,s,i,o,a,l,c,d,u,p){"use strict";function h(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.FilePolicy=a.FilePolicy,t.FolderPolicy=a.FolderPolicy,t.TeamSharingPolicies=a.TeamSharingPolicies,t.parseFolderPolicy=l.parseFolderPolicy;var m=(function(e){function t(t){var n=e.call(this)||this;return n.message=t,n.name="ShareError",n.stack=(new Error).stack,n}return n.__extends(t,e),t})(Error);t.ShareError=m;var _=(function(e){function t(t){var n=t.userId,r=t.isNonUserRelativeContext,s=e.call(this)||this;return null==r&&(r=!1),s.userId=n,r&&null==s.teamMemberId&&(s.teamMemberId=u.Viewer.get_viewer().work_user.team_member_id),s}return n.__extends(t,e),t.initClass=function(){this.prototype._getAccountBatchCache={},this.prototype._getCurrentAccountCache=null},t.prototype._getHeaders=function(e){return void 0===e&&(e=null),null!=this.teamMemberId&&(null===e&&(e={}),e["Dropbox-API-Select-Admin"]=this.teamMemberId),e},t.prototype._rpc=function(t,n,r){var s=this._getHeaders(r.headers);return e.prototype._rpc.call(this,t,n,{subjectUserId:r.subjectUserId,headers:s,flashError:!!r.flashError})},t.prototype.addMembers=function(e){e.contentId,e.members,e.accessLevel,e.customMessage,e.quiet;throw new TypeError("Not implemented")},t.prototype.addMembersWithAccessLevel=function(e){e.contentId,e.members,e.customMessage,e.quiet;throw new TypeError("Not implemented")},t.prototype.removeMember=function(e){e.contentId,e.memberId;throw new TypeError("Not implemented")},t.prototype.getMetadata=function(e){e.contentId,e.actions;throw new TypeError("Not implemented")},t.prototype.getMetadataInternal=function(e){e.contentId,e.actions;throw new TypeError("Not implemented")},t.prototype.getMetadataAlpha=function(e){e.contentId,e.actions;throw new TypeError("Not implemented")},t.prototype.listMembers=function(e){e.contentId,e.isAlpha;throw new TypeError("Not implemented")},t.prototype.listMembersContinue=function(e){e.cursor,e.isAlpha;throw new TypeError("Not implemented")},t.prototype.getMemberCounts=function(e){e.contentId;throw new TypeError("Not implemented")},t.prototype.getParentFolderAccess=function(e){e.contentId,e.memberId,e.accessLevel;throw new TypeError("Not implemented")},t.prototype.updateMember=function(e){e.contentId,e.memberId,e.accessLevel;throw new TypeError("Not implemented")},t.prototype.dismissInviteNotification=function(e){var t=e.contentId;return this.ns("sharing").rpc("dismiss_invite_notification",{content_id:t},{subjectUserId:this.userId})},t.prototype.getSharingPrefs=function(){return this.ns("users").rpc("get_sharing_prefs",void 0,{subjectUserId:this.userId}).then(l.sharingPrefsApiToRecord)},t.prototype.setSharingPrefs=function(e){return this.ns("users").rpc("set_sharing_prefs",e,{subjectUserId:this.userId})},t.prototype.claimMembership=function(e){var t=e.contentUrl;return this.ns("sharing").rpc("claim_membership",{content_url:t},{subjectUserId:this.userId})},t.prototype.checkJobStatus=function(e){var t=e.jobId;return this.ns("sharing").rpc("check_job_status",{async_job_id:t},{subjectUserId:this.userId})},t.prototype.getAccountBatch=function(e){var t=e.accountIds;return t.length>0?this.ns("users").rpc("get_account_batch",{account_ids:t},{subjectUserId:this.userId}).then(function(e){return e.map(l.accountInfoApiToRecord)}):Promise.resolve([])},t.prototype.getAccountBatchCached=function(e){var t=this,r=e.accountIds,i=this._getAccountBatchCache,o=Array.from(s.partition(r,function(e){return e in i})),a=o[0],l=o[1],c=s.values(s.pick(i,a));return this.getAccountBatch({accountIds:l}).then(function(e){var r=s.zipObject(e.map(function(e){return e.account_id}),e);return t._getAccountBatchCache=n.__assign({},i,r),e.concat(c)})},t.prototype.resetGetAccountBatchCache=function(){return this._getAccountBatchCache={}},t.prototype.getCurrentAccount=function(e){return this.ns("users").rpc("get_current_account",void 0,{subjectUserId:this.userId}).then(function(e){return l.fullAccountApiToRecord(e)})},t.prototype.getCurrentAccountCached=function(e){return null==this._getCurrentAccountCache&&(this._getCurrentAccountCache=this.getCurrentAccount()),this._getCurrentAccountCache},t.prototype.resetGetCurrentAccountCache=function(){return this._getCurrentAccountCache={}},t.prototype.requestAccess=function(e){var t=e.contentUrl,n=e.customMessage;return this.ns("sharing").rpc("request_access",{content_url:t,custom_message:n},{subjectUserId:this.userId})},t.prototype.sharedLinkInfo=function(e){var t=e.fileIdOrPath;return p.assert(null!=t,"an fqPath or fileId must be present to retrieve shared link info"),this.ns("sharing").rpc("alpha/list_shared_links",{path:t,direct_only:!0},{subjectUserId:this.userId}).then(function(e){return 0===e.links.length?null:l.linkMetadataApiToRecord(e.links[0])})},t.prototype.createSharedLink=function(e){var t=e.fileIdOrPath;return this.ns("sharing").rpc("alpha/create_shared_link_with_settings",{path:t},{subjectUserId:this.userId}).then(l.linkMetadataApiToRecord)},t.prototype.modifySharedLinkSettings=function(e){var t=e.url,n=e.settings,r=e.remove_expiration;return this.ns("sharing").rpc("alpha/modify_shared_link_settings",{url:t,settings:n,remove_expiration:r},{subjectUserId:this.userId}).then(l.linkMetadataApiToRecord)},t.prototype.revokeSharedLink=function(e){var t=e.url;return this.ns("sharing").rpc("revoke_shared_link",{url:t},{subjectUserId:this.userId})},t.prototype._addAccountsToMembership=function(e){return this._addAccountsToMembershipBatch(r.Map([[1,e]])).then(function(e){return e.get(1)})},t.prototype._addAccountsToMembershipBatch=function(e){var t=e.valueSeq().flatMap(function(e){return e.users.valueSeq()}).map(function(e){return e.memberId()}).toSet().toArray();return t.length>0?this.getAccountBatchCached({accountIds:t}).then(function(t){var n=r.Map(t.map(function(e){return[e.account_id,e]}));return e.map(function(e,t){return e.set("users",e.users.map(function(e){var t=n.get(e.account_id);return null!=t?e.set("account",t):e}))})}):Promise.resolve(e)},t})(o.UserActionsRootAwareClient);t.ShareApiClient=_,_.initClass();var f=(function(e){function t(t){var n=t.userId,r=t.isNonUserRelativeContext,s=e.call(this,{userId:n,isNonUserRelativeContext:r})||this;return s.getMetadata=s.getMetadata.bind(s),s.getMetadataInternal=s.getMetadataInternal.bind(s),s.getMetadataAlpha=s.getMetadataAlpha.bind(s),s.validateFqPath=s.validateFqPath.bind(s),s._promises={},s}return n.__extends(t,e),t.prototype.addMembers=function(e){e.contentId,e.members,e.accessLevel,e.customMessage,e.quiet;return this.createPromise("addMembers")},t.prototype.addMembersWithAccessLevel=function(e){e.contentId,e.members,e.customMessage,e.quiet;return this.createPromise("addMembersWithAccessLevel")},t.prototype.getMetadata=function(e){e.contentId,e.actions;return this.createPromise("getMetadata")},t.prototype.getMetadataInternal=function(e){e.contentId,e.actions;return this.createPromise("getMetadataInternal")},t.prototype.getMetadataAlpha=function(e){e.contentId,e.actions;return this.createPromise("getMetadataAlpha")},t.prototype.dismissInviteNotification=function(e){e.contentId,e.cursor;return this.createPromise("dismissInviteNotification")},t.prototype.getSharingPrefs=function(){return this.createPromise("getSharingPrefs")},t.prototype.listMembers=function(e){e.contentId,e.isAlpha;return this.createPromise("listMembers")},t.prototype.listMembersContinue=function(e){e.cursor,e.isAlpha;return this.createPromise("listMembersContinue")},t.prototype.getMemberCounts=function(e){e.contentId;return this.createPromise("getMemberCounts")},t.prototype.getParentFolderAccess=function(e){e.contentId,e.memberId,e.accessLevel;return this.createPromise("getParentFolderAccess")},t.prototype.removeMember=function(e){e.contentId,e.memberId;return this.createPromise("removeMember")},t.prototype.setLinkSettings=function(e){e.linkSettings,e.url;return this.createPromise("setLinkSettings")},t.prototype.share=function(e){e.fqPath,e.memberPolicy,e.aclUpdatePolicy,e.sharedLinkPolicy,e.forceAsync;return this.createPromise("share")},t.prototype.shareInternal=function(e){e.fqPath,e.folderPolicy,e.forceAsync,e.confidential;return this.createPromise("shareInternal")},t.prototype.requestAccess=function(e){e.contentUrl,e.customMessage;return this.createPromise("requestAccess")},t.prototype.sharedLinkInfo=function(e){e.fileIdOrPath;return this.createPromise("sharedLinkInfo")},t.prototype.transferContent=function(e){e.contentId,e.memberId;return this.createPromise("transferContent")},t.prototype.createSharedLink=function(e){e.fileIdOrPath;return this.createPromise("createSharedLink")},t.prototype.updateMember=function(){return this.createPromise("updateMember")},t.prototype.updatePolicyAlpha=function(){return this.createPromise("updatePolicyAlpha")},t.prototype.validateFqPath=function(e){e.fqPath,e.actions;return this.createPromise("validateFqPath")},t.prototype.getCurrentAccountCached=function(e){return this.createPromise("getCurrentAccountCached")},t.prototype.modifySharedLinkSettings=function(e){e.url,e.settings,e.remove_expiration;return this.createPromise("modifySharedLinkSettings")},t.prototype.revokeSharedLink=function(e){e.url;return this.createPromise("revokeSharedLink")},t.prototype.relinquishMembership=function(e){e.contentId,e.leaveACopy;return this.createPromise("relinquishMembership")},t.prototype.setConfidentiality=function(e){e.contentId,e.confidential;return this.createPromise("setConfidentiality")},t.prototype.createPromise=function(e){var t=this._promises[e];return t&&t.calledBeforeCreatePromise?(this._promises[e]=null,t.promise):(t={},t.promise=new Promise(function(e,n){return t.resolve=e,t.reject=n}),this._promises[e]=t,t.promise)},t.prototype.getPromise=function(e){return null!=this._promises[e]?this._promises[e].promise:void 0},t.prototype.resolvePromise=function(e,t,n){void 0===n&&(n=!1),this._promises[e]||this.createPromise(e);var r=this._promises[e];return r.calledBeforeCreatePromise=n,r.resolve.apply(null,t),r.promise},t.prototype.rejectPromise=function(e,t){this._promises[e]||this.createPromise(e);var n=this._promises[e];return n.reject.apply(null,t),n.promise},t})(_);t.MockShareApiClient=f;var g=(function(e){function t(t){var n=t.userId,r=t.isNonUserRelativeContext,s=e.call(this,{userId:n,
isNonUserRelativeContext:r})||this;return s.getMetadata=s.getMetadata.bind(s),s.getMetadataAlpha=s.getMetadataAlpha.bind(s),s.getMetadataBatchAlpha=s.getMetadataBatchAlpha.bind(s),s}return n.__extends(t,e),t.prototype.addMembers=function(e){var t=e.contentId,n=e.members,r=e.customMessage,s=void 0===r?null:r,i=e.quiet,o=void 0!==i&&i,a=e.accessLevel;null==a&&(a=c.ACCESS_LEVEL.READER);var d=l.accessLevelConstToApi(a);return 0===(null!=s?s.length:void 0)&&(s=null),this.ns("sharing").rpc("add_file_member",{file:t,members:n,custom_message:s,quiet:o,access_level:d},{subjectUserId:this.userId})},t.prototype.removeMember=function(e){var t=this,n=e.contentId,r=e.memberId;return this.ns("sharing").rpc("remove_file_member_2",{file:n,member:l.makeMemberSelector(r)},{subjectUserId:this.userId}).then(function(e){return l.memberAccessLevelApiToRecord(t.userId,e)})},t.prototype.getMetadata=function(e){var t=e.contentId,n=e.actions,r=void 0===n?[]:n;return this.ns("sharing").rpc("get_file_metadata",{file:t,actions:r},{subjectUserId:this.userId}).then(l.fileMetadataApiToRecord)},t.prototype.getMetadataAlpha=function(e){var t=e.contentId,n=e.actions,r=void 0===n?[]:n,s=e.sourceURL;return this.ns("sharing").rpc("alpha/get_file_metadata",{file:t,actions:r,url:s},{subjectUserId:this.userId}).then(l.fileMetadataApiToRecord)},t.prototype.getMetadataBatchAlpha=function(e){var t=e.contentIds,n=e.actions,r=void 0===n?[]:n;return this.ns("sharing").rpc("alpha/get_file_metadata/batch",{files:t,actions:r},{subjectUserId:this.userId}).then(function(e){return e.map(function(e){return l.fileMetadataApiToRecord(e.result)})})},t.prototype.listMembers=function(e){var t=e.contentId,n=e.url,r=void 0===n?null:n,s=e.limit,i=e.isAlpha,o=void 0!==i&&i,a=e.includeSeenState;null==s&&(s=100),null==a&&(a=!0);var c={file:t,actions:d.MEMBER_ACTION.ALL,include_inherited:!0,limit:s,url:o?r:void 0,include_seen_state:a},u=this.ns("sharing");return(o?u.rpc("alpha/list_file_members",c,{subjectUserId:this.userId}):u.rpc("list_file_members",c,{subjectUserId:this.userId})).then(l.membershipApiToRecord).then(this._addAccountsToMembership.bind(this))},t.prototype.listMembersContinue=function(e){var t=e.cursor,n=e.url,r=void 0===n?null:n,s=e.isAlpha,i=void 0!==s&&s,o={cursor:t,url:i?r:void 0},a=this.ns("sharing");return(i?a.rpc("alpha/list_file_members/continue",o,{subjectUserId:this.userId}):a.rpc("list_file_members/continue",o,{subjectUserId:this.userId})).then(function(e){return l.membershipApiToRecord(e,null)}).then(this._addAccountsToMembership.bind(this))},t.prototype.listMembersBatch=function(e){var t=e.contentIds,n=e.limit;return null==n&&(n=10),this.ns("sharing").rpc("list_file_members/batch",{files:t,limit:n},{subjectUserId:this.userId}).then(function(e){for(var t={},n=0,s=Array.from(e);n<s.length;n++){var i=s[n];"result"===i.result[".tag"]&&(t[i.file]=l.membershipApiToRecord(i.result.members,i.result.member_count))}return r.Map(t)}).then(this._addAccountsToMembershipBatch.bind(this))},t.prototype.getMemberCounts=function(e){var t=e.contentId,n=e.limit,r=e.countGroupsAsMembers,s=void 0!==r&&r,i=e.url,o=void 0===i?null:i,a=e.runViewerInfoChecks,l=void 0!==a&&a;return this.ns("sharing").rpc("get_file_member_counts",{file:t,limit:n,count_groups_as_members:s,url:o,run_viewer_info_checks:l},{subjectUserId:this.userId})},t.prototype.getParentFolderAccess=function(e){e.contentId,e.memberId,e.accessLevel;throw new m("Parent folder access points not implemented for files")},t.prototype.relinquishMembership=function(e){var t=e.contentId;return this.ns("sharing").rpc("relinquish_file_membership",{file:String(t)},{subjectUserId:this.userId})},t.prototype.listReceivedFiles=function(e){var t=e.limit,n=e.actions;return null==t&&(t=100),null==n&&(n=[]),this.ns("sharing").rpc("list_received_files",{limit:t,actions:n},{subjectUserId:this.userId}).then(l.listFilesResultApiToRecord)},t.prototype.listReceivedFilesContinue=function(e){var t=e.cursor;return this.ns("sharing").rpc("list_received_files/continue",{cursor:t},{subjectUserId:this.userId}).then(l.listFilesResultApiToRecord)},t.prototype.updateMember=function(e){var t=this,n=e.contentId,r=e.memberId,s=e.accessLevel;return this.ns("sharing").rpc("update_file_member",{file:String(n),member:l.makeMemberSelector(r),access_level:l.accessLevelConstToApi(s)},{subjectUserId:this.userId}).then(function(e){return l.memberAccessLevelApiToRecord(t.userId,e)})},t.prototype.updatePolicy=function(e){var t=e.contentId,n=e.newPolicy,r=e.actions,s=l.combinedPolicyDiffToApi(n);return s.actions=r,s.file=t,this.ns("sharing").rpc("alpha/update_file_policy",s,{subjectUserId:this.userId}).then(function(e){return null!=e.metadata&&(e=e.metadata),l.fileMetadataApiToRecord(e)})},t.prototype.unshare=function(e){var t=e.contentId;return this.ns("sharing").rpc("unshare_file",{file:String(t)},{subjectUserId:this.userId})},t})(_);t.FileShareApiClient=g;var y=(function(e){function t(t){var n=t.userId,r=t.isNonUserRelativeContext,s=e.call(this,{userId:n,isNonUserRelativeContext:r})||this;return s.getMetadata=s.getMetadata.bind(s),s.validateFqPath=s.validateFqPath.bind(s),s.updatePolicy=s.updatePolicy.bind(s),s.updatePolicyAlpha=s.updatePolicyAlpha.bind(s),s}return n.__extends(t,e),t.prototype.share=function(e){var t=this,n=e.fqPath,r=e.folderPolicy,s=e.confidential,o=void 0!==s&&s,a=e.checkFSWs,c=void 0!==a&&a,d=e.shouldSync,u=void 0===d?null:d,p=e.should_be_new_path,h=void 0===p?null:p,m=l.combinedPolicyDiffToApi(r);if(m.path=n,m.confidentiality=o?"confidential":"not_confidential",c&&(m.fsw_request="check"),null!==u){var _=u?"default":"not_synced";m.sync_setting=_}return null!==h&&(m.should_be_new_path=h),this.ns("sharing").rpc("alpha/share_folder",m,{subjectUserId:this.userId}).then(function(e){return("complete"===e[".tag"]?Promise.resolve(e):v(t.checkShareJobStatus.bind(t,{jobId:e.async_job_id}))).then(l.folderMetadataApiToRecord)}).catch(function(e){return e instanceof i.AppError&&e.error&&e.error.bad_path&&"already_shared"===e.error.bad_path[".tag"]?Promise.resolve(l.folderMetadataApiToRecord(e.error.bad_path)):Promise.reject(e)})},t.prototype.shareWithFsws=function(e){return this.share(n.__assign({},e,{checkFSWs:!0})).then(function(e){return{metadata:e}}).catch(i.catchApiError(function(e){var t=function(e,t){return e&&e[".tag"]&&e[".tag"]===t};if(e&&t(e.error,"bad_path")&&t(e.error.bad_path,"file_system_warnings"))return{fsws:e.error.bad_path.details};throw e}))},t.prototype.checkShareJobStatus=function(e){var t=e.jobId;return this.ns("sharing").rpc("check_share_internal_job_status",{async_job_id:t},{subjectUserId:this.userId})},t.prototype.checkRemoveMemberJobStatus=function(e){var t=e.jobId;return this.ns("sharing").rpc("check_remove_member_job_status",{async_job_id:t},{subjectUserId:this.userId})},t.prototype.addMembers=function(e){var t=e.contentId,n=e.members,r=e.accessLevel,s=e.customMessage,i=void 0===s?null:s,o=e.quiet,a=void 0!==o&&o,c=l.accessLevelConstToApi(r),d=Array.from(n).map(function(e){return{member:e,access_level:c}});return this.addMembersWithAccessLevel({contentId:t,members:d,customMessage:i,quiet:a})},t.prototype.addMembersWithAccessLevel=function(e){var t=e.contentId,n=e.members,r=e.customMessage,s=void 0===r?null:r,i=e.quiet,o=void 0!==i&&i;0===(null!=s?s.length:void 0)&&(s=null);var a={shared_folder_id:String(t),members:n,custom_message:s,quiet:o};return this.ns("sharing").rpc("add_folder_member",a,{subjectUserId:this.userId})},t.prototype.fetchNsId=function(e){return this.ns("files").rpc("get_metadata",{path:e},{subjectUserId:this.userId}).then(function(e){return null!=e.sharing_info?e.sharing_info.shared_folder_id:void 0})},t.prototype.getMetadata=function(e){var t=e.contentId,n=e.actions,r=void 0===n?[]:n;return this.ns("sharing").rpc("alpha/get_folder_metadata",{shared_folder_id:String(t),actions:r},{subjectUserId:this.userId}).then(l.folderMetadataApiToRecord)},t.prototype._metadataAndInheritMembers=function(e){var t=e.members_cursor;return t?this.listMembersContinue({cursor:t}).then(function(t){return{metadata:e,inheritedMembers:t}}):{metadata:e,inheritedMembers:new a.SharingMembership}},t.prototype.validateFqPath=function(e){var t=e.fqPath,n=e.actions,r=e.listMembersArg,s=e.shouldParseMetadataFromError,i=void 0!==s&&s,o=e.shareAsConfidential,a=void 0!==o&&o;null==n&&(n=[]),null==r&&(r={});var l=this.ns("sharing").rpc("validate_folder_path",{path:t,actions:n,list_members_arg:r,confidentiality:a?{".tag":"confidential"}:{".tag":"not_confidential"}},{subjectUserId:this.userId});return this.validatePathContinue(l,i)},t.prototype.validatePathContinue=function(e,t){return e.catch(i.catchApiError(function(e){if("already_shared"===h(null!=e.error?e.error.bad_path:void 0,function(e){return e[".tag"]}))return e.error.bad_path;if(t&&e instanceof i.AppError&&e.error&&"no_permission"===e.error[".tag"]&&l.hasFolderMetadataRecordInMetadata(e.error))return e.error;throw e})).then(l.folderMetadataApiToRecord).then(this._metadataAndInheritMembers.bind(this))},t.prototype.validateFolderPathBatch=function(e){var t=e.paths;return this.ns("sharing").rpc("validate_folder_path/batch",{paths:t},{subjectUserId:this.userId}).then(function(e){return e.entries.map(function(e){var t=e.result,n=null;"metadata"===t[".tag"]?n=t:"no_permission"===(null!=t.path_error?t.path_error[".tag"]:void 0)?n=t.path_error:"already_shared"===h(null!=t.path_error?t.path_error.bad_path:void 0,function(e){return e[".tag"]})&&(n=t.path_error.bad_path);var r=null;return n&&n.link_metadata&&(r=l.folderMetadataApiToRecord(n)),{path:e.path,metadata:r}})})},t.prototype.updatePolicy=function(e){var t=e.contentId,n=e.newPolicy,r=n;return r.shared_folder_id=String(t),this.ns("sharing").rpc("update_folder_policy",r,{subjectUserId:this.userId}).then(l.folderMetadataApiToRecord)},t.prototype.updatePolicyAlpha=function(e){var t=e.contentId,n=e.newPolicy,r=l.combinedPolicyDiffToApi(n);return r.shared_folder_id=String(t),this.ns("sharing").rpc("alpha/update_folder_policy",r,{subjectUserId:this.userId}).then(l.folderMetadataApiToRecord)},t.prototype.unshare=function(e){var t=this,n=e.contentId,r=e.leaveACopy,s=void 0!==r&&r;return this.ns("sharing").rpc("unshare_folder",{shared_folder_id:String(n),leave_a_copy:s},{subjectUserId:this.userId}).then(function(e){return"complete"===e[".tag"]?Promise.resolve(e):v(t.checkJobStatus.bind(t,{jobId:e.async_job_id}))})},t.prototype.listMembers=function(e){var t=e.contentId,n=e.limit;e.isAlpha;return null==n&&(n=100),this.ns("sharing").rpc("list_folder_members",{shared_folder_id:String(t),actions:d.MEMBER_ACTION.ALL,limit:n},{subjectUserId:this.userId}).then(l.membershipApiToRecord).then(this._addAccountsToMembership.bind(this))},t.prototype.listMembersContinue=function(e){var t=e.cursor;e.isAlpha;return this.ns("sharing").rpc("list_folder_members/continue",{cursor:t},{subjectUserId:this.userId}).then(function(e){return l.membershipApiToRecord(e,null)}).then(this._addAccountsToMembership.bind(this))},t.prototype.listMountableFolders=function(e){var t=void 0===e?{}:e,n=t.limit,r=t.actions;return null==n&&(n=100),null==r&&(r=[]),this.ns("sharing").rpc("list_mountable_folders",{limit:n,actions:r},{subjectUserId:this.userId}).then(l.listFoldersResultApiToRecord)},t.prototype.listMountableFoldersContinue=function(e){var t=e.cursor;return this.ns("sharing").rpc("list_mountable_folders/continue",{cursor:t},{subjectUserId:this.userId}).then(l.listFoldersResultApiToRecord)},t.prototype.listMountableFoldersAlpha=function(e){var t=void 0===e?{}:e,n=t.limit,r=t.actions,s=t.show_mounted;return null==n&&(n=100),null==r&&(r=[]),this.ns("sharing").rpc("alpha/list_mountable_folders",{limit:n,actions:r,show_mounted:s},{subjectUserId:this.userId}).then(l.listFoldersResultApiToRecord)},t.prototype.listMountableFoldersContinueAlpha=function(e){var t=e.cursor;return this.ns("sharing").rpc("alpha/list_mountable_folders/continue",{cursor:t},{subjectUserId:this.userId}).then(l.listFoldersResultApiToRecord)},t.prototype.getMemberCounts=function(e){var t=e.contentId;return this.ns("sharing").rpc("get_folder_member_counts",{shared_folder_id:String(t)},{subjectUserId:this.userId}).then(l.memberCountsApiToRecord)},t.prototype.getParentFolderAccess=function(e){var t=e.contentId,n=e.memberId,r=e.accessLevel;return this.ns("sharing").rpc("get_parent_folder_access",{shared_folder_id:String(t),member:l.makeMemberSelector(n),access_level:null!=r?l.accessLevelConstToApi(r):void 0},{subjectUserId:this.userId}).then(l.memberAccessLevelApiToRecord.bind(null,this.userId))},t.prototype.relinquishMembership=function(e){var t=this,n=e.contentId,r=e.leaveACopy,s=void 0!==r&&r;return this.ns("sharing").rpc("relinquish_folder_membership",{shared_folder_id:String(n),leave_a_copy:s},{subjectUserId:this.userId}).then(function(e){return"complete"===e[".tag"]?Promise.resolve():v(t.checkJobStatus.bind(t,{jobId:e.async_job_id}))})},t.prototype.removeMember=function(e){var t=this,n=e.contentId,r=e.memberId,s=e.leaveACopy,i=void 0!==s&&s;return this.ns("sharing").rpc("remove_folder_member",{shared_folder_id:String(n),member:l.makeMemberSelector(r),leave_a_copy:i},{subjectUserId:this.userId}).then(function(e){return"complete"===e[".tag"]?Promise.resolve(e):v(t.checkRemoveMemberJobStatus.bind(t,{jobId:e.async_job_id}))}).then(function(e){return l.memberAccessLevelApiToRecord(t.userId,e)})},t.prototype.transferContent=function(e){var t=e.contentId,n=e.memberId;return this.ns("sharing").rpc("transfer_folder",{shared_folder_id:String(t),to_dropbox_id:n},{subjectUserId:this.userId})},t.prototype.updateMember=function(e){var t=this,n=e.contentId,r=e.memberId,s=e.accessLevel;return this.ns("sharing").rpc("update_folder_member",{shared_folder_id:String(n),member:l.makeMemberSelector(r),access_level:l.accessLevelConstToApi(s)},{subjectUserId:this.userId}).then(function(e){return l.memberAccessLevelApiToRecord(t.userId,e)})},t.prototype.mount=function(e){var t=e.contentId;return this.ns("sharing").rpc("mount_folder",{shared_folder_id:String(t)},{subjectUserId:this.userId}).then(l.folderMetadataApiToRecord)},t.prototype.unmount=function(e){var t=e.contentId;return this.ns("sharing").rpc("unmount_folder",{shared_folder_id:String(t)},{subjectUserId:this.userId})},t.prototype.setConfidentiality=function(e){var t=this,n=e.contentId,r=e.confidential;return this.ns("sharing").rpc("set_confidentiality",{shared_folder_id:String(n),confidentiality:r?{".tag":"confidential"}:{".tag":"not_confidential"}},{subjectUserId:this.userId}).then(function(e){return"complete"===e[".tag"]?Promise.resolve(e):v(t.checkShareJobStatus.bind(t,{jobId:e.async_job_id}))}).then(l.folderMetadataApiToRecord)},t})(_);t.FolderShareApiClient=y;var v=function(e,t){var n=1e3,r=null;t&&t.interval&&(n=t.interval),t&&t.timeout&&(r=t.timeout);var s=null!=r?Date.now()+r:null,o=function(t,r){return null!=s&&Date.now()>s?r():e().then(function(e){switch(e[".tag"]){case"failed":return r(e);case"complete":return t(e);case"in_progress":return window.setTimeout(o,n,t,r)}}).catch(i.catchApiError(function(e){return r(e)}))};return new Promise(o)}}),define("modules/clean/sharing/api/types/metadata",["require","exports","tslib","external/immutable","modules/clean/api_v2/types"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemberPolicy={team:new s.UnionScalar("team"),anyone:new s.UnionScalar("anyone")},t.AclUpdatePolicy={owner:new s.UnionScalar("owner"),editors:new s.UnionScalar("editors")},t.SharedLinkPolicy={anyone:new s.UnionScalar("anyone"),members:new s.UnionScalar("members")},t.SharedFolderMemberMemberPolicy={team:new s.UnionScalar("team"),anyone:new s.UnionScalar("anyone")},t.SharedFolderJoinPolicy={from_team_only:new s.UnionScalar("from_team_only"),from_anyone:new s.UnionScalar("from_anyone")},t.SharedLinkCreatePolicy={default_public:new s.UnionScalar("default_public"),default_team_only:new s.UnionScalar("default_team_only"),team_only:new s.UnionScalar("team_only")},t.RequestedVisibilityPolicy={policy_name:"requested_visibility",password:"password",public:"public",team_only:"team_only"},t.ResolvedVisibilityPolicy={policy_name:"resolved_visibility",only_you:"only_you",password:"password",public:"public",shared_folder_only:"shared_folder_only",team_and_password:"team_and_password",team_only:"team_only"},t.VisibilityDisallowedReason={delete_and_recreate:"delete_and_recreate",restricted_by_shared_folder:"restricted_by_shared_folder",restricted_by_team:"restricted_by_team",user_account_type:"user_account_type",user_not_on_team:"user_not_on_team",permission_denied:"permission_denied"},t.LinkExpiryPolicy={policy_name:"expires"},t.ViewerInfoPolicy={policy_name:"viewer_info_policy",enabled:"enabled",disabled:"disabled"},t.DownloadPolicy={policy_name:"download_policy",allow:"allow",disallow:"disallow"},t.LinkAudience={public:"public",team:"team",members:"members",default_on:"default_on"},t.GroupManagementType={user_managed:new s.UnionScalar("user_managed"),company_managed:new s.UnionScalar("company_managed"),system_managed:new s.UnionScalar("system_managed")};var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({id:null,name:null},"Team"));t.Team=i;var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({display_name:null,member_id:null,team_info:null},"TeamMemberInfo"));t.TeamMemberInfo=o;var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({id:null,name:null,sharing_policies:null},"FullTeam"));t.FullTeam=a;var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({shared_folder_member_policy:null,shared_folder_join_policy:null,shared_link_create_policy:null},"TeamSharingPolicies"));t.TeamSharingPolicies=l;var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,is_teammate:!1,profile_photo_url:null,surname:null,team_member_id:null},"BasicAccount"));t.BasicAccount=c;var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,profile_photo_url:null,surname:null,team:null,team_member_id:null},"FullAccount"));t.FullAccount=d;var u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({allow:!1,reason:null},"PermissionSetting"));t.PermissionSetting=u;var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.contentId=function(){return this.shared_folder_id||this.path_lower},t.prototype.isSharedFolder=function(){return Boolean(this.shared_folder_id)},t.prototype.isNewSharedFolder=function(){return!this.shared_folder_id},t})(r.Record({access_type:null,is_confidential:!1,is_inside_team_folder:!1,is_team_folder:!1,link_metadata:null,members_cursor:null,name:null,owner_team:null,parent_shared_folder_id:null,path_lower:null,permissions:null,policy:null,preview_url:null,shared_folder_id:null,time_invited:null},"SharedFolderMetadata"));t.SharedFolderMetadata=p;var h=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({acl_update_policy:null,download_policy:null,member_policy:null,viewer_info_policy:null,resolved_member_policy:null,shared_link_policy:null},"FolderPolicy"));t.FolderPolicy=h;var m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({acl_update_policy:null,download_policy:null,member_policy:null,viewer_info_policy:null,shared_link_policy:null,audience:null,access_level:null,expiry:null,password:null},"CombinedPolicy"));t.CombinedPolicy=m;var _=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({change_options:null,disable_viewer_info:null,edit_contents:null,enable_viewer_info:null,invite_editor:null,invite_viewer:null,invite_viewer_no_comment:null,leave_a_copy:null,relinquish_membership:null,remove_download_policy:null,set_download_policy:null,update_confidentiality:null,unmount:null,unshare:null},"FolderPermissions"));t.FolderPermissions=_;var f=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({entries:r.Map(),cursor:null},"ListFoldersResult"));t.ListFoldersResult=f;var g=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.contentId=function(){return this.id},t.prototype.isSharedFolder=function(){return!1},t.prototype.isNewSharedFolder=function(){return!1},t})(r.Record({access_type:null,id:null,file_policy:null,link_metadata:null,name:null,owner_team:null,policy:null,parent_shared_folder_id:null,path_display:null,path_lower:null,permissions:null,preview_url:null,time_invited:null},"SharedFileMetadata"));t.SharedFileMetadata=g;var y=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({change_options:null,disable_viewer_info:null,edit_contents:null,enable_viewer_info:null,invite_viewer:null,invite_viewer_no_comment:null,relinquish_membership:null,remove_download_policy:null,set_download_policy:null,unshare:null,view_members:null},"FilePermissions"));t.FilePermissions=y;var v=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({audience:null,download_policy:null,viewer_info_policy:null},"FilePolicy"));t.FilePolicy=v;var S=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({entries:r.Map(),cursor:null},"ListFilesResult"));t.ListFilesResult=S;var E=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getMemberCount=function(){return this.memberCount||this.invitees.count()+this.groups.count()+this.users.count()},t})(r.Record({cursor:null,invitees:r.Map(),groups:r.Map(),users:r.Map(),memberCount:null},"SharingMembership"));t.SharingMembership=E,t.makeMemberKey=function(e,t){return e+":"+t};var b=(function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(r,e),r.prototype.memberId=function(){return this.account_id},r.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},r.prototype.displayName=function(){return this.account?this.account.display_name:void 0},r.prototype.contactId=function(){return this.account_id},r.prototype.contactType=function(){return"dropbox_id"},r.prototype.type=function(){return"users"},r})(r.Record({access_type:null,account:null,account_id:null,initials:null,is_inherited:!1,permissions:null,same_team:null,team_member_id:null,time_last_seen:null},"UserMembershipInfo"));t.UserMembershipInfo=b;var I=(function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(r,e),r.prototype.memberId=function(){return this.contact_type+":"+this.contact},r.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},r.prototype.displayName=function(){return this.contact},r.prototype.contactId=function(){return this.contact},r.prototype.contactType=function(){return"email"},r.prototype.type=function(){return"invitees"},r})(r.Record({access_type:null,contact:null,contact_type:null,initials:!1,is_inherited:null,permissions:null,same_team:null},"InviteeMembershipInfo"));t.InviteeMembershipInfo=I;var T=(function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(r,e),r.prototype.memberId=function(){return this.group_id},r.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},r.prototype.displayName=function(){return this.group_name},r.prototype.contactId=function(){return this.group_id},r.prototype.contactType=function(){return"dropbox_id"},r.prototype.type=function(){return"groups"},r})(r.Record({access_type:null,group_external_id:null,group_id:null,group_management_type:null,group_name:null,group_type:null,initials:null,is_inherited:!1,is_member:!1,is_owner:!1,member_count:null,permissions:null,same_team:!0},"GroupMembershipInfo"));t.GroupMembershipInfo=T;var C=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({leave_a_copy:null,make_editor:null,make_owner:null,make_viewer:null,make_viewer_no_comment:null,remove:null},"MemberPermissions"));t.MemberPermissions=C;var w=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({total_unique_users:null,users_outside_team:null,exceeds_count:!1},"MemberCounts"));t.MemberCounts=w;var A=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({access_level:null,warning:null,parentFolders:null},"MemberAccessLevelResult"));t.MemberAccessLevelResult=A;var M=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({name:null,shared_folder_id:null,path:null,permissions:null},"ParentFolderInfo"));t.ParentFolderInfo=M;var k=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.isFolder=function(){return"folder"===this.file_type},t.prototype.teamInfo=function(){return this.content_owner_team_info?this.content_owner_team_info:this.team_member_info?this.team_member_info.team_info:void 0},t})(r.Record({url:null,client_modified:null,content_owner_team_info:null,expires:null,file_type:null,id:null,link_permissions:null,name:null,path_lower:null,rev:null,server_modified:null,size:null,team_member_info:null,preview_type:null},"LinkMetadata"));t.LinkMetadata=k;var N=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({requested_visibility:null,link_password:null,expires:null,allow_download:null},"LinkPolicy"));t.LinkPolicy=N;var P=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({allow_comments:null,can_revoke:null,allow_download:null,can_allow_download:null,can_disallow_download:null,can_set_expiry:null,can_remove_expiry:null,requested_visibility:null,resolved_visibility:null,restricting_shared_folder_path:null,revoke_failure_reason:null,team_restricts_comments:null,visibility_policies:null},"LinkPermissions"));t.LinkPermissions=P;var L=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({policy:null,resolved_policy:null,allowed:null,disallowed_reason:null},"LinkVisibilityPolicy"));t.LinkVisibilityPolicy=L;var R=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({access_reader_no_comment_content_links:null,access_reader_no_comment_shared_folders:null},"SharingPrefs"));t.SharingPrefs=R;var O=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({change_audience:null,remove_expiry:null,remove_password:null,set_expiry:null,set_password:null},"SharedContentLinkPermissions"));t.SharedContentLinkPermissions=O;var F=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({shared_folder_id:null,name:null,audience:null},"AudienceRestrictingSharedFolder"));t.AudienceRestrictingSharedFolder=F;var D=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({audience_options:null,current_audience:null,expiry:null,link_permissions:null,password_protected:null,url:null,audience_restricting_shared_folder:null,access_level:null},"SharedContentLinkMetadata"));t.SharedContentLinkMetadata=D;var x=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({audience:null,remove_expiry:null,set_expiry:null,remove_password:null,set_password:null,access_level:null},"SharedContentLinkSettings"));t.SharedContentLinkSettings=x}),define("modules/clean/sharing/api/util/types",["require","exports","tslib","modules/clean/contacts/types","external/immutable","modules/clean/api_v2/types","modules/clean/sharing/access_level","modules/clean/sharing/link_info","modules/clean/sharing/api/types/metadata"],function(e,t,n,r,s,i,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.accessLevelConstToApi=function(e){switch(e){case o.ACCESS_LEVEL.OWNER:return new i.UnionScalar("owner");case o.ACCESS_LEVEL.WRITER:return new i.UnionScalar("editor");case o.ACCESS_LEVEL.READER:return new i.UnionScalar("viewer");case o.ACCESS_LEVEL.READER_NO_COMMENT:return new i.UnionScalar("viewer_no_comment");default:throw new Error("unknown access level: "+e)}},t.accessLevelApiToConst=function(e){switch(e.type||e){case"owner":return o.ACCESS_LEVEL.OWNER;case"editor":return o.ACCESS_LEVEL.WRITER;case"viewer":return o.ACCESS_LEVEL.READER;case"viewer_no_comment":return o.ACCESS_LEVEL.READER_NO_COMMENT}},t.groupManagementTypeApiToConst=function(e){if(!e)return null;switch(e[".tag"]){case"user_managed":return l.GroupManagementType.user_managed;case"company_managed":return l.GroupManagementType.company_managed;case"system_managed":return l.GroupManagementType.system_managed;default:return}},t.hasFolderMetadataRecordInMetadata=function(e){return null!=e.path_lower&&null!=e.access_type&&null!=e.policy},t.folderPolicyApiToRecord=function(e){return null==e?new l.FolderPolicy:new l.FolderPolicy({acl_update_policy:e.acl_update_policy&&e.acl_update_policy[".tag"],download_policy:e.download_policy&&e.download_policy[".tag"],member_policy:e.member_policy&&e.member_policy[".tag"],resolved_member_policy:e.resolved_member_policy&&e.resolved_member_policy[".tag"],shared_link_policy:e.shared_link_policy&&e.shared_link_policy[".tag"],viewer_info_policy:e.viewer_info_policy&&e.viewer_info_policy[".tag"]})};var c=function(e){for(var t={},n=0,r=e;n<r.length;n++){var s=r[n];t[s.action[".tag"]]=new l.PermissionSetting({allow:s.allow,reason:s.reason?s.reason[".tag"]:void 0})}return t};t.sharedContentLinkPermissionsApiToRecord=function(e){var t=c(e);return new l.SharedContentLinkPermissions(t)},t.audienceRestrictingSharedFolderToRecord=function(e){return new l.AudienceRestrictingSharedFolder({shared_folder_id:e.shared_folder_id,name:e.name,audience:e.audience[".tag"]})},t.sharedContentLinkMetadataToRecord=function(e){return new l.SharedContentLinkMetadata({audience_options:s.List(e.audience_options.map(function(e){return e[".tag"]})),current_audience:e.current_audience[".tag"],expiry:e.expiry&&new Date(e.expiry)>new Date?new Date(e.expiry):void 0,link_permissions:t.sharedContentLinkPermissionsApiToRecord(e.link_permissions),password_protected:e.password_protected,url:e.url,audience_restricting_shared_folder:e.audience_restricting_shared_folder&&t.audienceRestrictingSharedFolderToRecord(e.audience_restricting_shared_folder),access_level:e.access_level&&e.access_level[".tag"]})},t.parseFolderPolicy=t.folderPolicyApiToRecord,t.folderPermissionsApiToRecord=function(e){var t=c(e);return new l.FolderPermissions(t)},t.folderMetadataApiToRecord=function(e){return new l.SharedFolderMetadata({access_type:t.accessLevelApiToConst(i.Union.parse(e.access_type)),is_inside_team_folder:e.is_inside_team_folder,is_team_folder:e.is_team_folder,link_metadata:null!=e.link_metadata?t.sharedContentLinkMetadataToRecord(e.link_metadata):void 0,members_cursor:e.members_cursor,name:e.name,owner_team:null!=e.owner_team?new l.Team(e.owner_team):void 0,parent_shared_folder_id:e.parent_shared_folder_id,path_lower:e.path_lower,
permissions:null!=e.permissions?t.folderPermissionsApiToRecord(e.permissions):void 0,policy:t.parseFolderPolicy(e.policy),preview_url:e.preview_url,shared_folder_id:e.shared_folder_id,time_invited:null!=e.time_invited?new Date(e.time_invited):void 0,is_confidential:null!=e.is_confidential?e.is_confidential:void 0})},t.listFoldersResultApiToRecord=function(e){return new l.ListFoldersResult({entries:s.Map(e.entries.map(t.folderMetadataApiToRecord).map(function(e){return[e.shared_folder_id,e]})),cursor:e.cursor})},t.filePermissionsApiToRecord=function(e){var t={};if(e)for(var n=0,r=e;n<r.length;n++){var s=r[n];t[s.action[".tag"]]=new l.PermissionSetting({allow:s.allow,reason:s.reason&&s.reason[".tag"]})}return new l.FilePermissions(t)},t.getFilePolicy=function(e){var t={};return t[l.ViewerInfoPolicy.policy_name]=e&&e.viewer_info_policy&&e.viewer_info_policy[".tag"],t[l.DownloadPolicy.policy_name]=e&&e.download_policy&&e.download_policy[".tag"]||l.DownloadPolicy.allow,new l.FilePolicy(t)},t.fileMetadataApiToRecord=function(e){return new l.SharedFileMetadata({access_type:null!=e.access_type?t.accessLevelApiToConst(i.Union.parse(e.access_type)):o.ACCESS_LEVEL.READER,id:e.id,file_policy:t.getFilePolicy(e.policy),link_metadata:e.link_metadata&&t.sharedContentLinkMetadataToRecord(e.link_metadata),name:e.name,owner_team:e.owner_team&&new l.Team(e.owner_team),policy:null!=e.policy?t.parseFolderPolicy(e.policy):new l.FolderPolicy,parent_shared_folder_id:e.parent_shared_folder_id,path_display:e.path_display,path_lower:e.path_lower,permissions:t.filePermissionsApiToRecord(e.permissions),preview_url:e.preview_url,time_invited:e.time_invited&&new Date(e.time_invited)})},t.listFilesResultApiToRecord=function(e){return new l.ListFilesResult({entries:s.Map(e.entries.map(function(e){return[e.id,t.fileMetadataApiToRecord(e)]})),cursor:e.cursor})},t.memberPermissionsApiToRecord=function(e){var t={};if(null!=e)for(var n=0,r=e;n<r.length;n++){var s=r[n];t[s.action[".tag"]]=new l.PermissionSetting({allow:s.allow,reason:s.reason&&s.reason[".tag"]})}return new l.MemberPermissions(t)},t.inviteeMembershipApiToRecord=function(e){var n=e.invitee[".tag"];return new l.InviteeMembershipInfo({access_type:t.accessLevelApiToConst(i.Union.parse(e.access_type)),contact:e.invitee[n],contact_type:n,initials:e.initials,is_inherited:e.is_inherited,permissions:t.memberPermissionsApiToRecord(e.permissions),same_team:Boolean(e.user&&e.user.same_team)})},t.groupMembershipApiToRecord=function(e){return new l.GroupMembershipInfo({access_type:t.accessLevelApiToConst(i.Union.parse(e.access_type)),group_external_id:e.group.group_external_id,group_id:e.group.group_id,group_management_type:t.groupManagementTypeApiToConst(e.group.group_management_type),group_name:e.group.group_name,group_type:e.group.group_type[".tag"],initials:e.initials,is_inherited:e.is_inherited,is_member:e.group.is_member,is_owner:e.group.is_owner,member_count:e.group.member_count,permissions:t.memberPermissionsApiToRecord(e.permissions),same_team:e.group.same_team})},t.userMembershipApiToRecord=function(e){return new l.UserMembershipInfo({access_type:t.accessLevelApiToConst(i.Union.parse(e.access_type)),account_id:e.user.account_id,initials:e.initials,is_inherited:e.is_inherited,permissions:t.memberPermissionsApiToRecord(e.permissions),same_team:e.user.same_team,team_member_id:e.user.team_member_id,time_last_seen:e.time_last_seen&&new Date(e.time_last_seen)})},t.membershipApiToRecord=function(e,n){return void 0===n&&(n=null),new l.SharingMembership({cursor:e.cursor,invitees:s.Map(e.invitees.map(function(e){var n=t.inviteeMembershipApiToRecord(e);return[n.memberKey(),n]})),groups:s.Map(e.groups.map(function(e){var n=t.groupMembershipApiToRecord(e);return[n.memberKey(),n]})),users:s.Map(e.users.map(function(e){var n=t.userMembershipApiToRecord(e);return[n.memberKey(),n]})),memberCount:n})},t.memberCountsApiToRecord=function(e){return new l.MemberCounts(e)},t.parentFolderInfoApiToRecord=function(e){return new l.ParentFolderInfo({name:e.folder_name,shared_folder_id:e.shared_folder_id,path:e.path,permissions:t.memberPermissionsApiToRecord(e.permissions)})},t.memberAccessLevelApiToRecord=function(e,n){if(null==n)return new l.MemberAccessLevelResult;var r;return null!=n.access_details&&(r=n.access_details.map(function(e){return t.parentFolderInfoApiToRecord(e)})),new l.MemberAccessLevelResult({access_level:n.access_level&&t.accessLevelApiToConst(i.Union.parse(n.access_level)),warning:n.warning,parentFolders:r})},t.teamMemberInfoApiToRecord=function(e){return null==e?null:new l.TeamMemberInfo({display_name:e.display_name,member_id:e.member_id,team_info:e.team_info&&new l.Team(e.team_info)})},t.visibilityPolicyApiToRecord=function(e){return new l.LinkVisibilityPolicy({policy:e.policy&&e.policy[".tag"],resolved_policy:e.resolved_policy&&e.resolved_policy[".tag"],allowed:e.allowed,disallowed_reason:e.disallowed_reason&&e.disallowed_reason[".tag"]})},t.linkPermissionsApiToRecord=function(e){return null==e?new l.LinkPermissions:new l.LinkPermissions({allow_download:e.allow_download,allow_comments:e.allow_comments,can_allow_download:e.can_allow_download,can_disallow_download:e.can_disallow_download,can_revoke:e.can_revoke,can_set_expiry:e.can_set_expiry,can_remove_expiry:e.can_remove_expiry,requested_visibility:e.requested_visibility&&e.requested_visibility[".tag"],resolved_visibility:e.resolved_visibility&&e.resolved_visibility[".tag"],restricting_shared_folder_path:e.restricting_shared_folder_path,revoke_failure_reason:e.revoke_failure_reason&&e.revoke_failure_reason[".tag"],team_restricts_comments:e.team_restricts_comments,visibility_policies:e.visibility_policies&&e.visibility_policies.map(t.visibilityPolicyApiToRecord)})},t.linkMetadataApiToRecord=function(e){return new l.LinkMetadata({url:e.url,client_modified:e.client_modified&&new Date(e.client_modified),content_owner_team_info:e.content_owner_team_info&&new l.Team(e.content_owner_team_info),expires:e.expires&&new Date(e.expires),file_type:e[".tag"],id:e.id,link_permissions:t.linkPermissionsApiToRecord(e.link_permissions),name:e.name,path_lower:e.path_lower,rev:e.rev,server_modified:e.server_modified&&new Date(e.server_modified),size:e.size,team_member_info:t.teamMemberInfoApiToRecord(e.team_member_info),preview_type:e.preview_type})},t.accountInfoApiToRecord=function(e){return new l.BasicAccount({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,is_teammate:e.is_teammate,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id})},t.teamSharingPoliciesApiToRecord=function(e){return e&&new l.TeamSharingPolicies({shared_folder_member_policy:e.shared_folder_member_policy&&e.shared_folder_member_policy[".tag"],shared_folder_join_policy:e.shared_folder_join_policy&&e.shared_folder_join_policy[".tag"],shared_link_create_policy:e.shared_link_create_policy&&e.shared_link_create_policy[".tag"]})},t.fullAccountApiToRecord=function(e){var n=e.team&&new l.FullTeam({id:e.team.id,name:e.team.name,sharing_policies:t.teamSharingPoliciesApiToRecord(e.team.sharing_policies)});return new l.FullAccount({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id,team:n})},t.sharingPrefsApiToRecord=function(e){return new l.SharingPrefs({access_reader_no_comment_content_links:e.access_reader_no_comment_content_links,access_reader_no_comment_shared_folders:e.access_reader_no_comment_shared_folders})},t.makeMemberSelector=function(e){return e.startsWith("email:")?new i.UnionScalar("email",e.substr(6)):new i.UnionScalar("dropbox_id",e)},t.parseSharedLinkMetadata=function(e){if(null==e)return null;var t=i.Union.parse(e.link_permissions.resolved_visibility).type,r=null!=e.team_member_info?{teamId:e.team_member_info.team_info.id,teamName:e.team_member_info.team_info.name}:{teamId:null,teamName:null},s={isFolder:"folder"===e[".tag"],url:e.url,name:e.name,expires:e.expires&&new Date(e.expires),visibility:t,isPackage:e.is_package};return new a.LinkInfo(n.__assign({},s,r))},t.contactsToMembers=function(e){return e.map(function(e){if(e.type===r.NEW_STYLE_GROUP)return new i.UnionScalar("dropbox_id",e.getContactID());if(e.type!==r.INVALID_ID)return new i.UnionScalar("email",e.getContactID());throw new Error("Unknown contact type")})},t.createUnionScalar=function(e,t){return new i.UnionScalar(e,t)},t.getCombinedPolicy=function(e,t){return new l.CombinedPolicy({acl_update_policy:e instanceof l.FolderPolicy?e.acl_update_policy:void 0,download_policy:e.download_policy||"allow",member_policy:e instanceof l.FolderPolicy?e.resolved_member_policy:void 0,viewer_info_policy:e.viewer_info_policy,shared_link_policy:e instanceof l.FolderPolicy?e.shared_link_policy:void 0,audience:t&&t.current_audience,access_level:t&&t.access_level,expiry:{status:t&&t.expiry?"on":"off",value:t&&t.expiry||""},password:{status:t&&t.password_protected?"on":"off"}})},t.combinedPolicyDiffToApi=function(e){var t={};if(!e)return t;null!=e.acl_update_policy&&(t.acl_update_policy=e.acl_update_policy),null!=e.download_policy&&(t.download_policy=e.download_policy),null!=e.member_policy&&(t.member_policy=e.member_policy),null!=e.viewer_info_policy&&(t.viewer_info_policy=e.viewer_info_policy),null!=e.shared_link_policy&&(t.shared_link_policy=e.shared_link_policy);var n={};if(null!=e.audience&&(n.audience=new i.UnionScalar(e.audience)),null!=e.access_level&&(n.access_level=new i.UnionScalar(e.access_level)),null!=e.expiry){var r=e.expiry;if("on"===r.status&&r.value)r.value.setHours(23),r.value.setMinutes(59),r.value.setSeconds(59),n.expiry=new i.UnionScalar("set_expiry",i.formatTimestamp(r.value)).toJSON();else{if("off"!==r.status)throw new Error("Bad expiry settings");n.expiry=new i.UnionScalar("remove_expiry").toJSON()}}if(null!=e.password){var s=e.password;"on"===s.status&&s.value?n.password=new i.UnionScalar("set_password",s.value).toJSON():"off"===s.status&&(n.password=new i.UnionScalar("remove_password").toJSON())}return Object.keys(n).length>0&&(t.link_settings=n),t}}),define("modules/clean/sharing/components/button_group",["require","exports","tslib","external/spectrum/button","external/react","modules/clean/react/css"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this;return s.createElement("div",{className:"sharing-button-group"},this.props.options.map(function(t){var n=t.value,i=t.label,o=n===e.props.value;return s.createElement(r.Button,{key:n,variant:o?"primary":"secondary",onClick:function(){return e.props.onSelectValue(n)},disabled:o},i)}))},t})(s.Component);t.ButtonGroup=i(o,["/static/css/sharing/components-vflrV8W4h.css"])}),define("modules/clean/sharing/confirmation_modals/confirm_with_option_modal",["require","exports","tslib","external/react","modules/clean/react/modal"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(t){var n=e.call(this,t)||this;if(null==n.props.children)throw new Error("Must have children prop");return n.state={checked:!1},n.handleOptionClick=n.handleOptionClick.bind(n),n.handleAccept=n.handleAccept.bind(n),n.handleDismissCompleted=n.handleDismissCompleted.bind(n),n}return n.__extends(t,e),t.prototype.render=function(){return r.createElement(s.Modal,{acceptButtonText:this.props.confirmText,autoClose:this.props.autoClose,className:"simple-modal confirm-with-option-modal",dismissButtonText:this.props.cancelText,onAccept:this.handleAccept,onDismissCompleted:this.handleDismissCompleted,title:this.props.title},r.createElement("div",{className:"simple-modal-content"},r.createElement("div",{className:"confirm-with-option-modal__body-text"},this.props.children),this.renderOption()))},t.prototype.renderOption=function(){return this.props.showOption?r.createElement("div",{className:"u-mar-vertical-s confirm-with-option-modal__option"},r.createElement("input",{"aria-checked":this.state.checked,checked:this.state.checked,className:"confirm-with-option-modal__option-input",id:"confirm-with-option-modal__input",name:"confirmation_option",onClick:this.handleOptionClick,role:"checkbox",type:"checkbox"}),r.createElement("label",{className:"confirm-with-option-modal__option-label",htmlFor:"confirm-with-option-modal__input"},this.props.optionLabel)):null},t.prototype.handleOptionClick=function(){this.setState({checked:!this.state.checked})},t.prototype.handleAccept=function(){this.props.onConfirm&&this.props.onConfirm(this.state.checked)},t.prototype.handleDismissCompleted=function(){this.props.onCancel&&this.props.onCancel(this.state.checked)},t})(r.Component);t.ConfirmWithOptionModal=i}),define("modules/clean/sharing/confirmation_modals/member_access_change_confirmation_modal",["require","exports","external/react","modules/clean/em_string","modules/clean/react_format","modules/clean/sharing/confirmation_modals/confirm_with_option_modal","modules/clean/sharing/constants","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=l.i18n_default_project("sharing")._,d=function(e,t,l,d,u,p,h,m,_){void 0===e&&(e=""),void 0===u&&(u=!1),void 0===m&&(m=!1);var f,g,y,v=r.Emstring.em_snippet(e,40),S=null;return t===o.MEMBER_ACTION.REMOVE?(y=c("Remove access for %(name)s?").format({name:v}),l?(f=d&&!m?_?s.reactFormat(c("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to this shared folder. Keep in mind that anyone who can access <strong>%(parentname)s</strong> will still be able to access this folder."),{strong:n.createElement("strong",null),name:v,parentname:_}):s.reactFormat(c("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to this shared folder. Keep in mind that anyone who can access the parent folder will still be able to access this folder."),{strong:n.createElement("strong",null),name:v}):s.reactFormat(c("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to this shared folder."),{strong:n.createElement("strong",null),name:v}),u&&(S=c("Let %(name)s keep a copy of this shared folder").format({name:v}))):f=s.reactFormat(c("If you continue, <strong>%(name)s</strong> will lose access to this file."),{strong:n.createElement("strong",null),name:v}),g=c("Remove")):(y=c("Make %(name)s the owner of this folder?").format({name:v}),f=s.reactFormat(c("Only <strong>%(name)s</strong> will be able to unshare this folder or change folder settings."),{strong:n.createElement("strong",null),name:v}),g=c("Make owner")),a.Modal.showInstance(n.createElement(i.ConfirmWithOptionModal,{autoClose:!1,confirmText:g,cancelText:c("Cancel"),onConfirm:p,onCancel:h,optionLabel:S,showOption:null!=S,title:y},f))};t.showMemberAccessChangeConfirmationModal=d}),define("modules/clean/sharing/confirmation_modals/relinquish_membership_confirmation_modal",["require","exports","external/react","modules/clean/sharing/confirmation_modals/confirm_with_option_modal","modules/core/i18n","modules/clean/react/modal"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s.i18n_default_project("sharing")._;t.showRelinquishMembershipConfirmationModal=function(e,t,s,a,l,c){void 0===l&&(l=!1),void 0===c&&(c=!1);var d,u,p=null;return e?(u=o("Remove your access to this folder?"),d=o(t&&!c?"You may still have access to this folder through a company group or parent folder.":"If you continue, you won’t be able to access this folder anymore."),l&&(p=o("Keep a copy of this folder"))):(u=o("Remove your access to this file?"),d=o("If you continue, you won’t be able to access this file anymore.")),i.Modal.showInstance(n.createElement(r.ConfirmWithOptionModal,{cancelText:o("Cancel"),confirmText:o("Remove my access"),onCancel:a,onConfirm:s,optionLabel:p,showOption:null!=p,title:u},d))}}),define("modules/clean/sharing/confirmation_modals/reset_access_modal",["require","exports","external/react","modules/clean/em_string","modules/clean/react/modal","modules/clean/sharing/confirmation_modals/confirm_with_option_modal","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,r,s,i,o,a){"use strict";function l(e){var t,a=c("Let removed members keep a copy of this shared folder");t=c(e.linkAccessLanguage?e.isFolder?e.isNestedSharedFolder?"The link to this folder will no longer work. Unsharing will only remove members who             don’t have access to the parent folder.":"The link to this folder will no longer work, and everyone will be removed from this folder.             You’ll still keep a copy of this folder in your Dropbox account.":"Everyone else will lose access to this file and its link         except those who have access from a parent folder.         You’ll still keep a copy of this file in your Dropbox.":e.isFolder?"Everyone will be removed from this folder. You’ll         still keep a copy of this folder in your Dropbox.":"Everyone will be removed from this file. You’ll         still keep a copy of this file in your Dropbox.");var l=c("Unshare “%(content_name)s”?").format({content_name:r.Emstring.em_snippet(e.contentName,o.SNIPPET_SIZES.FILENAME)});s.Modal.showInstance(n.createElement(i.ConfirmWithOptionModal,{cancelText:c("Cancel"),confirmText:c("Unshare"),onCancel:e.onCancel,onConfirm:e.onConfirm,optionLabel:a,showOption:e.allowLeaveACopy&&e.isFolder,title:l},t))}Object.defineProperty(t,"__esModule",{value:!0});var c=a.i18n_default_project("sharing")._;t.confirmResetAccess=l}),define("modules/clean/sharing/confirmation_modals/simple_confirm_modal",["require","exports","tslib","external/react","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i.i18n_default_project("sharing")._,a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement(s.Modal,{style:"bare"},r.createElement("div",{className:"simple-confirm-modal"},r.createElement("div",{className:"simple-confirm-modal__main"},r.createElement("div",{className:"simple-confirm-modal__title"},this.props.title),r.createElement("div",{className:"simple-confirm-modal__body"},this.props.children)),r.createElement("div",{className:"simple-confirm-modal__footer"},r.createElement("button",{className:"simple-confirm-modal__cancel c-btn c-btn--secondary",onClick:this.props.onCancel},this.props.cancelText||o("Cancel")),r.createElement("button",{className:"simple-confirm-modal__confirm c-btn c-btn--primary",onClick:this.props.onConfirm},this.props.confirmText))))},t})(r.Component);t.SimpleConfirmModal=a}),define("modules/clean/sharing/content_info",["require","exports","tslib","external/immutable","modules/constants/python"],function(e,t,n,r,s){"use strict";function i(e){var t=(e.isFolder?e.targetNsId:e.fileId)||e.fqPath;if(null===t)throw new Error("Not enough fields provided for extras");return t}Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.createFromParams=function(e){var n=new a(e);return new t({extras:n,id:i(n)})},t.prototype.setNsId=function(e){var t=this.setIn(["extras","targetNsId"],e);return t.set("id",i(t.extras))},t.prototype.setFQPath=function(e){var t=this.setIn(["extras","fqPath"],e);return t.set("id",i(t.extras))},t.prototype.isFolder=function(){return this.extras.isFolder},t.prototype.isFile=function(){return!this.isFolder()},t.prototype.isFileFolder=function(){return this.isFolder()&&!this.isSharedFolder()},t.prototype.isSharedFolder=function(){return Boolean(this.extras.targetNsId)},t.prototype.isTeamSharedFolder=function(){return this.extras.isTeamSharedFolder},t.prototype.isInSharedFolder=function(){return Boolean(this.extras.nsId&&this.extras.nsId!==this.extras.userHomeNs)},t.prototype.isNestedSharedFolder=function(){return this.isInSharedFolder()&&this.isSharedFolder()},t.prototype.isOSXPackage=function(){var e=this.extras.fqPath,t=e.substr(e.lastIndexOf("."));return s.PACKAGE_EXTS.indexOf(t)>=0},t.prototype.isMounted=function(){return!this.extras.url},t.prototype.url=function(){return this.extras.url},t.prototype.pathExists=function(){return Boolean(this.extras.exists)},t.prototype.name=function(){return this.displayPath()?this.displayPath().split("/").pop():this.filename()},t.prototype.idForLink=function(){var e=this.extras.fileId||this.extras.fqPath;if(!e)throw new Error("No identifiers for getting links");return e},t.prototype.sharedFolderId=function(){var e=this.extras.targetNsId;if(!e)throw new Error("No shared folder ID");return e},t.prototype.displayPath=function(){return this.extras.fqPath},t.prototype.parentFolderName=function(){if(this.extras.fqPath){var e=this.displayPath().split("/");if(e.length>1)return e[e.length-2]}return""},t.prototype.filename=function(){return this.extras.filename},t.prototype.nsId=function(){if(!this.extras.nsId)throw new Error("Can't determine nsId");return this.extras.nsId},t.prototype.nsPath=function(){if(null===this.extras.nsPath)throw new Error("Can't determine nsPath");return this.extras.nsPath},t.prototype.sjid=function(){return this.extras.sjid},t.prototype.teamGroupInfo=function(){return this.extras&&this.extras.teamGroupInfo},t.prototype.beaconContext=function(){return this.extras&&this.extras.beaconContext},t})(r.Record({extras:null,id:null},"ContentInfo"));t.ContentInfo=o;var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({beaconContext:null,exists:!0,fileId:null,filename:null,fqPath:null,isFolder:null,isTeamSharedFolder:!1,modalSessionId:null,nsId:null,nsPath:null,origin:null,sjid:null,targetNsId:null,url:null,userHomeNs:null,teamGroupInfo:null},"ContentInfoExtras"));t.ContentInfoExtras=a}),define("modules/clean/sharing/delete_link_modal",["require","exports","modules/clean/ajax","modules/clean/em_string","modules/clean/react/modal","modules/clean/sharing/constants","modules/clean/sharing/ui_notifications_util","modules/core/i18n"],function(e,t,n,r,s,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a.i18n_default_project("sharing")._,c=function(e){var t=e.client,n=e.url,a=e.contentName,c=e.onDeleteLink,d=e.onCancel;a=r.Emstring.em_snippet(a,i.SNIPPET_SIZES.FILENAME);var u=function(){return t.revokeSharedLink({url:n}).then(function(){var e=l("Deleted link to “%(name)s”").format({name:a});o.sharingNotificationSuccess(e),s.Modal.close(),c&&c()})};s.SimpleModal.show({autoclose:!1,body_html:l("This link will no longer work for anyone who has it."),cancel_completed_callback:d,cancel_text:l("Cancel"),confirm_callback:u,confirm_text:l("Delete"),title_text:l("Delete link to “%(name)s”?").format({name:a}),style:"default-maestro"})};t.deleteLinkWithConfirm=c;var d=function(e){var t=e.client,a=e.tkey,c=e.contentName,d=e.onDeleteLink,u=e.onCancel;if(c=r.Emstring.em_snippet(c,i.SNIPPET_SIZES.FILENAME),null===a)return void s.Modal.close();var p=function(){return n.WebRequest({url:"/sm/disable/"+a,type:"POST",data:{tkey:a},subject_user:t.userId,success:function(){var e=l("Deleted link to “%(name)s”").format({name:c});o.sharingNotificationSuccess(e),s.Modal.close(),d&&d()}})};return s.SimpleModal.show({autoclose:!1,body_html:l("This link will no longer work for anyone who has it."),cancel_completed_callback:u,cancel_text:l("Cancel"),confirm_callback:p,confirm_text:l("Delete"),title_text:l("Delete link to “%(name)s”?").format({name:c}),style:"default-maestro"})};t.deleteLinkWithConfirmLegacy=d}),define("modules/clean/sharing/file_settings_modal",["require","exports","tslib","external/react","external/lodash","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/snackbar","modules/clean/react/util","modules/clean/react_format","modules/clean/sharing/actions/sharing_actions","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/confirmation_modals/reset_access_modal","modules/clean/sharing/constants","modules/clean/sharing/sharing_settings_constants","modules/clean/sharing/settings_modal_components","modules/clean/sharing/sharing_settings_modal","modules/clean/sharing/sharing_settings_util","modules/clean/sharing/ui_notifications_util","modules/constants/sharing","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y,v,S,E,b,I,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var C=T.i18n_default_project("sharing")._,w=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleAcceptClick=function(){var e=n.getPolicyDiff();e?u.setStatePromise(n,{isSubmitting:!0}).then(function(){return n.getClient().updatePolicy({contentId:n.props.contentId,newPolicy:e,actions:Object.keys(g.ALPHA_FILE_METADATA_PERMISSIONS)})}).catch(i.catchApiError(function(){n.setState({isSubmitting:!1}),Promise.reject({})})).then(function(e){b.sharingNotificationSuccess(C("File settings updated")),n.props.onPolicySet&&n.props.onPolicySet(e)}):n.props.onPolicySet&&n.props.onPolicySet(void 0)},n.handleDismissClick=function(){c.Modal.close(),n.props.onCancel&&n.props.onCancel()},n.handleDismissCompleted=function(){n.props.onCancel&&n.props.onCancel()},n.handlePolicyUpdate=function(e,t){n.setState({desiredPolicy:n.state.desiredPolicy.set(e,t)})},n.getPolicyDiff=function(){var e={};return n.state.desiredPolicy.keySeq().toArray().map(function(t){var r=n.state.desiredPolicy.get(t),i=n.props.initialPolicy.get(t);("object"==typeof r?s.isEqual(r,i):r===i)||(e[t]=n.state.desiredPolicy.get(t))}),e},n.handleUnshareFile=function(){var e=function(){return d.Snackbar.sync(p.reactFormat(C("Unsharing <st>%(file_name)s</st>..."),{st:r.createElement("strong",null),file_name:n.props.fileName}),!0),n.getClient().unshare({contentId:n.props.contentId}).then(function(){n.refreshSharedMemberData(),d.Snackbar.complete(p.reactFormat(C("Unshared <st>%(file_name)s</st>."),{st:r.createElement("strong",null),file_name:n.props.fileName})),c.Modal.close(),I.TRUELINK.TRUELINK_UI[n.props.user.id]&&h.SharingActions.loadFileMetadata({user:n.props.user,contentId:n.props.contentId})})};f.confirmResetAccess({allowLeaveACopy:!1,contentName:n.props.fileName,isFolder:!1,isNestedSharedFolder:!1,linkAccessLanguage:I.TRUELINK.TRUELINK_UI[n.props.user.id],onConfirm:e})},n.refreshSharedMemberData=function(){a.Dispatcher.dispatch({type:l.SharedWithActionType.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,data:{fileIds:[n.props.contentId]}})},n.state={isSubmitting:!1,desiredPolicy:t.initialPolicy},n}return n.__extends(t,e),t.prototype.render=function(){return I.TRUELINK.TRUELINK_UI[this.props.user.id]?this.openSharingSettingsModal():r.createElement(A,{canChangeOptions:this.props.canChangeOptions,canChangeViewerInfo:this.wrapCanChangePolicy(y.VIEWER_INFO_POLICY),canUnshareFile:this.props.canUnshareFile,contentId:this.props.contentId,desiredPolicy:this.state.desiredPolicy,fileName:this.props.fileName,handleUnshareFile:this.handleUnshareFile,isSubmitting:this.state.isSubmitting,onAccept:this.handleAcceptClick,onDismiss:this.handleDismissClick,onDismissCompleted:this.handleDismissCompleted,onPolicyUpdate:this.handlePolicyUpdate,ownerTeam:this.props.ownerTeam,user:this.props.user,viewerInfoDenyReason:E.getPassDenyReason(this.props.initialPolicy,this.props.permissions)})},t.prototype.getClient=function(){return new m.FileShareApiClient({userId:this.props.user.id})},t.prototype.wrapCanChangePolicy=function(e){var t=this.props.canChangeOptions;return E.isCommonSharingSettingsPolicy(e)&&(t=E.canChangePolicy(e,this.props.initialPolicy,this.state.desiredPolicy,this.props.linkMetadata,this.props.permissions)),t},t.prototype.openSharingSettingsModal=function(){var e=this,t=function(t,n){return[e.state.desiredPolicy.get(t),e.wrapCanChangePolicy(t)]};return r.createElement(S.SharingSettingsModal,{contentId:this.props.contentId,currentPolicy:this.props.initialPolicy,fileName:this.props.fileName,folderName:this.props.fileName,getEffectivePolicyValue:t,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,isFolder:!1,isLoading:!1,isSubmitting:this.state.isSubmitting,linkMetadata:this.props.linkMetadata,onDismiss:this.handleDismissClick,onOptionChange:this.handlePolicyUpdate,onSaveSettings:this.handleAcceptClick,onUnshare:this.handleUnshareFile,ownerTeam:this.props.ownerTeam,permissions:this.props.permissions,policyUpdate:this.getPolicyDiff(),user:this.props.user})},t.displayName="FileSettingsModal",t})(r.Component);t.FileSettingsModal=w;var A=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e;return this.props.canChangeOptions&&(e=r.createElement(v.SettingsModalButtons,{disableSave:!1,isAccepting:this.props.isSubmitting,onAccept:this.props.onAccept,onDismiss:this.props.onDismiss})),r.createElement(c.Modal,{autoClose:!1,className:"file-settings-modal",buttonComponent:r.createElement("span",null),onDismissCompleted:this.props.onDismissCompleted,title:C("“%(file_name)s” settings").format({file_name:o.Emstring.em_snippet(this.props.fileName,g.SNIPPET_SIZES.FILENAME)})},r.createElement("div",{className:"file-settings-form"},this.renderHeader(),this.renderPolicies(),this.renderButtons(),e))},t.prototype.renderHeader=function(){if(!this.props.canChangeOptions)return r.createElement("div",{className:"u-pad-xs u-font-center u-mar-bottom-s file-settings-form__no-permission-banner"},C("You don’t have permission to change the settings on this file."))},t.prototype.renderPolicies=function(){return r.createElement("div",null,null!=this.props.desiredPolicy.viewer_info_policy?this.renderViewerInfoPolicy():void 0)},t.prototype.renderViewerInfoPolicy=function(){var e;return e=this.props.ownerTeam?C("Show viewer info to members of %(company_name)s and people who can edit").format({company_name:this.props.ownerTeam.name}):C("Show viewer info to people who can edit"),r.createElement(v.SinglePolicyControl,{canChange:this.props.canChangeViewerInfo,denyReason:this.props.viewerInfoDenyReason,policyName:_.ViewerInfoPolicy.policy_name,policyDescription:C("Show who views this file?"),currentValue:this.props.desiredPolicy.viewer_info_policy,options:[{label:e,value:_.ViewerInfoPolicy.enabled},{label:C("Don’t show who views"),value:_.ViewerInfoPolicy.disabled}],handleOptionChange:this.props.onPolicyUpdate})},t.prototype.renderButtons=function(){var e;return this.props.canUnshareFile&&(e=r.createElement("div",{className:"u-l-fl"},r.createElement("button",{className:"button-as-link c-borderless-button",style:{lineHeight:"32px"},onClick:this.props.handleUnshareFile},C("Unshare file")))),r.createElement("div",{className:"u-mar-top-m clearfix"},e)},t.displayName="FileSettingsModalContents",t})(r.Component);t.FileSettingsModalContents=A}),
define("modules/clean/sharing/folder_settings_modal",["require","exports","tslib","external/classnames","external/create-react-class","external/purify","external/react","external/lodash","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/react/browse/store","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/snackbar","modules/clean/react/util","modules/clean/react_format","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/confirmation_modals/reset_access_modal","modules/clean/sharing/constants","modules/clean/sharing/settings_modal_components","modules/clean/sharing/share_page/action_types","modules/clean/sharing/sharing_settings_modal","modules/clean/sharing/sharing_settings_util","modules/clean/sharing/ui_notifications_util","modules/clean/sharing/ui_util","modules/clean/user","modules/constants/sharing","modules/constants/trademark","modules/core/browser","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y,v,S,E,b,I,T,C,w,A,M,k,N,P,L,R){"use strict";function O(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var F=o.createElement,D=o.DOM,x=R.i18n_default_project("sharing")._,U={shared_folder_member_policy:"team"},B={shared_folder_member_policy:"team"},q={member_policy:"shared_folder_member_policy"},H=s({displayName:"SharedFolderSettingsModal",propTypes:{actionHandler:o.PropTypes.instanceOf(y.ShareModalActionHandler),altAction:o.PropTypes.node,folderName:o.PropTypes.string.isRequired,folderId:o.PropTypes.string,folderPath:o.PropTypes.string,hasDisplayableMembers:o.PropTypes.bool,hasNonOwnerMembers:o.PropTypes.bool,nsId:o.PropTypes.string,nsPath:o.PropTypes.string,initialHasParentSharedFolder:o.PropTypes.bool,initialIsTeamSharedFolder:o.PropTypes.bool,initialMetadata:o.PropTypes.instanceOf(S.SharedFolderMetadata),initialOwnerTeam:o.PropTypes.shape({id:o.PropTypes.string.isRequired,name:o.PropTypes.string.isRequired}),initialPermissions:o.PropTypes.instanceOf(S.FolderPermissions),initialPolicy:o.PropTypes.oneOfType([o.PropTypes.instanceOf(S.CombinedPolicy),o.PropTypes.instanceOf(S.FolderPolicy)]),isConfidentialFolder:o.PropTypes.bool,isFolderInsideTeamFolderTree:o.PropTypes.bool,isLimitedTeam:o.PropTypes.bool,isSharedFolder:o.PropTypes.bool,isUserOnOwnerTeam:o.PropTypes.bool,linkMetadata:o.PropTypes.oneOfType([o.PropTypes.instanceOf(S.LinkMetadata),o.PropTypes.instanceOf(S.SharedContentLinkMetadata)]),onCancel:o.PropTypes.func,onPolicySet:o.PropTypes.func,onUnshare:o.PropTypes.func,showContentManagerBridge:o.PropTypes.bool,isInContentManager:o.PropTypes.bool,teamPolicy:o.PropTypes.instanceOf(v.TeamSharingPolicies),updateLinkSettings:o.PropTypes.func,user:o.PropTypes.instanceOf(k.User).isRequired},getInitialState:function(){return{currentPolicy:this.props.initialPolicy,hasParentSharedFolder:this.props.initialHasParentSharedFolder,isLoading:!(null!=this.props.initialPolicy&&null!=this.props.initialPermissions),isPolicyChangeRecursive:this._hasRecursivePolicyChanges(this.props.initialIsTeamSharedFolder,this.props.initialHasParentSharedFolder),isSubmitting:!1,isTeamSharedFolder:this.props.initialIsTeamSharedFolder,metadata:this.props.initialMetadata,teamPolicy:this.props.teamPolicy,newPolicy:this.props.initialPolicy,ownerTeam:this.props.initialOwnerTeam,permissions:this.props.initialPermissions}},componentDidMount:function(){if(this.state.isLoading)return this._fetchInitialState()},render:function(){var e={altAction:this.props.altAction,contentId:this.props.folderId,currentPolicy:this.state.currentPolicy,folderId:this.props.folderId,folderName:this.props.folderName,folderPath:this.props.folderPath,getEffectivePolicyValue:this._getEffectivePolicyValue,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,hasParentSharedFolder:this.state.hasParentSharedFolder,isConfidentialFolder:this.props.isConfidentialFolder,isFolder:!0,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isLimitedTeam:this.props.isLimitedTeam,isLoading:this.state.isLoading,isSharedFolder:this.props.isSharedFolder,isSubmitting:this.state.isSubmitting,isTeamSharedFolder:this.state.isTeamSharedFolder,isUserOnOwnerTeam:this.props.isUserOnOwnerTeam,linkMetadata:this.props.linkMetadata,onDismiss:this._handleDismiss,onOptionChange:this._handleOptionChange,onSaveSettings:this._handleSaveSettings,onUnshare:this._handleUnshareFolder,ownerTeam:this.state.ownerTeam,permissions:this.state.permissions,showContentManagerBridge:this.props.showContentManagerBridge,shouldHideHeader:this.state.shouldHideHeader,teamPolicy:this.state.teamPolicy,policyUpdate:this._getPolicyUpdate(),user:this.props.user};return N.TRUELINK.TRUELINK_UI[this.props.user.id]?F(C.SharingSettingsModal,e):F(j,e)},_getClient:function(){var e=p.getBrowseStore().context().isNonUserRelativeContext;return new v.FolderShareApiClient({userId:this.props.user.id,isNonUserRelativeContext:e})},_fetchFolderMetadata:function(){var e=[{".tag":"change_options"},{".tag":"unshare"}];return null!=this.props.folderId?this._getClient().getMetadata({contentId:this.props.folderId,actions:e}):this._getClient().validateFqPath({fqPath:this.props.folderPath,actions:e}).then(function(e){return e.metadata})},_fetchInitialState:function(){var e=this;return this._fetchFolderMetadata().then(function(t){if(e.isMounted()){var n=t.policy,r={hasParentSharedFolder:null!=t.parent_shared_folder_id,isTeamSharedFolder:t.is_team_folder,shouldHideHeader:"folder_is_limited_team_folder"===O(null!=t.permissions?t.permissions.change_options:void 0,function(e){return e.reason}),isLoading:!1,permissions:t.permissions,newPolicy:n,ownerTeam:t.owner_team,metadata:t};return null!=e.props.folderId&&(r.currentPolicy=n),r.isPolicyChangeRecursive=e._hasRecursivePolicyChanges(r.isTeamSharedFolder,r.hasParentSharedFolder),f.setStatePromise(e,r)}}).catch(l.catchApiError(function(){return m.Modal.close()}))},_hasRecursivePolicyChanges:function(e,t){return e||t},_handlePolicyUpdate:function(e,t){return this.setState({newPolicy:this.state.newPolicy.set(e,t)})},_handleSaveSettings:function(){var e=this,t=this._getPolicyUpdate();if(null!=t){var n=function(){var n=e.props.onPolicySet;return(e.isMounted()?f.setStatePromise(e,{isSubmitting:!0}):Promise.resolve()).then(function(){var n=function(e){return _.Snackbar.complete(x("Folder settings updated.")),Promise.resolve({policyUpdate:t,sharedFolderMetadata:e})},r=function(e){return this.props.actionHandler.reportShareFailure(e)};if(null!=e.props.folderId){return(0,e._getClient().updatePolicyAlpha)({contentId:e.props.folderId,newPolicy:t,url:null!=e.props.linkMetadata?e.props.linkMetadata.url:void 0}).then(n)}return t=N.TRUELINK.TRUELINK_UI[e.props.user.id]?new S.CombinedPolicy(t):new S.FolderPolicy(t),e.props.actionHandler.shareIfFileFolder(x("Updating folder settings..."),t).then(n).catch(r)}).then(function(e){var t=e.policyUpdate,r=e.sharedFolderMetadata;return"function"==typeof n?n(t,r):void 0}).catch(l.catchApiError(function(t){if(e.isMounted())return e.setState({isSubmitting:!1})}))};if(this.state.isPolicyChangeRecursive){var r=this.props;return m.SimpleModal.show({title_text:x("Save settings?"),body_html:this.state.isTeamSharedFolder?i.sanitize(x("Your changes will be applied to this team folder and any folders inside it.")):i.sanitize(x("Your changes will be applied to this folder and any folders inside it.")),confirm_text:x("Save settings"),cancel_text:x("Cancel"),autoclose:!1,confirm_callback:n,cancel_completed_callback:function(){return m.Modal.showInstance(F(H,r))}})}return n()}},_handleDismiss:function(){return m.Modal.close(),"function"==typeof this.props.onCancel?this.props.onCancel():void 0},_handleDismissCompleted:function(){return"function"==typeof this.props.onCancel?this.props.onCancel():void 0},_tooManyFilesSnackbar:function(){var e=function(){return L.open_tab("/help/files-folders/unshare-folder#foldersize")};return _.Snackbar.show(F(_.Snackbar,{actionButtonText:x("Learn more"),closeButtonText:x("Close"),onActionClick:e,title:x("Unsharing unsuccessful. This folder has too many files."),variant:"fail"}))},_handleUnshareFolder:function(){var e=this;if(null!=this.props.folderId&&O(null!=this.state.permissions?this.state.permissions.unshare:void 0,function(e){return e.allow})){var t=function(t){return _.Snackbar.sync(g.reactFormat(x("Unsharing <st>%(folder_name)s</st>..."),{st:D.strong(),folder_name:c.Emstring.em_snippet(e.props.folderName,b.SNIPPET_SIZES.FILENAME)}),!0),e._getClient().unshare({contentId:e.props.folderId,leaveACopy:t}).then(function(){return _.Snackbar.complete(g.reactFormat(x("Unshared <st>%(folder_name)s</st>."),{st:D.strong(),folder_name:c.Emstring.em_snippet(e.props.folderName,b.SNIPPET_SIZES.FILENAME)})),null!=e.props.actionHandler&&e.props.actionHandler.refreshSharedWithColumnContentData(),m.Modal.close(),u.Dispatcher.dispatch({type:T.SharePageActionTypes.UNSHARE_FOLDER_SUCCESS,metadata:e.state.metadata,user:e.props.user})}).catch(function(t){return"too_many_files"===t.error[".tag"]?e._tooManyFilesSnackbar():A.sharingNotificationError(t.message),u.Dispatcher.dispatch({type:T.SharePageActionTypes.UNSHARE_FOLDER_ERROR,metadata:e.state.metadata,user:e.props.user})})},n=(function(e){return function(){return m.Modal.showInstance(F(H,e))}})(this.props);return E.confirmResetAccess({allowLeaveACopy:O(null!=this.state.permissions?this.state.permissions.leave_a_copy:void 0,function(e){return e.allow}),contentName:this.state.metadata.name,isFolder:!0,isNestedSharedFolder:this.props.hasParentSharedFolder,linkAccessLanguage:N.TRUELINK.TRUELINK_UI[this.props.user.id],onCancel:n,onConfirm:t})}},_getPolicyUpdate:function(){var e=this;if(null==this.state.newPolicy&&null==this.state.currentPolicy)return null;var t={};return this.state.newPolicy.forEach(function(n,r){var s=Array.from(e._getEffectivePolicyValue(r)),i=s[0];if(s[1]&&!("object"==typeof n?a.isEqual(n,i):n===i))return t[r]=n}),t},_handleOptionChange:function(e,t){if(O(this._getPolicyUpdate(),function(t){return t[e]})!==t)return"function"==typeof this._handlePolicyUpdate?this._handlePolicyUpdate(e,t):void 0},_getEffectivePolicyValue:function(e,t){void 0===t&&(t=void 0);var n,r=q[e];null!=r&&null!=this.props.teamPolicy&&(n=this.props.teamPolicy.get(r));var s=null!=(null!=t?t[e]:void 0)?null!=t?t[e]:void 0:this.state.currentPolicy.get(e),i=null!=this.state.permissions.change_options?this.state.permissions.change_options.allow:void 0;return null!=n&&U[r]===n&&(i=!1,s=B[r]),w.isCommonSharingSettingsPolicy(e)&&(i=w.canChangePolicy(e,this.state.currentPolicy,this.state.newPolicy,this.props.linkMetadata,this.state.permissions,this.props.showContentManagerBridge)),this.props.showContentManagerBridge&&(i=!1),[s,i]}});t.SharedFolderSettingsModal=H;var V=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderHeader=function(){if(!t.props.shouldHideHeader){var e={"shared-folder-settings-form__team-folder-banner":!0,"u-pad-xs":!0,"u-font-center":!0,"u-mar-bottom-s":!0},n=D.div({},x("These settings will apply to all folders inside “%(folder_name)s”.").format({folder_name:t.props.folderName}));if(t.props.isInContentManager)return D.div({className:r(e)},n);if(t.props.showContentManagerBridge){var s=d.parent_dir(t.props.folderPath),i=d.filename(t.props.folderPath),o=M.genContentManagerBridgeUri({containingFolder:s,filenameToSelect:i,isLimitedTeam:t.props.isLimitedTeam});return D.div({className:r(e)},n,D.div({},x("You can change these settings in the Admin Console. "),D.a({href:o.toString(),target:"_blank"},x("Open in new tab."))))}return(t.props.isTeamSharedFolder||t.props.hasParentSharedFolder)&&t.props.isUserOnOwnerTeam?D.div({className:r(e)},n,D.div({},D.a({href:"/team",target:"_blank"},x("To edit, ask your admin.")))):O(null!=t.props.permissions?t.props.permissions.change_options:void 0,function(e){return e.allow})?void 0:D.div({className:r(a.assignIn(e,{"shared-folder-settings-form__team-folder-banner":!1,"shared-folder-settings-form__no-permissions-banner":!0}))},x("You don’t have permission to change the settings on this folder."))}},t._renderPolicies=function(){var e=null!=t.props.ownerTeam,n=null!=t.props.ownerTeam&&!t.props.isLimitedTeam,r=null!=t.props.currentPolicy.viewer_info_policy,s=t.props.isTeamSharedFolder||t.props.isFolderInsideTeamFolderTree;return D.div({},e?t._renderPolicy("member_policy",x(s?"Who can be added to folders?":"Who can be invited to this folder?"),[{label:t.props.isLimitedTeam?x("Only people on your team"):x("Only people on your %(trademark_business)s account").format({trademark_business:P.TRADEMARK_BUSINESS}),value:"team"},{label:x("Anyone"),value:"anyone"}]):void 0,t._renderPolicy("acl_update_policy",x(s?"Who can manage access to folders?":"Who can manage access to this folder?"),[{label:x(s?"Only Team Admins":"Only owners"),value:"owner"},{label:e?t.props.isLimitedTeam?x("Anyone on your team with edit permissions"):x("Anyone on your %(trademark_business)s account with edit permissions").format({trademark_business:P.TRADEMARK_BUSINESS}):x("People with edit permissions"),value:"editors"}]),n&&!t.props.isConfidentialFolder?t._renderPolicy("shared_link_policy",x(t.props.isTeamSharedFolder?"Allow members of this team folder to share links with others?":"Allow links to be shared with people outside of this folder?"),[{label:x("No"),value:"members"},{label:x("Yes"),value:"anyone"}]):void 0,(function(){if(r){var e=void 0;return e=t.props.ownerTeam?x("Show viewer info to members of %(company_name)s and people who can edit").format({company_name:t.props.ownerTeam.name}):x("Show viewer info to people who can edit"),t._renderPolicy("viewer_info_policy",x("Show who views files in this folder?"),[{label:e,value:"enabled"},{label:x("Don’t show viewer info"),value:"disabled"}],w.getPassDenyReason(t.props.currentPolicy,t.props.permissions))}})())},t._renderPolicy=function(e,n,r,s){void 0===s&&(s=null);var i=Array.from(t.props.getEffectivePolicyValue(e,t.props.policyUpdate)),o=i[0],a=i[1];return F(I.SinglePolicyControl,{canChange:a,denyReason:s,policyName:e,policyDescription:n,currentValue:o,options:r,handleOptionChange:t.props.onOptionChange})},t._renderButtons=function(){var e=O(null!=t.props.permissions?t.props.permissions.unshare:void 0,function(e){return e.allow});return D.div({className:"u-mar-top-m clearfix"},t.props.isSharedFolder&&e?D.div({className:"u-l-fl"},D.button({className:"button-as-link c-borderless-button",style:{lineHeight:"32px"},onClick:t.props.onUnshare},x(t.props.hasParentSharedFolder?"Reset membership":"Unshare folder"))):void 0,t._renderUpdateSettingsButtons())},t._renderUpdateSettingsButtons=function(){if(null!=t.props.permissions?t.props.permissions.change_options.allow:void 0)return F(I.SettingsModalButtons,{disableSave:null==t.props.policyUpdate,isAccepting:t.props.isSubmitting,onAccept:t.props.onSaveSettings,onDismiss:t.props.onDismiss})},t}return n.__extends(t,e),t.prototype.render=function(){return F(m.Modal,{altAction:this.props.altAction,autoClose:!1,className:r({"shared-folder-settings-modal":!0,"shared-folder-settings-modal--no-permissions":!O(null!=this.props.permissions?this.props.permissions.change_options:void 0,function(e){return e.allow})}),buttonComponent:D.span(),onDismissCompleted:this.props.onDismiss,title:this.props.isTeamSharedFolder?x("“%(folder_name)s” team folder settings").format({folder_name:c.Emstring.em_snippet(this.props.folderName,b.SNIPPET_SIZES.FILENAME)}):x("“%(folder_name)s” settings").format({folder_name:c.Emstring.em_snippet(this.props.folderName,b.SNIPPET_SIZES.FILENAME)})},this.props.isLoading?D.div({className:"shared-folder-settings-modal__loading-text"},x("Loading...")):D.div({},this._renderHeader(),this._renderPolicies(),this._renderButtons()))},t.displayName="SharedFolderSettingsModalContents",t.propTypes={altAction:o.PropTypes.node,currentPolicy:o.PropTypes.instanceOf(S.FolderPolicy),folderId:o.PropTypes.string,folderName:o.PropTypes.string.isRequired,folderPath:o.PropTypes.string,permissions:o.PropTypes.instanceOf(S.FolderPermissions),getEffectivePolicyValue:o.PropTypes.func,hasParentSharedFolder:o.PropTypes.bool,isConfidentialFolder:o.PropTypes.bool,isLimitedTeam:o.PropTypes.bool,isLoading:o.PropTypes.bool.isRequired,isSharedFolder:o.PropTypes.bool,isSubmitting:o.PropTypes.bool,isTeamSharedFolder:o.PropTypes.bool,isUserOnOwnerTeam:o.PropTypes.bool,onDismiss:o.PropTypes.func,onSaveSettings:o.PropTypes.func,onOptionChange:o.PropTypes.func,onUnshare:o.PropTypes.func,ownerTeam:o.PropTypes.shape({id:o.PropTypes.string.isRequired,name:o.PropTypes.string.isRequired}),showContentManagerBridge:o.PropTypes.bool,shouldHideHeader:o.PropTypes.bool,teamPolicy:o.PropTypes.instanceOf(v.TeamSharingPolicies),policyUpdate:o.PropTypes.instanceOf(S.FolderPolicy)},t.defaultProps={currentPolicy:null,folderId:null,getEffectivePolicyValue:null,hasParentSharedFolder:!1,isConfidentialFolder:!1,isTeamSharedFolder:!1,onDismiss:null,onOptionChange:null,onSaveSettings:null,onUnshareFolder:null,ownerTeam:null,shouldHideHeader:!1,teamPolicy:null,policyUpdate:null},t})(o.Component),j=h(V,["/static/css/sharing/share_modal-vflm4LDVj.css"],[I.SinglePolicyControl]);t.SharedFolderSettingsModalContents=j}),define("modules/clean/sharing/link_description",["require","exports","external/react","modules/clean/em_string","modules/clean/react_format","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/viewer","modules/constants/trademark","modules/core/i18n","modules/core/exception"],function(e,t,n,r,s,i,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=c.i18n_default_project("sharing"),p=u._,h=u.ungettext,m=function(e){return(function(){switch(e){case"public":return p("Anyone with the link");case"team_only":return p("Only people on your Dropbox team");case"password":return p("Only people with the password");case"team_and_password":return p("Only people on your Dropbox team with the password");default:throw Error("Unknown visibility option "+e)}})()};t.formatLinkVisibilityOption=m;var _=function(e,t,n){return void 0===n&&(n=null),e?(function(){switch(t){case"public":return p("Anyone with the link can comment.");case"team_only":return p("Only people on your Dropbox team can comment.");case"password":return p("Only people with the password can comment.");case"team_and_password":return p("Only people on your Dropbox team with the password can comment.");case"shared_folder_only":return n=n?n:"",p("Only members of the shared folder “%(shared_folder_name)s” can comment.").format({shared_folder_name:r.Emstring.em_snippet(n,o.SNIPPET_SIZES.FILENAME)});case"only_you":return p("Only you can comment.");default:throw Error("Unknown visibility setting "+t)}})():p("No one can comment.")};t.formatLinkCommentingVisibility=_;var f=function(e,t){void 0===t&&(t=!1),d.assert(!!e.expiry,"this function should only be used when there is expiry for linkMetadata");var n=e.expiry?e.expiry.getTime():0,r=n-(new Date).getTime(),s=Math.floor(r/864e5);if(s<1){var i=Math.floor(r/36e5)+1;return t?h("Expires in the next hour","Expires in the next %(num_hours)s hours",i,"sharing").format({num_hours:i}):h("link turns off in the next hour","link turns off in the next %(num_hours)s hours",i,"sharing",'comes after a phrase like: "Anyone with the link can view"').format({num_hours:i})}return t?h("Expires in 1 day","Expires in %(num_days)s days",s,"sharing").format({num_days:s}):h("link turns off in 1 day","link turns off in %(num_days)s days",s,"sharing",'comes after a phrase like: "Anyone with the link can view"').format({num_days:s})};t.formatSharedContentLinkExpiry=f;var g=function(e){var t=null!=(null!=e?e.current_audience:void 0)?null!=e?e.current_audience:void 0:i.LinkAudience.members;if(!(null!=e?e.url:void 0)&&t!==i.LinkAudience.members||t===i.LinkAudience.default_on)return p("Updating link...");var n=a.Viewer.get_viewer().team_is_limited,r=(function(){if(t===i.LinkAudience.members)return p("Only invited members can access");if(t===i.LinkAudience.public)return p(e.password_protected?"Anyone with the link and password can view":"Anyone with the link can view");if(t===i.LinkAudience.team)return e.password_protected?n?p("Only people on your team with the password can view"):p("Only people on your %(trademark_business)s team with the password can view").format({trademark_business:l.TRADEMARK_BUSINESS}):n?p("Only people on your team can view"):p("Only people on your %(trademark_business)s team can view").format({trademark_business:l.TRADEMARK_BUSINESS});throw Error("Unknown link audience "+e.current_audience)})();return e.expiry&&t!==i.LinkAudience.members&&(r=r+" ("+f(e)+")"),r};t.formatSharedContentLinkDescription=g;var y=function(e){return(function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return s.reactFormat(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this folder"),{strong:n.createElement("strong",null)});case"public":return s.reactFormat(p("<strong>Anyone</strong> with the link can <strong>view</strong> this folder"),{strong:n.createElement("strong",null)});case"shared_folder_only":return s.reactFormat(p("<strong>Members of this folder</strong> with this link can <strong>view</strong> this folder"),{strong:n.createElement("strong",null)});case"team_and_password":return s.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder"),{strong:n.createElement("strong",null)});case"team_only":return s.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder"),{strong:n.createElement("strong",null)});case"only_you":return s.reactFormat(p("<strong>Only you</strong> can <strong>view</strong> via the link."),{strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return s.reactFormat(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this file"),{strong:n.createElement("strong",null)});case"public":return s.reactFormat(p("<strong>Anyone</strong> with the link can <strong>view</strong> this file"),{strong:n.createElement("strong",null)});case"shared_folder_only":return s.reactFormat(p("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file"),{strong:n.createElement("strong",null)});case"team_and_password":return s.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file"),{strong:n.createElement("strong",null)});case"team_only":return s.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file"),{strong:n.createElement("strong",null)});case"only_you":return s.reactFormat(p("<strong>Only you</strong> can <strong>view</strong> via the link."),{strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}})()},v=function(e){return(function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return s.reactFormat(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this folder. Downloading is disabled."),{strong:n.createElement("strong",null)});case"public":return s.reactFormat(p("<strong>Anyone</strong> with the link can <strong>view</strong> this folder. Downloading is disabled."),{strong:n.createElement("strong",null)});case"shared_folder_only":return s.reactFormat(p("<strong>Members of this folder</strong> with this link can <strong>view</strong> this folder. Downloading is disabled."),{strong:n.createElement("strong",null)});case"team_and_password":return s.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder. Downloading is disabled."),{strong:n.createElement("strong",null)});case"team_only":return s.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder. Downloading is disabled."),{strong:n.createElement("strong",null)});case"only_you":return s.reactFormat(p("<strong>Only you</strong> can <strong>view</strong> via the link. Downloading is disabled."),{strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return s.reactFormat(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this file. Downloading is disabled."),{strong:n.createElement("strong",null)});case"public":return s.reactFormat(p("<strong>Anyone</strong> with the link can <strong>view</strong> this file. Downloading is disabled."),{strong:n.createElement("strong",null)});case"shared_folder_only":return s.reactFormat(p("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file. Downloading is disabled."),{strong:n.createElement("strong",null)});case"team_and_password":return s.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file. Downloading is disabled."),{strong:n.createElement("strong",null)});case"team_only":return s.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file. Downloading is disabled."),{strong:n.createElement("strong",null)});case"only_you":return s.reactFormat(p("<strong>Only you</strong> can <strong>view</strong> via the link. Downloading is disabled."),{strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}})()},S=function(e){d.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");var t=e.expires?e.expires.getTime():0,r=(function(){if(null!=e.expires){var n=t-(new Date).getTime();return n<0&&(n=0),Math.floor(n/864e5)}return-1})();return(function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return s.reactFormat(h("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this folder. Link expires in <strong>a day</strong>. Downloading is disabled.","<strong>Anyone</strong> with the link and the password can <strong>view</strong> this folder. Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});case"public":return s.reactFormat(h("<strong>Anyone</strong> with the link can <strong>view</strong> this folder. Link expires in <strong>a day</strong>. Downloading is disabled.","<strong>Anyone</strong> with the link can <strong>view</strong> this folder. Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});case"shared_folder_only":return s.reactFormat(h("<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder. Link expires in <strong>a day</strong>. Downloading is disabled.","<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder. Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});case"team_and_password":return s.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder. Link expires in <strong>a day</strong>. Downloading is disabled.","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder. Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});case"team_only":return s.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder. Link expires in <strong>a day</strong>. Downloading is disabled.","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder. Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});case"only_you":return s.reactFormat(h("<strong>Only you</strong> can <strong>view</strong> via the link. Link expires in <strong>a day</strong>. Downloading is disabled.","<strong>Only you</strong> can <strong>view</strong> via the link. Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return s.reactFormat(h("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file. Link expires in <strong>a day</strong>. Downloading is disabled.","<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file. Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});case"public":return s.reactFormat(h("<strong>Anyone</strong> with the link can <strong>view</strong> this file. \nLink expires in <strong>a day</strong>. Downloading is disabled.","<strong>Anyone</strong> with the link can <strong>view</strong> this file. Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});case"shared_folder_only":return s.reactFormat(h("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file. \nLink expires in <strong>a day</strong>. Downloading is disabled.","<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file. Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});case"team_and_password":return s.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file. Link expires in <strong>a day</strong>. Downloading is disabled.","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file.               Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});case"team_only":return s.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file. Link expires in <strong>a day</strong>. Downloading is disabled.","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file. Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});case"only_you":return s.reactFormat(h("<strong>Only you</strong> can <strong>view</strong> via the link. Link expires in <strong>a day</strong>. Downloading is disabled.","<strong>Only you<strong> can <strong>view</strong> via the link. Link expires in <strong>%(expires_days)s days</strong>. Downloading is disabled.",r),{expires_days:r,strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}})()},E=function(e){d.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");var t=(function(){if(null!=e.expires){var t=e.expires.getTime()-(new Date).getTime();return t<0&&(t=0),Math.floor(t/864e5)}return-1})();return(function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){
case"password":return s.reactFormat(h("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this folder. Link expires in <strong>a day</strong>.","<strong>Anyone </strong>with the link and the password can <strong>view</strong> this folder. Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});case"public":return s.reactFormat(h("<strong>Anyone</strong> with the link can <strong>view</strong> this folder. Link expires in <strong>a day</strong>.","<strong>Anyone</strong> with the link can <strong>view</strong> this folder. Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});case"shared_folder_only":return s.reactFormat(h("<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder.               Link expires in <strong>a day</strong>.","<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder.               Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});case"team_and_password":return s.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder.               Link expires in <strong>a day</strong>.","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder.               Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});case"team_only":return s.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder. Link expires in <strong>a day</strong>.","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder. Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});case"only_you":return s.reactFormat(h("<strong>Only you</strong> can <strong>view</strong> via the link. Link expires in <strong>a day</strong>.","<strong>Only you</strong> can <strong>view</strong> via the link. Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return s.reactFormat(h("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file. Link expires in <strong>a day</strong>.","<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file. Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});case"public":return s.reactFormat(h("<strong>Anyone</strong> with the link can <strong>view</strong> this file. Link expires in <strong>a day</strong>.","<strong>Anyone</strong> with the link can <strong>view</strong> this file. Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});case"shared_folder_only":return s.reactFormat(h("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file.               Link expires in <strong>a day</strong>.","<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file.               Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});case"team_and_password":return s.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file.               Link expires in <strong>a day</strong>.","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file.               Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});case"team_only":return s.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file. Link expires in <strong>a day</strong>.","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file. Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});case"only_you":return s.reactFormat(h("<strong>Only you</strong> can <strong>view</strong> via the link. Link expires in <strong>a day</strong>.","<strong>Only you</strong> can <strong>view</strong> via the link. Link expires in <strong>%(expires_days)s days</strong>.",t),{expires_days:t,strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}})()},b=function(e){return null!=e.expires?E(e):y(e)},I=function(e){return null!=e.expires?S(e):v(e)},T=function(e){return e.link_permissions.allow_download===!1?I(e):b(e)};t.formatLinkDescription=T}),define("modules/clean/sharing/link_info",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){var t=e.expires,n=e.isFolder,r=e.name,s=e.teamId,i=e.teamName,o=e.url,a=e.visibility,l=e.isPackage;this.expires=t,this.isFolder=n,this.name=r,this.teamId=s,this.teamName=i,this.url=o,this.visibility=a,this.isPackage=l}return e})();t.LinkInfo=n}),define("modules/clean/sharing/link_settings_modal",["require","exports","tslib","external/classnames","external/react","modules/clean/api_v2/types","modules/clean/datetime","modules/clean/em_string","modules/clean/filepath","modules/clean/previews/util","modules/clean/react/bubble_menu","modules/clean/react/calendar","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/delete_link_modal","modules/clean/sharing/link_description","modules/clean/sharing/ui_notifications_util","modules/clean/static_urls","modules/constants/sharing","modules/constants/trademark","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y,v,S,E,b,I,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var C=s.createElement,w=s.DOM,A=T.i18n_default_project("sharing")._,M=(function(e){function t(n){var r=e.call(this,n)||this;r._handlePolicyUpdate=function(e,t){return"expires"===e&&null!=t&&(t.setHours(23),t.setMinutes(59),t.setSeconds(59)),r.setState({newPolicy:r.state.newPolicy.set(e,t)})},r._getModifiedSettings=function(){var e=r.state.newPolicy;if(e.requested_visibility===f.RequestedVisibilityPolicy.password){if(null==e.link_password)e=e.set("requested_visibility",null);else if(""===e.link_password)return S.sharingNotificationError(A("Password can’t be empty")),null}else e=e.set("link_password",null);return r.props.linkMetadata.link_permissions.resolved_visibility===f.ResolvedVisibilityPolicy.shared_folder_only&&(e=e.set("requested_visibility",null)),null!=e.expires&&(e=r.props.linkMetadata.link_permissions.can_set_expiry?e.set("expires",i.formatTimestamp(e.expires)):e.set("expires",null)),e.allow_download===r.state.existingPolicy.allow_download&&(e=e.set("allow_download",void 0)),{url:r.props.linkMetadata.url,settings:e,remove_expiration:null!=r.props.linkMetadata.expires&&null==r.state.newPolicy.expires}},r._saveSettings=function(){var e=r._getModifiedSettings();if(null!=e)return r.setState({isSubmitting:!0}),r.props.client.modifySharedLinkSettings(e).catch(function(){return r.setState({isSubmitting:!1}),Promise.reject()}).then(function(e){return S.sharingNotificationSuccess(A("Settings saved.")),"function"==typeof r.props.onPolicySet&&r.props.onPolicySet(e),r._dismissModal()})},r._dismissModal=function(){return h.Modal.close(),r._handleDismissed()},r._handleDismissed=function(){return"function"==typeof r.props.onClose?r.props.onClose():void 0},r._deleteLink=function(){var e=function(){return"function"==typeof r.props.onDeleteLink?r.props.onDeleteLink():void 0},n=(function(e){return function(){return h.Modal.showInstance(C(t,e))}})(r.props);return y.deleteLinkWithConfirm({client:r.props.client,contentName:r.props.linkMetadata.name,onCancel:n,onDeleteLink:e,url:r.props.linkMetadata.url})};var s=n.linkMetadata.link_permissions.requested_visibility,o=n.linkMetadata.link_permissions.resolved_visibility;s===f.RequestedVisibilityPolicy.public&&o===f.ResolvedVisibilityPolicy.team_only&&(s=f.RequestedVisibilityPolicy.team_only);var a=new f.LinkPolicy({requested_visibility:s,link_password:s===f.RequestedVisibilityPolicy.password?null:"",expires:n.linkMetadata.expires,allow_download:n.linkMetadata.link_permissions.allow_download});return r.state={existingPolicy:a,isSubmitting:!1,newPolicy:a},r}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.linkMetadata.link_permissions.visibility_policies.filter(function(e){return e.disallowed_reason===f.VisibilityDisallowedReason.user_account_type}),t=e.length>0;return C(h.Modal,{autoClose:!1,className:"shared-link-settings-modal",buttonComponent:w.span(),onDismissCompleted:this._handleDismissed,title:A("Link permissions for “%(content_name)s”").format({content_name:this.props.linkMetadata.name})},C(k,{canSubmit:!this.state.existingPolicy.equals(this.state.newPolicy),isFile:this.props.isFile,isSubmitting:this.state.isSubmitting,linkMetadata:this.props.linkMetadata,onCancel:this._dismissModal,onSubmit:this._saveSettings,onPolicyUpdate:this._handlePolicyUpdate,onDeleteLink:this._deleteLink,renderedPolicy:this.state.newPolicy,showUpgradeToBiz:this.props.showUpgradeToBiz,showUpgradeMessage:t,isTeam:this.props.isTeam}))},t.displayName="SharedLinkSettingsModal",t.propTypes={client:s.PropTypes.instanceOf(_.ShareApiClient).isRequired,isFile:s.PropTypes.bool.isRequired,linkMetadata:s.PropTypes.instanceOf(f.LinkMetadata).isRequired,onClose:s.PropTypes.func,onDeleteLink:s.PropTypes.func,onPolicySet:s.PropTypes.func,showUpgradeToBiz:s.PropTypes.bool.isRequired,isTeam:s.PropTypes.bool},t})(s.Component),k=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={selectedExpiry:null!=t.props.renderedPolicy.expires?t.props.linkMetadata.link_permissions.can_set_expiry?"custom":"read-only":"no-expiry"},t._renderHeader=function(){if(t.props.showUpgradeToBiz)return w.div({className:"shared-link-settings-modal__upgrade-to-biz-banner"},w.div({className:"shared-link-settings-modal__upgrade-to-biz-banner-text"},A("Did you know %(trademark_business)s lets you add passwords and expiration dates to shared links?").format({trademark_business:I.TRADEMARK_BUSINESS})),w.div({className:"shared-link-settings-modal__upgrade-to-biz-banner-cta"},w.a({className:"c-btn c-btn--secondary shared-link-settings-modal__upgrade-to-biz-banner-cta-button",href:"/business?tk=teams&camp=sharing_link_modal",target:"_blank"},A("Learn More"))));if(t.props.showUpgradeMessage){var e=void 0,n=void 0;return t.props.isTeam?(e="/team/upgrade",n=A("Upgrade to %(trademark_business)s to enable permission settings").format({trademark_business:I.TRADEMARK_BUSINESS})):(e="/upgrade?oqa=sfp",n=A("Upgrade to Dropbox %(trademark_professional)s to enable permission settings.").format({trademark_professional:I.TRADEMARK_PROFESSIONAL})),w.div({className:"shared-link-settings-modal__upgrade-to-pro-banner"},w.a({href:e,target:"_blank"},n))}},t._renderPolicies=function(){return w.div({},t._renderVisibilityPolicies(),t._renderExpiryPolicy(),t._renderDownloadPolicy(),t._renderCommentsPolicy())},t._renderVisibilityPolicies=function(){var e=t.props.linkMetadata.link_permissions.visibility_policies.filter(function(e){return e.allowed||e.disallowed_reason===f.VisibilityDisallowedReason.user_account_type}),n=t.props.linkMetadata.link_permissions.visibility_policies[0].disallowed_reason;return t._renderFieldset(A("Who can view this link?"),n===f.VisibilityDisallowedReason.permission_denied&&0===e.length?t._renderNonPermissionVisibility():e.length<2?t._renderRestrictedBySharedFolderVisibility():e.map(t._renderVisibilityOption))},t._renderNonPermissionVisibility=function(){var e=t.props.linkMetadata.link_permissions.resolved_visibility;return w.span({},w.span({className:"shared-link-settings-modal__visibility-text"},e===f.ResolvedVisibilityPolicy.shared_folder_only?A("Only invited members can view this link."):v.formatLinkVisibilityOption(e))," ",w.span({className:"shared-link-settings-modal__visibility-advice u-font-meta"},A("You don’t have permission to change the visibility.")))},t._renderRestrictedBySharedFolderVisibility=function(){var e=t.props.linkMetadata.link_permissions.resolved_visibility,n=t.props.linkMetadata.link_permissions.visibility_policies[0].disallowed_reason;return w.span({},w.span({className:"shared-link-settings-modal__visibility-text"},(function(){if(e===f.ResolvedVisibilityPolicy.shared_folder_only){var n=t.props.linkMetadata.link_permissions.restricting_shared_folder_path;return n=a.Emstring.em_snippet(n,g.SNIPPET_SIZES.FILENAME),A("Only members of the shared folder “%(shared_folder_name)s” can view this link.").format({shared_folder_name:n})}if(e===f.ResolvedVisibilityPolicy.only_you)return A("Only you can view this link.");throw"Unexpected visibility "+e})())," ",w.span({className:"shared-link-settings-modal__visibility-advice u-font-meta"},(function(){if(n===f.VisibilityDisallowedReason.restricted_by_shared_folder)return A("To change who can access the link, go to the shared folder options.");if(n===f.VisibilityDisallowedReason.delete_and_recreate)return A("To change who can access the link, delete this link and create a new one.");throw"Unexpected disallowed reason "+n})()))},t._renderVisibilityOption=function(e){var n=e.disallowed_reason===f.VisibilityDisallowedReason.user_account_type;return[w.label({className:r({"u-font-meta":!e.allowed}),key:"visibility-label"},w.input({checked:e.policy===t.props.renderedPolicy.requested_visibility,className:r((s={"shared-link-settings-modal__audience":!0},s["shared-link-settings-modal__audience-"+e.policy]=!0,s)),disabled:n,name:f.RequestedVisibilityPolicy.policy_name,onChange:function(e){return t.props.onPolicyUpdate(e.target.name,e.target.value)},type:"radio",value:e.policy}),t._renderVisibilityLabelText(e)),e.policy===f.RequestedVisibilityPolicy.password&&t.props.renderedPolicy.requested_visibility===f.RequestedVisibilityPolicy.password?w.div({key:"password-input"},t._renderPasswordInput(n)):void 0];var s},t._renderVisibilityLabelText=function(e){return w.span({className:r((t={"shared-link-settings-modal__audience":!0},t["shared-link-settings-modal__audience-"+e.policy+"-label"]=!0,t))},v.formatLinkVisibilityOption(e.resolved_policy));var t},t._renderPasswordInput=function(e){var n=null==t.props.renderedPolicy.link_password;return w.div({className:"shared-link-settings-modal__password-container u-mar-left-m u-mar-right-xl u-mar-top-xs"},w.input({className:"shared-link-settings-modal__password-input c-input",disabled:e||n,name:"link_password",onChange:function(e){return t.props.onPolicyUpdate(e.target.name,e.target.value)},placeholder:A("Set password"),value:null!=t.props.renderedPolicy.link_password?t.props.renderedPolicy.link_password:"123456",type:"password"}),n&&!e?w.button({className:"shared-link-settings-modal__password-change button-as-link",onClick:function(){return t.props.onPolicyUpdate("link_password","")}},A("Change",{comment:"A link to change the password for the shared link"})):void 0)},t._renderExpiryPolicy=function(){return t._renderFieldset(A("Add an expiry date to this link?"),w.div({},w.label({className:r({"shared-link-settings-modal__expiry-label-yes":!0,"u-font-meta":!t.props.linkMetadata.link_permissions.can_set_expiry})},w.input({checked:"no-expiry"!==t.state.selectedExpiry,className:"shared-link-settings-modal__expiry-option-yes",disabled:!t.props.linkMetadata.link_permissions.can_set_expiry,onChange:function(){if("no-expiry"===t.state.selectedExpiry)return t._handleExpirySelectChange(30)},type:"radio"}),t._renderYesExpiryText()),"custom"===t.state.selectedExpiry?t._renderExpiryCustom():void 0,w.label({className:r({"u-font-meta":!t.props.linkMetadata.link_permissions.can_remove_expiry})},w.input({checked:null==t.props.renderedPolicy.expires,className:"shared-link-settings-modal__expiry-option-no",disabled:!t.props.linkMetadata.link_permissions.can_remove_expiry,onChange:function(){return"function"==typeof t.props.onPolicyUpdate&&t.props.onPolicyUpdate("expires",null),t.setState({selectedExpiry:"no-expiry"})},type:"radio"}),A("No"))))},t._renderYesExpiryText=function(){if([7,30].includes(t.state.selectedExpiry))return w.span({className:"shared-link-settings-modal__expiry-text-yes"},A("Yes, expires in",{comment:'Label followed by a date range e.g. "Yes, expires in 7 days"'})," ",t._renderExpirySelect());if(["custom","read-only"].includes(t.state.selectedExpiry))return w.span({className:"shared-link-settings-modal__expiry-text-yes"},A("Yes, expires on",{comment:'Label followed by a date. e.g. "Yes, expires on 5/10/2017"'})," ","read-only"===t.state.selectedExpiry?o.format_date(t.props.linkMetadata.expires,o.localized_date_format):void 0);if("no-expiry"===t.state.selectedExpiry)return w.span({className:"shared-link-settings-modal__expiry-text-yes"},A("Yes"));throw"Expiry policy is in an unknown state"},t._renderExpirySelect=function(){return C(d.BubbleMenu,{position:d.BubbleMenu.POSITIONS.BOTTOM,targetFixed:!0,items:[7,30,"custom"].map(function(e){return C(d.BubbleMenuItem,{onClick:(function(e){return function(){return t._handleExpirySelectChange(e)}})(e)},t._renderExpirySelectLabel(e))}),targetButton:w.button({className:"shared-link-settings-modal__selected-expiry button-as-link"},t._renderExpirySelectLabel(t.state.selectedExpiry)," ",w.img({alt:"",className:"sprite sprite_web s_web_arrow-down-gray",src:E.static_url("/static/images/icons/icon_spacer-vflN3BYt2.gif")}))})},t._renderExpirySelectLabel=function(e){if(7===e)return A("7 days",{comment:'as in "This link expires in 7 days"'});if(30===e)return A("30 days",{comment:'as in "This link expires in 30 days"'});if("custom"===e)return A("Custom date...",{comment:"Dropdown option for expiry date on a link. The user can choose 7 days, 30 days, or a custom expiry"});throw"Unknown selected expiry"},t._handleExpirySelectChange=function(e){return t.setState({selectedExpiry:e}),"custom"===e&&(e=30),"function"==typeof t.props.onPolicyUpdate?t.props.onPolicyUpdate("expires",o.daysAfterToday(e)):void 0},t._renderExpiryCustom=function(){return w.span({className:"shared-link-settings-modal__calendar-input"},C(u.Calendar,{alignAtLeft:!1,onDateChange:function(e){return"function"==typeof t.props.onPolicyUpdate?t.props.onPolicyUpdate("expires",e):void 0},initDate:null!=t.props.linkMetadata.expires?t.props.linkMetadata.expires:o.daysAfterToday(30),firstDay:o.daysAfterToday(1),lastDay:o.daysAfterToday(365)}))},t._renderDownloadPolicy=function(){var e=t.props.linkMetadata.link_permissions.can_disallow_download,n=t.props.linkMetadata.link_permissions.can_allow_download,s=t.props.linkMetadata.link_permissions.allow_download;if(null!=e&&null!=n&&null!=s){var i=t._shouldRenderNoPreviewFileWarning();return e=e&&!i,t._renderFieldset(w.div({},A("Disable downloads for this link?"),w.div({className:"shared-link-settings-modal__no-download-advice"},w.a({href:"/help/files-folders/set-link-permissions",target:"_blank"},A("Learn more")))),w.div({},w.label({className:r({"u-font-meta":!e})},w.input({checked:!t.props.renderedPolicy.allow_download,className:"shared-link-settings-modal__disallow-download-yes",disabled:!e,onChange:function(){return"function"==typeof t.props.onPolicyUpdate?t.props.onPolicyUpdate("allow_download",!1):void 0},type:"radio"}),A("Yes")),w.label({className:r({"u-font-meta":!n})},w.input({checked:t.props.renderedPolicy.allow_download,className:"shared-link-settings-modal__disallow-download-no",disabled:!n,onChange:function(){return"function"==typeof t.props.onPolicyUpdate?t.props.onPolicyUpdate("allow_download",!0):void 0},type:"radio"}),A("No"))),t._renderNoPreviewFileWarning(i))}},t._shouldRenderNoPreviewFileWarning=function(){if(!t.props.isFile)return!1;if(null!=(null!=t.props.linkMetadata?t.props.linkMetadata.preview_type:void 0)){var e=t.props.linkMetadata.preview_type;if(Array.from(c.VALID_PREVIEW_TYPES).includes(e))return!1}return!0},t._renderNoPreviewFileWarning=function(e){if(e){var n=l.file_extension(t.props.linkMetadata.name),r=n.toUpperCase();return w.div({className:"shared-link-settings-modal__preview-warning c-banner c-banner--warning"},w.div({className:"o-flag"},w.div({className:"o-flag-fix"},C(m,{alt:"",group:"web",name:"page_white_32"})),w.div({className:"o-flag__flex u-pad-left-xs"},A("%(file_extension)s files can’t be previewed. Downloads must be enabled to share.",{comment:'as in "People can’t view this .PDF file'}).format({file_extension:"."+r}))))}},t._renderCommentsPolicy=function(){if(!t.props.linkMetadata.link_permissions.team_restricts_comments)return t._renderFieldset(w.div({},A("Who can comment?"),w.div({className:"shared-link-settings-modal__commenting-advice"},(t.props.linkMetadata.link_permissions.allow_comments,w.a({href:"/help/9016#comments",target:"_blank"},A("Learn more"))))),w.div({},w.div({className:"shared-link-settings-modal__commenting-policy"},v.formatLinkCommentingVisibility(t.props.linkMetadata.link_permissions.allow_comments,t._getResolvedVisibility(t.props.renderedPolicy.requested_visibility),t.props.linkMetadata.link_permissions.restricting_shared_folder_path))))},t._getResolvedVisibility=function(e){var n=t.props.linkMetadata.link_permissions.visibility_policies.filter(function(t){return t.policy===e});if(1!==n.length)throw"Logic error: "+n.length+" should be 1.";return n[0].resolved_policy},t._renderFieldset=function(e,t,n){return void 0===n&&(n=null),w.fieldset({className:"settings-form-entry"},w.legend({className:"settings-form-entry__explanation u-trim-margin"},e),w.div({className:"settings-form-entry__options"},t),w.div({className:"u-mar-top-m"},n))},t._renderButtons=function(){return w.div({className:"u-mar-top-m clearfix"},t.props.linkMetadata.link_permissions.can_revoke?w.div({className:"u-l-fl"},w.button({className:"button-as-link delete-link",onClick:t.props.onDeleteLink,style:{lineHeight:"32px"},type:"button"},A("Delete link"))):void 0,w.div({className:"u-l-fr"},w.button({className:"c-btn c-btn--primary confirm-button",disabled:t.props.isSubmitting||!t.props.canSubmit,onClick:t.props.onSubmit},A(t.props.isSubmitting?"Saving...":"Save settings")),w.button({className:"c-btn c-btn--secondary u-mar-left-xs cancel-button",onClick:t.props.onCancel},A("Cancel"))))},t}return n.__extends(t,e),t.prototype.render=function(){return w.div({className:"shared-link-settings-modal__contents"},this._renderHeader(),this._renderPolicies(),this._renderButtons())},t.displayName="SharedLinkSettingsModalContents",t.propTypes={canSubmit:s.PropTypes.bool.isRequired,isFile:s.PropTypes.bool.isRequired,isSubmitting:s.PropTypes.bool.isRequired,linkMetadata:s.PropTypes.instanceOf(f.LinkMetadata).isRequired,onCancel:s.PropTypes.func,onSubmit:s.PropTypes.func,onPolicyUpdate:s.PropTypes.func,onDeleteLink:s.PropTypes.func,renderedPolicy:s.PropTypes.instanceOf(f.LinkPolicy).isRequired,showUpgradeToBiz:s.PropTypes.bool.isRequired,showUpgradeMessage:s.PropTypes.bool.isRequired,isTeam:s.PropTypes.bool},t})(s.Component);t.SharedLinkSettingsModalContents=k,t.showUpgradeToBizBanner=function(e){return b.SHARING_MODAL.SHOW_UPGRADE_TO_BIZ_BANNER[e]},t.SharedLinkSettingsModal=p(M,["/static/css/sharing/share_modal-vflm4LDVj.css"])}),define("modules/clean/sharing/member_avatars",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/photo_avatar","modules/clean/avatar/shared_link_avatar","modules/clean/avatar/viewer_avatar","modules/clean/avatar/list","modules/clean/components/title_bubble","modules/clean/datetime","modules/clean/em_string","modules/clean/react/tooltip","modules/clean/sharing/constants","modules/clean/sharing/link_description","modules/clean/static_urls","modules/clean/viewer","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y){"use strict";function v(e){var t=e.overflowCount,n=e.avatarArgs,s=void 0===n?{}:n,o=y.ungettext("%(count)s more member","%(count)s more members",t).format({count:t}),a=t>=99?"99+":""+t,l=b(s),c=l.avatarDimension,u=l.onAvatarClick,p=l.titleButtonDirection;return r.createElement(d,{key:"overflow_count",text:o,direction:p},r.createElement(i.InitialsAvatar,{alt:o,dimension:c,initials:a,color:"#7B8994",shape:"CIRCLE",onClick:u}))}function S(e){if(!e)return!1;var t=g.Viewer.get_viewer();if(t.is_paired){var n=t.get_user_ids(!0),r=e.map(function(e){return e.user_id});if(r.includes(n[0])&&r.includes(n[1]))return!0}return!1}function E(e,t,n){return function(r){e&&e(t,n),r.stopPropagation()}}function b(e){return n.__assign({},R,e)}function I(e){var t,o=e.arePairedUsersInSF,a=e.member,c=e.avatarArgs,u=void 0===c?{}:c,h=a.user_id,_=g.Viewer.get_viewer(),f=_.get_user_ids(!0).includes(h),y="";if(f&&o){var v=a.user_id,S=_.get_user_by_role("personal",!0),I=_.get_user_by_role("work",!0);S&&v===S.id?y="Personal":I&&v===I.id&&null!=_.team_name&&(y=_.team_name)}else y=a.display_name;y=p.Emstring.em_snippet(y,m.SNIPPET_SIZES.DISPLAY_NAME);var T=N(y,a.access_type,f,o),C=b(u),w=C.avatarDimension,A=C.onAvatarClick,M=C.titleButtonDirection,k=E(A,"member",a),P={alt:T,dimension:w,onPhotoClick:k,photoUrl:a.photo_url,defaultAvatar:r.createElement(i.InitialsAvatarWithColorDerivedFromName,{alt:T,dimension:w,name:a.display_name,initials:a.initials.toUpperCase(),shape:"CIRCLE",onClick:k})};return t=f?r.createElement(l,n.__assign({},P)):r.createElement(s,n.__assign({},P)),r.createElement(d,{key:"user:"+a.user_id+":"+a.photo_url,text:T,direction:M},t)}function T(e){var t,n,s=e.group,a=e.avatarArgs,l=void 0===a?{}:a,c=b(l),u=c.avatarDimension,p=c.onAvatarClick,h=c.titleButtonDirection,m=E(p,"group",s);return s.is_automatic?(n=M(s.name,s.access_type),t=r.createElement(o.PhotoAvatar,{alt:n,dimension:u,photoUrl:f.static_url("/static/images/icons/team_32-vflk8mBzO.png"),shape:"SQUARE",onClick:m})):(n=k(s.name,s.access_type,s.num_users),t=r.createElement(i.InitialsAvatarWithColorDerivedFromName,{alt:n,dimension:u,name:s.name,shape:"SQUARE",initials:A(s.name),onClick:m})),r.createElement(d,{key:"group:"+s.gid+":"+s.name,text:n,direction:h},t)}function C(e){var t=e.index,n=e.description,s=e.avatarArgs,i=void 0===s?{}:s,o=b(i),a=o.avatarDimension,l=o.onAvatarClick,c=o.titleButtonDirection;return r.createElement(d,{key:"placeholder:"+t,text:n,direction:c},r.createElement("button",{className:"u-unbutton c-avatar--m",onClick:l?l:void 0},r.createElement("img",{alt:n,src:f.static_url("/static/images/icons/no_member-vflE0FYQV.svg"),width:a,height:a})))}function w(e){var t=e.invited_member,n=e.avatarArgs,s=void 0===n?{}:n,o=b(s),a=o.avatarDimension,l=o.onAvatarClick,c=o.titleButtonDirection,u=E(l,"invited",t),p=N(t.email_or_fbname,"pending",!1);return r.createElement(d,{key:"invitation:"+t.invitation_id,text:p,direction:c},r.createElement(i.InitialsAvatar,{alt:p,dimension:a,color:"#aaa",initials:A(t.email_or_fbname),shape:"CIRCLE",onClick:u}))}function A(e){if(null==e||!(e.length>0))return"";var t=e.split(" "),n=t.map(function(e){return e.charAt(0).toLowerCase()});return n.length>2&&(n=n.splice(0,2)),n.join("")}function M(e,t){return("editor"===t?y._("%(team_group_name)s can edit"):y._("%(team_group_name)s can view")).format({team_group_name:p.Emstring.em_snippet(e,m.SNIPPET_SIZES.DISPLAY_NAME)})}function k(e,t,n){var r;return r="editor"===t?y.ungettext("%(num_users)s person in %(group_name)s can edit","%(num_users)s people in %(group_name)s can edit",n):y.ungettext("%(num_users)s person in %(group_name)s can view","%(num_users)s people in %(group_name)s can view",n),r.format({group_name:p.Emstring.em_snippet(e,m.SNIPPET_SIZES.DISPLAY_NAME),num_users:n})}function N(e,t,n,r){void 0===r&&(r=!1);var s,i={viewer:y._("You can view"),editor:y._("You can edit"),owner:y._("You’re the owner"),team:y._("You’re a member of this team folder"),default:y._("You")},o={viewer:y._("%(name)s can view"),editor:y._("%(name)s can edit"),owner:y._("%(name)s is the owner"),pending:y._("%(name)s hasn’t added this to their Dropbox yet"),team:y._("%(name)s is a member of this team folder"),default:y._("%(name)s"),"no access":y._("No access")},a={viewer:y._("You (%(name)s) can view"),editor:y._("You (%(name)s) can edit"),owner:y._("You (%(name)s) are the owner")};return s=n?r&&null!=e?a:i:o,s.hasOwnProperty(t)?s[t].format({name:p.Emstring.em_snippet(e,m.SNIPPET_SIZES.DISPLAY_NAME)}):""}function P(e,t,n,s,i){void 0===s&&(s=5);var o,a,l=e.length,c=t.length+n.length,d=function(e){return p.Emstring.em_snippet(e,17)};if(c>0){var u=L(t.map(function(e){return d(e.display_name)}).concat(n.map(function(e){return d(e.email_or_fbname)})),s);o=r.createElement(h.Tooltip,{key:"members_text",position:h.TooltipPosition.BOTTOM,tooltip_contents:u.join("\n"),tooltip_classname:i},y.ungettext("%(member_count)s member","%(member_count)s members",c).format({member_count:c}))}if(l>0){var u=L(e.map(function(e){return d(e.name)}),s);a=r.createElement(h.Tooltip,{key:"groups_text",position:h.TooltipPosition.BOTTOM,tooltip_contents:u.join("\n"),tooltip_classname:i},y.ungettext("%(group_count)s group","%(group_count)s groups",l).format({group_count:l}))}return o&&!a?o:a&&!o?a:a&&o?r.createElement("div",null,a,", ",o):void 0}function L(e,t){if(e.length>t){var n=e.slice(0,t-1),r=e.length-(t-1);return n.push(y.ungettext("and %(num)s more…","and %(num)s more…",r,{comment:"Number of additional members. Expected to be >= 2."}).format({num:r})),n}return e}Object.defineProperty(t,"__esModule",{value:!0});t.MemberAvatarsMixin={getInitialState:function(){return{paired_users_in_sf:!1}},componentWillMount:function(){var e=S(this.props.joinedMembers);this.setState({paired_users_in_sf:e})},componentWillReceiveProps:function(e){var t=S(e.joinedMembers);this.setState({paired_users_in_sf:t})},findOwnerAndMeInJoinedMembers:function(e){for(var t=null,n=null,r=0,s=e;r<s.length;r++){var i=s[r];if("owner"===i.access_type&&(t=i),i.user_id===this.props.user.id&&(n=i),t&&n)break}return[t,n]},addGroupsMembersInvitations:function(e,t,n,r,s){var i={avatarDimension:this.props.avatarDimension,onAvatarClick:this.props.onAvatarClick,titleButtonDirection:this.props.titleButtonDirection};null==s&&(s=[]);for(var o=0,a=t;o<a.length;o++){var l=a[o];e.push(T({group:l,avatarArgs:i}))}for(var c=0,d=n;c<d.length;c++){var u=d[c];s.includes(u.user_id)||e.push(I({arePairedUsersInSF:this.state.paired_users_in_sf,member:u,avatarArgs:i}))}for(var p=0,h=r;p<h.length;p++){var m=h[p];e.push(w({invited_member:m,avatarArgs:i}))}},renderAvatarList:function(e,t){return r.createElement(c,{avatars:e,avatarDimension:this.props.avatarDimension,maxVisible:this.props.maxVisibleAvatars,undisplayableCount:this.props.numUndisplayableUsersAndInvites||0,onOverflowCountClick:this.props.onOverflowCountClick,overflowCountRenderer:v,animation:this.props.animation,className:t||""})},renderSharedLink:function(e,t){var n,s,i=this,o=this.getDescriptionForSharedLinkInfo(e,t),l=r.createElement(a,{alt:o,dimension:this.props.avatarDimension,onClick:function(t){i.props.onSharedLinkClick(e),t.stopPropagation()}});return(null!=e?e.allow_download:void 0)===!1?(n="sharing-icon-bubble-title u-font-center",s=!0):(n="",s=!1),r.createElement(d,{key:"shared_link",text:o,direction:"south",className:n,respectLineBreaks:s},l)},getDescriptionForSharedLinkInfo:function(e,t){var n;if(t)return _.formatSharedContentLinkDescription(t);var r=e.visibility_type,s=e.expires_posix,i=e.shared_folder_link_policy,o="";if(s){var a=(new Date).getTime()/1e3,l=s-a,c=Math.floor(l/86400)
;if(l<0)return y._("Link Disabled");n=new Date(1e3*s);var d=c>180;n=u.nice_date_with_month_name(n,d,!1,!0)}e.allow_download===!1&&(o=". "+y._("Downloading is disabled.",{comment:'This follows a description of link visibility. For example: "Anyone with the link can view this file. Downloading is disabled."'}));var p="MEMBERS_ONLY"===i;if(n){if(p)return y._("Folder members with the link can view until %(date)s").format({date:n})+o;if(r===m.SHMODEL_LINK_TOKEN_VISIBILITY.PUBLIC)return y._("People with the link can view until %(date)s").format({date:n})+o;if(r===m.SHMODEL_LINK_TOKEN_VISIBILITY.PASSWORD)return y._("People with the password can view until %(date)s").format({date:n})+o;if(r===m.SHMODEL_LINK_TOKEN_VISIBILITY.TEAM_ONLY)return y._("People at %(team_name)s can view until %(date)s").format({team_name:g.Viewer.get_viewer().team_name,date:n})+o;if(r===m.SHMODEL_LINK_TOKEN_VISIBILITY.ONLY_YOU)return y._("Only you can view until %(date)s").format({date:n})+o}else{if(p)return y._("Folder members with the link can view")+o;if(r===m.SHMODEL_LINK_TOKEN_VISIBILITY.PUBLIC)return y._("People with the link can view")+o;if(r===m.SHMODEL_LINK_TOKEN_VISIBILITY.PASSWORD)return y._("People with the password can view")+o;if(r===m.SHMODEL_LINK_TOKEN_VISIBILITY.TEAM_ONLY)return y._("People at %(team_name)s with the link can view").format({team_name:g.Viewer.get_viewer().team_name})+o;if(r===m.SHMODEL_LINK_TOKEN_VISIBILITY.ONLY_YOU)return y._("Only you can view")+o}throw Error("Unable to construct description!")}},t.renderOverflowCount=v;var R={avatarDimension:32,onAvatarClick:null,titleButtonDirection:"south"};t.renderJoinedMember=I,t.renderGroup=T,t.renderPlaceholderAvatar=C,t.renderInvitedPerson=w,t.buildGroupsAndMembersText=P}),define("modules/clean/sharing/parent_folder_access_modal",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/react/flag","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=d.i18n_default_project("sharing"),p=u._,h=u.ungettext,m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dismissModal=function(){o.Modal.close(),t.handleDismissed()},t.handleDismissed=function(){t.props.onClose&&t.props.onClose()},t.handleNavigateToParentFolder=function(e){return function(){o.Modal.close(),t.props.onParentFolderClicked&&t.props.onParentFolderClicked(e.path,t.arePermissionsAllowed(e.permissions))}},t.arePermissionsAllowed=function(e){return e.some(function(e){return e&&e.allow})},t.memberCanEdit=function(){return[l.ACCESS_LEVEL.OWNER,l.ACCESS_LEVEL.WRITER].indexOf(t.props.memberAccessLevelResult.access_level)>-1},t.getInfoStr=function(){return"remove"===t.props.originalAction?t.props.contentInfo.isFolder()?h("As a member of the parent folder listed below, %(member_name)s can still access the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still access the contents of “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):h("As a member of the parent folder listed below, %(member_name)s can still access “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still access “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):t.props.contentInfo.isFolder()?t.memberCanEdit()?h("As a member of the parent folder listed below, %(member_name)s can still edit the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still edit the contents of “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):h("As a member of the parent folder listed below, %(member_name)s can still view the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still view the contents of “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):t.memberCanEdit()?h("As a member of the parent folder listed below, %(member_name)s can still edit “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still edit “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):h("As a member of the parent folder listed below, %(member_name)s can still view “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still view “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length)},t.renderParentFolderContent=function(){var e=t.getInfoStr();return r.createElement("div",null,e.format({member_name:s.Emstring.em_snippet(t.props.memberDisplayName,c.SNIPPET_SIZES.DISPLAY_NAME),content_name:s.Emstring.em_snippet(t.props.contentInfo.name()||"",c.SNIPPET_SIZES.FILENAME)}),r.createElement("div",{className:"parent-folder-access-modal__folder-list u-mar-top-s"},r.createElement("ul",{className:"o-list-ui o-list-ui--dividers"},t.props.memberAccessLevelResult.parentFolders.map(t.renderParentFolder))))},t.renderParentFolder=function(e){var n=r.createElement(a,{group:"web",name:"folder_user_32",className:"u-pad-right-xs",alt:""});return r.createElement("li",null,r.createElement("div",{className:"parent-folder-access-modal__parent-folder u-pad-vertical-xs u-pad-horizontal-s",onClick:t.handleNavigateToParentFolder(e)},r.createElement(i.Flag,{leftAttachment:n,rightAttachment:t.renderFolderLink(e)},r.createElement("span",{className:"parent-folder-access-modal__folder-name"},s.Emstring.em_snippet(e.name,c.SNIPPET_SIZES.FILENAME)))))},t.renderFolderLink=function(e){return r.createElement("button",{className:"button-as-link",onClick:t.handleNavigateToParentFolder(e),type:"button"},p(t.arePermissionsAllowed(e.permissions)?"Manage membership":"View folder"))},t.renderSimpleContent=function(){return r.createElement("div",null,r.createElement("span",{className:"parent-folder-access-modal__warning"},t.props.memberAccessLevelResult.warning),r.createElement("div",{className:"u-mar-top-m clearfix"},r.createElement("div",{className:"u-l-fr"},r.createElement("button",{className:"c-btn c-btn--primary confirm-button",onClick:t.dismissModal},p("OK")))))},t.getTitleStr=function(){return p("remove"===t.props.originalAction?t.props.contentInfo.isFolder()?"%(member_name)s can still access this folder":"%(member_name)s can still access this file":t.props.contentInfo.isFolder()?t.memberCanEdit()?"%(member_name)s can still edit this folder":"%(member_name)s can still view this folder":t.memberCanEdit()?"%(member_name)s can still edit this file":"%(member_name)s can still view this file")},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.getTitleStr();return r.createElement(o.Modal,{autoClose:!1,className:"parent-folder-access-modal",buttonComponent:r.createElement("span",null),onDismissCompleted:this.handleDismissed,title:e.format({member_name:s.Emstring.em_snippet(this.props.memberDisplayName,c.SNIPPET_SIZES.DISPLAY_NAME)})},r.createElement("div",{className:"parent-folder-access-modal__contents"},this.props.memberAccessLevelResult.parentFolders&&!this.props.isInContentManager?this.renderParentFolderContent():this.renderSimpleContent()))},t.displayName="ParentFolderAccessModal",t})(r.Component);t.ParentFolderAccessModal=m}),define("modules/clean/sharing/settings_modal/views/link_settings_tab",["require","exports","modules/clean/em_string","modules/core/i18n","external/react","modules/clean/sharing/api/types/metadata","modules/clean/sharing/sharing_settings_constants","modules/clean/sharing/gating_util","modules/constants/trademark"],function(e,t,n,r,s,i,o,a,l){"use strict";function c(){return u("Link settings")}function d(e){return a.isUserNoCommentEnabled(e)?[o.AUDIENCE_POLICY,o.ACCESS_LEVEL_POLICY,o.EXPIRY_POLICY,o.PASSWORD_POLICY]:[o.AUDIENCE_POLICY,o.EXPIRY_POLICY,o.PASSWORD_POLICY]}Object.defineProperty(t,"__esModule",{value:!0});var u=r.i18n_default_project("sharing")._;t.TabName=c,t.Description=function(e){var t;return t="owner"===e.aclUpdatePolicy?u(e.isTeamFolderTree?"Only team admins can change these settings":e.userIsOwner?"Only you (the owner) can change these settings":"Only the owner can change these settings"):null!=e.ownerTeam?u("Members of %(team_name)s with edit access can change these settings").format({team_name:n.Emstring.em_snippet(e.ownerTeam.name,12)}):u("Anyone with edit access can change these settings"),s.createElement("span",null,t)},t.Banner=function(e){var t,n=e.linkMetadata.link_permissions&&e.linkMetadata.link_permissions.some(function(e){return!(!e||!e.allow)}),r=null!=e.linkMetadata.link_permissions.set_password&&e.linkMetadata.link_permissions.set_password.reason===i.VisibilityDisallowedReason.user_account_type;if(n){if(!r)return s.createElement("div",null);t=e.user.is_team?s.createElement("a",{href:"/team/upgrade",target:"_blank",rel:"noopener noreferrer"},u("Upgrade to %(trademark_business)s to enable expiration and password settings").format({trademark_business:l.TRADEMARK_BUSINESS})):s.createElement("a",{href:"/upgrade?oqa=sfp",target:"_blank",rel:"noopener noreferrer"},u("Upgrade to Dropbox %(trademark_professional)s to enable expiration and password settings.").format({trademark_professional:l.TRADEMARK_PROFESSIONAL}))}else t=s.createElement("span",null,u("You don’t have permission to modify these link settings"));return s.createElement("div",{className:"sharing-settings-modal__banner u-font-center"},t)},t.getPolicies=d}),define("modules/clean/sharing/settings_modal_components",["require","exports","tslib","external/classnames","external/react","external/spectrum/button","modules/clean/react/css","modules/core/i18n"],function(e,t,n,r,s,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=s.DOM,c=a.i18n_default_project("sharing")._,d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return l.div({className:"u-l-fr"},s.createElement(i.Button,{className:"cancel-button",variant:"secondary",onClick:this.props.onDismiss},c("Cancel")),s.createElement(i.Button,{className:"confirm-button u-mar-left-s",variant:"primary",disabled:this.props.disableSave||this.props.isAccepting,onClick:this.props.onAccept},c(this.props.isAccepting?"Saving...":"Save")))},t.displayName="SettingsModalButtons",t.propTypes={disableSave:s.PropTypes.bool,isAccepting:s.PropTypes.bool,onAccept:s.PropTypes.func,onDismiss:s.PropTypes.func},t})(s.Component);t.SettingsModalButtons=d;var u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this;return l.fieldset({className:r({"settings-form-entry":!0,"settings-form-entry--no-permissions":!this.props.canChange})},this.props.canChange||void 0===this.props.denyReason?void 0:l.div({className:"u-pad-xs u-font-center u-mar-bottom-s shared-folder-settings-form__no-permissions-banner"},this.props.denyReason),l.legend({className:"settings-form-entry__explanation u-trim-margin"},this.props.policyDescription),l.div({className:"settings-form-entry__options"},Array.from(this.props.options).map(function(t){return l.label({key:t.value},l.input({checked:t.value===e.props.currentValue,className:"settings-form-entry-option-"+e.props.policyName+"__"+t.value,disabled:!e.props.canChange,name:e.props.policyName,onChange:function(t){return"function"==typeof e.props.handleOptionChange?e.props.handleOptionChange(t.target.name,t.target.value):void 0},type:"radio",value:t.value}),t.label)})))},t.displayName="SinglePolicyControl",t.propTypes={canChange:s.PropTypes.bool,denyReason:s.PropTypes.string,currentValue:s.PropTypes.string,handleOptionChange:s.PropTypes.func,options:s.PropTypes.array,policyDescription:s.PropTypes.string,policyName:s.PropTypes.string},t.defaultProps={canChange:!0},t})(s.Component),p=o(u,["/static/css/sharing/share_modal-vflm4LDVj.css"]);t.SinglePolicyControl=p}),define("modules/clean/sharing/share_modal",["require","exports","tslib","external/immutable","external/react","modules/clean/flux/dispatcher","modules/clean/flux/store_listener","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/pass/store","modules/clean/react/pass/utils","modules/clean/sharing/api/types/metadata","modules/clean/sharing/access_level","modules/clean/sharing/api/util/types","modules/clean/sharing/file_settings_modal","modules/clean/sharing/folder_settings_modal","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/ui_util","modules/clean/sharing/views/inherited_members","modules/clean/sharing/views/modal_content","modules/clean/viewer","modules/constants/sharing","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y,v,S,E,b,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var T=s.createElement,C=I.i18n_default_project("sharing")._,w=function(e){var t=d.AnonymousViewerUtils.getAnonymousUserIds(e),n=C("Guest");return t.map(function(e){return new u.UserMembershipInfo({access_type:p.ACCESS_LEVEL.READER,account:new u.BasicAccount({account_id:e,display_name:n,familiar_name:n,given_name:n,surname:""}),account_id:e,initials:d.AnonymousViewerUtils.getAnonymousViewerInitials(n),is_inherited:!1,permissions:new u.MemberPermissions({make_editor:new u.PermissionSetting({allow:!1}),make_viewer:new u.PermissionSetting({allow:!1}),make_owner:new u.PermissionSetting({allow:!1}),remove:new u.PermissionSetting({allow:!1})}),same_team:!1,time_last_seen:null})})},A=function(e){var t=e.actionHandler.getSharingInfo(),s=e.actionHandler.getPassInfo(),i=s.groupSeenStateInfo,o=s.presentAccountIds,a=s.passFetchingStatus,l={actionHandler:e.actionHandler,areMembersFullyLoaded:t.areMembersFullyLoaded(),areSharingPrefsLoaded:t.areSharingPrefsLoaded(),banner:t.banner(),canChangeOptions:t.canChangeOptions(),canEdit:t.canEdit(),canInviteEditor:t.canInviteEditor(),canInviteViewer:t.canInviteViewer(),canInviteViewerNoComment:t.canInviteViewerNoComment(),canMakeViewerNoComment:t.canMakeViewerNoComment(),canRelinquishMembership:t.canRelinquishMembership(),canShareLink:t.canShareLink(),canUnshareFile:t.canUnshareFile(),canUnshareFolder:t.canUnshareFolder(),canUpdateConfidentiality:t.canUpdateConfidentiality(),contactsError:t.contactsError(),contentInfo:t.contentInfo(),contentNameMessage:t.contentNameMessage(),contentNameMessageLevel:t.contentNameMessageLevel(),filePolicy:t.filePolicy(),folderPolicy:t.folderPolicy(),guestMembers:w(o),groupSeenStateInfo:i,hasDisplayableMembers:t.hasDisplayableMembers(),hasNonOwnerMembers:t.hasNonOwnerMembers(),hasParentSharedFolder:t.hasParentSharedFolder(),initialRecipientRawInput:t.initialRecipientRawInput(),initialRecipientTokens:t.initialRecipientTokens(),isConfidentialFolder:t.isConfidentialFolder(),isContentNameFocused:t.isContentNameFocused(),isFolderInsideTeamFolderTree:t.isFolderInsideTeamFolderTree(),isLinkMetadataLoaded:t.isLinkMetadataLoaded(),isMetadataLoaded:t.isMetadataLoaded(),isNoCommentEnabledForFolders:t.isNoCommentEnabledForFolders(),isNoCommentEnabledForLinks:t.isNoCommentEnabledForLinks(),isOwner:t.isOwner(),isTeamPolicyLoaded:t.isTeamPolicyLoaded(),isTeamSharedFolder:t.isTeamSharedFolder(),isTokenizerEmpty:t.isTokenizerEmpty(),isUserOnOwnerTeam:t.isUserOnOwnerTeam(),linkMetadata:t.linkMetadata(),linkOnlyReason:t.linkOnlyReason(),memberCounts:t.memberCounts(),memberCountWithRecipients:t.memberCountWithRecipients(),members:t.members(),metadata:t.metadata(),ownerTeam:t.ownerTeam(),passFetchingStatus:a,pendingMemberAction:t.pendingMemberAction(),permissions:t.permissions(),presentAccountIds:r.Set(o),recipientAccess:t.recipientAccess(),recipientMessage:t.recipientMessage(),recipientTokens:t.recipientTokens(),shareFolderPromise:t.shareFolderPromise(),shouldBlockMemberListOnPassLoad:t.shouldBlockMemberListOnPassLoad(),teamPolicy:t.teamPolicy(),uiMode:t.uiMode(),expSubgrowthProOverquotaCreateSharedLink:t.expSubgrowthProOverquotaCreateSharedLink()};return n.__assign({},t.getInitialProps(),l)},M=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSettingsClick=function(){t.props.contentInfo.isFolder()?t.handleFolderSettingsClick():t.handleFileSettingsClick()},t.handleSetConfidentialClick=function(){l.Modal.showInstance(s.createElement(v.SetInheritedMembersUIConfidentialModal,{actionHandler:t.props.actionHandler,initialIsConfidentialFolder:t.props.isConfidentialFolder,contentInfo:t.props.contentInfo,teamName:t.props.ownerTeam.name,onCancel:t.props.actionHandler.openShareModal}))},t}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){var e=this.getTokenizer();this.props.actionHandler.onShareModalUnmount(e)},t.prototype.render=function(){var e=c.passStore.getPassPermissions(this.props.contentInfo.id),t=e&&e.canReadPresence,r=!!(this.props.contentInfo.isFile()?this.props.filePolicy&&this.props.filePolicy.viewer_info_policy:this.props.folderPolicy&&this.props.folderPolicy.viewer_info_policy),i={headerId:"unified-share-modal-title",areCheckboxSettingsLoaded:this.props.areSharingPrefsLoaded,isLimitedTeam:this.props.viewer.team_is_limited,isPassEnabled:t,isInContentManager:this.props.isInContentManager,onSettingsClick:this.handleSettingsClick,onToggleInheritanceClick:this.handleSetConfidentialClick,mode:this.props.uiMode,ref:"content",showContentManagerBridge:this.shouldRenderContentManagerBridge(),showPassFileSettings:r};return i=n.__assign({},this.props,i),s.createElement(l.Modal,{style:"bare",acceptButtonText:null,dismissButtonText:null,headerId:"unified-share-modal-title",ref:"modal"},T(S.ShareModalContent,i))},t.prototype.refreshSharedWithColumnLinkData=function(){i.Dispatcher.dispatch({type:a.SharedWithActionType.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this.props.contentInfo.displayPath()]}})},t.prototype.handleFolderPolicySuccess=function(e,t){i.Dispatcher.dispatch({type:f.SharePageActionTypes.FETCH_FOLDER_POLICY_SUCCESS,user:this.props.user,metadata:t,folderPolicy:e})},t.prototype.getTokenizer=function(){return this.refs.content&&this.refs.content.getWrappedComponent()&&this.refs.content.getWrappedComponent().refs.tokenizer},t.prototype.handleFileSettingsClick=function(){var e=this,t=b.TRUELINK.TRUELINK_UI[this.props.user.id]?h.getCombinedPolicy(this.props.filePolicy,this.props.linkMetadata):this.props.filePolicy,n=function(n){null!=n&&e.props.actionHandler.handleUpdateFilePolicy(n,t),e.props.actionHandler.openShareModal()};l.Modal.showInstance(s.createElement(m.FileSettingsModal,{fileName:this.props.contentInfo.name(),contentId:this.props.contentInfo.id,canChangeOptions:this.props.canChangeOptions,canUnshareFile:this.props.canUnshareFile,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,initialPolicy:t,linkMetadata:this.props.linkMetadata,onCancel:n,onPolicySet:n,ownerTeam:this.props.ownerTeam,permissions:this.props.permissions,user:this.props.user})),y.logTiburonEvent(this.props.contentInfo,this.props.user.id,"OPEN_FILE_SETTINGS_MODAL")},t.prototype.handleFolderSettingsClick=function(){var e=this,t=b.TRUELINK.TRUELINK_UI[this.props.user.id]?h.getCombinedPolicy(this.props.folderPolicy,this.props.linkMetadata):this.props.folderPolicy,n=function(t,n){null!=n&&(e.props.actionHandler.handleUpdateSharingSettings(n),e.handleFolderPolicySuccess(t,n),e.props.onSuccessSharing&&e.props.onSuccessSharing(),n.policy.shared_link_policy!==e.props.folderPolicy.shared_link_policy&&(e.props.actionHandler.fetchLinkMetadata(),e.refreshSharedWithColumnLinkData())),e.props.actionHandler.openShareModal()},r=null,i=null;this.props.contentInfo.extras&&this.props.contentInfo.extras.nsId&&(r=this.props.contentInfo.extras.nsId,i=this.props.contentInfo.extras.nsPath),l.Modal.showInstance(s.createElement(_.SharedFolderSettingsModal,{actionHandler:this.props.actionHandler,folderName:this.props.contentInfo.name(),folderId:this.props.metadata.shared_folder_id,folderPath:this.props.contentInfo.displayPath(),nsId:r,nsPath:i,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,hasParentSharedFolder:this.props.hasParentSharedFolder,initialHasParentSharedFolder:this.props.hasParentSharedFolder,initialMetadata:this.props.metadata,initialOwnerTeam:this.props.ownerTeam,initialPermissions:this.props.permissions,initialPolicy:t,isInContentManager:this.props.isInContentManager,isSharedFolder:this.props.contentInfo.isSharedFolder(),initialIsTeamSharedFolder:this.props.isTeamSharedFolder,isConfidentialFolder:this.props.isConfidentialFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isLimitedTeam:this.props.viewer.team_is_limited,isUserOnOwnerTeam:this.props.isUserOnOwnerTeam,linkMetadata:this.props.linkMetadata,onCancel:n,onPolicySet:n,showContentManagerBridge:this.shouldRenderContentManagerBridge(!0),teamPolicy:this.props.teamPolicy,updateLinkSettings:this.props.actionHandler.updateLinkSettings,user:this.props.user}))},t.prototype.shouldRenderContentManagerBridge=function(e){return void 0===e&&(e=!1),!this.props.isInContentManager&&(!!y.GoldenGate.hasContentManagerAndSuperAdmin(this.props.user.id)&&(!!this.props.isTeamSharedFolder||!(!this.props.isFolderInsideTeamFolderTree||!this.props.isUserOnOwnerTeam)&&(e||!this.props.canInviteEditor)))},t.displayName="ShareModal",t.defaultProps={viewer:E.Viewer.get_viewer()},t})(s.Component);t.ShareModal=o.listenToStores(M,{sharingInfoStore:g.sharingInfoStore,passStore:c.passStore},A)}),define("modules/clean/sharing/share_modal_icon",["require","exports","tslib","external/react","external/spectrum/icon_content","modules/clean/filetypes","modules/clean/react/icon/file_icon","modules/clean/react/icon/icon_helper"],function(e,t,n,r,s,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return this.props.isFolder?this.renderFolder():this.renderFile()},t.prototype.renderFile=function(){var e={file:{type:i.FileTypes.FILE,fq_path:this.props.filename},className:this.props.className,variant:"small"};return r.createElement(o.FileIcon,n.__assign({},e))},t.prototype.renderFolder=function(){var e=i.FileTypes.FOLDER;this.props.pathExists&&(this.props.isTeamSharedFolder?e=i.FileTypes.TEAM_SHARED_FOLDER:this.props.isSharedFolder&&(e=i.FileTypes.SHARED_FOLDER));var t=a.spectrum_folder_icon({fileType:e,isViewOnly:this.props.isViewOnly,isInTeamFolderTree:this.props.isFolderInsideTeamFolderTree,size:a.ICON_SIZES.LARGE});return r.createElement(s.IconContent,{name:t,alt:this.props.alt,className:this.props.className})},t})(r.Component);t.ShareModalIcon=l}),define("modules/clean/sharing/share_modal_util",["require","exports","tslib","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/contacts/contact","modules/clean/contacts/types","modules/clean/filetypes","modules/clean/react/browse/action_logger","modules/clean/react/browse/models","modules/clean/react/teams/modals/limited_team_folder_settings_modal","modules/clean/react/teams/modals/limited_team_share_folder_modal","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/content_info","modules/clean/sharing/public_folder/public_folder","modules/clean/sharing/share_modal","modules/clean/sharing/ui_util","modules/clean/viewer"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateModalSessionId=function(){return Math.random().toString()},t.getSharingInfo=function(e,r,s){void 0===s&&(s={});var i=null;"number"==typeof e&&(e=v.Viewer.get_viewer().get_user_by_id(e)),null==s.userHomeNs&&(s.userHomeNs=e.home_ns_id);var o=t.getShareModalInfo(r),a=null;if(null!=o){o=n.__assign({},o,s),o.modalSessionId&&(o.modalSessionId=t.generateModalSessionId());var d=o.nsId,u=o.sjid,p=o.fileId,h=o.filename,m=o.fqPath;l.logViewShareModel({uid:e.id,modal_session_id:o.modalSessionId||"",file_nsid:d,file_sjid:u,file_id:p,file_name:h,file_path:m});try{i=_.ContentInfo.createFromParams(o)}catch(e){i=null}a=r instanceof c.BrowseContext?r:o.browseContext}return{browseContext:a,contentInfo:i,shareModalInfo:o,user:e}},t.showShareModal=function(e,n,i){void 0===i&&(i={});var o,a,l;if(b=t.getSharingInfo(e,n,i),o=b.browseContext,a=b.contentInfo,l=b.shareModalInfo,e=b.user,null==a||null==l)return!1;if(y.logTiburonEvent(a,e.id,"BEGIN_SHARE_FLOW"),l&&t.showFastrakShareModalIfAllowed(e,l,o))return!0;if(!l.skipPublicFolderCheck&&a&&o){var c=f.makePublicFolderLink(e.id,o.config,a.displayPath(),a.isFolder());if(c)return f.showPublicFolderLinkModal(c),!0}var d=(null!=o?o.isNonUserRelativeContext:void 0)||l.isNonUserRelativeContext,u=s.SHMODAL;if("PREVIEW_PAGE"===l.origin&&(u=s.SHARE_FILEVIEWER),d||r.EmailVerification.get_for_user(e).verified_or_show(u)){var h=a.isFolder()?m.FolderShareApiClient:m.FileShareApiClient,_=new h({userId:e.id,isNonUserRelativeContext:d}),v=new p.ShareModalActionHandler(_,e,g.ShareModal),S=l.inLinksPage,E=l.prefillContacts;v.initializeShareModal({contentInfo:a,initialRecipientTokens:E,inLinksPage:S},{client:_,user:e,onDeleteLink:l.onDeleteLink,teamGroupInfo:a.teamGroupInfo(),isInContentManager:d,onSuccessSharing:l.onSuccessSharing,shareAsConfidential:l.shareAsConfidential,initialContentName:l.initialContentName,shouldSyncThisFolder:l.shouldSyncThisFolder}),v.openShareModal()}else y.logTiburonEvent(a,e.id,"SHARE_MODAL_EMAIL_UNVERIFIED");return!0;var b},t.showFastrakShareModalIfAllowed=function(e,t,n){return!(!t.isTeamSharedFolder||!v.Viewer.get_viewer().team_is_limited)&&(n&&e.is_team_admin&&t.origin&&t.targetNsId&&["BROWSE_SHARED_FOLDER_BANNER","BROWSE_GLOBAL_ACTIONS"].indexOf(t.origin)>-1?d.showWithProps({folderId:t.targetNsId.toString(),folderName:n.getNameOfTargetFolder(),user:e}):u.showModalInstance({fqPath:t.fqPath}),!0)},t.getShareModalInfo=function(e){if(e instanceof c.File){var t=[a.FileTypes.FILE,a.FileTypes.PACKAGE].indexOf(e.type)>-1;return{beaconContext:e.beacon_context,exists:!e.isDeleted,fileId:e.file_id,fqPath:e.fq_path,isFolder:!t,isTeamSharedFolder:e.type===a.FileTypes.TEAM_SHARED_FOLDER,sjid:e.sjid,nsId:e.ns_id,nsPath:e.ns_path,targetNsId:e.target_ns}}return e instanceof c.BrowseContext?S(e):e};var S=function(e){return e.isInsideDeletedFolder||e.isInsideDeletedSharedFolder?null:e.isInFolderMode?e.isInsideSharedFolder?e.currentNSPath?{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentMountPoint,isFolder:!0,nsId:null,nsPath:e.currentMountPoint,targetNsId:e.currentNSID}:{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentFQPath,isFolder:!1,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}};t.showNewFolderShareModal=function(e,n,r,s,i,o,a){void 0===n&&(n=null),void 0===r&&(r=null),void 0===s&&(s=null),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===a&&(a=null),n||(n=t.generateModalSessionId());var l=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=1;n<=100;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return y.getNewFolderPathFromContentName(e,r||"")},c={fqPath:l(),isFolder:!0,exists:!1,origin:"WIZARD",modalSessionId:n,isNonUserRelativeContext:o,isTeamSharedFolder:!1,initialContentName:s,shareAsConfidential:i,shouldSyncThisFolder:a};return t.showShareModal(e,c)},t.showSharedContentLinkSyncModal=function(t,n){var r=new h.SharingApi(t),s=function(r){var s=JSON.parse(r.responseText);e(["modules/clean/sharing/shared_content_link_sync_utils"],function(e){return e.showSharedContentSyncModal(t.id,s,n)})};return r.get_sync_vars_for_ns_id(n.ns_id,n.ns_path,s)},t.showPrefilledShareModal=function(e){var n,r,s=e.user,a=e.sharePrefillEmail,l=e.content;return a?(n="GRANT_ACCESS",r=[new i.Contact({type:o.EMAIL,email:a,name:""})]):(n="DESKTOP_CLIENT",r=[]),t.showShareModal(s,l,{origin:n,prefillContacts:r})}}),define("modules/clean/sharing/share_page/action_types",["require","exports","modules/clean/flux/action_type"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n.withActionNamespace("share-page",{INITIALIZE:"initialize-store",EMAIL_UNVERIFIED:"email-unverified",SWITCH_TAB:"switch-tab",SWITCH_ROLE:"switch-role",SWITCH_USER:"switch-user",LOAD_FOLDER_DATA_REQUEST:"load-folder-data-request",LOAD_FOLDER_DATA_SUCCESS:"load-folder-data-success",LOAD_FOLDER_DATA_ERROR:"load-folder-data-error",LOAD_FILE_DATA_REQUEST:"load-file-data-request",LOAD_FILE_DATA_SUCCESS:"load-file-data-success",LOAD_FILE_DATA_ERROR:"load-file-data-error",MOUNT_FOLDER_REQUEST:"mount-folder-request",MOUNT_FOLDER_SUCCESS:"mount-folder-success",MOUNT_FOLDER_ERROR:"mount-folder-error",UNMOUNT_FOLDER_REQUEST:"unmount-folder-request",UNMOUNT_FOLDER_SUCCESS:"unmount-folder-success",UNMOUNT_FOLDER_ERROR:"unmount-folder-error",UNSHARE_FOLDER_REQUEST:"unshare-folder-request",UNSHARE_FOLDER_SUCCESS:"unshare-folder-success",UNSHARE_FOLDER_ERROR:"unshare-folder-error",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",FETCH_TEAM_POLICY_ERROR:"fetch-team-policy-error",FETCH_FOLDER_POLICY_SUCCESS:"fetch-folder-policy-success",FETCH_METADATA_SUCCESS:"fetch-metadata-success",RELINQUISH_FOLDER_MEMBERSHIP_REQUEST:"relinquish-folder-membership-request",RELINQUISH_FOLDER_MEMBERSHIP_SUCCESS:"relinquish-folder-membership-success",RELINQUISH_FOLDER_MEMBERSHIP_ERROR:"relinquish-folder-membership-error",RELINQUISH_FILE_MEMBERSHIP_REQUEST:"relinquish-file-membership-request",RELINQUISH_FILE_MEMBERSHIP_SUCCESS:"relinquish-file-membership-success",RELINQUISH_FILE_MEMBERSHIP_ERROR:"relinquish-file-membership-error"});t.SharePageActionTypes=r}),define("modules/clean/sharing/sharing_settings_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MEMBER_POLICY="member_policy",t.DOWNLOAD_POLICY="download_policy",t.VIEWER_INFO_POLICY="viewer_info_policy",t.AUDIENCE_POLICY="audience",t.ACCESS_LEVEL_POLICY="access_level",t.FOLDER_LINK_AUDIENCE_POLICY="shared_link_policy",t.PASSWORD_POLICY="password",t.EXPIRY_POLICY="expiry",t.ACL_UPDATE_POLICY="acl_update_policy",t.DROPDOWN="dropdown",t.TOGGLE="toggle",t.PASSWORD_INPUT="password_input",t.EXPIRY_INPUT="expiry_input",t.FILE_SETTINGS="file_settings",t.FOLDER_SETTINGS="folder_settings",t.LINK_SETTINGS="link_settings"}),define("modules/clean/sharing/sharing_settings_dropdown",["require","exports","external/spectrum/dropdown_button","external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite"],function(e,t,n,r,s,i){"use strict";function o(e){var t=e.customButton||r.createElement(n.DropdownButton,{className:"sharing-settings-dropdown__button"},r.createElement("span",{className:"sharing-settings-dropdown__button-label"},e.optionsDict[e.currentValue].label)),o=e.valuesList.map(function(t){var n=r.createElement("span",null);return t===e.currentValue&&(n=r.createElement(i,{alt:"",group:"web",name:"check_gray"})),r.createElement(s.BubbleMenuItem,{checked:t===e.currentValue,key:t,onClick:function(){return e.onValueSelected(t)}},r.createElement("div",{className:"sharing-settings-dropdown-item"},r.createElement("div",{className:"sharing-settings-dropdown-item__left-margin"},n),r.createElement("div",{className:"sharing-settings-dropdown-item__label"},r.createElement("div",{className:"sharing-settings-dropdown-item__title"},e.optionsDict[t].label),r.createElement("div",{className:"sharing-settings-dropdown-item__description u-font-meta"},e.optionsDict[t].description))))});return r.createElement(s.BubbleMenu,{targetButton:t,targetFixed:!0,
position:e.openUp?s.BubbleMenu.POSITIONS.TOP_ALIGN_RIGHT:s.BubbleMenu.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"sharing-settings-dropdown",items:o,shouldShowArrow:!1})}Object.defineProperty(t,"__esModule",{value:!0}),t.SettingDropdown=o}),define("modules/clean/sharing/sharing_settings_modal",["require","exports","tslib","external/classnames","external/react","external/lodash","modules/clean/datetime","modules/clean/em_string","modules/clean/filepath","modules/clean/react/calendar","modules/clean/react_format","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/tabs/tab_nav","modules/clean/react/tabs/tab_util","modules/clean/sharing/components/button_group","modules/clean/sharing/constants","modules/clean/sharing/settings_modal_components","modules/clean/sharing/ui_util","modules/core/i18n","modules/clean/sharing/api/types/metadata","modules/clean/sharing/settings_modal/views/link_settings_tab","modules/clean/sharing/sharing_settings_dropdown","modules/clean/sharing/sharing_settings_constants","modules/clean/sharing/sharing_settings_util"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y,v,S,E,b,I,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var C=v.i18n_default_project("sharing")._,w=s.createElement,A=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleTogglePasswordPolicy=function(e){n.props.onOptionChange(I.PASSWORD_POLICY,{status:e}),n.setState({passwordInputDisabled:"on"===n.props.currentPolicy.get(I.PASSWORD_POLICY).status})},n.handleChangePasswordClick=function(){n.setState({passwordInputDisabled:!1}),n.props.onOptionChange(I.PASSWORD_POLICY,{status:"on",value:""})},n.state={passwordInputDisabled:!0},n}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=n.__assign({},this.props);return t=i.assignIn(t,{currentTab:this.state.currentTab,onChangePasswordClick:this.handleChangePasswordClick,onTabSelected:function(t){e.setState({currentTab:t})},onTogglePasswordPolicy:this.handleTogglePasswordPolicy,passwordInputDisabled:this.state.passwordInputDisabled}),w(k,t)},t})(s.Component);t.SharingSettingsModal=A;var M=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getDefaultProps=function(){return{hasDisplayableMembers:!1,hasNonOwnerMembers:!1}},t.prototype.componentDidUpdate=function(e){!this.props.passwordInputDisabled&&e.passwordInputDisabled&&this.refs.passwordInputRef&&this.refs.passwordInputRef.focus()},t.prototype.render=function(){var e;return e=this.props.isLoading?s.createElement("div",{className:"sharing-settings-modal__loading-text"},C("Loading...")):s.createElement("div",{className:"sharing-settings-modal"},this.renderHeader(),this.renderTabs(),this.renderTabContent(),s.createElement("div",{className:"sharing-settings-modal__footer"},this.renderButtons())),s.createElement(p.Modal,{altAction:this.props.altAction,style:"bare"},e)},t.prototype.renderHeader=function(){var e,t={folder_name:a.Emstring.em_snippet(this.props.folderName,f.SNIPPET_SIZES.FILENAME)};return e=C("Settings for “%(folder_name)s”").format(t),s.createElement("div",{className:"sharing-settings-modal__header"},s.createElement("div",{className:"sharing-settings-modal__title-row"},s.createElement("div",{className:"u-l-b"},e)))},t.prototype.renderTabs=function(){return s.createElement(h,{tabs:this.getTabs(),onChange:this.props.onTabSelected,defaultSelectedIndex:0,variant:m.TabVariant.UNDERLINE})},t.prototype.getTabs=function(){var e=this,t={value:I.FILE_SETTINGS,label:C("File settings")},n={value:I.FOLDER_SETTINGS,label:C("Folder settings")},r={value:I.LINK_SETTINGS,label:C("Link settings")},s=this.props.isFolder?[n]:[t];return!this.props.isTeamSharedFolder&&this.props.linkMetadata&&s.push(r),s.filter(function(t){return e.getTabInfo(t.value).policies.length>0})},t.prototype.getCurrentTab=function(){return this.props.currentTab||this.getTabs()[0].value},t.prototype.renderTabContent=function(){var e=this,t=this.getTabInfo(this.getCurrentTab());return s.createElement("div",null,t.banner,s.createElement("div",{className:"sharing-settings-modal__tab-content"},s.createElement("div",{className:"tab-content-header"},s.createElement("div",{className:"tab-content-header__description u-font-meta"},t.description)),s.createElement("div",null,t.policies.map(function(t){var n=e.getPolicyDict(t);return e.renderPolicy(t,n)}))))},t.prototype.getFolderSettingsBanner=function(){if(!this.props.shouldHideHeader&&this.props.isFolder){var e,t=C("These settings will apply to all folders inside “%(folder_name)s”.").format({folder_name:this.props.folderName});if(this.props.isInContentManager)e=t;else if(this.props.showContentManagerBridge){var n=l.parent_dir(this.props.folderPath),r=y.genContentManagerBridgeUri({containingFolder:n,isLimitedTeam:this.props.isLimitedTeam,filenameToSelect:this.props.folderName,isCDM:void 0});e=s.createElement("div",null,t,s.createElement("div",null,C("You can change these settings in the Admin Console.")+" ",s.createElement("a",{href:r.toString(),target:"_blank"},C("Open in new tab."))))}else if(this.isTeamFolderTree())e=s.createElement("div",null,t,s.createElement("div",null,s.createElement("a",{href:"/team",target:"_blank"},C("To edit, ask your admin."))));else{if(this.props.permissions.change_options.allow)return;e=C("You don’t have permission to change the settings on this folder.")}return s.createElement("div",{className:"sharing-settings-modal__banner u-font-center"},e)}},t.prototype.isTeamFolderTree=function(){return this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree},t.prototype.getMemberPolicyQuestion=function(){return C(this.isTeamFolderTree()?"Who can be added to folders?":"Who can be invited to this folder?")},t.prototype.getAclUpdatePolicyQuestion=function(){return C(this.isTeamFolderTree()?"Who can invite new members and create a link to folders?":"Who can invite new members and create a link to this folder?")},t.prototype.getDownloadsPolicyDescription=function(){return C(this.isTeamFolderTree()?"Lets people download the folders. People with edit access can always download.":this.props.isFolder?"Lets people download this folder. People with edit access can always download.":"Lets people download this file. People with edit access can always download.")},t.prototype.getViewerInfoPolicyDescription=function(){if(this.props.ownerTeam){var e=void 0;return e=C(this.props.isFolder?"Shows who viewed the files. Only members of %(team_name)s and people who can edit can see this info.":"Shows who viewed the file. Only members of %(team_name)s and people who can edit can see this info."),e.format({team_name:this.props.ownerTeam.name})}return C(this.props.isFolder?"Shows who viewed the files.":"Shows who viewed the file.")},t.prototype.getFolderSettingPolicies=function(){var e=[];return Boolean(this.props.ownerTeam)&&(e.push(I.FOLDER_LINK_AUDIENCE_POLICY),e.push(I.MEMBER_POLICY)),e.push(I.ACL_UPDATE_POLICY),this.canChangePolicy(I.DOWNLOAD_POLICY)&&e.push(I.DOWNLOAD_POLICY),null!=this.props.currentPolicy.viewer_info_policy&&e.push(I.VIEWER_INFO_POLICY),e},t.prototype.getFileSettingPolicies=function(){var e=[];return this.canChangePolicy(I.DOWNLOAD_POLICY)&&e.push(I.DOWNLOAD_POLICY),null!=this.props.currentPolicy.viewer_info_policy&&e.push(I.VIEWER_INFO_POLICY),e},t.prototype.canChangePolicy=function(e){return this.props.getEffectivePolicyValue(e,this.props.policyUpdate)[1]},t.prototype.getMemberPolicyTeamLabel=function(){return C("Only members of %(team_name)s").format({team_name:a.Emstring.em_snippet(this.props.ownerTeam.name,3,1)})},t.prototype.getAclUpdatePolicyEditorsLabel=function(){return this.props.ownerTeam?C("Members on %(team_name)s with edit access").format({team_name:a.Emstring.em_snippet(this.props.ownerTeam.name,12)}):C("Members with edit access")},t.prototype.getAclUpdatePolicyEditorsDescription=function(){return this.props.ownerTeam?C("Any member of %(team_name)s with edit access to this folder.").format({team_name:a.Emstring.em_snippet(this.props.ownerTeam.name,12)}):C("Anyone with edit access to this folder.")},t.prototype.getPolicyDict=function(e){var t=this;switch(e){case I.MEMBER_POLICY:return{title:C("Membership"),description:this.getMemberPolicyQuestion(),optionsDict:{team:{label:this.getMemberPolicyTeamLabel()},anyone:{label:C("Anyone")}},optionsList:["anyone","team"],type:I.DROPDOWN};case I.ACL_UPDATE_POLICY:return{title:C("Management"),description:this.getAclUpdatePolicyQuestion(),optionsDict:{owner:{label:C(this.isTeamFolderTree()?"Only Team Admins":"Only the owner"),description:C(this.isTeamFolderTree()?"Only Team Admins.":"Only the owner of this folder.")},editors:{label:this.getAclUpdatePolicyEditorsLabel(),description:this.getAclUpdatePolicyEditorsDescription()}},optionsList:["editors","owner"],type:I.DROPDOWN};case I.DOWNLOAD_POLICY:return{title:C("Downloads"),description:this.getDownloadsPolicyDescription(),optionsDict:{allow:{label:C("On")},disallow:{label:C("Off")}},optionsList:["allow","disallow"],type:I.TOGGLE};case I.VIEWER_INFO_POLICY:return{title:C("Viewer info"),description:this.getViewerInfoPolicyDescription(),optionsDict:{enabled:{label:C("On")},disabled:{label:C("Off")}},optionsList:["enabled","disabled"],type:I.TOGGLE};case I.AUDIENCE_POLICY:return{title:C("Link access"),description:C("Who can open the shared link?"),optionsDict:T.getAudienceOptionsDict(this.props.isFolder,this.props.ownerTeam&&this.props.ownerTeam.name,this.props.hasNonOwnerMembers,this.props.hasDisplayableMembers),optionsList:this.props.linkMetadata.audience_options.valueSeq().toArray(),type:I.DROPDOWN,extras:function(e){return t.renderAudiencePolicyExtras(e)}};case I.ACCESS_LEVEL_POLICY:return{title:C("Link permission"),description:C("What can users with links do?"),optionsDict:{viewer:{label:C("Can comment"),description:C("Lets them view and comment, but not edit.")},viewer_no_comment:{label:C("Can view"),description:C("Lets them view only. They can’t see comments.")}},optionsList:["viewer","viewer_no_comment"],type:I.DROPDOWN};case I.FOLDER_LINK_AUDIENCE_POLICY:if(!this.props.ownerTeam)throw new Error("Policy only valid for teams");return{title:C("Link restrictions"),description:C("Limits who can access this folder via a link."),optionsDict:{anyone:{label:C("No restrictions"),description:C("Show all access options for links.")},team:{label:C("Team and invite-only"),description:C("Show “Only people at %(team_name)s” and “Only                               invited members.”").format({team_name:a.Emstring.em_snippet(this.props.ownerTeam.name,12)})},members:{label:C("Invite-only"),description:C("Show “Only invited members” only.")}},optionsList:["anyone","team","members"],type:I.DROPDOWN};case I.PASSWORD_POLICY:return{title:C("Password protection"),description:C("Add a password to the shared link"),optionsDict:{on:{label:C("On")},off:{label:C("Off")}},optionsList:["on","off"],type:I.PASSWORD_INPUT};case I.EXPIRY_POLICY:return{title:C("Expiration"),description:C("Disables the shared link on a specific date"),optionsDict:{on:{label:C("On")},off:{label:C("Off")}},optionsList:["on","off"],type:I.EXPIRY_INPUT};default:throw new Error("Policy name not found")}},t.prototype.getFolderSettingsDescription=function(){return C(this.isTeamFolderTree()?"Only team admins can change these settings":this.canChangePolicy(I.ACL_UPDATE_POLICY)?"Only you (the owner) can change these settings.":"Only the owner can change these settings.")},t.prototype.getTabInfo=function(e){switch(e){case I.FILE_SETTINGS:return{title:C("File settings"),banner:void 0,description:"",policies:this.getFileSettingPolicies()};case I.FOLDER_SETTINGS:return{title:C("Folder settings"),banner:this.getFolderSettingsBanner(),description:this.getFolderSettingsDescription(),policies:this.getFolderSettingPolicies()};case I.LINK_SETTINGS:var t="owner"===this.props.currentPolicy.get(I.ACL_UPDATE_POLICY)&&this.canChangePolicy(I.AUDIENCE_POLICY);return{title:E.TabName(),banner:s.createElement(E.Banner,{linkMetadata:this.props.linkMetadata,user:this.props.user}),description:s.createElement(E.Description,{aclUpdatePolicy:this.props.currentPolicy.get(I.ACL_UPDATE_POLICY),isTeamFolderTree:this.isTeamFolderTree(),ownerTeam:this.props.ownerTeam,userIsOwner:t}),policies:E.getPolicies(this.props.user)};default:throw new Error("tabName not found")}},t.prototype.renderPolicy=function(e,t){var n,i,o=this,a=t.title,l=t.description,c=t.optionsDict,d=t.optionsList,u=t.type,p=t.extras,h=void 0===p?null:p;g=this.props.getEffectivePolicyValue(e,this.props.policyUpdate),n=g[0],i=g[1];var m;if(u===I.DROPDOWN)m=s.createElement(b.SettingDropdown,{currentValue:n,valuesList:d,optionsDict:c,onValueSelected:function(t){return o.props.onOptionChange(e,t)}});else if(u===I.TOGGLE)m=s.createElement(_.ButtonGroup,{options:this.getButtonGroupOptions(d,c),value:n,onSelectValue:function(t){return o.props.onOptionChange(e,t)}});else if(u===I.PASSWORD_INPUT)m=this.renderPasswordInput(e,n,c,d);else{if(u!==I.EXPIRY_INPUT)throw new Error("Selector type not found");m=this.renderExpiryInput(e,n,c,d)}var f=s.createElement("div",null);return h&&(f=h(n)),s.createElement("div",{className:r({policy:!0,"policy--no-permissions":!i})},s.createElement("div",{className:"policy__left"},s.createElement("div",{className:"policy__title"},a),s.createElement("div",{className:"policy__description u-font-meta"},l)),s.createElement("div",{className:"policy__selector"},m),s.createElement("div",{className:"policy__extras"},f));var g},t.prototype.renderAudiencePolicyExtras=function(e){var t=this.props.linkMetadata,n=s.createElement("div",null);if(t.audience_restricting_shared_folder&&t.audience_restricting_shared_folder.audience===e){var r=void 0,i=t.audience_restricting_shared_folder.name;r=1===t.audience_options.size?d.reactFormat(C("This setting is applied via a parent folder.              To change access, go to <strong>%(folder_name)s</strong> link settings."),{folder_name:i,strong:s.createElement("strong",null)}):d.reactFormat(C("This setting is limited via a parent folder.              To see more options, go to <strong>%(folder_name)s</strong> link settings."),{folder_name:i,strong:s.createElement("strong",null)}),n=s.createElement("div",{className:"policy__graybox"},r)}else this.props.isFolder&&e!==S.LinkAudience.members&&(n=s.createElement("div",{className:"policy__audience-extras"},C("Applies to all items in this folder")));return n},t.prototype.renderPasswordInput=function(e,t,n,r){var i=this,o=t,a=s.createElement("div",null);if("on"===o.status){var l=s.createElement("div",null);this.props.passwordInputDisabled&&this.props.linkMetadata.link_permissions.set_password.allow&&(l=s.createElement("button",{className:"password-input__change-button button-as-link",onClick:this.props.onChangePasswordClick},"Change")),a=s.createElement("div",{className:"password-input u-pad-top-s"},s.createElement("label",{htmlFor:"password-input"},"Password:"),s.createElement("br",null),s.createElement("input",{autoFocus:!0,className:"c-input password-input__input",disabled:this.props.passwordInputDisabled,id:"password-input",onChange:function(t){i.props.onOptionChange(e,{status:"on",value:t.target.value})},placeholder:C("Enter a new password"),ref:"passwordInputRef",type:"password",value:this.props.passwordInputDisabled?123456:o.value||""}),l)}return s.createElement("div",null,s.createElement(_.ButtonGroup,{options:this.getButtonGroupOptions(r,n),value:o.status,onSelectValue:this.props.onTogglePasswordPolicy}),a)},t.prototype.renderExpiryInput=function(e,t,n,r){var i=this,a=t,l=s.createElement("div",null),d=o.daysAfterToday(30);return"on"===a.status&&(l=s.createElement("div",{className:"u-pad-top-s"},s.createElement("div",null,C("Link deactivates on:")),s.createElement(c.Calendar,{alignAtLeft:!1,disabled:!this.props.linkMetadata.link_permissions.set_expiry.allow,firstDay:o.daysAfterToday(1),initDate:a.value?new Date(a.value):d,lastDay:o.daysAfterToday(365),onDateChange:function(t){return i.props.onOptionChange(e,{status:"on",value:t})}}))),s.createElement("div",null,s.createElement(_.ButtonGroup,{options:this.getButtonGroupOptions(r,n),value:a.status,onSelectValue:function(t){i.props.onOptionChange(e,{status:t,value:a.value||d})}}),l)},t.prototype.getButtonGroupOptions=function(e,t){return e.map(function(e){return{value:e,label:t[e].label}})},t.prototype.allowSaveSettings=function(){return!(!this.props.policyUpdate||0===Object.keys(this.props.policyUpdate).length)&&!(this.props.policyUpdate.password&&"on"===this.props.policyUpdate.password.status&&!this.props.passwordInputDisabled&&(!this.props.policyUpdate.password.value||""===this.props.policyUpdate.password.value))},t.prototype.renderButtons=function(){var e;if(this.props.permissions.unshare.allow&&(this.props.isSharedFolder||!this.props.isFolder)){var t=void 0;t=C(this.props.isFolder?this.props.isFolderInsideTeamFolderTree?"Reset membership":"Unshare folder":"Unshare file"),e=s.createElement("div",{className:"u-l-fl"},s.createElement("button",{className:"button-as-link c-borderless-button",style:{lineHeight:"32px"},onClick:this.props.onUnshare},t))}return s.createElement("div",{className:"clearfix sharing-settings-modal__buttons"},e,s.createElement(g.SettingsModalButtons,{disableSave:!this.allowSaveSettings(),isAccepting:this.props.isSubmitting,onAccept:this.props.onSaveSettings,onDismiss:this.props.onDismiss}))},t})(s.Component);t.SharingSettingsModalContentsView=M;var k=u(M,["/static/css/sharing/share_modal-vflm4LDVj.css"])}),define("modules/clean/sharing/sharing_settings_util",["require","exports","external/react","modules/clean/em_string","modules/clean/react_format","modules/clean/sharing/sharing_settings_constants","modules/core/i18n"],function(e,t,n,r,s,i,o){"use strict";function a(e,t,n,r,s,o){switch(e){case i.AUDIENCE_POLICY:return r&&r.link_permissions.change_audience.allow&&r.audience_options.size>1;case i.PASSWORD_POLICY:return r&&"members"!==n.get(i.AUDIENCE_POLICY)&&(r.link_permissions.set_password.allow||r.link_permissions.remove_password.allow&&"off"!==t.get(i.PASSWORD_POLICY).status);case i.EXPIRY_POLICY:return r&&"members"!==n.get(i.AUDIENCE_POLICY)&&(r.link_permissions.set_expiry.allow||r.link_permissions.remove_expiry.allow&&"off"!==t.get(i.EXPIRY_POLICY).status);case i.DOWNLOAD_POLICY:return!(!s||o)&&("allow"===t.get(i.DOWNLOAD_POLICY)?s.set_download_policy&&s.set_download_policy.allow:s.remove_download_policy&&s.remove_download_policy.allow);case i.VIEWER_INFO_POLICY:return!(!s||o)&&("enabled"===t.get(i.VIEWER_INFO_POLICY)?s.disable_viewer_info&&s.disable_viewer_info.allow:s.enable_viewer_info&&s.enable_viewer_info.allow);default:throw new Error("Link policy not found")}}function l(e){switch(e){case"restricted_by_parent_folder":return p("This setting is turned off for all files in this folder.");case"restricted_by_team":return p("Your admin has disabled this setting.");default:return}}function c(e,t){return"enabled"===e.get(i.VIEWER_INFO_POLICY)?t.disable_viewer_info?l(t.disable_viewer_info.reason):void 0:t.enable_viewer_info?l(t.enable_viewer_info.reason):void 0}function d(e){return[i.AUDIENCE_POLICY,i.DOWNLOAD_POLICY,i.EXPIRY_POLICY,i.VIEWER_INFO_POLICY,i.PASSWORD_POLICY].indexOf(e)!==-1}function u(e,t,i,o){var a,l,c=o&&!i;return c?(a=p("Only you"),l=p(e?"Only you can access this folder.":"Only you can access this file.")):(a=p("Invited members"),l=e?s.reactFormat(p("<strong>Most secure.</strong> Only those specifically invited can access this folder."),{strong:n.DOM.strong()}):s.reactFormat(p("<strong>Most secure.</strong> Only those specifically invited can access this file."),{strong:n.DOM.strong()})),{public:{label:p("Anyone with the link"),description:p(e?"Anyone who has the link can access this folder.":"Anyone who has the link can access this file.")},team:{label:p("Members of %(team_name)s").format({team_name:r.Emstring.em_snippet(t||"",6,1)}),description:e?p("Only members of %(team_name)s and invited members can access this folder.").format({team_name:t}):p("Only members of %(team_name)s and invited members can access this file.").format({team_name:t})},members:{label:a,description:l}}}Object.defineProperty(t,"__esModule",{value:!0});var p=o.i18n_default_project("sharing")._;t.canChangePolicy=a,t.denyReasonToDenyString=l,t.getPassDenyReason=c,t.isCommonSharingSettingsPolicy=d,t.getAudienceOptionsDict=u}),define("modules/clean/sharing/stores/sharing_info",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/sharing/action_types","modules/clean/sharing/api/types/metadata","modules/clean/sharing/access_level","modules/clean/sharing/stores/sharing_info_util","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/constants/sharing","modules/core/exception"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=function(e,t){return t=String(t),t.startsWith("id:")||(t=t.toLowerCase()),e+"::"+t},_=(function(e){function t(){var t=e.call(this)||this;return t.sharingInfoMap={},t}return n.__extends(t,e),t.prototype.getSharingInfo=function(e,t){return t?this.sharingInfoMap[m(e,t)]:null},t.prototype.mapContentIdsToSharingInfo=function(e,t,n){for(var r=0,s=t;r<s.length;r++){var i=s[r];i&&(this.sharingInfoMap[m(e,i)]=n)}},t.prototype._new_payload=function(e){var t=this;if(e&&e.action&&e.action.type)switch(e.action.type){case o.SharingActionTypes.CLEAR_EVERYTHING:this.sharingInfoMap={};break;case o.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS:var n=e.action.user;e.action.data.forEach(function(e){t._new_payload_for_single_content(o.ShareModalActionTypes.FETCH_METADATA_SUCCESS,n,c.getContentIdsForMetadata(e),{metadata:e})}),this.emit_change();break;default:if(!e.action.contentIds)return;this._new_payload_for_single_content(e.action.type,e.action.user,e.action.contentIds,e.action.data),this.emit_change()}},t.prototype._new_payload_for_single_content=function(e,t,n,r){h.assert(Boolean(t.id),"valid user needed"),h.assert(n.length>0,"contentIds cannot be empty");for(var s=null,i=0,o=n;i<o.length;i++){var a=o[i],l=m(t.id,a);if(l in this.sharingInfoMap){s=this.sharingInfoMap[l];break}}return s||(s=new f(t)),this.mapContentIdsToSharingInfo(t.id,n,s),s._new_payload(e,r)},t})(i);t.sharingInfoStore=new _;var f=(function(){function e(e){this._areMembersFullyLoaded=!1,this._areSharingPrefsLoaded=!1,this._hasDisplayableMembers=!1,this._isLinkMetadataLoaded=!1,this._isTeamPolicyLoaded=!1,this._isUpdatingLinkAudience=!1,this._sharingPrefs=new a.SharingPrefs,this._shouldBlockMemberListOnPassLoad=!0,this._user=e}return e.prototype._new_payload=function(e,n){switch(e){case o.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_REQUEST:var r=this._metadata;this._linkMetadata||(r=r.set("link_metadata",new a.SharedContentLinkMetadata)),r=r.setIn(["link_metadata","current_audience"],n.newAudience),this.setMetadata(r),this._isUpdatingLinkAudience=!0;break;case o.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_FAILURE:this._isUpdatingLinkAudience=!1,this.setMetadata(this._metadata.setIn(["link_metadata","current_audience"],n.prevAudience));break;case o.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_SUCCESS:this._modalInfo.hasChangedLinkAudience=!0,this._isUpdatingLinkAudience=!1,this.setMetadata(n.metadata);break;case o.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE:var i=n.member;this._members=this._members.setIn([i.type(),i.memberKey(),"access_type"],n.prevAccess);break;case o.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_REQUEST:var i=n.member;this._members=this._members.setIn([i.type(),i.memberKey(),"access_type"],n.newAccess);break;case o.ShareModalActionTypes.CHANGE_RECIPIENTS:this._modalInfo.recipientTokens=n.recipientTokens,this._modalInfo.recipientRawInput=n.recipientRawInput;var l=void 0;n.recipientTokens.length>0||n.recipientRawInput.length>0?this.uiMode()===u.MODES.MEMBERSHIP&&(l=u.MODES.SHARE):this.uiMode()===u.MODES.SHARE&&(l=u.MODES.MEMBERSHIP),l&&(this._modalInfo.uiMode=l);break;case o.ShareModalActionTypes.CHANGE_RECIPIENT_ACCESS:this._modalInfo.recipientAccess=n.newAccess;break;case o.ShareModalActionTypes.CHANGE_RECIPIENT_MESSAGE:this._modalInfo.recipientMessage=n.message;break;case o.ShareModalActionTypes.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:this._members=this._members.update("users",function(e){return e.map(function(e){return e.set("time_last_seen",null)})});break;case o.ShareModalActionTypes.CREATE_LINK_SUCCESS:this._linkMetadata=n.linkMetadata;break;case o.ShareModalActionTypes.FETCH_MEMBER_COUNTS_SUCCESS:this._memberCounts=n.memberCounts;break;case o.ShareModalActionTypes.FETCH_METADATA_FAILURE:this._fetchingMetadataPromise=void 0,this._modalInfo&&(this._modalInfo.uiMode=u.MODES.LINK_ONLY,this._modalInfo.linkOnlyReason!==u.LINK_ONLY_REASON.LINKS_PAGE&&(this._modalInfo.linkOnlyReason=n.reason));break;case o.ShareModalActionTypes.FETCH_METADATA_REQUEST:this._fetchingMetadataPromise=n.promise;break;case o.ShareModalActionTypes.FETCH_METADATA_SUCCESS:this._fetchingMetadataPromise=void 0,this.setMetadata(n.metadata);break;case o.ShareModalActionTypes.FETCH_SHARING_PREFS_REQUEST:this._areSharingPrefsLoaded=!1;break;case o.ShareModalActionTypes.FETCH_SHARING_PREFS_SUCCESS:this._areSharingPrefsLoaded=!0,this._sharingPrefs=n.sharingPrefs;break;case o.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE:this._isLinkMetadataLoaded=!0,this._linkMetadata=void 0;break;case o.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS:this._isLinkMetadataLoaded=!0,this._linkMetadata=n.linkMetadata;break;case o.ShareModalActionTypes.FETCH_USER_ACCOUNTS_REQUEST:this._fetchingMembersRequest={limitNonNull:n.limitNonNull,promise:n.promise,requestId:n.requestId};break;case o.ShareModalActionTypes.FETCH_USER_ACCOUNTS_SUCCESS:if(this._fetchingMembersRequest&&n.requestId!==this._fetchingMembersRequest.requestId)return!1;if(this._hasDisplayableMembers&&this._fetchingMembersRequest&&this._fetchingMembersRequest.limitNonNull<this._members.getMemberCount())return;this._hasDisplayableMembers=!0,n.members.cursor||(this._areMembersFullyLoaded=!0,this._fetchingMembersRequest=void 0),this._members=n.members;break;case o.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:if(this._fetchingMembersRequest&&n.requestId!==this._fetchingMembersRequest.requestId)return!1;n.members.cursor||(this._areMembersFullyLoaded=!0,this._fetchingMembersRequest=void 0),this._members=this._members.mergeDeep(n.members);break;case o.ShareModalActionTypes.FETCH_TEAM_POLICY_REQUEST:this._isTeamPolicyLoaded=!1;break;case o.ShareModalActionTypes.FETCH_TEAM_POLICY_SUCCESS:this._isTeamPolicyLoaded=!0,this._teamPolicy=n.teamPolicy;case o.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_SUCCESS:this._memberCounts=new a.MemberCounts({total_unique_users:n.count,users_outside_team:0,exceeds_count:n.exceeds_limit});break;case o.ShareModalActionTypes.FETCH_UPSELL_EXPERIMENT_VARIANT:n.variant&&(this._expSubgrowthProOverquotaCreateSharedLink=n.variant);case o.ShareModalActionTypes.HANDLE_CONTENT_NAME_CHANGE:""===n.name?(this._modalInfo.contentNameMessage=u.CONTENT_NAME_EMPTY_TOOLTIP,this._modalInfo.contentNameMessageLevel=u.CONTENT_NAME_MESSAGE_LEVELS.INFO):(this._modalInfo.contentNameMessage=void 0,this._modalInfo.contentNameMessageLevel=u.CONTENT_NAME_MESSAGE_LEVELS.INFO);break;case o.ShareModalActionTypes.HANDLE_CONTENT_NAME_FOCUS_CHANGE:this._modalInfo.isContentNameFocused=n.focus;break;case o.ShareModalActionTypes.MEMBER_ACTION_COMPLETE:this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(n.member.memberKey());break;case o.ShareModalActionTypes.MEMBER_ACTION_PENDING:this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.add(n.member.memberKey());break;case o.ShareModalActionTypes.REMOVE_MEMBER_KEEP_ACCESS:var i=n.member;this._members=this._members.setIn([i.type(),i.memberKey(),"access_type"],n.access),this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(i.memberKey());break;case o.ShareModalActionTypes.REMOVE_MEMBER_SUCCESS:var i=n.member;this._members=this._members.deleteIn([i.type(),i.memberKey()]),this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(i.memberKey());break;case o.ShareModalActionTypes.SEND_SHARE_FAILURE:this._modalInfo.uiMode=u.MODES.SHARE;break;case o.ShareModalActionTypes.SEND_SHARE_REQUEST:this._modalInfo.uiMode=u.MODES.SHARE_SENDING;break;case o.ShareModalActionTypes.SEND_SHARE_SUCCESS:this._modalInfo.uiMode=u.MODES.SHARE;break;case o.ShareModalActionTypes.SHARE_FOLDER_FAILURE:this._shareFolderPromise=void 0;break;case o.ShareModalActionTypes.SHARE_FOLDER_REQUEST:this._shareFolderPromise=n.promise;break;case o.ShareModalActionTypes.SHARE_FOLDER_SUCCESS:this.setMetadata(n.metadata),this._shareFolderPromise=void 0;break;case o.ShareModalActionTypes.SHARE_MODAL_CLOSE:this._modalInfo.initialRecipientTokens=n.tokens||[],this._modalInfo.initialRecipientRawInput=n.value||"";break;case o.ShareModalActionTypes.SHARE_MODAL_OPEN:this.handleShareModalOpen(n);break;case o.ShareModalActionTypes.TRANSFER_OWNER_SUCCESS:this._metadata=void 0,this._isLinkMetadataLoaded=!1,this._hasDisplayableMembers=!1;break;case o.ShareModalActionTypes.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:this._shouldBlockMemberListOnPassLoad=!1;break;case o.ShareModalActionTypes.UPDATE_BANNER:this._modalInfo.banner=n.banner;break;case o.ShareModalActionTypes.UPDATE_SHARING_SETTINGS_SUCCESS:this._modalInfo&&(this._modalInfo.hasChangedSharingSettings=!0),this.setMetadata(n.metadata);break;case o.ShareModalActionTypes.VALIDATE_CONTENT_NAME_ERROR:this._modalInfo.contentNameMessage=n.errorMsg,this._modalInfo.contentNameMessageLevel=u.CONTENT_NAME_MESSAGE_LEVELS.ERROR;break;case o.ShareModalActionTypes.VALIDATE_CONTENT_NAME_SUCCESS:var c=s.parent_dir(this.fqPath()),p=d.getNewFolderPathFromContentName(n.contentName,c);this._modalInfo.contentInfo=this._modalInfo.contentInfo.setFQPath(p),t.sharingInfoStore.mapContentIdsToSharingInfo(this._user.id,[p],this)}},e.prototype.handleShareModalOpen=function(e){this._modalInfo=new g(e.shareModalInfo.contentInfo),this._modalInfo.initialRecipientTokens=e.shareModalInfo.initialRecipientTokens||[],this._initialProps=e.initialProps,e.shareModalInfo.inLinksPage&&(this._modalInfo.uiMode=u.MODES.LINK_ONLY,this._modalInfo.linkOnlyReason=u.LINK_ONLY_REASON.LINKS_PAGE),this._areMembersFullyLoaded=!1,!e.shareModalInfo.contentInfo.pathExists()&&!e.initialProps.initialContentName&&(this._modalInfo.isContentNameFocused=!0,this._modalInfo.contentNameMessage=u.CONTENT_NAME_EMPTY_TOOLTIP)},e.prototype.setMetadata=function(e){p.TRUELINK.TRUELINK_UI[this._user.id]&&(this._isUpdatingLinkAudience&&(e=e.setIn(["link_metadata","current_audience"],this._linkMetadata.current_audience)),this._isLinkMetadataLoaded=!0,e.link_metadata&&(this._linkMetadata=e.link_metadata));var n=e.permissions||this._metadata&&this._metadata.permissions;this._metadata=e.set("permissions",n),this._modalInfo&&e.shared_folder_id&&(this._modalInfo.contentInfo=this._modalInfo.contentInfo.setNsId(e.shared_folder_id)),t.sharingInfoStore.mapContentIdsToSharingInfo(this._user.id,c.getContentIdsForMetadata(e),this)},e.prototype.isViewerNoCommentEnabled=function(){return this.isFolder()?this.isNoCommentEnabledForFolders():this.isNoCommentEnabledForLinks()},e.prototype.hasNonOwnerMembers=function(){var e=this._members&&this._members.getMemberCount();if(!e)return!1;if(1===e&&1===this._members.users.count()){return this._members.users.first().account_id!==this._user.account_id}return!0},e.prototype.memberCountWithRecipients=function(){return(this.memberCounts()&&this.memberCounts().total_unique_users||this.members()&&this.members().getMemberCount()||0)+d.getMemberCountForTokens(this.recipientTokens())},e.prototype.getInitialProps=function(){return this._initialProps},e.prototype.areMembersFullyLoaded=function(){return this._areMembersFullyLoaded},e.prototype.areSharingPrefsLoaded=function(){return this._areSharingPrefsLoaded},
e.prototype.banner=function(){return this._modalInfo.banner},e.prototype.canChangeOptions=function(){return Boolean(this._metadata&&this._metadata.permissions.change_options&&this._metadata.permissions.change_options.allow)},e.prototype.canEdit=function(){return Boolean(this._metadata&&this._metadata.permissions.edit_contents&&this._metadata.permissions.edit_contents.allow)},e.prototype.canInviteEditor=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_editor&&this._metadata.permissions.invite_editor.allow)},e.prototype.canInviteViewer=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_viewer&&this._metadata.permissions.invite_viewer.allow)},e.prototype.canInviteViewerNoComment=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_viewer_no_comment&&this._metadata.permissions.invite_viewer_no_comment.allow)},e.prototype.canMakeViewerNoComment=function(){return this.isViewerNoCommentEnabled()},e.prototype.canRelinquishMembership=function(){return Boolean(this._metadata&&this._metadata.permissions.relinquish_membership&&this._metadata.permissions.relinquish_membership.allow)},e.prototype.canShareLink=function(){return!this.isConfidentialFolder()&&!this.isTeamSharedFolder()&&this.contentInfo().pathExists()&&this.contentInfo().isMounted()},e.prototype.canUnshareFile=function(){return Boolean(this._metadata&&this._metadata.permissions.unshare&&this._metadata.permissions.unshare.allow)},e.prototype.canUnshareFolder=function(){return Boolean(this._metadata&&this._metadata.permissions.unshare&&this._metadata.permissions.unshare.allow)},e.prototype.canUpdateConfidentiality=function(){return Boolean(this._metadata&&this._metadata.permissions.update_confidentiality&&this._metadata.permissions.update_confidentiality.allow)},e.prototype.contactsError=function(){return d.validateContacts(this.recipientTokens(),this._user,this.ownerTeam(),this.folderPolicy(),this.isTeamSharedFolder(),this.isFolderInsideTeamFolderTree(),this.memberCountWithRecipients())},e.prototype.contentId=function(){return this._modalInfo.contentInfo.id},e.prototype.contentInfo=function(){return this._modalInfo.contentInfo},e.prototype.contentNameMessage=function(){return this._modalInfo.contentNameMessage},e.prototype.contentNameMessageLevel=function(){return this._modalInfo.contentNameMessageLevel},e.prototype.expSubgrowthProOverquotaCreateSharedLink=function(){return this._expSubgrowthProOverquotaCreateSharedLink},e.prototype.fetchingMembersRequest=function(){return this._fetchingMembersRequest},e.prototype.fetchingMetadataPromise=function(){return this._fetchingMetadataPromise},e.prototype.filePolicy=function(){return this._metadata&&this._metadata.file_policy},e.prototype.folderPolicy=function(){return this._metadata&&this._metadata.policy},e.prototype.fqPath=function(){return this._modalInfo.contentInfo.displayPath()},e.prototype.hasChangedLinkAudience=function(){return this._modalInfo&&this._modalInfo.hasChangedLinkAudience},e.prototype.hasChangedSharingSettings=function(){return this._modalInfo&&this._modalInfo.hasChangedSharingSettings},e.prototype.hasDisplayableMembers=function(){return this._hasDisplayableMembers},e.prototype.hasParentSharedFolder=function(){return this._metadata&&this._metadata.is_inside_team_folder},e.prototype.initialRecipientRawInput=function(){return this._modalInfo.initialRecipientRawInput},e.prototype.initialRecipientTokens=function(){return this._modalInfo.initialRecipientTokens},e.prototype.isNoCommentEnabledForFolders=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_shared_folders)},e.prototype.isNoCommentEnabledForLinks=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_content_links)},e.prototype.isNonUserRelativeContext=function(){return this.getInitialProps().isInContentManager},e.prototype.isFolder=function(){return this._modalInfo.contentInfo.isFolder()},e.prototype.isConfidentialFolder=function(){return Boolean(this._metadata&&this._metadata.is_confidential)},e.prototype.isContentNameFocused=function(){return this._modalInfo.isContentNameFocused},e.prototype.isFolderInsideTeamFolderTree=function(){return this._metadata&&this._metadata.is_inside_team_folder},e.prototype.isInsideSharedFolder=function(){return Boolean(this._metadata&&this._metadata.parent_shared_folder_id||this.contentInfo().isInSharedFolder())},e.prototype.isLinkMetadataLoaded=function(){return this._isLinkMetadataLoaded},e.prototype.isMetadataLoaded=function(){return Boolean(this._metadata)},e.prototype.isOwner=function(){return Boolean(this._metadata&&this._metadata.access_type===l.ACCESS_LEVEL.OWNER)},e.prototype.isUserOnOwnerTeam=function(){return Boolean(this._metadata&&this._metadata.owner_team&&this._metadata.owner_team.id===this._user.team_dbtid)},e.prototype.isTeamPolicyLoaded=function(){return this._isTeamPolicyLoaded},e.prototype.isTeamSharedFolder=function(){return Boolean(this._metadata&&this._metadata.is_team_folder||this.contentInfo().isTeamSharedFolder())},e.prototype.isTokenizerEmpty=function(){return 0===this.recipientRawInput().length&&0===this.recipientTokens().length},e.prototype.isUpdatingLinkAudience=function(){return this._isUpdatingLinkAudience},e.prototype.linkMetadata=function(){return this._linkMetadata},e.prototype.linkOnlyReason=function(){return this._modalInfo.linkOnlyReason},e.prototype.memberCounts=function(){return this._memberCounts},e.prototype.members=function(){return this._members},e.prototype.metadata=function(){return this._metadata},e.prototype.ownerTeam=function(){return this._metadata&&this._metadata.owner_team},e.prototype.parentSharedFolderId=function(){return this._metadata&&this._metadata.parent_shared_folder_id},e.prototype.pendingMemberAction=function(){return this._modalInfo.pendingMemberAction},e.prototype.permissions=function(){return this._metadata&&this._metadata.permissions},e.prototype.recipientAccess=function(){return this._modalInfo.recipientAccess},e.prototype.recipientMessage=function(){return this._modalInfo.recipientMessage},e.prototype.recipientRawInput=function(){return this._modalInfo.recipientRawInput},e.prototype.recipientTokens=function(){return this._modalInfo.recipientTokens},e.prototype.shareAsConfidential=function(){return Boolean(this.getInitialProps().shareAsConfidential)},e.prototype.shareFolderPromise=function(){return this._shareFolderPromise},e.prototype.shouldBlockMemberListOnPassLoad=function(){return this._shouldBlockMemberListOnPassLoad},e.prototype.shouldSyncThisFolder=function(){return this.getInitialProps()?this.getInitialProps().shouldSyncThisFolder:null},e.prototype.teamPolicy=function(){return this._teamPolicy},e.prototype.uiMode=function(){return this._modalInfo.uiMode},e})();t.SharingInfo=f;var g=(function(){function e(e){this.banner=u.BANNERS.NO_MEMBERS,this.canRelinquishMembership=!1,this.contentNameMessageLevel=u.CONTENT_NAME_MESSAGE_LEVELS.INFO,this.hasChangedLinkAudience=!1,this.hasChangedSharingSettings=!1,this.initialRecipientRawInput="",this.initialRecipientTokens=[],this.isContentNameFocused=!1,this.pendingMemberAction=r.Set(),this.recipientAccess=l.ACCESS_LEVEL.READER,this.recipientMessage="",this.recipientRawInput="",this.recipientTokens=[],this.shareAsConfidential=!1,this.uiMode=u.MODES.MEMBERSHIP,this.contentInfo=e,e.isFolder()&&(this.recipientAccess=l.ACCESS_LEVEL.WRITER)}return e})();t.SharingModalInfo=g}),define("modules/clean/sharing/stores/sharing_info_util",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContentIdsForMetadata=function(e){return[e.shared_folder_id,e.id,e.path_lower].filter(Boolean)},t.getContentIdsForContentInfo=function(e){var t=[];return e.isSharedFolder()?t.push(e.sharedFolderId()):(e.extras.fileId&&t.push(e.extras.fileId),e.extras.nsId&&e.extras.nsPath&&t.push("ns:"+e.nsId()+e.nsPath())),e.displayPath()&&t.push(e.displayPath()),t}}),define("modules/clean/sharing/strings",["require","exports","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s.i18n_default_project("sharing")._,o=(p={},p[n.ACCESS_LEVEL.OWNER]=i("Owner"),p[n.ACCESS_LEVEL.WRITER]=i("Can edit"),p[n.ACCESS_LEVEL.READER]=i("Can view"),p[n.ACCESS_LEVEL.READER_NO_COMMENT]=i("View-only"),p);t.ACCESS_NAME=o;var a=(h={},h[n.ACCESS_LEVEL.OWNER]=i("Owner"),h[n.ACCESS_LEVEL.WRITER]=i("Can edit"),h[n.ACCESS_LEVEL.READER]=i("Can comment"),h[n.ACCESS_LEVEL.READER_NO_COMMENT]=i("Can view"),h);t.ACCESS_NAME_NO_COMMENT=a;var l=(m={},m[r.MEMBER_ACTION.MAKE_EDITOR]=i("People can edit, delete, comment, and add the file to their Dropbox"),m[r.MEMBER_ACTION.MAKE_VIEWER]=i("People can view, download, and comment"),m[r.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=i("People can only view and download the files"),m);t.MEMBER_ACTION_FOLDER=l;var c=(_={},_[r.MEMBER_ACTION.MAKE_EDITOR]=i("People can edit, delete, comment, and add the files to their Dropbox"),_[r.MEMBER_ACTION.MAKE_VIEWER]=i("People can view, download, and comment"),_[r.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=i("People can only view and download the file"),_);t.MEMBER_ACTION_FILE=c;var d=(f={},f[r.MEMBER_ACTION.MAKE_EDITOR]=i("Lets them view, comment, and edit."),f[r.MEMBER_ACTION.MAKE_VIEWER]=i("Lets them view and comment, but not edit."),f[r.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=i("Lets them view only. They can’t see comments."),f);t.MEMBER_ACTION_FOLDER_NO_COMMENT=d;var u=(g={},g[r.MEMBER_ACTION.MAKE_EDITOR]=i("Lets them view, comment, and edit."),g[r.MEMBER_ACTION.MAKE_VIEWER]=i("Lets them view and comment, but not edit."),g[r.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=i("Lets them view only. They can’t see comments."),g);t.MEMBER_ACTION_FILE_NO_COMMENT=u;var p,h,m,_,f,g}),define("modules/clean/sharing/ui_util",["require","exports","external/react","external/lodash","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/contacts/contact_token_state","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/icon/icon_helper","modules/clean/react_format","modules/clean/sharing/api/types/metadata","modules/clean/sharing/gating_util","modules/constants/trademark","modules/core/i18n","modules/core/uri","modules/core/user_i18n"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoldenGate=p.GoldenGate;var g=m.i18n_default_project("sharing")._,y={};t.SharingExperiments=y;var v={strong:n.createElement("strong",null),em:n.createElement("em",null)},S={SHARED_FILE:"shared-file",SHARED_FOLDER:"shared-folder",SHARED_LINK:"shared-link",PUBLIC:"public",NO_SHARE:"no-share"};t.SHARE_UI_TYPE=S;var E={SINGLE_INVALID:g("The email address you entered is invalid"),SINGLE_OUT_OF_TEAM:g("This person isn’t on your Dropbox team"),SINGLE_TOO_MANY_MEMBERS:g("Can’t share with this many people"),GENERAL_INVALID:g("One or more names or email addresses you entered are invalid."),GENERAL_OUT_OF_TEAM:g("One or more invitees are outside your Dropbox team."),GENERAL_TOO_MANY_MEMBERS:d.reactFormat(g("This will put the folder over its %(member_limit)s-member limit. <a>Learn more.</a>",{comment:"member_limit will be a number greater than 200"}),{member_limit:p.GoldenGate.SHARING_TOTAL_LIMIT,a:n.createElement("a",{href:"/help/9292",target:"_blank",key:"help_center_article"})}),NONGROUP_INVITEE:g("Only groups can be added to team folders.")};t.CONTACT_ERROR_MESSAGES=E;var b={ERROR:"error",WARN:"warn"};t.CONTACT_ERROR_LEVEL=b;var I=function(e,t){return(t.displayName()||"").toLowerCase()},T=Math.pow(2,53)-1,C=function(e){return function(t,n){var r=n.memberId()===t,s=n instanceof u.GroupMembershipInfo?"0":"1",i=(n.displayName()||"").toLowerCase(),o=function(e){var t=String(T-Number(e)),n=String(T).length;return t.length<n&&(t=""+Array(n-t.length+1).join("0")+t),t},a=null!=n.account_id&&e.has(n.account_id);return s+(a&&r?"a":a?"b":null!=n.time_last_seen?"c"+o(n.time_last_seen):"d")+i}},w=function(e,t,n){var r=n?C(t):I;return function(t,n){var s=r(e.account_id,t),i=r(e.account_id,n);return s<i?-1:s===i?0:1}};t.makeMemberSortCmp=w;var A=function(e,t,n){return!e.is_cdm_member&&(t||n)};t.shouldEnforceMemberLimits=A;var M=function(e,t,n,r,s,i,a){var l={state:o.ContactTokenState.ok,msg:null};if(s&&!e.group_id)return{state:o.ContactTokenState.invalid,msg:E.NONGROUP_INVITEE};if(A(t,s,i)&&a>p.GoldenGate.SHARING_TOTAL_LIMIT)return{state:o.ContactTokenState.invalid,msg:E.SINGLE_TOO_MANY_MEMBERS};if(e.invalid)l={state:o.ContactTokenState.invalid,msg:E.SINGLE_INVALID};else{if(e.email===t.email)return l;if(null!=n&&t.is_team&&e.dbx_team_id!==n.id&&!e.group_id){var c=E.SINGLE_OUT_OF_TEAM,d=void 0;d="team"===(null!=r?r.member_policy:void 0)||"team"===(null!=r?r.resolved_member_policy:void 0)?o.ContactTokenState.invalid:o.ContactTokenState.warn,l={msg:c,state:d}}}return l};t.validateContact=M;var k=function(e,t,n,r,s,i,a){for(var l=null,c=null,d=0,u=e;d<u.length;d++){var h=u[d],m=M(h,t,n,r,s,i,0),_=m.state,f=m.msg;if(_===o.ContactTokenState.invalid){if(l=b.ERROR,f===E.SINGLE_INVALID){c=E.GENERAL_INVALID;break}f===E.SINGLE_OUT_OF_TEAM&&(c=E.GENERAL_OUT_OF_TEAM),f===E.NONGROUP_INVITEE&&(c=E.NONGROUP_INVITEE)}_===o.ContactTokenState.warn&&f===E.SINGLE_OUT_OF_TEAM&&(l||(l=b.WARN,c=E.GENERAL_OUT_OF_TEAM))}return A(t,s,i)&&e.length>0&&l!==b.ERROR&&a>p.GoldenGate.SHARING_TOTAL_LIMIT&&(l=b.ERROR,c=E.GENERAL_TOO_MANY_MEMBERS),{level:l,message:c}};t.validateContacts=k;var N=function(e){switch(e){case"reader":return"viewer";case"writer":return"editor";case"owner":return"owner";default:return"default"}},P=function(e){var t=e.displayName()||"";return{access_type:N(e.access_type),display_name:t,initials:null!=e.initials?e.initials:f.getInitials(t),photo_url:null!=e.account?e.account.profile_photo_url:void 0,user_id:e.memberId()}};t.apiUserMemberToAvatarInfo=P;var L=function(e){return{access_type:N(e.access_type),gid:e.memberId(),is_automatic:"team"===e.group_type,name:e.displayName(),num_users:e.member_count}};t.apiGroupMemberToAvatarInfo=L;var R=function(e){return{access_type:N(e.access_type),invitation_id:e.memberId(),email_or_fbname:e.displayName()}};t.apiInviteeMemberToAvatarInfo=R;var O=function(e,t,n,i){void 0===i&&(i={}),s.ShareTibEventLogger.log(t,n,e.extras.origin||"",r.assignIn(i,{file_id:e.extras.fileId,fq_path:e.displayPath(),ns_id:e.isSharedFolder()?e.sharedFolderId():void 0,modal_session_id:e.extras.modalSessionId}))};t.logTiburonEvent=O;var F={access_error:g("You don’t have access to this content."),email_unverified:g("You haven’t verified your email. Check your email and try again."),bad_member:g("You entered an invalid name or email address."),cant_share_outside_team:g("Your team settings don’t allow sharing outside your team."),too_many_members:g("You’re sharing with too many people."),too_many_pending_invites:g("You’re sharing with too many people."),rate_limit:g("You’ve hit the limit of invites for today. Try again later."),insufficient_plan:g("You need a Dropbox %(trademark_plus)s or Business account to do this.").format({trademark_plus:h.TRADEMARK_PLUS}),team_folder:g("You can’t add members to a team folder. Contact your team admin."),no_permission:g("You don’t have permission to do this. Contact the owner.")},D=function(e){return e.message?e.message:e instanceof i.AppError&&e.error&&e.error[".tag"]&&F[e.error[".tag"]]?F[e.error[".tag"]]:g("There was a problem completing this request.")};t.genAddMemberErrorMessage=D;var x=function(e){var t=null!=e.parent_shared_folder_id,n=!1;return e.permissions&&e.permissions.edit_contents&&(n=!e.permissions.edit_contents.allow),c.folder_icon({isShared:e.isSharedFolder(),isDeleted:null==e.path_lower,isInTeamFolderTree:t,isTeamFolder:e.is_team_folder,isViewOnly:n})};t.folderIconForMetadata=x;var U=function(e){var t=null!=e.parent_shared_folder_id,n=!1;e.permissions&&e.permissions.edit_contents&&(n=!e.permissions.edit_contents.allow);var r=l.FileTypes.FOLDER;return e.isSharedFolder()?r=l.FileTypes.SHARED_FOLDER:e.is_team_folder&&(r=l.FileTypes.TEAM_SHARED_FOLDER),c.spectrum_folder_icon({fileType:r,isInTeamFolderTree:t,isViewOnly:n})};t.spectrumFolderIconForMetadata=U;var B=function(e){return c.file_icon(e.name,{size:c.ICON_SIZES.LARGE})};t.fileIconForMetadata=B;var q=function(e){var t,n=(e.isLimitedTeam,e.containingFolder),r=e.filenameToSelect,s=e.isCDM,i=s?"content":"team_folders";return n=a.normalize(n)||"",r&&(t=[n,r].join("/")),new _({path:"/team/admin/"+i+"/home"+n,query:t?{select:t}:void 0})};t.genContentManagerBridgeUri=q;var H=function(e,t){return[a.normalize(t),e].join("/")};t.getNewFolderPathFromContentName=H;var V=function(e){return null==e?0:e.map(function(e){return e.group_size||1}).reduce(function(e,t){return e+t},0)};t.getMemberCountForTokens=V;var j=function(e){return e.toHTML?d.reactFormat(e.toHTML(),v):e};t.convertIfHTML=j}),define("modules/clean/sharing/views/constants",["require","exports","external/lodash","modules/core/i18n"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r.i18n_default_project("sharing")._;t.MODES={LINK_ONLY:"link-only",LOADING:"loading",MEMBERSHIP:"membership",SHARE:"share",SHARE_SENDING:"share-sending"};var i;(function(e){e[e.NO_MEMBERS=0]="NO_MEMBERS",e[e.INPUT_CONTENT_NAME=1]="INPUT_CONTENT_NAME"})(i=t.BANNERS||(t.BANNERS={}));var o;(function(e){e[e.INFO=0]="INFO",e[e.ERROR=1]="ERROR"})(o=t.CONTENT_NAME_MESSAGE_LEVELS||(t.CONTENT_NAME_MESSAGE_LEVELS={})),t.LINK_ONLY_REASON={INSIDE_SHARED_FOLDER:"inside_shared_folder",CONTAINS_SHARED_FOLDER:"contains_shared_folder",LINKS_PAGE:"links_page"},t.CONTENT_NAME_EMPTY_TOOLTIP=s("Name your shared folder"),t.MODE_VALUES=n.values(t.MODES),t.BANNER_VALUES=n.values(i),t.CONTENT_NAME_MESSAGE_LEVEL_VALUES=n.values(o)}),define("modules/clean/sharing/views/exp_share_link_upsell",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/react_format","modules/clean/static_urls","modules/constants/trademark","modules/constants/payments"],function(e,t,n,r,s,i,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=d.OUT_OF_SPACE_URL+"?oqa=sf_sloq";return r.createElement("div",{className:"share-link-upgrade__content"},r.createElement(i.Image,{className:"unified-share-modal__illo",src:l.static_url("/static/images/sharing/sharing-invite-users-vflfTH_fj.png"),srcHiRes:l.static_url("/static/images/sharing/sharing-invite-users@2x-vflgGHzXi.png")}),r.createElement("div",{className:"share-link-upgrade__footer"},r.createElement("div",{className:"share-link-upgrade__footer-content"},r.createElement("p",{className:"u-mar-top-s share-link-upgrade__copy"},a.reactFormat(o._("Get %(trademark_plus)s to add more shared content to your Dropbox."),{trademark_plus:c.TRADEMARK_PLUS})),r.createElement("a",{className:"c-btn c-btn--primary subgrowth_pro_overquota_create_shared_link",href:e},o._("Upgrade")))))},t})(r.Component);t.ExpShareLinkUpsellV1=s(u,["/static/css/sharing/exp_oq_shared_link_upsellV1-vflBUzAf2.css"]),t.ExpShareLinkUpsellV2=s(u,["/static/css/sharing/exp_oq_shared_link_upsellV2-vflCPWbUy.css"])}),define("modules/clean/sharing/views/inherited_members",["require","exports","tslib","external/classnames","external/react","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/filepath","modules/clean/react/modal","modules/clean/react/snackbar","modules/clean/react/sprite","modules/clean/react_format","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/undo","modules/core/i18n","modules/core/notify"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=s.createElement,y=function(e,t){i.catchApiError(function(){return e.message?(f.error(e.message),e instanceof i.ServerError?t&&t():l.Modal.close()):l.Modal.close(),e})(e)},v=(function(e){function t(t){var n=e.call(this,t)||this;return n.onToggleShowMemberList=function(){0!==n.props.members.length&&n.setState({areMembersExpanded:!n.state.areMembersExpanded})},n.state={areMembersExpanded:!1},n}return n.__extends(t,e),t.prototype.renderMembersList=function(){return this.state.areMembersExpanded?s.createElement("div",null,s.createElement("div",{className:"u-mar-top-xs u-mar-horizontal-xs u-pad-top-xs inherited-member-list__divider"}),s.createElement("div",null,s.createElement("ul",{className:"u-pad-horizontal-s u-pad-vertical-xs inherited-member-list__member"},this.props.children))):void 0},t.prototype.renderRemoveButton=function(){return this.props.canUpdateConfidentiality?s.createElement("button",{className:"inherited-member-list__remove-button button-as-link",onClick:this.props.onToggleInheritanceClick},_._("Remove",{comment:"Shown on button that can be clicked to remove access to subfolder"})):void 0},t.prototype.renderTriangle=function(){return 0===this.props.members.length?s.createElement("div",{className:"u-pad-horizontal-xs"}):s.createElement("a",{href:"#",className:"u-pad-horizontal-xxs o-flag__fix inherited-member-list__triangle",onClick:this.onToggleShowMemberList},g(d,{alt:_._("Toggle whether inherited members are displayed or hidden"),group:"web",name:this.state.areMembersExpanded?"triangle_open_1x":"triangle_closed_1x"}))},t.prototype.render=function(){var e,t=a.parent_dir(this.props.contentInfo.displayPath());if("/"===t)e=_._("Members of %(team_name)s shared workspace").format({team_name:o.Emstring.em_snippet(this.props.teamName,h.SNIPPET_SIZES.DISPLAY_NAME)});else{var n=a.filename(t);e=_._("Members of “%(folder_name)s” folder").format({folder_name:o.Emstring.em_snippet(n,h.SNIPPET_SIZES.FILENAME)})}var i=0;this.props.members.forEach(function(e){e instanceof p.GroupMembershipInfo?i+=e.member_count:i++});var l=_.ungettext("%(members_count)s member","%(members_count)s members",i).format({members_count:i}),c=r([{"u-mar-bottom-xs":!0,"inherited-member-list__outer-expanded":this.state.areMembersExpanded,"inherited-member-list__outer-closed":!this.state.areMembersExpanded}]),u=r([{"inherited-member-list__inner":!this.state.areMembersExpanded}]);return s.createElement("div",{className:c},s.createElement("div",{className:u},s.createElement("div",{className:"o-flag inherited-member-list__toggle-show-member",onClick:this.onToggleShowMemberList},this.renderTriangle(),s.createElement("div",{className:"o-flag__flex u-pad-vertical-xs u-pad-right-s"},s.createElement("div",{className:"o-flag"},s.createElement("div",{className:"o-flag__fix"},g(d,{alt:"",className:"unified-share-modal__title-icon",group:"web",name:"folder_user_32"})),s.createElement("div",{className:"o-flag__flex u-pad-left-s"},s.createElement("div",{className:"inherited-member-list__member-str u-font-strong"},e),s.createElement("div",{className:"inherited-member-list__member-count-str u-font-meta"},l)),s.createElement("div",{className:"o-flag__fix u-pad-right-xxs"},this.renderRemoveButton())))),s.createElement("div",null,this.renderMembersList())))},t})(s.Component);t.InheritedMembers=v;var S=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={isAccepting:!1},n}return n.__extends(t,e),t.prototype.renderContent=function(e,t,n){var r;return r=this.props.initialIsConfidentialFolder?e?u.reactFormat(_._("<strong>%(folder_name)s</strong> won’t be shared privately any more.\n             Everyone at %(team_name)s will have access to this folder.").format({team_name:o.Emstring.em_snippet(this.props.teamName,h.SNIPPET_SIZES.DISPLAY_NAME),folder_name:o.Emstring.em_snippet(n,15)}),{strong:s.createElement("strong",{style:{fontWeight:500}})}):u.reactFormat(_._("Everyone who can access <strong>%(parent_folder_name)s</strong> will be able to access this folder.").format({parent_folder_name:o.Emstring.em_snippet(t,15)}),{strong:s.createElement("strong",{style:{fontWeight:500}})}):e?u.reactFormat(_._("Members of %(team_name)s won’t be able to access <strong>%(folder_name)s</strong>.").format({team_name:o.Emstring.em_snippet(this.props.teamName,h.SNIPPET_SIZES.DISPLAY_NAME),folder_name:o.Emstring.em_snippet(n,15)}),{strong:s.createElement("strong",{style:{fontWeight:500}})}):u.reactFormat(_._("Members of <strong>%(parent_folder_name)s</strong> folder won’t be able to access\n             <strong>%(folder_name)s</strong>.").format({parent_folder_name:o.Emstring.em_snippet(t,15),folder_name:o.Emstring.em_snippet(n,15)}),{strong:s.createElement("strong",{style:{fontWeight:500}})}),s.createElement("div",null,s.createElement("div",{className:"confirmation-modal__content"},r),s.createElement("br",null))},t.prototype.renderButtons=function(e,t,n){var r=this,i=o.Emstring.em_snippet(this.props.teamName,h.SNIPPET_SIZES.DISPLAY_NAME),a=e?_._("Share with %(team_name)s").format({team_name:i}):_._("Share"),l=this.props.initialIsConfidentialFolder?a:_._("Remove");return s.createElement("div",{className:"u-l-fr"},s.createElement("button",{className:"c-btn c-btn--primary confirmation-modal__action",disabled:this.state.isAccepting,onClick:function(){return r._onToggleConfidentialFolder(!1,e,t,n)}},l),s.createElement("button",{className:"c-btn c-btn--secondary u-mar-left-xs confirmation-modal__cancel",onClick:this.props.onCancel},_._("Cancel")))},t.prototype._onToggleConfidentialFolder=function(e,t,n,r){var s=this,i=!e,a=e?this.props.initialIsConfidentialFolder:!this.props.initialIsConfidentialFolder;e||this.setState({isAccepting:!0});var l=this.props.actionHandler;return l.handleSetConfidential(a).then(function(){if(l.fetchDataAndShowShareModal(),i){var e=void 0;e=a?t?_._("Members of %(team_name)s removed from “%(folder_name)s”.").format({team_name:o.Emstring.em_snippet(s.props.teamName,h.SNIPPET_SIZES.DISPLAY_NAME),folder_name:o.Emstring.em_snippet(r,15)}):_._("Members of “%(parent_folder_name)s” folder removed from “%(folder_name)s”.").format({parent_folder_name:o.Emstring.em_snippet(n,15),folder_name:o.Emstring.em_snippet(r,15)}):t?_._("“%(folder_name)s” shared with %(team_name)s.").format({folder_name:o.Emstring.em_snippet(r,15),team_name:o.Emstring.em_snippet(s.props.teamName,h.SNIPPET_SIZES.DISPLAY_NAME)}):_._("“%(folder_name)s” shared with members of “%(parent_folder_name)s”.").format({folder_name:o.Emstring.em_snippet(r,15),parent_folder_name:o.Emstring.em_snippet(n,15)}),m.notifyWithUndo(e,{confidential:s.props.initialIsConfidentialFolder},function(){return s._onToggleConfidentialFolder(!0)},10,_._("Undo"))}}).catch(function(e){return y(e,function(){return s.setState({isAccepting:!1})})})},t.prototype.render=function(){var e,t,n,r=this.props.contentInfo.displayPath(),i=a.parent_dir(r),c=a.filename(r);return"/"===i?t=!0:(t=!1,n=a.filename(i)),e=this.props.initialIsConfidentialFolder?t?_._("Share “%(folder_name)s” with everyone at %(team_name)s?").format({folder_name:o.Emstring.em_snippet(c,15),team_name:o.Emstring.em_snippet(this.props.teamName,h.SNIPPET_SIZES.DISPLAY_NAME)}):_._("Share “%(folder_name)s” with everyone who can access “%(parent_folder_name)s”?").format({folder_name:o.Emstring.em_snippet(c,15),parent_folder_name:o.Emstring.em_snippet(n,15)}):t?_._("Remove members of %(team_name)s?").format({team_name:o.Emstring.em_snippet(this.props.teamName,h.SNIPPET_SIZES.DISPLAY_NAME)}):_._("Remove members of “%(folder_name)s” folder?").format({folder_name:o.Emstring.em_snippet(n,15)}),s.createElement(l.Modal,{autoClose:!1,buttonComponent:s.createElement("span",null),onDismissCompleted:this.props.onCancel,title:e},this.renderContent(t,n,c),this.renderButtons(t,n,c))},t})(s.Component);t.SetInheritedMembersUIConfidentialModal=S;var E=(function(){function e(e,t,n,r,i){var o=this;this.getConfirmModalTitle=function(){var e={current_folder:o.currentFolderName,parent_folder:o.parentFolderName,team_name:o.teamName,b:s.createElement("b",{style:{fontWeight:500}})},t="";return t=o.isDowngrading?_._("<b>Change how members can access “%(current_folder)s”</b>"):o.isTsdPlusOne?_._("<b>Remove everyone at %(team_name)s</b>"):_._("<b>Remove a member of “%(parent_folder)s”</b>"),u.reactFormat(t,e)},this.getConfirmModalContent=function(){var e={member_name:o.memberName,parent_folder:o.parentFolderName,current_folder:o.currentFolderName,team_name:o.teamName,b:s.createElement("b",{style:{fontWeight:500}}),br:s.createElement("br",null)},t="";return t=o.isTsdPlusOne?o.isDowngrading?_._("%(member_name)s will only be able to view this folder, and new %(team_name)s members won’t be able to access it automatically.<br/>To add more people to this folder in the future, you’ll need to invite them directly."):_._("%(team_name)s members won’t be able to see future changes to <b>%(current_folder)s</b> automatically.<br/>To give people access to this folder in the future, you’ll need to invite them directly."):o.isDowngrading?_._("%(member_name)s will only be able to view this folder, and new members of <b>%(parent_folder)s</b> won’t be able to access it automatically.<br/>To add more people to this folder in the future, you’ll need to invite them directly."):_._("%(member_name)s and new members of the <b>%(parent_folder)s</b> folder, won’t be able to see future changes to this shared folder.<br/>To add more people to this folder in the future, you’ll need to invite them directly."),u.reactFormat(t,e)},this.getSnackBarRemovingString=function(){var e={b:s.createElement("b",{style:{fontWeight:500}}),current_folder:o.currentFolderName,member_name:o.memberName},t=o.isDowngrading?_._("Changing access for <b>%(current_folder)s</b>…"):_._("Removing <b>%(member_name)s</b>…");return u.reactFormat(t,e)},this.getSnackBarCompleteString=function(){var e={b:s.createElement("b",{style:{fontWeight:500}}),current_folder:o.currentFolderName,member_name:o.memberName},t=o.isDowngrading?_._("Access changed for <b>%(current_folder)s</b>."):_._("<b>%(member_name)s</b> removed.");return u.reactFormat(t,e)},this.isDowngrading=e,this.teamName=t,this.parentFolderName=n,this.currentFolderName=r,this.memberName=i,this.isTsdPlusOne=""===n}return e})(),b=(function(e){function t(t){var n=e.call(this,t)||this;n.actionCompleteCallback=function(){var e=n.props.actionHandler;c.Snackbar.complete(n.stringManager.getSnackBarCompleteString()),n.setState({removing:!1}),e.fetchDataAndShowShareModal()},n.removeTheSelectedMember=function(e){var t=n.props,r=t.member,s=t.actionHandler;return t.isUserSelf?void s.relinquishMembership(e.shared_folder_id,!1):s.removeMember(e.shared_folder_id,r,!1,!0).then(n.actionCompleteCallback).catch(function(e){return y(e,function(){return n.setState({removing:!1})})})},n.changeAccessOfSelectedMember=function(e){var t=n.props,r=t.newAccessLevel,s=t.actionHandler,i=t.member,o=r;return s.changeMemberAccess(e.shared_folder_id,i,o).then(n.actionCompleteCallback)},n.changeConfidentialAccess=function(){var e=n.props,t=e.actionHandler,r=e.inheritedMembers,i=e.isDowngrading;return n.setState({removing:!0}),c.Snackbar.show(s.createElement(c.Snackbar,{title:n.stringManager.getSnackBarRemovingString(),variant:"sync",timeoutDelayMs:1e5,syncProgressLoop:!0})),t.handleSetConfidential(!0).then(function(e){(function(){return t.addMembers(r,e.shared_folder_id,!0)})().then(function(){return i?n.changeAccessOfSelectedMember(e):n.removeTheSelectedMember(e)}).catch(function(e){return y(e,function(){return n.setState({removing:!1})})})}).catch(function(e){return y(e,function(){return n.setState({removing:!1})})})},n.state={removing:!1};var r=n.props,i=r.member,o=r.teamName,a=r.parentFolderName,l=r.currentFolderName,d=r.isDowngrading;return n.stringManager=new E(d,o,a,l,i.displayName()||""),n}return n.__extends(t,e),t.prototype.render=function(){return s.createElement(l.Modal,{autoClose:!1,buttonComponent:s.createElement("span",null),title:this.renderTitle()},this.renderBody(),this.renderButtons())},t.prototype.renderTitle=function(){return this.stringManager.getConfirmModalTitle()},
t.prototype.renderBody=function(){return s.createElement("div",null,s.createElement("div",{className:"confirmation-modal__content"},this.stringManager.getConfirmModalContent()),s.createElement("br",null))},t.prototype.renderButtons=function(){var e=this.props,t=e.actionHandler,n=e.isDowngrading,r=e.parentFolderName,i="";return i=n?_._("Change access"):""===r?_._("Remove everyone"):"Remove",s.createElement("div",{className:"u-l-fr"},s.createElement("button",{className:"c-btn c-btn--primary confirmation-modal__action",disabled:this.state.removing,onClick:this.changeConfidentialAccess},i),s.createElement("button",{className:"c-btn c-btn--secondary u-mar-left-xs confirmation-modal__cancel",onClick:t.openShareModal},_._("Cancel")))},t})(s.Component);t.SingleInheritedUserAccessChangeModal=b}),define("modules/clean/sharing/views/member_list",["require","exports","tslib","external/immutable","external/react","modules/clean/sharing/access_level","modules/clean/sharing/gating_util","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/views/inherited_members","modules/clean/sharing/views/member_list_item","modules/clean/sharing/views/viewer_info","modules/clean/sharing/ui_util","modules/clean/viewer","modules/core/i18n","modules/clean/sharing/views/wrapped_group_viewers_maker","modules/clean/react/pass/store"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=m.i18n_default_project("sharing")._,y=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderMembersListItem=function(e,n){var r=e.memberKey(),a=t.props.groupSeenStateInfo[e.memberId()]?t.renderWrappedGroupViewersElement(e):void 0,c=function(r){var s=r===l.MEMBER_ACTION.REMOVE,a=!s&&i.isLowerAccess(e.access_type,r);if(o.GoldenGate.enableSetConfidentialForRemovingSingleUser(t.props.user.id)&&t.props.canUpdateConfidentiality&&e.is_inherited&&null!==n&&void 0!==n&&(s||a)){var c=t.props.teamName;return t.props.actionHandler.handleInheritedMemberAccessChange(e,n,c,a,a?r:void 0)}return t.props.actionHandler.handleMemberAccessChange(e,r)};return s.createElement(d.SharingMemberListItem,{canInviteMembers:t.props.canInviteMembers,canMakeViewerNoComment:t.props.canMakeViewerNoComment,canRelinquishMembership:t.props.canRelinquishMembership,contentInfo:t.props.contentInfo,disabled:t.props.disabled,wrappedGroupViewersElement:a,isMemberActionPending:t.props.pendingMemberAction.has(r),isPresent:t.props.shouldShowPassUI&&t.isMemberCurrentlyViewing(e),key:r,member:e,user:t.props.user,onAccessChangeInBubbleMenu:c})},t}return n.__extends(t,e),t.prototype.render=function(){var e=p.makeMemberSortCmp(this.props.user,this.props.presentAccountIds||r.Set(),this.shouldSortUsingPassRules()),t=this.membersByInheritance(),n=t.get(!1);n&&(n=n.sort(e));var i=t.get(!0);i&&(i=i.sort(e));var o=null;return this.props.areMembersFullyLoaded||(o=s.createElement("div",{className:"sharing-member-list__loading c-loader u-mar-horizontal-auto u-l-b"},g("Loading more members..."))),s.createElement("div",{className:"sharing-member-list"},this.renderInheritedUI(n,i),o)},t.prototype.shouldSortUsingPassRules=function(){var e=f.passStore.getPassPermissions(this.props.contentInfo.id);return null!=e&&(e.canReadPresence||e.canReadSeenState)},t.prototype.renderInheritedUI=function(e,t){var n=this,r=null;this.props.user.is_cdm_member&&!this.props.isConfidentialFolder&&this.props.isFolderInsideTeamFolderTree&&(r=s.createElement(c.InheritedMembers,{canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,members:t?t.toArray():[],onToggleInheritanceClick:this.props.onToggleInheritanceClick,teamName:this.props.teamName},t?t.map(function(e){return n.renderMembersListItem(e,t)}):null));var i=null;return e&&e.count()>0&&(i=s.createElement("div",{className:"u-pad-horizontal-s"},e.map(function(e){return n.renderMembersListItem(e)}).toArray())),s.createElement("ul",{className:"o-list-ui u-trim-margin u-pad-horizontal-xs"},r,i)},t.prototype.isMemberCurrentlyViewing=function(e){return!this.memberIsAssumed(e)&&(e instanceof a.UserMembershipInfo&&this.props.presentAccountIds&&this.props.presentAccountIds.has(e.account_id))},t.prototype.memberIsAssumed=function(e){return e instanceof a.UserMembershipInfo&&e.account_id===this.props.user.account_id&&h.Viewer.get_viewer().is_assume_user_session},t.prototype.membersByInheritance=function(){var e=this,t=function(t){return e.shouldSortByInherited()&&t.is_inherited};return this.props.membership?this.props.membership.groups.valueSeq().concat(this.props.membership.invitees.valueSeq(),this.props.membership.users.valueSeq(),this.props.guestMembers).groupBy(t):this.props.guestMembers.length>0?r.List(this.props.guestMembers).groupBy(t):r.Map()},t.prototype.shouldSortByInherited=function(){return this.props.user.is_cdm_member&&!!this.props.isFolderInsideTeamFolderTree},t.prototype.extractGroupSeenStateAndViewers=function(e){var t=this,n=this.props.groupSeenStateInfo[e.memberId()],r=[];return this.props.presentAccountIds&&(r=n.map(function(e){return new u.ViewerInfo(e)}).filter(function(e){return null!=e.time_last_seen||t.props.presentAccountIds.has(e.account_id)})),{singleGroupSeenStateInfo:n,viewers:r}},t.prototype.renderWrappedGroupViewersElement=function(e){var t=this.extractGroupSeenStateAndViewers(e).viewers;return t.length?_.WrappedGroupViewersMaker.make(t,this.props.presentAccountIds):{element:null,elementText:""}},t.displayName="SharingMemberList",t.defaultProps={disabled:!1,groupSeenStateInfo:{}},t})(s.Component);t.SharingMemberList=y}),define("modules/clean/sharing/views/member_list_item",["require","exports","tslib","external/classnames","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/size","modules/clean/datetime","modules/clean/em_string","modules/clean/react/pass/utils","modules/clean/react/title_bubble","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/sharing/views/viewer_info","modules/clean/static_urls","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=g.i18n_default_project("sharing"),S=v._,E=v.ungettext,b=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.shouldLinkToGroup=function(){return this.props.member instanceof p.GroupMembershipInfo&&(!!this.props.member.same_team&&(!!this.props.user.is_team_admin||!!this.props.member.is_member&&this.props.member.group_management_type!==p.GroupManagementType.system_managed))},t.prototype.linkToGroup=function(e,t,n){var i="/team#groups/%(id)s".format({id:e.group_id}),o=r({"u-font-meta":!n,"sharing-member-info__group-name-link":!0,"sharing-member-info__display-name-title":n});return s.createElement("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:o,title:e.group_name},t)},t.prototype.renderAvatar=function(e,t){var n,r=this.props.member.displayName()||"";this.props.member instanceof _.ViewerInfo||(n=this.props.member.initials),n=n||y.getInitials(r);var l=t?"SQUARE":"CIRCLE",c=d.AnonymousViewerUtils.isAnonymousUserId(this.props.member.memberId())?this.props.member.memberId():r;return s.createElement("div",{className:"o-flag__fix"},s.createElement(i,{dimension:a.AVATAR_DIMENSION_BY_SIZE.MEDIUM,photoUrl:e,shape:l,defaultAvatar:s.createElement(o.InitialsAvatarWithColorDerivedFromName,{dimension:a.AVATAR_DIMENSION_BY_SIZE.MEDIUM,shape:l,initials:n,name:c})}))},t.prototype.renderNameTitleAndText=function(e,t,n){return e?this.shouldLinkToGroup()&&!this.shouldRenderGroupCount()?this.linkToGroup(this.props.member,n,!0):s.createElement("span",{className:"sharing-member-info__display-name-title",title:t},n):null},t.prototype.renderDisabledMessage=function(e){return e?[s.createElement("span",{className:"u-font-meta dot"},"·"),s.createElement("span",{className:"u-font-danger"}," ",e)]:null},t.prototype.renderSeenState=function(e){if(e){var t=r({"u-font-meta":!0,"sharing-member-info__last-seen-text":!0,"sharing-member-info__last-seen-text--not-present":!this.props.isPresent});return[s.createElement("span",{className:"u-font-meta dot"},"·"),s.createElement("span",{className:t},e)]}return null},t.prototype.renderOffTeamMessage=function(e){return e?s.createElement("span",{className:"u-font-meta"},e):null},t.prototype.renderDisplayName=function(e,t){var n=this.props.member.displayName(),i="",o=null;if(this.props.wrappedGroupViewersElement)i=this.props.wrappedGroupViewersElement.elementText,o=this.props.wrappedGroupViewersElement.element;else if(this.props.isPresent)i=o=S("Viewing now");else if(t){i=S("Viewed %(time_str)s").format({time_str:l.ago(t,!1,!0,!0)});var a=t.toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"}),d=t.toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric"});o=s.createElement(u.TitleBubble,{content:s.createElement("div",null,a,s.createElement("br",null),d),className:"timestamp-tooltip",children:s.createElement("span",null,i),position:u.TitleBubble.POSITIONS.BOTTOM,isTargetPositionFixed:!0})}var p="";e&&e.disabled&&(p=S("Deleted"));var m=0,_=0;if(n){i&&(m=new c.Emstring("  ·  %s".format(i)).length),p&&(_=new c.Emstring("  ·  %s".format(p)).length);var f=h.SNIPPET_SIZES.DISPLAY_NAME-m-_,g=c.Emstring.em_snippet(n,f),y="";g!==n&&(y=n);var v=r({"u-font-meta":this.props.isMemberActionPending,"u-font-strong":!0,"u-ellip":!0,"sharing-member-info__display-name":!0});return s.createElement("div",{className:v},this.renderNameTitleAndText(n,y,g),this.renderDisabledMessage(p),this.renderSeenState(o))}},t.prototype.renderMemberDetails=function(e,t){var n="",r=0,i=t&&!t.email;!this.props.user.is_team||this.props.member.same_team||i||(n=S("Outside your Dropbox team"),r=new c.Emstring("  ·  %s".format(n)).length);var o;if(e)o=this.shouldLinkToGroup()?this.linkToGroup(this.props.member,e,!1):e;else if(t&&t.email&&t.email_verified){var a=h.SNIPPET_SIZES.EMAIL-r,l=c.Emstring.em_snippet(t.email,a),d="";l!==t.email&&(d=t.email),o=s.createElement("span",{title:d},l)}var u;return n&&o&&(u=s.createElement("span",{className:"u-font-meta dot"},"·")),s.createElement("div",{className:"u-font-meta u-ellip sharing-member-info__details"},o,u,this.renderOffTeamMessage(n))},t.prototype.renderSharingBubbleMenu=function(){var e;if(this.props.isMemberActionPending)e=s.createElement("img",{src:f.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:S("Changing access")});else if(this.props.isViewOnly||this.props.member instanceof _.ViewerInfo)e=s.createElement("span",null);else{var t=this.props.member.permissions.get("make_viewer_no_comment"),n=t&&t.allow&&this.props.canMakeViewerNoComment,r=this.props.member.permissions.set("make_viewer_no_comment",new p.PermissionSetting({allow:n})),i=this.props.member.memberId()===this.props.user.account_id&&this.props.canRelinquishMembership;e=s.createElement(m.SharingBubbleMenu,{allowRelinquishMembership:i,canInviteMembers:this.props.canInviteMembers,canMakeViewerNoComment:n,contentInfo:this.props.contentInfo,currentAccess:this.props.member.access_type,disabled:this.props.disabled,isInherited:this.props.member.is_inherited,memberPermissions:r,onAccessChange:this.props.onAccessChangeInBubbleMenu,pendingAccessChange:this.props.pendingAccessChange})}return s.createElement("div",{className:"o-flag__fix"},e)},t.prototype.shouldRenderGroupCount=function(){return this.props.member instanceof p.GroupMembershipInfo&&this.props.member.member_count},t.prototype.render=function(){var e,t=void 0,n=!1,i=null,o=void 0,a=this.props.member;if(a instanceof p.UserMembershipInfo){if(t=a.account,!t)return null;i=t.profile_photo_url||null,e=a.time_last_seen}else a instanceof p.GroupMembershipInfo?(n=!0,"team"===a.group_type&&(i=f.static_url("/static/images/icons/team_24@2x-vflR8kGKs.png")),this.shouldRenderGroupCount()&&(o=E("%(member_num)s member","%(member_num)s members",a.member_count).format({member_num:a.member_count}))):a instanceof _.ViewerInfo&&(t={email:a.email,email_verified:!!a.email},i=a.photo_circle_url,e=a.time_last_seen);var l=r({"sharing-member-info":!0,"o-flag":!0,"u-pad-right-m":!this.props.isViewOnly});return s.createElement("li",{className:"sharing-member-list__item o-flag"},s.createElement("div",{className:"o-flag__flex"},s.createElement("div",{className:l},this.renderAvatar(i,n),s.createElement("div",{className:"sharing-member-info__contact o-flag__flex"},this.renderDisplayName(t,e),this.renderMemberDetails(o,t)))),this.renderSharingBubbleMenu())},t.displayName="SharingMemberListItem",t.defaultProps={canInviteMembers:!1,canMakeViewerNoComment:!1,canRelinquishMembership:!1,disabled:!1,isPresent:!1,isViewOnly:!1,wrappedGroupViewersElement:void 0},t})(s.Component);t.SharingMemberListItem=b}),define("modules/clean/sharing/views/modal_content",["require","exports","external/classnames","external/create-react-class","external/immutable","external/react","external/react-dom","external/lodash","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/contacts/util","modules/clean/em_string","modules/clean/filepath","modules/clean/react/bubble","modules/clean/react/bubble_dropdown_v2","modules/clean/react/css","modules/clean/react/image","modules/clean/react/pass/constants","modules/clean/react/snackbar","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/react_format","modules/clean/sharing/access_level","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/share_modal_icon","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/clean/sharing/views/exp_share_link_upsell","modules/clean/sharing/views/hover_close_button","modules/clean/sharing/views/member_list","modules/clean/sharing/views/modal_link_info","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/static_urls","modules/clean/user","modules/clean/web_timing_logger","modules/constants/rebrand","modules/constants/sharing","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y,v,S,E,b,I,T,C,w,A,M,k,N,P,L,R,O,F,D,x,U,B,q){"use strict";function H(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.MODES=k.MODES;var V=i.createElement,j=i.DOM,G=q.i18n_default_project("sharing"),K=G._,W=G.ungettext,Y=r({displayName:"ShareModalContent",statics:{MODES:k.MODES},propTypes:{actionHandler:i.PropTypes.instanceOf(I.ShareModalActionHandler).isRequired,areMembersFullyLoaded:i.PropTypes.bool,banner:i.PropTypes.oneOf(k.BANNER_VALUES),canEdit:i.PropTypes.bool.isRequired,canInviteEditor:i.PropTypes.bool.isRequired,canInviteViewer:i.PropTypes.bool.isRequired,canInviteViewerNoComment:i.PropTypes.bool.isRequired,canMakeViewerNoComment:i.PropTypes.bool.isRequired,canRelinquishMembership:i.PropTypes.bool,canShareLink:i.PropTypes.bool.isRequired,canUpdateConfidentiality:i.PropTypes.bool,contactsError:i.PropTypes.shape({level:i.PropTypes.string,message:i.PropTypes.oneOfType([i.PropTypes.string,i.PropTypes.array])}),contentInfo:i.PropTypes.instanceOf(w.ContentInfo).isRequired,contentNameMessage:i.PropTypes.string,contentNameMessageLevel:i.PropTypes.oneOf(k.CONTENT_NAME_MESSAGE_LEVEL_VALUES),displayContentNameTooltip:i.PropTypes.bool,displayContentNameBanner:i.PropTypes.bool,folderPolicy:i.PropTypes.instanceOf(T.FolderPolicy),guestMembers:i.PropTypes.array.isRequired,groupSeenStateInfo:i.PropTypes.object,hasDisplayableMembers:i.PropTypes.bool.isRequired,hasNonOwnerMembers:i.PropTypes.bool.isRequired,headerId:i.PropTypes.string,initialContentName:i.PropTypes.string,initialRecipientRawInput:i.PropTypes.string,initialRecipientTokens:i.PropTypes.array,isConfidentialFolder:i.PropTypes.bool,isContentNameFocused:i.PropTypes.bool,isFolderInsideTeamFolderTree:i.PropTypes.bool,isInContentManager:i.PropTypes.bool,isLimitedTeam:i.PropTypes.bool,isLinkMetadataLoaded:i.PropTypes.bool.isRequired,isMetadataLoaded:i.PropTypes.bool.isRequired,isPassEnabled:i.PropTypes.bool,isTeamSharedFolder:i.PropTypes.bool,isTokenizerEmpty:i.PropTypes.bool.isRequired,linkMetadata:i.PropTypes.oneOfType([i.PropTypes.instanceOf(T.LinkMetadata),i.PropTypes.instanceOf(T.SharedContentLinkMetadata)]),linkOnlyReason:i.PropTypes.oneOf(a.values(k.LINK_ONLY_REASON)),memberCounts:i.PropTypes.instanceOf(T.MemberCounts),memberCountWithRecipients:i.PropTypes.number,members:i.PropTypes.instanceOf(T.SharingMembership),mode:i.PropTypes.oneOf(k.MODE_VALUES),name:i.PropTypes.string,onSettingsClick:i.PropTypes.func,onToggleInheritanceClick:i.PropTypes.func,ownerTeam:i.PropTypes.shape({id:i.PropTypes.string.isRequired,name:i.PropTypes.string.isRequired}),passFetchingStatus:i.PropTypes.number,pendingMemberAction:i.PropTypes.instanceOf(s.Set).isRequired,presentAccountIds:i.PropTypes.instanceOf(s.Set),recipientAccess:i.PropTypes.oneOf(b.ACCESS_VALUES).isRequired,recipientMessage:i.PropTypes.string.isRequired,recipientTokens:i.PropTypes.array,shareFolderPromise:i.PropTypes.instanceOf(Promise),shouldBlockMemberListOnPassLoad:i.PropTypes.bool,showContentManagerBridge:i.PropTypes.bool,showPassFileSettings:i.PropTypes.bool,teamGroupInfo:i.PropTypes.shape({id:i.PropTypes.string,name:i.PropTypes.string}),user:i.PropTypes.instanceOf(D.User).isRequired,expSubgrowthProOverquotaCreateSharedLink:i.PropTypes.string},getDefaultProps:function(){return{contactsError:{level:null,message:null},headerId:"unified-share-modal-title",linkMetadata:null,members:null,initialRecipientRawInput:"",initialRecipientTokens:[],isTeamSharedFolder:!1,mode:k.MODES.MEMBERSHIP,onFolderSettingsClick:null}},componentDidMount:function(){if(this.logTTI(),this.refs.contentNameInput)return o.findDOMNode(this.refs.contentNameInput).focus()},componentDidUpdate:function(e,t){return this.logTTI()},logTTI:function(){return"GRANT_ACCESS"===this.props.contentInfo.extras.origin&&this.props.isMetadataLoaded&&x.mark_time_to_interactive(),this.props.mode===k.MODES.LINK_ONLY&&this.props.isLinkMetadataLoaded?this.props.actionHandler.logIfHaventBefore("VIEW_LINK_ONLY_MODAL"):this.props.isMetadataLoaded&&(this.props.actionHandler.logIfHaventBefore("VIEW_SHARE_MODAL"),!this._shouldRenderMainLoading())?this.props.actionHandler.logIfHaventBefore("MEMBER_LIST_LOADED",{member_count:this._getMemberNum()}):void 0},render:function(){return j.div({className:"unified-share-modal unified-share-modal--"+this.props.mode},this._renderHeaderSection(),this._renderToSection(),this._renderErrorMessageSection(),this._renderConfidentialFolderSection(),this._renderMainSection(),this._renderFooterSection())},_renderHeaderSection:function(){var e=this,t=this._getMemberNum(),r=this.props.user.is_team&&(null!=this.props.memberCounts?this.props.memberCounts.users_outside_team:void 0)>0&&null!=this.props.ownerTeam?W("%(outside_team_count)s outside your Dropbox team","%(outside_team_count)s outside your Dropbox team",this.props.memberCounts.users_outside_team).format({outside_team_count:this.props.memberCounts.users_outside_team}):void 0,s=t?r?W("%(member_num)s member (%(outside_team_string)s)","%(member_num)s members (%(outside_team_string)s)",t,{comment:'Description of the count of total folder members and count of outside-of-team folder members, like "10 members (3 outside of your Dropbox team)"'}):W("%(member_num)s member","%(member_num)s members",t):"";return s=s.format({member_num:t+((null!=this.props.memberCounts?this.props.memberCounts.exceeds_count:void 0)?"+":""),outside_team_string:r}),j.div({className:"unified-share-modal__section unified-share-modal__section--header"},V(A.ShareModalIcon,{alt:"",className:"unified-share-modal__title-icon",isTeamSharedFolder:this.props.isTeamSharedFolder,isFolder:this.props.contentInfo.isFolder(),isSharedFolder:this.props.contentInfo.isSharedFolder(),pathExists:this.props.contentInfo.pathExists(),filename:this.props.contentInfo.name(),isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isViewOnly:!this.props.canEdit}),j.div({className:n("unified-share-modal__title",t?"unified-share-modal__title--member-count":void 0)},this.props.contentInfo.pathExists()?j.h3({className:"u-font-strong",id:this.props.headerId},u.Emstring.em_snippet(this.props.contentInfo.name(),C.SNIPPET_SIZES.FILENAME)):this._renderContentNameInput(),t?j.h4({className:"u-trim-margin u-font-meta"},s):void 0),B.TRUELINK.TRUELINK_UI[this.props.user.id]?this._renderContentSettings():void 0,j.div({className:"unified-share-modal__close"},V(P,{className:"u-mar-left-s",onClick:function(){return e.props.actionHandler.onClickX(e.refs.tokenizer)}})))},_renderContentNameInput:function(){var e=this;return j.div({className:"unified-share-modal__content-name"},null==this.props.contentNameMessage||!this.props.isContentNameFocused&&this.props.contentNameMessageLevel!==k.CONTENT_NAME_MESSAGE_LEVELS.ERROR?void 0:V(h,{arrow:h.ARROW.TOP,className:n({"unified-share-modal__content-name__tooltip":!0,"unified-share-modal__content-name__tooltip-error":this.props.contentNameMessageLevel===k.CONTENT_NAME_MESSAGE_LEVELS.ERROR,"u-font-strong":!0})},j.div({className:n(["u-pad-top-xxs","u-pad-bottom-xxs","u-pad-left-xs","u-pad-right-xs"])},this.props.contentNameMessage)),j.input({className:n(["u-trim-padding","u-trim-margin","u-l-ib","u-font-strong"]),id:this.props.headerId,ref:"contentNameInput",onChange:function(t){return e.props.actionHandler.handleContentNameChange(t.target.value)},onFocus:function(){return e.props.actionHandler.handleContentNameFocusChange(!0)},onBlur:function(){return e.props.actionHandler.handleContentNameFocusChange(!1)},onKeyUp:function(t){if(H(null!=e.refs.tokenizer?e.refs.tokenizer.refs.tokenizer:void 0,function(e){return e.refs.input})&&13===t.keyCode)return o.findDOMNode(e.refs.tokenizer.refs.tokenizer.refs.input).focus()},placeholder:this.props.isContentNameFocused?void 0:K("Folder name"),defaultValue:this.props.initialContentName}))},_renderToSection:function(){var e=this;if(this.props.linkOnlyReason===k.LINK_ONLY_REASON.LINKS_PAGE)return null;if(this.props.mode===k.MODES.LINK_ONLY)return this._renderNoPermissionSection();if(!this.props.isMetadataLoaded)return j.div({className:"unified-share-modal__section unified-share-modal__section--to"},j.div({className:"unified-share-modal__to-placeholder"}," "));if(this.props.showContentManagerBridge)return this._renderContentManagerBridge();if(!this.props.canInviteEditor&&!this.props.canInviteViewer)return this._renderNoPermissionSection();if(M.shouldEnforceMemberLimits(this.props.user,this.props.isTeamSharedFolder,this.props.isFolderInsideTeamFolderTree)&&(null!=this.props.memberCounts?this.props.memberCounts.total_unique_users:void 0)>=M.GoldenGate.SHARING_TOTAL_LIMIT)return this._renderOverLimitSection();var t=this.props.contentInfo.isFile()&&!this.props.canInviteEditor&&!this.props.canInviteViewerNoComment;return j.div({className:"unified-share-modal__section unified-share-modal__section--to"},j.div({className:"o-flag"},j.label({className:"o-flag__fix u-font-strong",htmlFor:"unified-share-modal-contacts-tokenizer"},this.props.isTeamSharedFolder?K("Add groups:",{comment:"Label for with whom to share"}):K("To:",{comment:"Label for with whom to share"})),j.div({className:"unified-share-modal__to-input-box o-flag__flex"},V(l.ContactsTokenizer,{ref:"tokenizer",context:"tiburon",excludeDomainContacts:!1,customContactFilter:this.props.isTeamSharedFolder?function(e){return e.type!==c.FB&&e.group_id}:this.props.isInContentManager?function(e){return e.type!==c.FB}:function(t){return t.type!==c.FB&&t.email!==e.props.user.email},focusOnMount:this.props.contentInfo.pathExists(),id:"unified-share-modal-contacts-tokenizer",onContentsChange:this.props.actionHandler.recipientsChange,populatedInputData:{tokens:this.props.initialRecipientTokens,value:this.props.initialRecipientRawInput},customContactValidator:function(t){return M.validateContact(t,e.props.user,e.props.ownerTeam,e.props.folderPolicy,e.props.isTeamSharedFolder,e.props.isFolderInsideTeamFolderTree,e.props.memberCountWithRecipients)},placeholder:K(this.props.isTeamSharedFolder?"Group names":this.props.user.is_team?"Email, name, or group":"Email or name"),shouldLogContactSearch:!0,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.isTeamSharedFolder?this.props.teamGroupInfo:null,user:this.props.user})),j.div({className:n({"o-flag__fix":!0})},t?V(S.Tooltip,{position:S.TooltipPosition.BOTTOM,tooltip_contents:K("Only folders can be shared with edit access"),tooltip_classname:"sharing-access-menu__tooltip"},j.span({className:"ax-visually-hidden"},K("Only folders can be shared with edit access")),this._renderToSectionAccessDropdown()):this._renderToSectionAccessDropdown())))},_renderToSectionAccessDropdown:function(){return V(O.SharingBubbleMenu,{asButton:!0,canMakeViewerNoComment:this.props.canMakeViewerNoComment,contentInfo:this.props.contentInfo,currentAccess:this.props.recipientAccess,disabled:this.props.showContentManagerBridge,memberPermissions:new T.MemberPermissions({make_editor:new T.PermissionSetting({allow:this.props.canInviteEditor}),make_viewer:new T.PermissionSetting({allow:this.props.canInviteViewer}),make_viewer_no_comment:new T.PermissionSetting({allow:this.props.canInviteViewerNoComment})}),onAccessChange:this.props.actionHandler.changeRecipientAccess})},_shouldRenderContentSettingsShareButton:function(){return this.props.isMetadataLoaded&&this.props.mode!==k.MODES.LINK_ONLY&&(this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings||[k.MODES.SHARE,k.MODES.SHARE_SENDING].includes(this.props.mode)||this.props.isInContentManager)},_shouldRenderFooterSection:function(){return this._renderLinkRowInFooter()?this.props.canShareLink:this._shouldRenderContentSettingsShareButton()},_renderFooterSection:function(){if(this._shouldRenderFooterSection())return j.div({className:"unified-share-modal__section unified-share-modal__section--footer clearfix"},this._renderLinkRowInFooter()?this._renderLinkRowContent():this._renderContentSettingsShareButton())},_renderContentSettingsShareButton:function(){var e=this;if(this._shouldRenderContentSettingsShareButton())return j.div({},B.TRUELINK.TRUELINK_UI[this.props.user.id]?void 0:j.div({className:"u-l-fl"},this._renderContentSettings()),j.div({className:"u-l-fr"},(function(){var t;switch(e.props.mode){case k.MODES.SHARE:t=K(e.props.isTeamSharedFolder?"Add":"Share");var n=e.props.isTokenizerEmpty||e.props.contactsError.level===M.CONTACT_ERROR_LEVEL.ERROR||null!=e.props.contentNameMessage;return e._renderShareButton(n,t);case k.MODES.SHARE_SENDING:return t=K(e.props.isTeamSharedFolder?"Adding...":"Sharing..."),e._renderShareButton(!0,t);case k.MODES.MEMBERSHIP:if(e.props.isInContentManager&&!e.props.contentInfo.pathExists())return t=K(e.props.isTeamSharedFolder?"Add":"Share"),e._renderShareButton(!1,t);break;default:return null}})()))},_renderShareButton:function(e,t){return i.createElement("button",{className:"unified-share-modal__share-send c-btn c-btn--primary",disabled:e,onClick:this._onShareButtonClick},t)},_onShareButtonClick:function(){this.props.actionHandler.handleShareClick(this.refs.tokenizer,this.refs.contentNameInput)},_renderContentSettings:function(){var e=this;if(this.props.isMetadataLoaded)return this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings?j.button({"aria-label":K("Settings"),className:"unified-share-modal__settings u-font-meta c-borderless-button",disabled:this.props.mode===k.MODES.SHARE_SENDING,onClick:function(){return e.props.onSettingsClick()}},V(v,{alt:"",className:"u-mar-right-xs u-l-ib u-l-ib--m",group:"web",name:"settings"}),B.TRUELINK.TRUELINK_UI[this.props.user.id]?void 0:K(this.props.contentInfo.isFile()?"File settings":"Folder settings")):void 0},_renderErrorMessageSection:function(){return this.props.contactsError.message?j.div({className:n(["unified-share-modal__section","unified-share-modal__error-message","u-font-center",this.props.contactsError.level===M.CONTACT_ERROR_LEVEL.WARN?"unified-share-modal__warn":void 0,this.props.contactsError.level===M.CONTACT_ERROR_LEVEL.ERROR?"unified-share-modal__error":void 0])},this.props.contactsError.message):null},_shouldRenderMainLoading:function(){var e=this.props.isMetadataLoaded,t=this.props.hasNonOwnerMembers||this.props.areMembersFullyLoaded,n=!this.props.isPassEnabled||this._isPassInfoLoaded(),r=this.props.shouldBlockMemberListOnPassLoad&&!n;return!e||!t||r},_renderMainSection:function(){if(this.props.mode===k.MODES.LINK_ONLY)return this._renderMainLinkOnly();if(this._shouldRenderMainLoading())return this._renderMainLoading();switch(this.props.mode){case k.MODES.MEMBERSHIP:return this._renderMainMembership();case k.MODES.SHARE:case k.MODES.SHARE_SENDING:return this._renderMainShare();default:return null}},_renderNoPermissionSection:function(){return j.div({className:"unified-share-modal__section unified-share-modal__no-permission u-font-center"},this.props.mode===k.MODES.LINK_ONLY?this.props.contentInfo.isOSXPackage()?K(B.TRUELINK.TRUELINK_UI[this.props.user.id]?"Package files can’t be shared.":"This package file can only be shared as a link."):this.props.linkOnlyReason===k.LINK_ONLY_REASON.INSIDE_SHARED_FOLDER?B.TRUELINK.TRUELINK_UI[this.props.user.id]?K("You don’t have permission to share this folder."):j.span({},K("This folder can only be shared as a link because it’s in a shared folder.")+" ",j.a({href:"/help/1931",target:"_blank"},K("Learn more"))):B.TRUELINK.TRUELINK_UI[this.props.user.id]?K("This folder can’t be shared"):this.props.linkOnlyReason===k.LINK_ONLY_REASON.CONTAINS_SHARED_FOLDER?j.span({},K("This folder can only be shared as a link because it contains a shared folder.")+" ",j.a({href:"/help/1931",target:"_blank"},K("Learn more"))):K("This folder can only be shared as a link."):this.props.isTeamSharedFolder&&this._shouldRenderTeamFolderNoPermissionMessage(this.props.members)?K("This folder is automatically shared with all members of %(team_name)s").format({team_name:this.props.ownerTeam.name}):this.props.isTeamSharedFolder?E.reactFormat(K("Only <admin_link>admins</admin_link> and <group_link>group managers</group_link> can change team folder membership."),{admin_link:j.a({href:"/team?_tk=left_nav_team",target:"_blank"}),group_link:j.a({href:"/help/7232#transfer",target:"_blank"})}):K(this.props.contentInfo.isFolder()?B.TRUELINK.TRUELINK_UI[this.props.user.id]&&(null!=this.props.permissions?this.props.permissions.change_options.allow:void 0)?"To add new members, you’ll need to add them to the parent folder.":"You don’t have permission to manage membership of this folder":"You don’t have permission to manage membership of this file"))},_renderConfidentialFolderSection:function(){if(this.props.isConfidentialFolder&&this.props.canUpdateConfidentiality)return j.div({className:"unified-share-modal__section unified-share-modal__confidential-folder u-font-center"},j.span({},E.reactFormat(K("<b>Invite only.</b> Members of parent folders can’t access."),{b:j.b()}),this.props.contentInfo.pathExists()?[" ",j.a({onClick:this.props.onToggleInheritanceClick},K("Restore access"))]:void 0))},_renderContentManagerBridge:function(){var e=p.parent_dir(this.props.contentInfo.displayPath()),t=this.props.contentInfo.name(),n=M.genContentManagerBridgeUri({containingFolder:e,filenameToSelect:t,isLimitedTeam:this.props.isLimitedTeam});return j.div({className:"unified-share-modal__section unified-share-modal__no-permission u-font-center"},j.span({},K("You can manage folder membership in the Admin Console. "),j.a({href:n.toString(),target:"_blank"},K("Open in new tab."))))},_renderOverLimitSection:function(){
return j.div({className:"unified-share-modal__section unified-share-modal__no-permission u-font-center"},j.div({},K("This folder is over its %(member_limit)s-member limit.",{comment:"member limit is a number greater than 200"}).format({member_limit:M.GoldenGate.SHARING_TOTAL_LIMIT})),j.div({},K("Please remove some members.")," ",j.a({href:"/help/9292",target:"_blank"},K("Learn more."))))},_shouldRenderTeamFolderNoPermissionMessage:function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){return"team"===e.group_type&&(null!=e.permissions.make_editor?e.permissions.make_editor.allow:void 0)&&(null!=e.permissions.make_viewer?e.permissions.make_viewer.allow:void 0)})},_isOwnerOfAtLeastOneGroup:function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){return e.is_owner})},_renderMainLoading:function(){return j.div({className:n(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer"])},this._renderLinkRow(),j.div({className:"u-font-center u-font-meta u-pad-top-xl"},j.div({className:"c-loader"},K("Loading..."))))},_renderMainLinkOnly:function(){return B.TRUELINK.TRUELINK_UI[this.props.user.id]&&this.props.linkOnlyReason!==k.LINK_ONLY_REASON.LINKS_PAGE?null:j.div({className:n(["unified-share-modal__main","unified-share-modal__main--link-only","unified-share-modal__section",this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0])},this._renderLinkRow())},_showSharingMemberList:function(){return!!this.props.hasNonOwnerMembers||(this.props.isFolderInsideTeamFolderTree?1===this.props.members.users.size||!this.props.isConfidentialFolder&&this.props.user.is_cdm_member:this.props.guestMembers.length>0)},_renderMainMembership:function(){var e=this;return j.div({className:n(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer",this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0])},this._renderLinkRow(),this._showSharingMemberList()?V(L.SharingMemberList,{actionHandler:this.props.actionHandler,areMembersFullyLoaded:this.props.areMembersFullyLoaded,canInviteMembers:this.props.canInviteEditor||this.props.canInviteViewer,canMakeViewerNoComment:this.props.canMakeViewerNoComment,canRelinquishMembership:this.props.canRelinquishMembership,canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,disabled:this.props.showContentManagerBridge,guestMembers:this.props.guestMembers,groupSeenStateInfo:this.props.groupSeenStateInfo,isConfidentialFolder:this.props.isConfidentialFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,membership:this.props.members,onToggleInheritanceClick:this.props.onToggleInheritanceClick,pendingMemberAction:this.props.pendingMemberAction,presentAccountIds:this.props.presentAccountIds,shouldShowPassUI:this.props.isPassEnabled&&g.fetchingStatusIsSuccessful(this.props.passFetchingStatus),teamName:null!=this.props.ownerTeam?this.props.ownerTeam.name:void 0,user:this.props.user,viewer:this.props.viewer}):this.props.banner===k.BANNERS.INPUT_CONTENT_NAME?j.div({className:n(["unified-share-modal__input-content-name-banner","u-font-center","u-font-meta","u-mar-top-xs"])},V(f.Image,{src:F.static_url("/static/images/sharing/illo-name-folder-vfl38PzAv.png"),srcHiRes:F.static_url("/static/images/sharing/illo-name-folder@2x-vflzK0uJv.png")}),j.h3({className:n(["u-font-strong","u-mar-top-xs"])},K("Name your shared folder")),j.p({className:n(["u-pad-left-xxl","u-pad-right-xxl"])},K("Shared folders are for collaborting on projects, client works, and organizing departments"))):j.div({className:n(["unified-share-modal__no-members-banner","u-font-center","u-font-meta","u-font-center","u-font-meta"])},(function(){if(e.props.isTeamSharedFolder)return null!=e.props.teamGroupInfo?[j.p({className:"u-mar-top-xxl"},j.a({onClick:e._addEveryoneGroup},K("Add everyone at %(team_name)s").format({team_name:e.props.ownerTeam.name}))),j.p({},K("Or, add groups to this team folder.")+" ",j.a({href:"/team#groups/newgroup"},K("Create a group")))]:j.p({className:"u-mar-top-xxl"},K("Add groups to this team folder.")+" ",j.a({href:"/team#groups/newgroup"},K("Create a group")));var t=B.TRUELINK.TRUELINK_UI[e.props.user.id];return t||"V1"!==e.props.expSubgrowthProOverquotaCreateSharedLink?t||"V2"!==e.props.expSubgrowthProOverquotaCreateSharedLink?U.REBRAND_M1_IS_ON&&!t?j.div({}):j.div({},V(f.Image,{className:"unified-share-modal__illo",src:F.static_url("/static/images/sharing/sharing-invite-users-vflfTH_fj.png"),srcHiRes:F.static_url("/static/images/sharing/sharing-invite-users@2x-vflgGHzXi.png")}),j.p({className:"u-mar-top-s"},K("Add people you want to share with"))):V(N.ExpShareLinkUpsellV2):V(N.ExpShareLinkUpsellV1)})()))},_renderMainShare:function(){var e=this;return j.div({className:"unified-share-modal__main unified-share-modal__section u-pad-horizontal-m"},this.props.isTeamSharedFolder?void 0:j.textarea({placeholder:K("Add a message (optional)"),onChange:function(t){return e.props.actionHandler.changeRecipientMessage(t.target.value)},value:this.props.recipientMessage}))},_renderLinkRow:function(){return this._renderLinkRowInFooter()?void 0:this._renderLinkRowContent()},_renderLinkRowContent:function(){if(!this.props.isInContentManager||B.TRUELINK.TRUELINK_UI[this.props.user.id]){return!this.props.contentInfo.isMounted()&&this.props.isPassEnabled&&this._isPassInfoLoaded()&&this.props.isMetadataLoaded||this.props.isLinkMetadataLoaded&&(this.props.isMetadataLoaded||this.props.mode===k.MODES.LINK_ONLY)?j.div({className:"unified-share-modal__link-info"},V(R.ModalLinkInfo,{actionHandler:this.props.actionHandler,linkabilityState:this.props.isTeamSharedFolder?R.LinkabilityStates.CANT_LINK_TEAM_FOLDER:this.props.canShareLink||this.props.mode===k.MODES.LINK_ONLY?R.LinkabilityStates.CAN_LINK:this.props.canInviteEditor||this.props.canInviteViewer?R.LinkabilityStates.INVITE_NO_LINK:R.LinkabilityStates.NO_INVITE_NO_LINK,contentInfo:this.props.contentInfo,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,isLimitedTeam:this.props.isLimitedTeam,linkMetadata:this.props.linkMetadata,mode:this.props.mode,shareFolderPromise:this.props.shareFolderPromise,teamName:null!=this.props.ownerTeam?this.props.ownerTeam.name:void 0,presentAccountIds:this.props.presentAccountIds,user:this.props.user})):this.props.mode===k.MODES.LINK_ONLY?j.div({className:"unified-share-modal__link-info--loading"},j.div({className:"c-loader c-loader--spinner--blue u-l-b u-mar-horizontal-auto"},K("Loading…"))):this.props.contentInfo.isTeamSharedFolder()?void 0:j.div({className:"unified-share-modal__link-info--filler"})}},_getMemberNum:function(){return null!=this.props.memberCounts&&void 0!==this.props.memberCounts.total_unique_users?this.props.memberCounts.total_unique_users:null!=this.props.members?this.props.members.getMemberCount():void 0},_isPassInfoLoaded:function(){return g.fetchingStatusIsComplete(this.props.passFetchingStatus)},_addEveryoneGroup:function(){return null!=this.refs.tokenizer?this.refs.tokenizer.addExternalContacts([d.teamGroupInfoToContact(this.props.teamGroupInfo)]):void 0},_renderLinkRowInFooter:function(){return this.props.mode!==k.MODES.LINK_ONLY&&(this.props.mode!==k.MODES.SHARE&&this.props.mode!==k.MODES.SHARE_SENDING&&(!!this.props.isMetadataLoaded&&B.TRUELINK.TRUELINK_UI[this.props.user.id]))}}),z=_(Y,["/static/css/react/contacts_tokenizer-vflQsfYaG.css","/static/css/scooter/scooter-scoped-vflhQ6850.css","/static/css/sharing/share_modal-vflm4LDVj.css"],[m.BubbleDropdown,y.Snackbar]);t.ShareModalContent=z}),define("modules/clean/sharing/views/modal_link_info",["require","exports","tslib","jquery","external/classnames","external/react","modules/clean/clipboard_v2","modules/clean/em_string","modules/clean/react_format","modules/clean/react/snackbar","modules/clean/react/sprite","modules/clean/react/util","modules/clean/sharing/api/types/metadata","modules/clean/sharing/link_description","modules/clean/sharing/sharing_settings_dropdown","modules/clean/sharing/sharing_settings_util","modules/clean/sharing/ui_util","modules/clean/sharing/ui_notifications_util","modules/clean/sharing/views/constants","modules/constants/sharing","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l,c,d,u,p,h,m,_,f,g,y,v,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=S.i18n_default_project("sharing")._;E("Link not available. To share, invite specific people."),E("Link not available");var b;(function(e){e.CAN_LINK="CAN_LINK",e.INVITE_NO_LINK="INVITE_NO_LINK",e.NO_INVITE_NO_LINK="NO_INVITE_NO_LINK",e.CANT_LINK_TEAM_FOLDER="CANT_LINK_TEAM_FOLDER"})(b=t.LinkabilityStates||(t.LinkabilityStates={}));var I=(function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.handleCreateLinkClicked=function(){if(r.isSharedContentLink())throw Error("Should not display this for shared content link");if(r.props.actionHandler)return r.props.actionHandler.createSharedLink()},r.handleCopyLinkClicked=function(){if(!r.state.showingUrl){var e={};r.props.linkMetadata instanceof p.SharedContentLinkMetadata?(e.type="scl",e.password_protected=r.props.linkMetadata.password_protected,e.audience=r.props.linkMetadata.current_audience,e.expiration=r.props.linkMetadata.expiry):r.props.linkMetadata instanceof p.LinkMetadata?(e.type="shmodel",e.visibility=r.props.linkMetadata.link_permissions.resolved_visibility,e.expiration=r.props.linkMetadata.expires):r.isSharedContentLink()&&(e.type="scl"),r.props.contentInfo&&f.logTiburonEvent(r.props.contentInfo,r.props.user.id,"CLICK_TIB_COPY_LINK",e),r.props.actionHandler&&r.props.actionHandler.turnLinkOnIfQualified()}return u.setStatePromise(r,{showingUrl:!r.state.showingUrl}).then(function(){if(r.urlField){var e=r.urlField;e.focus(),e.select(),r.clipboard.do_copy()}})},r.state={showingUrl:!1},r.clipboard=null,r}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.clipboard=new o(this.props.linkMetadata&&this.props.linkMetadata.url,function(){return g.sharingNotificationSuccess(E("Link copied to clipboard"))},function(){g.sharingNotificationError(E("Unable to copy the link, please copy manually"))},this.handleCopyLinkClicked)},t.prototype.componentDidMount=function(){this.setupCopy()},t.prototype.componentDidUpdate=function(){this.setupCopy()},t.prototype.setupCopy=function(){var e=r(".copy-link-button");e.length&&this.clipboard.setupCopy(e,r(".copy-link-container"))},t.prototype.render=function(){return this.props.linkabilityState===b.NO_INVITE_NO_LINK?this.renderCantLinkOrShare():this.props.linkabilityState===b.INVITE_NO_LINK?this.renderCantLinkCDM():this.props.linkabilityState===b.CANT_LINK_TEAM_FOLDER?this.renderCantLinkTeamFolder():this.props.linkMetadata||this.isSharedContentLink()?this.renderLink():this.props.linkabilityState===b.CAN_LINK?this.renderNoLink():null},t.prototype.renderLink=function(){var e=this;if(!this.props.linkMetadata)return null;var t=null;this.props.linkMetadata instanceof p.SharedContentLinkMetadata&&(t=this.renderSharedContentLinkInfo());var n;if(this.state.showingUrl)n=i.createElement("span",null,t,i.createElement("span",null,i.createElement("label",{className:"ax-visually-hidden",htmlFor:"unified-share-modal-link-url",key:"link-label"},E("Shared link URL")),i.createElement("input",{className:"unified-share-modal-link-info__url",id:"unified-share-modal-link-url",key:"link-url-input",onClick:this.handleUrlClick,readOnly:!0,ref:function(t){return e.urlField=t},type:"text",value:this.props.linkMetadata.url})));else{var r=null;this.props.linkMetadata instanceof p.LinkMetadata?r=h.formatLinkDescription(this.props.linkMetadata):this.props.linkMetadata instanceof p.SharedContentLinkMetadata&&(r=this.renderSharedContentLinkInfo());var o=null;null!==r&&(o=i.createElement("span",{className:s({"unified-share-modal-link-info__description":!0,"unified-share-modal-link-info__description--content-link":this.isSharedContentLink()})},r)),n=i.createElement("span",null,o)}var a=null;return this.isSharedContentLink()?this.props.linkMetadata&&this.props.linkMetadata.url?a=this.renderCopyLink():this.isSharingFolder()||(a=this.renderGetLink()):a=i.createElement("span",null,this.renderLinkSettings(),this.renderDivider(),this.renderCopyLink()),i.createElement("div",{className:"unified-share-modal-link-info o-flag"},i.createElement("div",{className:"o-flag__fix"},this.renderLinkIcon()),i.createElement("div",{className:this.detailsClassName()},n),i.createElement("ul",{className:"unified-share-modal-link-info__actions o-flag__fix"},a))},t.prototype.renderLinkSettings=function(){return!this.state.showingUrl&&this.props.actionHandler?i.createElement("li",{className:"u-l-ib"},i.createElement("button",{className:"button-as-link",onClick:this.props.actionHandler.handleLinkSettingsClick},E("Link settings"))):null},t.prototype.renderDivider=function(){return this.state.showingUrl?null:i.createElement("span",{className:"u-l-ib u-mar-left-xs u-mar-right-xs"},"•")},t.prototype.renderCopyLink=function(){var e;return e=this.state.showingUrl?E("Hide link"):o.is_supported()?i.createElement("span",{className:"copy-link-button"},E("Copy link")):E("Show link"),i.createElement("li",{className:"u-l-ib"},i.createElement("button",{className:"button-as-link copy-link-container",onClick:this.handleCopyLinkClicked},e))},t.prototype.renderGetLink=function(){var e=this,t=function(){e.props.actionHandler&&e.props.actionHandler.turnLinkOnIfQualified().then(function(){if(e.props.actionHandler){var t=void 0;t=e.props.contentInfo?l.reactFormat(E("Creating shared link for <st>%(folder_name)s</st>..."),{st:i.createElement("strong",null),folder_name:e.props.contentInfo.name()}):E("Creating shared link..."),e.props.actionHandler.shareIfFileFolder(t).then(function(){var t;t=e.props.contentInfo?l.reactFormat(E("Created shared link for <st>%(folder_name)s</st>."),{st:i.createElement("strong",null),folder_name:e.props.contentInfo.name()}):E("Created shared link."),c.Snackbar.complete(t)}).catch(function(t){e.props.actionHandler&&e.props.actionHandler.reportShareFailure(t)})}})};return i.createElement("li",{className:"u-l-ib"},i.createElement("button",{className:"button-as-link",onClick:t},E("Get link")))},t.prototype.detailsClassName=function(){return"unified-share-modal-link-info__details o-flag__flex"},t.prototype.renderNoLink=function(){return i.createElement("div",{className:"unified-share-modal-link-info unified-share-modal-link-info--no-link o-flag"},i.createElement("div",{className:"o-flag__fix"},i.createElement("div",{className:"unified-share-modal-link-info__icon"},i.createElement(d,{alt:"",group:"web",name:"shared_link_gray"}))),i.createElement("div",{className:this.detailsClassName()},E("No link created yet")),i.createElement("div",{className:"unified-share-modal-link-info__actions o-flag__fix"},i.createElement("button",{className:"button-as-link",onClick:this.handleCreateLinkClicked},E("Create a link"))))},t.prototype.renderCantLinkOrShare=function(){return i.createElement("div",{className:"unified-share-modal-link-info unified-share-modal-link-info--cant-share o-flag"},i.createElement("div",{className:"o-flag__fix"},i.createElement("div",{className:"unified-share-modal-link-info__icon"},i.createElement(d,{alt:"",group:"web",name:"shared_link_gray"}))),i.createElement("div",{className:this.detailsClassName()},E("Link not available")))},t.prototype.renderCantLinkTeamFolder=function(){return i.createElement("div",{className:"unified-share-modal-link-info unified-share-modal-link-info--cant-share o-flag"},i.createElement("div",{className:"o-flag__fix"},i.createElement("div",{className:"unified-share-modal-link-info__icon"},i.createElement(d,{alt:"",group:"web",name:"shared_link_gray"}))),i.createElement("div",{className:this.detailsClassName()},E("Link not available")),i.createElement("div",{className:"unified-share-modal-link-info__actions o-flag__fix"},i.createElement("a",{href:"/help/business/team-folders",target:"_blank",rel:"noopener noreferrer"},E("Learn more"))))},t.prototype.renderCantLinkCDM=function(){return i.createElement("div",{className:"unified-share-modal-link-info unified-share-modal-link-info--cant-link o-flag"},i.createElement("div",{className:"o-flag__fix"},i.createElement("div",{className:"unified-share-modal-link-info__icon"},i.createElement(d,{alt:"",group:"web",name:"shared_link_gray"}))),i.createElement("div",{className:this.detailsClassName()},E("Link not available. To share, invite specific people.")),i.createElement("div",{className:"unified-share-modal-link-info__actions o-flag__fix"},i.createElement("a",{href:"/help/business/team-space-overview#share",target:"_blank",rel:"noopener noreferrer"},E("Learn more"))))},t.prototype.handleUrlClick=function(e){e.target.select()},t.prototype.isSharedContentLink=function(){return v.TRUELINK.TRUELINK_UI[this.props.user.id]},t.prototype.renderLinkIcon=function(){return i.createElement("div",{className:"unified-share-modal-link-info__icon"},i.createElement(d,{alt:"",group:"web",name:"shared_link_white"}))},t.prototype.isSharingFolder=function(){return Boolean(this.props.shareFolderPromise)},t.prototype.renderSharedContentLinkInfo=function(){if(!(this.props.actionHandler&&this.props.linkMetadata&&this.props.linkMetadata instanceof p.SharedContentLinkMetadata))return null;if(this.isSharingFolder()||this.props.linkMetadata instanceof p.SharedContentLinkMetadata&&this.props.linkMetadata.current_audience===p.LinkAudience.default_on)return i.createElement("div",null,E("Updating link"),i.createElement("div",{className:"c-loader"}));var e,t=this.props.linkMetadata.audience_options.size>1;this.props.linkMetadata.current_audience===p.LinkAudience.members?e=this.props.hasDisplayableMembers&&!this.props.hasNonOwnerMembers?l.reactFormat(E("<strong>Only you</strong> can use the link"),{strong:i.DOM.strong()}):l.reactFormat(E("<strong>Invited members</strong> with the link can view"),{strong:i.DOM.strong()}):this.props.linkMetadata.current_audience===p.LinkAudience.team?e=l.reactFormat(E("<strong>Members of %(team_name)s</strong> with the link can view"),{strong:i.DOM.strong(),team_name:a.Emstring.em_snippet(this.props.teamName||"",10)}):this.props.linkMetadata.current_audience===p.LinkAudience.public&&(e=l.reactFormat(E("<strong>Anyone</strong> with the link can view"),{strong:i.DOM.strong()}));var n;if(t){var r=i.createElement("button",{className:"c-borderless-button change-audience-button"},e,i.createElement(d,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-gray"}));n=i.createElement(m.SettingDropdown,{currentValue:this.props.linkMetadata.current_audience,valuesList:this.props.linkMetadata.audience_options.valueSeq().toArray(),optionsDict:_.getAudienceOptionsDict(this.props.contentInfo&&this.props.contentInfo.isFolder()||!1,this.props.teamName||"",this.props.hasNonOwnerMembers||!1,this.props.hasDisplayableMembers||!1),onValueSelected:this.props.actionHandler.handleSelectLinkAudience,customButton:r,openUp:this.props.mode!==y.MODES.LINK_ONLY})}else n=e;var s=[];this.props.linkMetadata.expiry&&s.push(h.formatSharedContentLinkExpiry(this.props.linkMetadata,!0)),this.props.linkMetadata.password_protected&&this.props.linkMetadata.expiry&&s.push(this.renderDivider()),this.props.linkMetadata.password_protected&&s.push(E("Password protected"));var o;if(this.props.linkMetadata.audience_restricting_shared_folder&&this.props.linkMetadata.audience_restricting_shared_folder.audience===this.props.linkMetadata.current_audience){var c=this.props.linkMetadata.audience_restricting_shared_folder.name;o=l.reactFormat(E("Applied via <strong>%(folder_name)s</strong>"),{strong:i.DOM.strong(),folder_name:c})}else this.props.contentInfo&&this.props.contentInfo.isFolder()&&this.props.linkMetadata.current_audience!==p.LinkAudience.members&&(o=E("Applies to all items in this folder"));return i.createElement("div",null,i.createElement("div",null,n),i.createElement("div",null,s),o)},t.displayName="ModalLinkInfo",t})(i.Component);t.ModalLinkInfo=I}),define("modules/clean/sharing/views/sharing_bubble_menu",["require","exports","tslib","external/classnames","external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/clean/sharing/strings","modules/core/i18n"],function(e,t,n,r,s,i,o,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=d.i18n_default_project("sharing")._,p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getMemberActionInfo=function(){var e=c.ACCESS_NAME;this.props.canMakeViewerNoComment&&(e=c.ACCESS_NAME_NO_COMMENT);var t=c.MEMBER_ACTION_FOLDER;this.props.canMakeViewerNoComment&&(t=c.MEMBER_ACTION_FOLDER_NO_COMMENT);var n=c.MEMBER_ACTION_FILE;this.props.canMakeViewerNoComment&&(n=c.MEMBER_ACTION_FILE_NO_COMMENT);var r=u("Remove");return this.props.allowRelinquishMembership&&(r=u("Remove my access")),[[l.MEMBER_ACTION.MAKE_EDITOR,{value:a.ACCESS_LEVEL.WRITER,title:e[a.ACCESS_LEVEL.WRITER],folder_description:t[l.MEMBER_ACTION.MAKE_EDITOR],file_description:n[l.MEMBER_ACTION.MAKE_EDITOR]}],[l.MEMBER_ACTION.MAKE_VIEWER,{value:a.ACCESS_LEVEL.READER,title:e[a.ACCESS_LEVEL.READER],folder_description:t[l.MEMBER_ACTION.MAKE_VIEWER],file_description:n[l.MEMBER_ACTION.MAKE_VIEWER]}],[l.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT,{value:a.ACCESS_LEVEL.READER_NO_COMMENT,title:e[a.ACCESS_LEVEL.READER_NO_COMMENT],folder_description:t[l.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT],file_description:n[l.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]}],[l.MEMBER_ACTION.MAKE_OWNER,{value:a.ACCESS_LEVEL.OWNER,title:u("Make owner")}],[l.MEMBER_ACTION.REMOVE,{value:"remove",title:s.createElement("div",{className:"u-font-danger"},r)}]]},t.prototype.renderMenuItem=function(e){var t=this,n=e.value,r=e.title,a=e.file_description,l=e.folder_description,c=null;c=this.props.contentInfo&&this.props.contentInfo.isFolder()?l:a;var d=null;n!==this.props.currentAccess&&(d=function(){return t.props.onAccessChange(n)});var u=null;return n===this.props.currentAccess&&(u=s.createElement(o,{alt:"",group:"web",name:"check_gray"})),s.createElement(i.BubbleMenuItem,{className:"sharing-access-menu-item",key:n,onClick:d},s.createElement("div",{className:"sharing-access-menu-item__left-margin u-l-ib u-l-ib--t"},u),s.createElement("div",{className:"sharing-access-menu-item__label u-l-ib u-l-ib--t"},s.createElement("div",{className:"u-font-nowrap u-font-black sharing-access-menu-item__title"},r),s.createElement("div",{className:"u-font-wrap u-font-meta sharing-access-menu-item__description"},c)))},t.prototype.renderCurrentAccessText=function(e){var t=r({"sharing-access-menu__current-access":!0,"u-font-nowrap":!0,"c-btn--disabled":e,"sharing-access-menu__current-access--button":this.props.asButton,"c-btn":this.props.asButton,"c-btn--secondary":this.props.asButton,"u-trim-margin":this.props.asButton,"c-borderless-button":!this.props.asButton,"change-access-button":!this.props.asButton&&!e}),n=c.ACCESS_NAME[this.props.currentAccess];this.props.canMakeViewerNoComment&&(n=c.ACCESS_NAME_NO_COMMENT[this.props.currentAccess]);var i=null;return e||(i=[s.createElement("div",{className:"gray-arrow",key:"gray"},s.createElement(o,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-gray"})),s.createElement("div",{className:"blue-arrow",key:"blue"},s.createElement(o,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-blue"}))]),s.createElement("button",{className:t},n,i)},t.prototype.render=function(){for(var e=[],t=0,n=this.getMemberActionInfo();t<n.length;t++){var r=n[t],o=r[0],a=r[1];(a.value===this.props.currentAccess||this.props.memberPermissions&&this.props.memberPermissions.get(o)&&this.props.memberPermissions.get(o).allow||a.value===l.MEMBER_ACTION.REMOVE&&this.props.allowRelinquishMembership)&&e.push(this.renderMenuItem(a))}if(e.length<=1||this.props.pendingAccessChange)return this.renderCurrentAccessText(!0);var c=0;return this.props.asButton&&(c=-5),s.createElement(i.BubbleMenu,{targetButton:this.renderCurrentAccessText(this.props.disabled||!1),targetFixed:!0,position:i.BubbleMenu.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"sharing-access-menu o-list-ui o-list-ui--dividers",items:e,shouldShowArrow:!1,disabled:this.props.disabled,verticalDisplacement:c})},t.displayName="SharingBubbleMenu",t.defaultProps={allowRelinquishMembership:!1,asButton:!1,canInviteMembers:!1,canMakeViewerNoComment:!1,disabled:!1,pendingAccessChange:void 0},t})(s.Component);t.SharingBubbleMenu=p}),define("modules/clean/sharing/views/viewer_info",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){e.when_last_seen&&(this.time_last_seen=new Date(1e3*e.when_last_seen));var t=e.seen_state_user;this.account_id=t.user_id,this.display_name=t.display_name,this.email=t.email,this.photo_circle_url=t.photo_circle_url,this.same_team=!0}return e.prototype.displayName=function(){return this.display_name},e.prototype.memberId=function(){return this.account_id},e})();t.ViewerInfo=n}),define("modules/clean/sharing/views/wrapped_group_viewers_maker",["require","exports","external/react","modules/clean/datetime","modules/clean/em_string","modules/clean/react/title_bubble","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,r,s,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a.i18n_default_project("sharing"),c=l._,d=l.ungettext;(function(e){function t(e,t){for(var r=d("%(num_viewers)d viewer","%(num_viewers)d viewers",e.length).format({num_viewers:e.length}),s=e.length<=10,o=s?e.length:9,l=a(e[0],t),c=1;c<o;c++)l=l.concat(a(e[c],t));if(!s){var u=e.length-o,p=d("and %(num_others)d other","and %(num_others)d others",u).format({num_others:u});l=l.concat(n.createElement("tr",null,n.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__member-name"},p)))}return{element:n.createElement(i.TitleBubble,{content:n.createElement("table",{className:"group-tooltip__viewers-table"},n.createElement("tbody",null,l)),className:"group-tooltip",children:n.createElement("span",{className:"u-font-meta sharing-member-info__viewer-count-text"},r),position:i.TitleBubble.POSITIONS.BOTTOM,isTargetPositionFixed:!0}),elementText:r}}function a(e,t){var i=t.has(e.account_id)?c("Viewing now"):r.ago(e.time_last_seen,!1,!0);return[n.createElement("tr",null,n.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__member-name"},s.Emstring.em_snippet(e.displayName(),o.SNIPPET_SIZES.DISPLAY_NAME)),n.createElement("td",{className:"group-tooltip__viewers-table-cell dot"},"·"),n.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__seen-string"},i))]}e.make=t})(t.WrappedGroupViewersMaker||(t.WrappedGroupViewersMaker={}))}),define("modules/clean/teams/admin/api/admin_console_api_client",["require","exports","tslib","modules/clean/api_v2/team_actions_client","modules/clean/filepath","modules/clean/sharing/api/util/types","modules/clean/viewer"],function(e,t,n,r,s,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(t){void 0===t&&(t=!1);var n=e.call(this)||this,r=o.Viewer.get_viewer();return r.work_user&&(n.teamMemberId=r.work_user.team_member_id),n.userId=r.get_uid_by_role("work"),n.isCMForCDM=t,n}return n.__extends(t,e),t.prototype._adminHeaders=function(){return{"Dropbox-API-Select-Admin":this.teamMemberId}},t.prototype.setPermanentDeletePolicy=function(e){return this.ns("team").rpc("set_permanent_delete_policy",{permanent_delete_enabled:e},{subjectUserId:this.userId})},t.prototype.setMultipleAccountsPolicy=function(e){return this.ns("team").rpc("set_multiple_accounts_policy",{multiple_accounts_enabled:e},{subjectUserId:this.userId})},t.prototype.setFileRequestPolicy=function(e){return this.ns("team").rpc("sharing/set_file_request_policy",{file_request_enabled:e},{subjectUserId:this.userId})},t.prototype.setOfficeAddInPolicy=function(e){return this.ns("team").rpc("set_office_addin_policy",{office_addin_enabled:e},{subjectUserId:this.userId})},t.prototype.setSharedLinkPolicy=function(e,t){var n={sharing_outside_enabled:e};return e&&(n.default_visibility=t),this.ns("team").rpc("sharing/set_shared_link_policy",n,{subjectUserId:this.userId})},t.prototype.setSharedFolderSharingPolicy=function(e){return this.ns("team").rpc("sharing/set_shared_folder_sharing_policy",{sharing_outside_enabled:e},{subjectUserId:this.userId})},t.prototype.setSharedFolderJoiningPolicy=function(e){return this.ns("team").rpc("sharing/set_shared_folder_joining_policy",{joining_outside_enabled:e},{subjectUserId:this.userId})},t.prototype.setCommentingPolicy=function(e){return this.ns("team").rpc("sharing/set_commenting_policy",{commenting_enabled:e},{subjectUserId:this.userId})},t.prototype.setPasswordStrength=function(e,t){var n="enabled"===e?t:"minimal_requirements";return this.ns("team").rpc("set_password_requirements",{password_strength_policy:n},{subjectUserId:this.userId})},t.prototype.resetAllPasswords=function(){return this.ns("team").rpc("reset_all_passwords",void 0,{subjectUserId:this.userId})},t.prototype.setViewerInfoSetting=function(e){return this.ns("team").rpc("set_viewer_info_policy",{viewer_info_policy:e},{subjectUserId:this.userId})},t.prototype.setPaperPolicy=function(e,t,n,r){var s={paper_deployment_type:n,enabled_members_update:{users_to_add:this.make_user_selector_list(r.users_to_add),users_to_remove:this.make_user_selector_list(r.users_to_remove)}},i={paper_enabled:e,paper_deployment_mode:s};return t&&(i.dropbox_terms="agree"),this.ns("team").rpc("paper/set_paper_policy",i,{subjectUserId:this.userId})},t.prototype.setPaperSharingPolicy=function(e,t){void 0===e&&(e=!0);var n={external_sharing_allowed:void 0===e||e,default_visibility:t};return this.ns("team").rpc("paper/set_paper_sharing_policy",n,{subjectUserId:this.userId})},t.prototype.setRequestMembershipPolicy=function(e){return this.ns("team").rpc("set_request_membership_policy",{request_membership:e},{subjectUserId:this.userId})},t.prototype.setSuggestMembersPolicy=function(e){return this.ns("team").rpc("set_suggest_members_policy",{suggest_members_enabled:e},{subjectUserId:this.userId})},t.prototype.deviceManagementGetExcludedUsers=function(){return this.ns("team").rpc("device_management/get_excluded_users",void 0,{subjectUserId:this.userId})},t.prototype.deviceManagementConfigureSettings=function(e){return this.ns("team").rpc("device_management/configure_settings",e,{subjectUserId:this.userId})},t.mapValueToRolloutMethod=function(e){return 0===e?"unlink_all":1===e?"unlink_most_inactive":"add_member_to_exceptions"},t.prototype.deviceManagementConfigureSettingsForAcf=function(e,n,r,s,i){var o={is_enabled:!0,can_user_remove_device:n,rollout_method:{".tag":t.mapValueToRolloutMethod(i)},users_to_add:e.users_to_add,users_to_remove:e.users_to_remove,desktop_devices_limit:r===-1?{".tag":"unlimited"}:{limited:Number(r),".tag":"limited"},mobile_devices_limit:s===-1?{".tag":"unlimited"}:{limited:Number(s),".tag":"limited"}};return this.ns("team").rpc("device_management/configure_settings",o,{subjectUserId:this.userId})},t.prototype.deviceManagementConfigureSettingsDisable=function(){return this.ns("team").rpc("device_management/configure_settings",{is_enabled:!1},{subjectUserId:this.userId})},t.prototype.deviceManagementRemoveDevice=function(e,t,n){return this.ns("team").rpc("device_management/remove_device",{user_id:e,device_id:t,delete_data:n},{subjectUserId:this.userId})},t.prototype.deviceManagementRemoveClient=function(e,t,n,r){return this.ns("team").rpc("device_management/remove_client",{user_id:e,device_id:t,client_unique_identifier:n,delete_data:r},{subjectUserId:this.userId})},t.prototype.webSessionManagementConfigureSettings=function(e,t){
return this.ns("team").rpc("web_session_management/configure_settings",{remember_session_expires:e,idle_session_timeout:t},{subjectUserId:this.userId})},t.prototype.teamFolderArchive=function(e,t){return void 0===t&&(t=!1),this.ns("team").rpc("team_folder/archive",{team_folder_id:String(e),force_async_off:!t},{subjectUserId:this.userId})},t.prototype.teamFolderUnarchive=function(e){return this.ns("team").rpc("team_folder/activate",{team_folder_id:String(e)},{subjectUserId:this.userId})},t.prototype.teamFolderCreate=function(e,t){var n={name:e};return void 0!==t&&(n.sync_setting=t?{".tag":"default"}:{".tag":"not_synced"}),this.ns("team").rpc("team_folder/create",n,{subjectUserId:this.userId})},t.prototype.teamFolderUpdateSyncSetting=function(e){var t=e.teamFolderId,n=e.shouldSync,r=e.fileIds,s={team_folder_id:t},i=n?{".tag":"default"}:{".tag":"not_synced"};return r?s.content_sync_settings=r.map(function(e){return{id:e,sync_setting:i}}):s.sync_setting=i,this.ns("team").rpc("team_folder/update_sync_settings",s,{subjectUserId:this.userId})},t.prototype.teamFoldersList=function(e){return void 0===e&&(e=1e3),this.ns("team").rpc("team_folder/list",{limit:e},{subjectUserId:this.userId})},t.prototype.teamFolderRename=function(e,t){return this.ns("team").rpc("team_folder/rename",{team_folder_id:String(e),name:t},{subjectUserId:this.userId})},t.prototype.teamFolderPermanentlyDelete=function(e){return this.ns("team").rpc("team_folder/permanently_delete",{team_folder_id:String(e)},{subjectUserId:this.userId})},t.prototype.setGroupsCreationPolicy=function(e){return this.ns("team").rpc("groups/set_creation_policy",{group_creation:e},{subjectUserId:this.userId})},t.prototype.setNTSBlockTrafficPolicy=function(e){return this.ns("team").rpc("nts/set_block_traffic_policy",{block_traffic_enabled:e},{subjectUserId:this.userId})},t.prototype.configureSsoAndGoogleLoginPolicy=function(e,t,n,r,s,i){return this.ns("team").rpc("configure_sso_and_google_login_policy",{sso_policy:e,sign_in_url:t,sign_out_url:n,saml_cert:r,saml_nameid_format:s,google_login_enabled:i},{subjectUserId:this.userId})},t.prototype.configureSso=function(e,t,n,r,s){return this.ns("team").rpc("configure_sso",{sso_policy:e,saml_cert:t,sign_in_url:n,sign_out_url:r,nameid_format:s},{subjectUserId:this.userId})},t.prototype.configureDirectoryRestrictions=function(e){var t={users_to_add:e.users_to_add,users_to_remove:e.users_to_remove};return this.ns("team").rpc("directory_restrictions/configure_settings",t,{subjectUserId:this.userId})},t.prototype.configureGoogleLoginPolicy=function(e){return this.ns("team").rpc("configure_google_login_policy",{google_login_enabled:e},{subjectUserId:this.userId})},t.prototype.setResellerSupportSetting=function(e){return this.ns("team").rpc("change_reseller_support",{reseller_support_enabled:e},{subjectUserId:this.userId})},t.prototype.folderCreate=function(e,t,n){"/"!==t&&(t+="/");var r="ns:"+e+t+n;return this.ns("files").rpc("create_folder",{path:r},{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.bulkFileDelete=function(e){for(var t=[],n=null,r=0,s=e.length;r<s;r++)n=e[r],t.push({path:"ns:"+n.ns_id+n.ns_path});return this.ns("files").rpc("delete_batch_with_changeset_sync",{entries:t},{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.fileRename=function(e,t,n){var r="ns:"+e+t,s=t.substring(0,t.lastIndexOf("/"))+"/"+n,i="ns:"+e+s;return this.ns("files").rpc("move",{from_path:r,to_path:i,autorename:!0},{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.shareFolder=function(e,t,r,s){void 0===r&&(r=null),void 0===s&&(s=!1);var o="ns:"+e+t,a=n.__assign({},i.combinedPolicyDiffToApi(r),{confidentiality:s?"confidential":"not_confidential",path:o});return this.ns("sharing").rpc("alpha/share_folder",a,{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.validateFolderPath=function(e,t,n,r){var s="ns:"+e+t;return this.ns("sharing").rpc("validate_folder_path",{path:s,actions:n,list_members_arg:r},{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.restoreFile=function(e,t,n){var r="ns:"+e+t;return this.ns("files").rpc("restore",{path:r,rev:n},{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.restorePaths=function(e){for(var t,n=[],r=0,s=e;r<s.length;r++){var i=s[r];t="ns:"+i.ns_id+i.ns_path,n.push(t)}return this.ns("files").rpc("restore_path_batch_sync",{entries:n},{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.permanentDeleteFile=function(e,t){var n="ns:"+e+t;return this.ns("files").rpc("permanently_delete",{path:n},{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.listRevisions=function(e,t){var n="ns:"+e+t;return this.ns("files").rpc("list_revisions",{path:n},{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.setTSDWritePolicy=function(e){return this.ns("team").rpc("team_folder/set_tsd_writable_setting",{is_writable:e},{subjectUserId:this.userId})},t.prototype.setInfinitePolicy=function(e){return this.ns("team").rpc("set_infinite_policy",{setting:e},{subjectUserId:this.userId})},t.prototype.setSmartSyncDesktopPolicy=function(e){return this.ns("team").rpc("set_smart_sync_desktop_policy",{setting:e},{subjectUserId:this.userId})},t.prototype.getTeamFolderNsPathForFile=function(e){return this.isCMForCDM?e.fq_path:"/"+e.fq_path.split("/").slice(2).join("/")},t.prototype.bulkFileMove=function(e,t,n){for(var r,i,o=[],a=0,l=t;a<l.length;a++){var c=l[a];i=this.getTeamFolderNsPathForFile(c),r=s.filename(c.fq_path),o.push({from_path:"ns:"+e+i,to_path:"ns:"+e+n+"/"+r})}return this.ns("files").rpc("move_batch_sync",{entries:o,autorename:!0},{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.bulkFileCopy=function(e,t,n,r){void 0===r&&(r=null);for(var i,o,a=[],l=0,c=t;l<c.length;l++){var d=c[l];o=this.getTeamFolderNsPathForFile(d),i=s.filename(d.fq_path),a.push({from_path:"ns:"+e+o,to_path:"ns:"+e+n+"/"+i})}return this.ns("files").rpc("copy_batch_sync",{entries:a,autorename:!0,allow_shared_folder:!0,fsw_request:r},{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.setMemberSpaceLimits=function(e){return this.ns("team").rpc("member_space_limits/set_default_limit",{limit_level:e},{subjectUserId:this.userId})},t.prototype.setMslCapsType=function(e){return this.ns("team").rpc("member_space_limits/set_caps_type",{caps_type:e},{subjectUserId:this.userId})},t.prototype.setCustomQuota=function(e,t){return this.ns("team").rpc("member_space_limits/set_custom_quota",{users_and_quotas:[{user:this._create_user_selector_json(e),quota_gb:t}]},{subjectUserId:this.userId})},t.prototype.removeCustomQuota=function(e){return this.ns("team").rpc("member_space_limits/remove_custom_quota",{users:[this._create_user_selector_json(e)]},{subjectUserId:this.userId})},t.prototype._create_user_selector_json=function(e){return{".tag":"email",email:e}},t.prototype.make_user_selector_list=function(e){return void 0===e&&(e=[]),e.map(this._create_user_selector_json)},t.prototype.memberSpaceLimitsUpdateExclusionList=function(e){var t=this.make_user_selector_list(e.users_to_add),n=this.make_user_selector_list(e.users_to_remove);return this.ns("team").rpc("member_space_limits/update_excluded_users",{users_to_add:t,users_to_remove:n},{subjectUserId:this.userId})},t.prototype.getUserInfos=function(e){return this.ns("users").rpc("get_account_batch",{account_ids:e},{subjectUserId:this.userId,headers:this._adminHeaders()})},t.prototype.emmConfigureSettings=function(e,t){var n={users_to_add:this.make_user_selector_list(t.users_to_add),users_to_remove:this.make_user_selector_list(t.users_to_remove)};return this.ns("team").rpc("emm/configure_settings",{emm_policy:{".tag":e},exclusion_list:n},{subjectUserId:this.userId})},t.prototype.emmRefreshToken=function(){return this.ns("team").rpc("emm/refresh_token",void 0,{subjectUserId:this.userId})},t.prototype.emmGenerateUsageReport=function(){return this.ns("team").rpc("emm/generate_report",{report_type:{".tag":"mobile_app_usage"}},{subjectUserId:this.userId})},t})(r.TeamActionsClient);t.AdminConsoleApiClient=a,t.default=a}),define("modules/clean/teams/membership_discovery_util",["require","exports","modules/clean/ajax","modules/clean/loggers/growth_features_events_logger","modules/clean/react/modal","modules/constants/trademark","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,r,s,i,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=function(e,t){return n.WebRequest({url:"/team/discover/get_discoverable_team_for_folder",type:"POST",data:{ns_id:e},success:function(e){return e=JSON.parse(e),t(null!=e?e.team:void 0)},error:function(){return t()}})};t.getDiscoverableTeamForFolder=d;var u=function(e,t){return n.WebRequest({url:"/team/discover/join_ajax",data:{team_id:e,cont:"#"},success:function(e){switch(e=JSON.parse(e),null!=e?e.result:void 0){case"request_sent":l.success(a._("Request to join sent."));break;case"can_join":o.redirect(e.url);break;case"max_team_size_achieved":l.error(a._("This team has reached the maximum size. Please ask the admins of this team to upgrade to %(trademark_business)s, which allows teams to add as many members as possible.").format({trademark_business:i.TRADEMARK_BUSINESS}));break;case"pending_approval":l.success(a._("Your request to join is pending."));break;default:l.error(a._("Invalid request"))}return"function"==typeof t?t(e):void 0},error:function(){return l.error(a._("Error sending request.")),"function"==typeof t?t():void 0}})};t.sendTeamRequest=u;var p=function(e,t,r){return n.WebRequest({url:"/account/team/add_users",subject_user:t,data:{emails:e,team_id:r},success:function(e){if(e=JSON.parse(e),e.num_invited){var t=a.ungettext("Invitation sent.","Invitations sent.",e.num_invited);return l.success(t)}},error:function(){var t=a.ungettext("Error sending invitation.","Error sending invitations.",e.length);return l.error(t)}})};t.sendLimitedTeamInvitations=p;var h=function(e,t,i,d){return n.WebRequest({url:"/account/team/add_users",subject_user:t,data:{emails:e,team_id:i},success:function(n){var s={subject_user_id:t.id,team_id:i,num_suggested_users:e.length};if(r.logMagnetEvent("send_admin_invite_ajax_success",s),n=JSON.parse(n),n.num_invited){var o=a.ungettext("Invitation sent.","Invitations sent.",n.num_invited);return l.success(o)}},error:function(n){var l={subject_user_id:t.id,team_id:i,num_suggested_users:e.length,response_text:n.responseText};return r.logMagnetEvent("send_admin_invite_ajax_fail",l),n.responseText.includes("You need an additional license to invite this user.")?s.SimpleModal.show({title_text:a._("No available licenses"),body_html:a._("You don’t have enough available licenses to invite additional members. Please visit the admin console to purchase more licenses."),confirm_text:a._("Go to admin console"),confirm_callback:function(){return l={team_id:i,ui_object:"not_enough_licenses_modal"},r.logMagnetEvent("go_to_admin_console_clicked",l),o.redirect(new c({path:"/team/admin/members"}))},cancel_text:a._("Not now"),cancel_callback:function(){return l={team_id:i,ui_object:"not_enough_licenses_modal"},r.logMagnetEvent("not_now_clicked",l)}}):m(e,d,function(){return o.redirect(new c({path:"/team/admin/requests",query:{invite_emails:e}}))})}})};t.sendAdminTeamInvitations=h;var m=function(e,t,r,s){return n.WebRequest({url:"/team/discover/suggest_ajax",data:{emails:JSON.stringify(e),ns_id:JSON.stringify(t)},success:function(t){var n=a.ungettext("Suggestion sent.","Suggestions sent.",e.length);return l.success(n),"function"==typeof r?r(t):void 0},error:function(){var t=a.ungettext("Error sending suggestion.","Error sending suggestions.",e.length);return l.error(t),"function"==typeof s?s():void 0}})};t.sendTeamSuggestions=m;var _=function(e,t,r){return n.WebRequest({url:"/team/discover/filter_suggestable_ajax",type:"POST",data:{emails:JSON.stringify(e)},success:function(e){return e=JSON.parse(e),"function"==typeof t?t(e):void 0},error:function(){return"function"==typeof r?r():void 0}})};t.filterSuggestableUsers=_}),define("modules/clean/teams/modals/create_team_prompt_modal",["require","exports","tslib","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/react/button","modules/clean/react/image","modules/clean/react/modal","modules/clean/static_urls","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,r,s,i,o,a,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h;(function(e){e[e.CLICK_CREATE=0]="CLICK_CREATE",e[e.DISMISS=1]="DISMISS",e[e.CLICK_NEXT_TIME=2]="CLICK_NEXT_TIME"})(h||(h={}));var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClickCreate=function(){var e=t.props.invitedMembers.map(function(e){return e.email}).filter(function(e){return"string"==typeof e&&""!==e}),n=new p({path:"/team",query:{tk:"tib_upsell",invite_members:e.join(",")}});d.redirect(n.toString()),t.logClick(h.CLICK_CREATE)},t.onClickNextTime=function(){l.Modal.close(),t.logClick(h.CLICK_NEXT_TIME)},t.onDismiss=function(){s.WebRequest({url:"/team/stop_show_create_team_modal"}),t.logClick(h.DISMISS)},t}return n.__extends(t,e),t.prototype.logClick=function(e){i.TeamsWebActionsLogger.log("share_crt_team_modal",{num_shared:this.props.invitedMembers.length,clicked_create:e===h.CLICK_CREATE,clicked_nxt_time:e===h.CLICK_NEXT_TIME,dismissed:e===h.DISMISS})},t.prototype.renderButtons=function(){return r.createElement("div",{className:"db-modal-buttons"},r.createElement(o.Button,{className:"dbmodal-button",importance:"primary",onClick:this.onClickCreate},u._("Create free work Dropbox")),r.createElement(o.Button,{className:"dbmodal-button",importance:"tertiary",onClick:this.onClickNextTime},u._("Ask me next time")))},t.prototype.render=function(){for(var e=[],t=0,n=this.props.invitedMembers;t<n.length;t++){var s=n[t];s.name&&s.name!==s.email&&e.push(s.name)}var i=u._("Work with these people often?");return 2===e.length&&2===this.props.invitedMembers.length?i=u._("Work with %(firstname_1)s and %(firstname_2)s often?").format({firstname_1:e[0],firstname_2:e[1]}):3===e.length&&3===this.props.invitedMembers.length&&(i=u._("Work with %(firstname_1)s, %(firstname_2)s, and %(firstname_3)s often?").format({firstname_1:e[0],firstname_2:e[1],firstname_3:e[2]})),r.createElement(l.Modal,{style:"clean",className:"create-team-modal-after-sharing",buttonComponent:this.renderButtons(),onDismiss:this.onDismiss,clickOutToClose:!1,showX:!0,width:500},r.createElement("div",null,r.createElement(a.Image,{className:"create-team-modal__team-illo u-mar-top-l",alt:u._("Work together"),src:c.static_url("/static/images/teams/modals/illo_how-create-vfl99WbqQ.png"),srcHiRes:c.static_url("/static/images/teams/modals/illo_how-create@2x-vflvsB25f.png")}),r.createElement("h1",{className:"create-team-modal__header u-mar-top-m u-mar-bottom-s"},i),r.createElement("div",{className:"create-team-modal__subheader"},u._("Get a free 2 GB work Dropbox to organize projects in one place,               collaborate from anywhere, and stay in sync."))))},t})(r.Component);t.CreateTeamPromptModal=m}),define("modules/clean/tokenizer",["require","exports","tslib","external/classnames","external/create-react-class","external/react","external/react-dom","external/lodash","jquery","modules/clean/keycode","modules/clean/typeahead"],function(e,t,n,r,s,i,o,a,l,c,d){"use strict";function u(e,t,n){return void 0!==e&&null!==e&&"function"==typeof e[t]?n(e,t):void 0}function p(e,t){return void 0!==e&&null!==e?t(e):void 0}function h(e,t,n){for(var r=[],s=e<t,i=n?s?t+1:t-1:t,o=e;s?o<i:o>i;s?o++:o--)r.push(o);return r}Object.defineProperty(t,"__esModule",{value:!0});var m=i.DOM,_=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._makeCloseButton=function(){return t.props.onRemove?m.span({className:"tokenizer-token-close",onClick:function(){return t.props.onRemove(),!1},dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""},t}return n.__extends(t,e),t.prototype.render=function(){var e={"tokenizer-token":!0};return e[this.props.className]=!0,m.a(l.extend({tabIndex:-1},this.props,{className:r(e)}),String(this.props.data),this._makeCloseButton())},t.displayName="Token",t.propTypes={className:i.PropTypes.string,data:i.PropTypes.any,onRemove:i.PropTypes.func},t})(i.Component);t.Token=_;var f=s({displayName:"Tokenizer",propTypes:{customClass:i.PropTypes.string,dataSource:i.PropTypes.object.isRequired,initialInputText:i.PropTypes.string,logSearchBegin:i.PropTypes.func,logSearchComplete:i.PropTypes.func,logTokenChangeEvent:i.PropTypes.func,onContentsChange:i.PropTypes.func,onTokensAdd:i.PropTypes.func,onTokenRemove:i.PropTypes.func,placeholderText:i.PropTypes.string,populatedTokenData:i.PropTypes.array,renderToken:i.PropTypes.func.isRequired,renderTokenHover:i.PropTypes.func,renderInput:i.PropTypes.func.isRequired,renderSelector:i.PropTypes.func.isRequired,stringTokenizer:i.PropTypes.func.isRequired,tokenSpacing:i.PropTypes.number,focusOnMount:i.PropTypes.bool,tabIndex:i.PropTypes.number,disableAdditionalInput:i.PropTypes.bool,disabled:i.PropTypes.bool},getDefaultProps:function(){return{initialInputText:"",renderInput:function(){return m.input()},renderSelector:function(){return i.createElement(d.TypeaheadSelector,null)},renderToken:function(e){return i.createElement(_,{data:e})},stringTokenizer:function(e,t){var n=e.split(",");return{tokens:n,value:t?"":n.pop()}},tokenSpacing:3,focusOnMount:!1,logSearchBegin:null,logSearchComplete:null,disableAdditionalInput:!1,disabled:!1}},getInitialState:function(){return this.tokenData=[],this.queryResults=null,{queryResults:this.queryResults,tokenData:this.tokenData,selectedTokenIndex:null,inputWidth:150,numLines:1}},componentDidMount:function(){if(setTimeout(this._resizeTokenizerInput,0),o.findDOMNode(this.refs.input).value=this.props.initialInputText,l(o.findDOMNode(this.refs.tokenizer_input)).on("keydown",this._proxyKeys),document.addEventListener("click",this._handleDocumentClick,!1),this.props.focusOnMount&&o.findDOMNode(this.refs.input).focus(),"function"==typeof this.props.dataSource.registerForUpdates&&this.props.dataSource.registerForUpdates(this._dataUpdatedCallback),(null!=this.props.populatedTokenData?this.props.populatedTokenData.length:void 0)>0)return this._addTokens(this.props.populatedTokenData,!1,null)},componentWillUnmount:function(){return l(o.findDOMNode(this.refs.tokenizer_input)).off("keydown",this._proxyKeys),document.removeEventListener("click",this._handleDocumentClick,!1)},componentDidUpdate:function(e,t){return(null!=this.props.populatedTokenData?this.props.populatedTokenData.length:void 0)!==(null!=e.populatedTokenData?e.populatedTokenData.length:void 0)&&this._addTokens(this.props.populatedTokenData,!1,null),this._resizeTokenizerInput()},render:function(){var e={"react-tokenizer":!0};null!=this.props.customClass&&(e[this.props.customClass]=null!=this.props.customClass);var t={padding:this.props.tokenSpacing,paddingRight:0,maxHeight:this.props.tokenSpacing+3*(this.props.tokenSpacing+29)+14+2},n=r({"tokenizer-input":!0,"tokenizer-input-disabled":this.props.disabled,"tokenizer-input-additionalInputDisabled":this.props.disableAdditionalInput});return this.state.numLines>3&&(t.overflowY="auto",t.overflowX="visible"),m.div({onClick:this._handleMyClick,className:r(e)},m.div({className:n,ref:"tokenizer_input",style:t},m.div({className:"token-container",style:{marginLeft:-this.props.tokenSpacing,marginBottom:-this.props.tokenSpacing}},this._renderTokens(),this._renderInput())),this._renderSelector())},serializeInputData:function(){return{tokens:this.tokenData,value:o.findDOMNode(this.refs.input).value}},tokenizeAll:function(){var e=o.findDOMNode(this.refs.input),t=this.props.stringTokenizer(e.value,!0).tokens;return t.length>0&&this._addTokens(t,!1),e.value="",this.refs.selector.close()},addExternalTokens:function(e){this._addTokens(e,!1,null),this.refs.selector.close()},_getCurrentValue:function(){var e=o.findDOMNode(this.refs.input);return this.props.stringTokenizer(e.value).value},queryDataSource:function(e){var t=this,n=function(n){var r;e||(n=null);var s=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},i=a.map(t.tokenData,s);return n=null!=n?n.filter(function(e){return r=s(e),!Array.from(i).includes(r)}):null},r=function(r){return r=n(r),t.queryResults=r,t.setState({queryResults:t.queryResults}),"function"==typeof t.props.logSearchComplete?t.props.logSearchComplete(e,(null!=r?r.length:void 0)||0,!0):void 0},s=function(r){return e===t._getCurrentValue()&&(r=n(r),r&&r.length&&(t.queryResults=t.queryResults?t.queryResults.concat(r):r,t.setState({queryResults:t.queryResults}))),"function"==typeof t.props.logSearchComplete?t.props.logSearchComplete(e,(null!=r?r.length:void 0)||0,!1):void 0};return this.props.dataSource.query(e,r,s)},_dataUpdatedCallback:function(){if(this.isMounted()){var e=Boolean(this.state.queryResults);return u(this.refs.selector,"reset",function(e){return e.reset()}),e&&o.findDOMNode(this.refs.input).focus(),this.queryDataSource(o.findDOMNode(this.refs.input).value)}},_addTokens:function(e,t,n){var r=this;void 0===t&&(t=!1),void 0===n&&(n=null);for(var s=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},i=a.map(this.tokenData,s),l=[],c=0,d=Array.from(e);c<d.length;c++){var u=d[c],h=s(u);Array.from(i).includes(h)||(l.push(u),i.push(h))}this.tokenData=this.tokenData.concat(l),this.setState({tokenData:this.tokenData}),"function"==typeof this.props.onTokensAdd&&this.props.onTokensAdd(l,this),"function"==typeof this.props.onContentsChange&&this.props.onContentsChange(this.tokenData,p(o.findDOMNode(this.refs.input),function(e){return e.value}));var m=t?{search_expr:n,selected_pos:(null!=this.refs.selector?this.refs.selector.state.selectionIndex:void 0)||0,num_query_results:null!=this.state.queryResults?this.state.queryResults.length:void 0,did_select_suggestion:!0}:{did_select_suggestion:!1};return(function(){for(var e=[],t=0,n=Array.from(l);t<n.length;t++)u=n[t],e.push("function"==typeof r.props.logTokenChangeEvent?r.props.logTokenChangeEvent(u,!1,m):void 0);return e})()},_addToken:function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=null),this._addTokens([e],t,n)},removeTokens:function(e){for(var t=this.state.selectedTokenIndex,n=[],r=0,s=Array.from(e);r<s.length;r++){var i=s[r],a=this.tokenData.indexOf(i);a!==-1&&(t===a?t=null:t>a&&(t-=1),this.tokenData.splice(a,1),n.push(i))}var l=o.findDOMNode(this.refs.input);l.focus(),this._setSelectedToken(t),this.queryResults=null,this.setState({tokenData:this.tokenData,queryResults:this.queryResults});for(var c=0,d=Array.from(n);c<d.length;c++)i=d[c],"function"==typeof this.props.onTokenRemove&&this.props.onTokenRemove(i);for(var u=0,p=Array.from(n);u<p.length;u++)i=p[u],"function"==typeof this.props.logTokenChangeEvent&&this.props.logTokenChangeEvent(i,!0);return"function"==typeof this.props.onContentsChange?this.props.onContentsChange(this.tokenData,l.value):void 0},removeToken:function(e){return this.removeTokens([e])},replaceTokens:function(e){var t=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},n=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Array.from(e[0]),s=r[0],i=r[1];return t(s)===t(i)};if(e.length!==this.tokenData.length||!a.every(a.zip(this.tokenData,e),n))return this.tokenData=e,this.setState({tokenData:e}),"function"==typeof this.props.onContentsChange?this.props.onContentsChange(this.tokenData,p(o.findDOMNode(this.refs.input),function(e){return e.value})):void 0},_renderTokens:function(){for(var e=[],t=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},n=0;n<this.state.tokenData.length;n++){var s=this.state.tokenData[n],o=this.props.renderToken(s),a=this.state.selectedTokenIndex===n,l="function"==typeof this.props.renderTokenHover?this.props.renderTokenHover(s):void 0,c=[{selected:a,"c-title-bubble":null!=l,"c-title-bubble--s":null!=l}];e.push(i.cloneElement(o,{ref:"token"+n,key:"token"+t(s),style:{margin:"0 0 "+this.props.tokenSpacing+"px "+this.props.tokenSpacing+"px"},className:r(c,o.props.className),"data-title":l,onClick:this._setSelectedToken.bind(this,n),onRemove:this.removeToken.bind(this,s),tokenSpacing:this.props.tokenSpacing}))}return e},_renderSelector:function(){return i.cloneElement(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._onSelect,onClose:this._clearResults})},_renderInput:function(){var e=this.state.tokenData.length?"":this.props.placeholderText;return i.cloneElement(this.props.renderInput(),{ref:"input",style:{width:this.state.inputWidth,marginLeft:this.props.tokenSpacing,marginBottom:this.props.tokenSpacing},onChange:this._textUpdated,placeholder:e,tabIndex:this.props.tabIndex,onClick:this._setSelectedToken.bind(this,null),disabled:this.props.disabled||this.props.disableAdditionalInput})},_getTokenizerInput:function(){return this.refs.tokenizer_input},_getTokenComponents:function(){var e=this;return h(0,this.state.tokenData.length,!1).map(function(t){return e.refs["token"+t]}).filter(function(e){return e})},_setSelectedToken:function(e){return null!=e?(o.findDOMNode(this.refs["token"+e]).focus(),this.refs.selector.close()):o.findDOMNode(this.refs.input).focus(),this.setState({selectedTokenIndex:e})},_resizeTokenizerInput:function(){var e=function(e){return p(o.findDOMNode(e),function(e){return e.clientWidth})},t=this._getTokenizerInput(),n=e(t);if(null!=n){for(var r=this.props.tokenSpacing+2,s=this.props.tokenSpacing,i=0,a=this._getTokenComponents(),l=1,c=0,d=Array.from(a);c<d.length;c++){var u=d[c],h=e(u)+r;i+h+s>n&&(l+=1,i=0),i+=h}var m=n-i-s-2;return m<80&&(l+=1,m=n-s),m!==this.state.inputWidth&&this.setState({inputWidth:m}),l!==this.state.numLines?this.setState({numLines:l}):void 0}},_onSelect:function(e){var t=o.findDOMNode(this.refs.input);return t.focus(),this._addToken(e,!0,t.value),t.value="",this.queryResults=null,this.setState({queryResults:this.queryResults})},_handleMyClick:function(e){return"function"==typeof e.nativeEvent.stopImmediatePropagation?e.nativeEvent.stopImmediatePropagation():void 0},_handleDocumentClick:function(e){return this.refs.selector.close()},_proxyKeys:function(e){if(e.keyCode===c.KeyCode.BACKSPACE&&""===this._getCurrentValue()&&e.preventDefault(),this._shouldListenForTokenNavigation()){var t=this.state.selectedTokenIndex;switch(e.keyCode){case c.KeyCode.BACKSPACE:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):this.removeToken(this.state.tokenData[t]));case c.KeyCode.LEFT:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):t>0&&this._setSelectedToken(t-1));case c.KeyCode.RIGHT:if(null!==t)return void(t>=this.state.tokenData.length-1?this._setSelectedToken(null):this._setSelectedToken(t+1));break;case c.KeyCode.DELETE:if(null!==t)return void this.removeToken(this.state.tokenData[t])}}if(this.refs.selector.onKeyDown(e),!e.isDefaultPrevented())return e.keyCode===c.KeyCode.TAB&&""!==o.findDOMNode(this.refs.input).value?(this.tokenizeAll(),e.preventDefault()):void 0},_shouldListenForTokenNavigation:function(){if(!this.state.tokenData.length)return!1;var e=o.findDOMNode(this.refs.input);return 0===e.selectionStart&&0===e.selectionEnd},_textUpdated:function(){var e=o.findDOMNode(this.refs.input),t=e.value,n=this.props.stringTokenizer(t),r=n.tokens,s=n.value;return"function"==typeof this.props.logSearchBegin&&this.props.logSearchBegin(s),s!==t&&(e.value=s,s||this.refs.selector.close()),r.length>0?this._addTokens(r,!1):"function"==typeof this.props.onContentsChange&&this.props.onContentsChange(this.tokenData,s),this.queryDataSource(s)},_clearResults:function(){return this.queryResults=null,this.setState({queryResults:this.queryResults})}});t.Tokenizer=f}),define("modules/clean/typeahead",["require","exports","tslib","external/classnames","external/create-react-class","external/react","external/react-dom","external/lodash","modules/clean/fuzzy","modules/clean/keycode"],function(e,t,n,r,s,i,o,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=i.DOM,u=(function(){function e(e){var t=(void 0===e?{}:e).local;this.local=t}return e.prototype.filterAndSort=function(e){return l.filter(e,this.local)},e.prototype.query=function(e,t){return t(a.map(this.filterAndSort(e),function(e){return e.original}))},e})();t.DataSource=u;var p={getInitialState:function(){return{selectionIndex:0}},getOptions:function(){if(!this.props.queryOptions)return[];var e=this.props.maxVisible||this.props.queryOptions.length;return this.props.queryOptions.slice(0,e)},renderOptions:function(){for(var e=[],t=this.getOptions(),n=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},s=0;s<t.length;s++){var o=t[s],a={selected:this.state.selectionIndex===s,"typeahead-option":!0,"u-pad-xs":!0},l=this.renderOption(o);e.push(i.cloneElement(l,{className:r(a,l.props.className),key:"option"+n(o),onMouseEnter:this._hover.bind(this,s),onClick:this.onSelect.bind(this,o)}))}return e},onSelect:function(e){return this.props.onSelect(e),this.reset()},renderOption:function(e){return this.props.renderQueryOption(e)},onKeyDown:function(e){switch(e.keyCode){case c.KeyCode.UP:return this._navigate(-1),e.preventDefault();case c.KeyCode.DOWN:return this._navigate(1),e.preventDefault();case c.KeyCode.ENTER:return this._selectSelectionIndex(e);case c.KeyCode.ESC:if(Boolean(this.props.queryOptions))return this.close(),e.preventDefault();break;case c.KeyCode.TAB:return this._selectSelectionIndex(e);default:return this.reset()}},_selectSelectionIndex:function(e){var t=this.getOptions();if(t.length){var n=this.state.selectionIndex;if(n!==-1)return this.onSelect(t[n]),e.preventDefault()}},reset:function(){return this._changeSelectionIndex(0)},close:function(){return"function"==typeof this.props.onClose&&this.props.onClose(),this.reset()},_hover:function(e){return this._changeSelectionIndex(e)},_navigate:function(e){var t=this.getOptions().length;if(t){var n=this.state.selectionIndex+e,r=t+1;return n<-1?n+=r:n>=t&&(n-=r),this._changeSelectionIndex(n)}},_changeSelectionIndex:function(e){return e!==this.state.selectionIndex&&"function"==typeof this.onSelectionIndexChange&&this.onSelectionIndexChange(e),this.setState({selectionIndex:e})}};t.TypeaheadSelectorMixin=p;var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={queryResults:null,value:t.props.value,focus:!1},t._onMouseOver=function(){return t.setState({focus:!0})},t._onMouseLeave=function(){return t.setState({focus:!1})},t._onBlur=function(){if(t.props.onBlur(),!t.state.focus)return t._clearResults()},t._onFocus=function(){return t._queryDataSource(t.state.value),t.refs.selector.reset()},t._renderInput=function(){var e=t.props.renderInput();return i.cloneElement(e,{ref:"input",onChange:function(n){return null!=e.props.onChange&&e.props.onChange(n),t._inputChanged(n)},onKeyDown:function(n){return null!=e.props.onKeyDown&&e.props.onKeyDown(n),t._proxyKeys(n)},onBlur:function(n){return null!=e.props.onBlur&&e.props.onBlur(n),t._onBlur(n)},onFocus:function(n){return null!=e.props.onFocus&&e.props.onFocus(n),t._onFocus(n)},placeholder:t.props.placeholder,value:t.state.value,name:t.props.name,autoComplete:"off",disabled:t.props.disabled})},t._renderSelector=function(){return i.cloneElement(t.props.renderSelector(),{ref:"selector",queryOptions:t.state.queryResults,onSelect:t._autocomplete,onClose:t._clearResults,maxVisible:t.props.maxVisible})},t._inputChanged=function(e){var n=e.target.value;return t.setState({value:e.target.value}),t.props.onChange(n),t._queryDataSource(n),t.refs.selector.reset()},t._getCurrentValue=function(){return o.findDOMNode(t.refs.input).value},t._queryDataSource=function(e){var n=function(e){return t.queryResults=e,t.setState({queryResults:t.queryResults})
},r=function(r){if(e===t._getCurrentValue()&&r&&r.length){return n(t.queryResults?t.queryResults.concat(r):r)}};return t.props.dataSource.query(e,n,r)},t._proxyKeys=function(e){return t.refs.selector.onKeyDown(e)},t._autocomplete=function(e){return o.findDOMNode(t.refs.input).focus(),e=t.props.renderCompletionText(e),t.setState({value:e}),t.props.onSelect(e),t._clearResults()},t._clearResults=function(){return t.queryResults=null,t.setState({queryResults:t.queryResults})},t}return n.__extends(t,e),t.prototype.render=function(){var e={};return e[this.props.customClass]=null!=this.props.customClass,d.div({className:r(e),onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave},this._renderInput(),this._renderSelector())},t.prototype.componentWillReceiveProps=function(e){return this.setState({value:e.value})},t.displayName="Autocomplete",t.propTypes={customClass:i.PropTypes.string,maxVisible:i.PropTypes.number,dataSource:i.PropTypes.object.isRequired,onBlur:i.PropTypes.func,onSelect:i.PropTypes.func,onChange:i.PropTypes.func,placeholder:i.PropTypes.string,renderCompletionText:i.PropTypes.func.isRequired,renderInput:i.PropTypes.func.isRequired,renderSelector:i.PropTypes.func.isRequired,value:i.PropTypes.string,name:i.PropTypes.string,disabled:i.PropTypes.bool},t.defaultProps={value:"",maxVisible:7,onBlur:function(){},onSelect:function(e){},onChange:function(e){},renderCompletionText:function(e){return String(e)},renderInput:function(){return d.input()},renderSelector:function(){return i.createElement(m,null)},disabled:!1},t})(i.Component);t.Autocomplete=h;var m=s({displayName:"TypeaheadSelector",mixins:[p],propTypes:{customClass:i.PropTypes.string,maxVisible:i.PropTypes.number,onClose:i.PropTypes.func.isRequired,onSelect:i.PropTypes.func.isRequired,queryOptions:i.PropTypes.array,renderQueryOption:i.PropTypes.func.isRequired},getDefaultProps:function(){return{maxVisible:7,onClose:function(){},onSelect:function(e){},renderQueryOption:function(e){return d.li({},String(e))}}},render:function(){if(!this.getOptions().length)return d.div({});var e={"typeahead-selector":!0};return e[this.props.customClass]=null!=this.props.customClass,d.ul({className:r(e)},this.renderOptions())}});t.TypeaheadSelector=m}),define("modules/clean/zendesk_feedback",["require","exports","tslib","external/react","external/react-dom","jquery","modules/clean/ajax","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/select","modules/clean/sharing/views/hover_close_button","modules/core/i18n","modules/core/notify"],function(e,t,n,r,s,i,o,a,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=r.DOM,m=r.createElement,_=u.i18n_default_project("sharing")._,f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){return s.findDOMNode(this.refs.textbox).focus()},t.prototype.render=function(){var e=this;return m(l.Modal,{className:"zendesk-feedback-form",title:_("Send us your feedback"),acceptButtonDisabled:!this.state.message||this.state.isSending,acceptButtonText:_("Send feedback"),autoClose:!1,dismissButtonText:_("Cancel"),onAccept:function(){e.setState({isSending:!0});return b("truelink_feedback",{categoryTag:e.state.message},function(){return e.setState({isSending:!1})})}},h.label({htmlFor:"feedback-category"},_("Category")),m(c.input,{ref:"category",className:"u-mar-bottom-m feedback-category",id:"feedback-category",defaultValue:this.props.defaultCategory},m(c.option,{value:"sender"},_("I have feedback about sharing links with others")),m(c.option,{value:"receiver"},_("I have feedback about accessing links shared with me")),m(c.option,{value:"settings"},_("I have feedback about changing sharing settings")),m(c.option,{value:"general"},_("I have general feedback")),m(c.option,{value:"bug"},_("I found a bug"))),h.label({htmlFor:"feedback-content"},_("What is your feedback?")),h.textarea({className:"zendesk-feedback-form__textbox",id:"feedback-content",onChange:function(t){return e.setState({message:t.target.value})},ref:"textbox"}))},t.displayName="OpenFeedbackForm",t.propTypes={defaultCategory:r.PropTypes.string},t})(r.Component),g=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){return s.findDOMNode(this.refs.mainButton).focus()},t.prototype.render=function(){var e=this;return h.div({className:"zendesk-flyout"},h.div({className:"zendesk-flyout__header u-pad-left-l u-pad-bottom-m u-pad-top-m"},_("Have a moment?"),m(d,{className:"zendesk-flyout__x u-mar-right-m",onClick:function(){return"function"==typeof e.props.onCloseClick&&e.props.onCloseClick(),E()}})),h.div({className:"u-pad-left-l u-mar-bottom-m u-pad-top-m u-mar-right-m"},_("Help us make your Dropbox experience even better by sending us your feedback."),h.button({className:"c-btn c-btn--primary u-mar-top-m zendesk-flyout__main_button",onClick:function(){return E(),l.Modal.showInstance(m(v,e.props))},ref:"mainButton"},_("Give feedback"))))},t.displayName="FeedbackFlyout",t.propTypes={defaultCategory:r.PropTypes.string,onCloseClick:r.PropTypes.func},t})(r.Component),y=a(g,["/static/css/zendesk_feedback-vflr6Jf-t.css"]),v=a(f,["/static/css/zendesk_feedback-vflr6Jf-t.css"]),S=function(e){var t=function(){return o.BackgroundRequest({url:"/sharing/show_feedback_flyout",data:{dont_show_again:!0}})};return o.WebRequest({url:"/sharing/show_feedback_flyout",success:function(n){if(JSON.parse(n)){var r=i("<div />").attr({class:"zendesk-flyout-container"}).prependTo("body")[0];return s.render(m(y,{onCloseClick:t,defaultCategory:e}),r)}}})};t.showFeedbackFlyoutIfAllowed=S;var E=function(){return i(".zendesk-flyout-container").remove()},b=function(e,t,n){return o.WebRequest({url:"/log/file_collab_feedback",data:{feedback_tag:e,user_feedback:JSON.stringify(t)},success:function(){return p.success(_("Thanks for helping make Dropbox better!")),l.Modal.close()},error:n})}});
//# sourceMappingURL=pkg-sharing.min.js-vflCS3Kz2.map